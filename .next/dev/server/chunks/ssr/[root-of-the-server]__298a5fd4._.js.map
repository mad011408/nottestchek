{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/stripe.ts"],"sourcesContent":["import Stripe from \"stripe\";\n\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY as string, {\n  apiVersion: \"2025-11-17.clover\",\n});\n\nexport { stripe };\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,SAAS,IAAI,uPAAM,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAY;IACjE,YAAY;AACd"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/workos.ts"],"sourcesContent":["import { WorkOS } from \"@workos-inc/node\";\n\nconst workos = new WorkOS(process.env.WORKOS_API_KEY, {\n  clientId: process.env.WORKOS_CLIENT_ID,\n});\n\nexport { workos };\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,SAAS,IAAI,iXAAM,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;IACpD,UAAU,QAAQ,GAAG,CAAC,gBAAgB;AACxC"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/actions/billing-portal.ts"],"sourcesContent":["\"use server\";\n\nimport { redirect } from \"next/navigation\";\nimport { stripe } from \"../../app/api/stripe\";\nimport { workos } from \"@/app/api/workos\";\nimport { withAuth } from \"@workos-inc/authkit-nextjs\";\n\nexport default async function redirectToBillingPortal() {\n  const { organizationId, user } = await withAuth();\n\n  if (!user?.id) {\n    throw new Error(\"User not authenticated\");\n  }\n\n  if (!organizationId) {\n    throw new Error(\"No organization found\");\n  }\n\n  // Check if user is an admin of the organization (for team subscriptions)\n  const memberships = await workos.userManagement.listOrganizationMemberships({\n    userId: user.id,\n    organizationId,\n    statuses: [\"active\"],\n  });\n\n  const userMembership = memberships.data[0];\n  if (!userMembership) {\n    throw new Error(\"User is not a member of this organization\");\n  }\n\n  // Only admins can access billing portal for team subscriptions\n  if (userMembership.role?.slug !== \"admin\") {\n    throw new Error(\"Only admins can manage billing\");\n  }\n\n  const response = await fetch(\n    `${workos.baseURL}/organizations/${organizationId}`,\n    {\n      headers: {\n        Authorization: `Bearer ${process.env.WORKOS_API_KEY}`,\n        \"content-type\": \"application/json\",\n      },\n    },\n  );\n  if (!response.ok) {\n    throw new Error(\"Failed to fetch organization details\");\n  }\n  const workosOrg = await response.json();\n\n  if (!workosOrg?.stripe_customer_id) {\n    throw new Error(\"No billing account found for this organization\");\n  }\n\n  const baseUrl = process.env.NEXT_PUBLIC_BASE_URL;\n  const billingPortalSession = await stripe.billingPortal.sessions.create({\n    customer: workosOrg.stripe_customer_id,\n    return_url: `${baseUrl}`,\n  });\n\n  if (!billingPortalSession?.url) {\n    throw new Error(\"Failed to create billing portal session\");\n  }\n  redirect(billingPortalSession.url);\n}\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AACA;AACA;;;;;;;AAEe,eAAe;IAC5B,MAAM,EAAE,cAAc,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,uYAAQ;IAE/C,IAAI,CAAC,MAAM,IAAI;QACb,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,CAAC,gBAAgB;QACnB,MAAM,IAAI,MAAM;IAClB;IAEA,yEAAyE;IACzE,MAAM,cAAc,MAAM,8HAAM,CAAC,cAAc,CAAC,2BAA2B,CAAC;QAC1E,QAAQ,KAAK,EAAE;QACf;QACA,UAAU;YAAC;SAAS;IACtB;IAEA,MAAM,iBAAiB,YAAY,IAAI,CAAC,EAAE;IAC1C,IAAI,CAAC,gBAAgB;QACnB,MAAM,IAAI,MAAM;IAClB;IAEA,+DAA+D;IAC/D,IAAI,eAAe,IAAI,EAAE,SAAS,SAAS;QACzC,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,WAAW,MAAM,MACrB,GAAG,8HAAM,CAAC,OAAO,CAAC,eAAe,EAAE,gBAAgB,EACnD;QACE,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,QAAQ,GAAG,CAAC,cAAc,EAAE;YACrD,gBAAgB;QAClB;IACF;IAEF,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM;IAClB;IACA,MAAM,YAAY,MAAM,SAAS,IAAI;IAErC,IAAI,CAAC,WAAW,oBAAoB;QAClC,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,UAAU,QAAQ,GAAG,CAAC,oBAAoB;IAChD,MAAM,uBAAuB,MAAM,8HAAM,CAAC,aAAa,CAAC,QAAQ,CAAC,MAAM,CAAC;QACtE,UAAU,UAAU,kBAAkB;QACtC,YAAY,GAAG,SAAS;IAC1B;IAEA,IAAI,CAAC,sBAAsB,KAAK;QAC9B,MAAM,IAAI,MAAM;IAClB;IACA,IAAA,gZAAQ,EAAC,qBAAqB,GAAG;AACnC;;;IAxD8B;;AAAA,8bAAA"}}]
}