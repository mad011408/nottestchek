{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/SourcesDialog.tsx"],"sourcesContent":["import { Dialog, DialogContent, DialogTitle } from \"@/components/ui/dialog\";\nimport Image from \"next/image\";\n\ninterface Source {\n  title?: string;\n  url: string;\n  text?: string;\n  publishedDate?: string;\n}\n\ninterface SourcesDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  sources: Source[];\n}\n\nexport const SourcesDialog = ({\n  open,\n  onOpenChange,\n  sources,\n}: SourcesDialogProps) => {\n  const getFaviconUrl = (domain: string) => {\n    return `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;\n  };\n\n  const getDomain = (url: string) => {\n    try {\n      const u = new URL(url);\n      return u.hostname;\n    } catch {\n      // Fallback: try to extract hostname from string\n      const match = url.match(/^(?:https?:\\/\\/)?([^\\/]+)/);\n      return match ? match[1] : url;\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent\n        className=\"sm:max-w-3xl w-full\"\n        aria-describedby={undefined}\n      >\n        <div className=\"flex w-full flex-row items-center justify-between border-b px-1 pb-3\">\n          <DialogTitle>Citations</DialogTitle>\n        </div>\n        <div className=\"h-[60vh] max-h-[700px] w-full overflow-y-auto\">\n          <div className=\"flex w-full flex-col mt-0\">\n            <ul className=\"flex flex-col px-1 py-2\">\n              {sources.map((src, idx) => {\n                const domain = getDomain(src.url);\n                const displayHost = (() => {\n                  try {\n                    return new URL(src.url).hostname.replace(/^www\\./, \"\");\n                  } catch {\n                    return domain;\n                  }\n                })();\n                return (\n                  <li key={`link-${idx}`}>\n                    <a\n                      href={src.url}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"hover:bg-secondary flex flex-col gap-1 rounded-xl px-3 py-2.5\"\n                    >\n                      <div className=\"line-clamp-1 flex h-6 items-center gap-2 text-xs\">\n                        <Image\n                          alt=\"\"\n                          width={16}\n                          height={16}\n                          className=\"bg-background rounded-full object-cover w-4 h-4\"\n                          src={getFaviconUrl(domain)}\n                          unoptimized\n                        />\n                        {displayHost}\n                      </div>\n                      <div className=\"line-clamp-2 text-sm font-semibold break-words\">\n                        {src.title || src.url}\n                      </div>\n                      {src.text && (\n                        <div className=\"text-muted-foreground line-clamp-2 text-sm leading-snug font-normal\">\n                          <span>{src.text}</span>\n                        </div>\n                      )}\n                    </a>\n                  </li>\n                );\n              })}\n            </ul>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAeO,MAAM,gBAAgB,CAAC,EAC5B,IAAI,EACJ,YAAY,EACZ,OAAO,EACY;IACnB,MAAM,gBAAgB,CAAC;QACrB,OAAO,CAAC,0CAA0C,EAAE,OAAO,MAAM,CAAC;IACpE;IAEA,MAAM,YAAY,CAAC;QACjB,IAAI;YACF,MAAM,IAAI,IAAI,IAAI;YAClB,OAAO,EAAE,QAAQ;QACnB,EAAE,OAAM;YACN,gDAAgD;YAChD,MAAM,QAAQ,IAAI,KAAK,CAAC;YACxB,OAAO,QAAQ,KAAK,CAAC,EAAE,GAAG;QAC5B;IACF;IAEA,qBACE,6bAAC,qIAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,6bAAC,4IAAa;YACZ,WAAU;YACV,oBAAkB;;8BAElB,6bAAC;oBAAI,WAAU;8BACb,cAAA,6bAAC,0IAAW;kCAAC;;;;;;;;;;;8BAEf,6bAAC;oBAAI,WAAU;8BACb,cAAA,6bAAC;wBAAI,WAAU;kCACb,cAAA,6bAAC;4BAAG,WAAU;sCACX,QAAQ,GAAG,CAAC,CAAC,KAAK;gCACjB,MAAM,SAAS,UAAU,IAAI,GAAG;gCAChC,MAAM,cAAc,CAAC;oCACnB,IAAI;wCACF,OAAO,IAAI,IAAI,IAAI,GAAG,EAAE,QAAQ,CAAC,OAAO,CAAC,UAAU;oCACrD,EAAE,OAAM;wCACN,OAAO;oCACT;gCACF,CAAC;gCACD,qBACE,6bAAC;8CACC,cAAA,6bAAC;wCACC,MAAM,IAAI,GAAG;wCACb,QAAO;wCACP,KAAI;wCACJ,WAAU;;0DAEV,6bAAC;gDAAI,WAAU;;kEACb,6bAAC,uVAAK;wDACJ,KAAI;wDACJ,OAAO;wDACP,QAAQ;wDACR,WAAU;wDACV,KAAK,cAAc;wDACnB,WAAW;;;;;;oDAEZ;;;;;;;0DAEH,6bAAC;gDAAI,WAAU;0DACZ,IAAI,KAAK,IAAI,IAAI,GAAG;;;;;;4CAEtB,IAAI,IAAI,kBACP,6bAAC;gDAAI,WAAU;0DACb,cAAA,6bAAC;8DAAM,IAAI,IAAI;;;;;;;;;;;;;;;;;mCAvBd,CAAC,KAAK,EAAE,KAAK;;;;;4BA6B1B;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOd"}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/MessageActions.tsx"],"sourcesContent":["import {\n  Copy,\n  Check,\n  RotateCcw,\n  Pencil,\n  ThumbsUp,\n  ThumbsDown,\n  Split,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport Image from \"next/image\";\nimport type { ChatStatus } from \"@/types\";\nimport { WithTooltip } from \"@/components/ui/with-tooltip\";\nimport { Button } from \"@/components/ui/button\";\nimport { SourcesDialog } from \"./SourcesDialog\";\n\ninterface MessageActionsProps {\n  messageText: string;\n  isUser: boolean;\n  isLastAssistantMessage: boolean;\n  canRegenerate: boolean;\n  onRegenerate: () => void;\n  onEdit: () => void;\n  onBranch?: () => void;\n  isHovered: boolean;\n  isEditing: boolean;\n  status: ChatStatus;\n  onFeedback?: (type: \"positive\" | \"negative\") => void;\n  existingFeedback?: \"positive\" | \"negative\" | null;\n  isAwaitingFeedbackDetails?: boolean;\n  hasFileContent?: boolean;\n  isTemporaryChat?: boolean;\n  sources?: Array<{\n    title?: string;\n    url: string;\n    text?: string;\n    publishedDate?: string;\n  }>;\n}\n\nexport const MessageActions = ({\n  messageText,\n  isUser,\n  isLastAssistantMessage,\n  canRegenerate,\n  onRegenerate,\n  onEdit,\n  onBranch,\n  isHovered,\n  isEditing,\n  status,\n  onFeedback,\n  existingFeedback,\n  isAwaitingFeedbackDetails = false,\n  hasFileContent = false,\n  isTemporaryChat = false,\n  sources = [],\n}: MessageActionsProps) => {\n  const [copied, setCopied] = useState(false);\n  const [isSourcesOpen, setIsSourcesOpen] = useState(false);\n  const [isRegenerating, setIsRegenerating] = useState(false);\n\n  const getFaviconUrl = (domain: string) => {\n    return `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;\n  };\n\n  const getDomain = (url: string) => {\n    try {\n      const u = new URL(url);\n      return `${u.protocol}//${u.hostname}`;\n    } catch {\n      return url;\n    }\n  };\n\n  const handleCopy = async () => {\n    try {\n      await navigator.clipboard.writeText(messageText);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      console.error(\"Failed to copy message:\", error);\n    }\n  };\n\n  const handleFeedback = (type: \"positive\" | \"negative\") => {\n    if (onFeedback) {\n      onFeedback(type);\n    }\n  };\n\n  const handleRegenerate = () => {\n    if (isRegenerating) return;\n    setIsRegenerating(true);\n    onRegenerate();\n  };\n\n  // Don't show actions for last assistant message when it's loading/streaming\n  const isLastAssistantLoading =\n    isLastAssistantMessage &&\n    (status === \"submitted\" || status === \"streaming\");\n  const shouldShowActions =\n    !isLastAssistantLoading && !isEditing && (isUser ? isHovered : true); // Always show for assistant, only on hover for user\n\n  // Reset isRegenerating when status changes back to idle\n  const isLoading = status === \"submitted\" || status === \"streaming\";\n  if (!isLoading && isRegenerating) {\n    setIsRegenerating(false);\n  }\n\n  return (\n    <div\n      className={`mt-1 flex flex-wrap items-center gap-2 transition-opacity duration-200 ease-in-out ${isUser ? \"justify-end\" : \"justify-start\"} ${shouldShowActions ? \"opacity-100\" : \"opacity-0\"}`}\n    >\n      {shouldShowActions ? (\n        <>\n          <div className=\"flex items-center space-x-2\">\n            <WithTooltip\n              display={copied ? \"Copied!\" : \"Copy message\"}\n              trigger={\n                <button\n                  onClick={handleCopy}\n                  className=\"p-1.5 opacity-70 hover:opacity-100 transition-opacity rounded hover:bg-secondary text-muted-foreground\"\n                  aria-label={copied ? \"Copied!\" : \"Copy message\"}\n                >\n                  {copied ? <Check size={16} /> : <Copy size={16} />}\n                </button>\n              }\n              side=\"bottom\"\n              delayDuration={300}\n            />\n\n            {/* Show edit only for user messages without images */}\n            {isUser && !hasFileContent && (\n              <WithTooltip\n                display={\"Edit message\"}\n                trigger={\n                  <button\n                    onClick={onEdit}\n                    className=\"p-1.5 opacity-70 hover:opacity-100 transition-opacity rounded hover:bg-secondary text-muted-foreground\"\n                    aria-label=\"Edit message\"\n                  >\n                    <Pencil size={16} />\n                  </button>\n                }\n                side=\"bottom\"\n                delayDuration={300}\n              />\n            )}\n\n            {/* Show feedback buttons only for assistant messages and not in temporary chats */}\n            {!isUser && onFeedback && !isTemporaryChat && (\n              <>\n                {/* Hide positive feedback button when awaiting negative feedback details */}\n                {!isAwaitingFeedbackDetails && (\n                  <WithTooltip\n                    display={\"Good response\"}\n                    trigger={\n                      <button\n                        type=\"button\"\n                        onClick={() => handleFeedback(\"positive\")}\n                        className={`p-1.5 transition-opacity rounded hover:bg-secondary ${\n                          existingFeedback === \"positive\"\n                            ? \"opacity-100 text-primary-foreground\"\n                            : \"opacity-70 hover:opacity-100 text-muted-foreground\"\n                        }`}\n                        aria-label=\"Good response\"\n                      >\n                        <ThumbsUp\n                          size={16}\n                          fill={\n                            existingFeedback === \"positive\"\n                              ? \"currentColor\"\n                              : \"none\"\n                          }\n                        />\n                      </button>\n                    }\n                    side=\"bottom\"\n                    delayDuration={300}\n                  />\n                )}\n                <WithTooltip\n                  display={\"Poor response\"}\n                  trigger={\n                    <button\n                      type=\"button\"\n                      onClick={() => handleFeedback(\"negative\")}\n                      className={`p-1.5 transition-opacity rounded hover:bg-secondary ${\n                        existingFeedback === \"negative\" ||\n                        isAwaitingFeedbackDetails\n                          ? \"opacity-100 text-primary-foreground\"\n                          : \"opacity-70 hover:opacity-100 text-muted-foreground\"\n                      }`}\n                      aria-label=\"Poor response\"\n                    >\n                      <ThumbsDown\n                        size={16}\n                        fill={\n                          existingFeedback === \"negative\" ||\n                          isAwaitingFeedbackDetails\n                            ? \"currentColor\"\n                            : \"none\"\n                        }\n                      />\n                    </button>\n                  }\n                  side=\"bottom\"\n                  delayDuration={300}\n                />\n              </>\n            )}\n\n            {/* Show regenerate only for the last assistant message */}\n            {!isUser && isLastAssistantMessage && (\n              <WithTooltip\n                display={\"Regenerate response\"}\n                trigger={\n                  <button\n                    type=\"button\"\n                    onClick={handleRegenerate}\n                    disabled={!canRegenerate || isRegenerating}\n                    className=\"p-1.5 opacity-70 hover:opacity-100 disabled:opacity-50 transition-opacity rounded hover:bg-secondary text-muted-foreground\"\n                    aria-label=\"Regenerate response\"\n                  >\n                    <RotateCcw size={16} />\n                  </button>\n                }\n                side=\"bottom\"\n                delayDuration={300}\n              />\n            )}\n\n            {/* Show branch only for assistant messages and not in temporary chats */}\n            {!isUser && onBranch && !isTemporaryChat && (\n              <WithTooltip\n                display={\"Branch in new chat\"}\n                trigger={\n                  <button\n                    type=\"button\"\n                    onClick={onBranch}\n                    className=\"p-1.5 opacity-70 hover:opacity-100 transition-opacity rounded hover:bg-secondary text-muted-foreground\"\n                    aria-label=\"Branch in new chat\"\n                  >\n                    <Split size={16} />\n                  </button>\n                }\n                side=\"bottom\"\n                delayDuration={300}\n              />\n            )}\n          </div>\n\n          {/* Sources (only for assistant messages with web results) - positioned at the end */}\n          {!isUser && sources.length > 0 && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setIsSourcesOpen(true)}\n              className=\"group/footnote bg-background hover:bg-muted flex w-fit items-center gap-1.5 rounded-3xl px-3 py-1.5 h-auto\"\n              aria-label=\"View sources\"\n            >\n              <div className=\"flex flex-row-reverse\">\n                {sources.slice(0, 3).map((src, idx) => {\n                  const domain = getDomain(src.url);\n                  return (\n                    <div\n                      key={`src-${idx}`}\n                      className=\"border-background bg-background flex items-center overflow-clip rounded-full -ms-1.5 first:me-0 border-2 group-hover/footnote:border-muted relative\"\n                    >\n                      <div className=\"relative inline-block shrink-0\">\n                        <Image\n                          alt=\"\"\n                          width={20}\n                          height={20}\n                          className=\"w-5 h-5 rounded-full shadow-[inset_0_0_0_1px_rgba(0,0,0,0.05)] duration-200 motion-safe:transition-opacity opacity-100\"\n                          src={getFaviconUrl(domain)}\n                          unoptimized\n                        />\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n              <div className=\"text-muted-foreground mt-[-1px] text-[13px] font-medium\">\n                Sources\n              </div>\n            </Button>\n          )}\n        </>\n      ) : (\n        <>\n          {/* Invisible spacer buttons to maintain layout */}\n          <div className=\"p-1.5 w-7 h-7\" />\n        </>\n      )}\n\n      {/* Sources Dialog */}\n      {!isUser && sources.length > 0 && (\n        <SourcesDialog\n          open={isSourcesOpen}\n          onOpenChange={setIsSourcesOpen}\n          sources={sources}\n        />\n      )}\n    </div>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 494, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/CodeHighlight.tsx"],"sourcesContent":["import type { ReactNode } from \"react\";\nimport { useState, useMemo } from \"react\";\nimport ShikiHighlighter, { isInlineCode, type Element } from \"react-shiki\";\nimport { CodeActionButtons } from \"@/components/ui/code-action-buttons\";\nimport { isLanguageSupported, ShikiErrorBoundary } from \"@/lib/utils/shiki\";\n\ninterface CodeHighlightProps {\n  className?: string | undefined;\n  children?: ReactNode | undefined;\n  node?: Element | undefined;\n}\n\nexport const CodeHighlight = ({\n  className,\n  children,\n  node,\n  ...props\n}: CodeHighlightProps) => {\n  const match = className?.match(/language-(\\w+)/);\n  const language = match ? match[1] : undefined;\n  const codeContent = String(children);\n\n  const [isWrapped, setIsWrapped] = useState(false);\n\n  const isInline: boolean | undefined = node ? isInlineCode(node) : undefined;\n\n  // Check if language is supported by Shiki\n  const shouldUsePlainText = useMemo(() => {\n    return !isLanguageSupported(language);\n  }, [language]);\n\n  const handleToggleWrap = () => {\n    setIsWrapped(!isWrapped);\n  };\n\n  return !isInline ? (\n    <div className=\"shiki not-prose relative rounded-lg bg-card border border-border my-2 overflow-hidden\">\n      {/* Menu bar */}\n      <div className=\"flex items-center justify-between px-4 py-2 bg-muted border-b border-border\">\n        {/* Left side - Language */}\n        <div className=\"flex-1\">\n          {language && (\n            <span className=\"text-xs tracking-tighter px-2 py-1 rounded text-secondary-foreground\">\n              {language}\n            </span>\n          )}\n        </div>\n\n        {/* Right side - Action buttons */}\n        <CodeActionButtons\n          content={codeContent}\n          language={language}\n          isWrapped={isWrapped}\n          onToggleWrap={handleToggleWrap}\n          variant=\"codeblock\"\n        />\n      </div>\n\n      {/* Code content */}\n      <div className=\"overflow-hidden\">\n        {shouldUsePlainText ? (\n          <pre\n            className={`shiki not-prose relative bg-card text-sm font-[450] text-card-foreground px-[1em] py-[1em] rounded-none m-0 ${\n              isWrapped\n                ? \"whitespace-pre-wrap break-words overflow-visible\"\n                : \"overflow-x-auto max-w-full\"\n            }`}\n          >\n            <code>{codeContent}</code>\n          </pre>\n        ) : (\n          <ShikiErrorBoundary\n            fallback={\n              <pre\n                className={`shiki not-prose relative bg-card text-sm font-[450] text-card-foreground px-[1em] py-[1em] rounded-none m-0 ${\n                  isWrapped\n                    ? \"whitespace-pre-wrap break-words overflow-visible\"\n                    : \"overflow-x-auto max-w-full\"\n                }`}\n              >\n                <code>{codeContent}</code>\n              </pre>\n            }\n          >\n            <ShikiHighlighter\n              language={language}\n              theme=\"houston\"\n              delay={150}\n              addDefaultStyles={false}\n              showLanguage={false}\n              className={`shiki not-prose relative bg-card text-sm font-[450] text-card-foreground [&_pre]:!bg-transparent [&_pre]:px-[1em] [&_pre]:py-[1em] [&_pre]:rounded-none [&_pre]:m-0 ${\n                isWrapped\n                  ? \"[&_pre]:whitespace-pre-wrap [&_pre]:break-words [&_pre]:overflow-visible\"\n                  : \"[&_pre]:overflow-x-auto [&_pre]:max-w-full\"\n              }`}\n              {...props}\n            >\n              {codeContent}\n            </ShikiHighlighter>\n          </ShikiErrorBoundary>\n        )}\n      </div>\n    </div>\n  ) : (\n    <code\n      className=\"bg-muted text-muted-foreground px-1.5 py-0.5 rounded text-sm font-mono\"\n      {...props}\n    >\n      {children}\n    </code>\n  );\n};\n"],"names":[],"mappings":";;;;;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;AAQO,MAAM,gBAAgB,CAAC,EAC5B,SAAS,EACT,QAAQ,EACR,IAAI,EACJ,GAAG,OACgB;IACnB,MAAM,QAAQ,WAAW,MAAM;IAC/B,MAAM,WAAW,QAAQ,KAAK,CAAC,EAAE,GAAG;IACpC,MAAM,cAAc,OAAO;IAE3B,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gaAAQ,EAAC;IAE3C,MAAM,WAAgC,OAAO,IAAA,8XAAY,EAAC,QAAQ;IAElE,0CAA0C;IAC1C,MAAM,qBAAqB,IAAA,+ZAAO,EAAC;QACjC,OAAO,CAAC,IAAA,6IAAmB,EAAC;IAC9B,GAAG;QAAC;KAAS;IAEb,MAAM,mBAAmB;QACvB,aAAa,CAAC;IAChB;IAEA,OAAO,CAAC,yBACN,6bAAC;QAAI,WAAU;;0BAEb,6bAAC;gBAAI,WAAU;;kCAEb,6bAAC;wBAAI,WAAU;kCACZ,0BACC,6bAAC;4BAAK,WAAU;sCACb;;;;;;;;;;;kCAMP,6bAAC,mKAAiB;wBAChB,SAAS;wBACT,UAAU;wBACV,WAAW;wBACX,cAAc;wBACd,SAAQ;;;;;;;;;;;;0BAKZ,6bAAC;gBAAI,WAAU;0BACZ,mCACC,6bAAC;oBACC,WAAW,CAAC,4GAA4G,EACtH,YACI,qDACA,8BACJ;8BAEF,cAAA,6bAAC;kCAAM;;;;;;;;;;6EAGT,6bAAC,4IAAkB;oBACjB,wBACE,6bAAC;wBACC,WAAW,CAAC,4GAA4G,EACtH,YACI,qDACA,8BACJ;kCAEF,cAAA,6bAAC;sCAAM;;;;;;;;;;;8BAIX,cAAA,6bAAC,6XAAgB;wBACf,UAAU;wBACV,OAAM;wBACN,OAAO;wBACP,kBAAkB;wBAClB,cAAc;wBACd,WAAW,CAAC,oKAAoK,EAC9K,YACI,6EACA,8CACJ;wBACD,GAAG,KAAK;kCAER;;;;;;;;;;;;;;;;;;;;;iEAOX,6bAAC;QACC,WAAU;QACT,GAAG,KAAK;kBAER;;;;;;AAGP"}},
    {"offset": {"line": 643, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/MemoizedMarkdown.tsx"],"sourcesContent":["import { memo } from \"react\";\nimport { Streamdown } from \"streamdown\";\nimport { CodeHighlight } from \"./CodeHighlight\";\n\ninterface MemoizedMarkdownProps {\n  content: string;\n}\n\nexport const MemoizedMarkdown = memo(({ content }: MemoizedMarkdownProps) => {\n  return (\n    <Streamdown\n      components={{\n        code: CodeHighlight,\n        a({ children, href, ...props }) {\n          return (\n            <a\n              href={href}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"text-link hover:text-link/80 hover:underline transition-colors duration-200\"\n              {...props}\n            >\n              {children}\n            </a>\n          );\n        },\n      }}\n    >\n      {content}\n    </Streamdown>\n  );\n});\n\nMemoizedMarkdown.displayName = \"MemoizedMarkdown\";\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AACA;;;;;;;;;AAMO,MAAM,iCAAmB,IAAA,4ZAAI,EAAC,CAAC,EAAE,OAAO,EAAyB;IACtE,qBACE,6bAAC,2XAAU;QACT,YAAY;YACV,MAAM,oJAAa;YACnB,GAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,OAAO;gBAC5B,qBACE,6bAAC;oBACC,MAAM;oBACN,QAAO;oBACP,KAAI;oBACJ,WAAU;oBACT,GAAG,KAAK;8BAER;;;;;;YAGP;QACF;kBAEC;;;;;;AAGP;AAEA,iBAAiB,WAAW,GAAG"}},
    {"offset": {"line": 692, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/tools/FileToolsHandler.tsx"],"sourcesContent":["import { useMemo } from \"react\";\nimport { UIMessage } from \"@ai-sdk/react\";\nimport ToolBlock from \"@/components/ui/tool-block\";\nimport { FilePlus, FileText, FilePen, FileMinus } from \"lucide-react\";\nimport { useGlobalState } from \"../../contexts/GlobalState\";\nimport type { ChatStatus } from \"@/types\";\n\ninterface DiffDataPart {\n  type: \"data-diff\";\n  data: {\n    toolCallId: string;\n    filePath: string;\n    originalContent: string;\n    modifiedContent: string;\n  };\n}\n\ninterface FileToolsHandlerProps {\n  message: UIMessage;\n  part: any;\n  status: ChatStatus;\n}\n\nexport const FileToolsHandler = ({\n  message,\n  part,\n  status,\n}: FileToolsHandlerProps) => {\n  const { openSidebar } = useGlobalState();\n\n  // Extract diff data from data-diff parts in the message (streamed separately from tool result)\n  // This data only exists in memory/stream - not persisted, so on reload we just show the result message\n  const diffDataFromStream = useMemo(() => {\n    if (part.type !== \"tool-search_replace\") return null;\n\n    const diffPart = message.parts.find(\n      (p): p is DiffDataPart =>\n        p.type === \"data-diff\" &&\n        (p as DiffDataPart).data?.toolCallId === part.toolCallId,\n    );\n\n    return diffPart?.data || null;\n  }, [message.parts, part.type, part.toolCallId]);\n\n  const renderReadFileTool = () => {\n    const { toolCallId, state, input, output } = part;\n    const readInput = input as\n      | {\n          target_file: string;\n          offset?: number;\n          limit?: number;\n        }\n      | undefined;\n\n    const getFileRange = () => {\n      if (!readInput) return \"\";\n      if (readInput.offset && readInput.limit) {\n        return ` L${readInput.offset}-${readInput.offset + readInput.limit - 1}`;\n      }\n      if (!readInput.offset && readInput.limit) {\n        return ` L1-${readInput.limit}`;\n      }\n      if (readInput.offset && !readInput.limit) {\n        return ` L${readInput.offset}+`;\n      }\n      return \"\";\n    };\n\n    switch (state) {\n      case \"input-streaming\":\n        return status === \"streaming\" ? (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FileText />}\n            action=\"Reading file\"\n            isShimmer={true}\n          />\n        ) : null;\n      case \"input-available\":\n        return status === \"streaming\" ? (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FileText />}\n            action=\"Reading\"\n            target={\n              readInput\n                ? `${readInput.target_file}${getFileRange()}`\n                : undefined\n            }\n            isShimmer={true}\n          />\n        ) : null;\n      case \"output-available\": {\n        if (!readInput) return null;\n        const readOutput = output as { result: string };\n\n        const handleOpenInSidebar = () => {\n          const cleanContent = readOutput.result.replace(/^\\s*\\d+\\|/gm, \"\");\n          const range =\n            readInput.offset && readInput.limit\n              ? {\n                  start: readInput.offset,\n                  end: readInput.offset + readInput.limit - 1,\n                }\n              : undefined;\n\n          openSidebar({\n            path: readInput.target_file,\n            content: cleanContent,\n            range,\n            action: \"reading\",\n          });\n        };\n\n        const handleKeyDown = (e: React.KeyboardEvent) => {\n          if (e.key === \"Enter\" || e.key === \" \") {\n            e.preventDefault();\n            handleOpenInSidebar();\n          }\n        };\n\n        return (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FileText />}\n            action=\"Read\"\n            target={`${readInput.target_file}${getFileRange()}`}\n            isClickable={true}\n            onClick={handleOpenInSidebar}\n            onKeyDown={handleKeyDown}\n          />\n        );\n      }\n      default:\n        return null;\n    }\n  };\n\n  const renderWriteFileTool = () => {\n    const { toolCallId, state, input, output } = part;\n    const writeInput = input as\n      | {\n          file_path: string;\n          contents: string;\n        }\n      | undefined;\n\n    switch (state) {\n      case \"input-streaming\":\n        return status === \"streaming\" ? (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FilePlus />}\n            action=\"Creating file\"\n            isShimmer={true}\n          />\n        ) : null;\n      case \"input-available\":\n        return status === \"streaming\" ? (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FilePlus />}\n            action=\"Writing to\"\n            target={writeInput?.file_path}\n            isShimmer={true}\n          />\n        ) : null;\n      case \"output-available\":\n        if (!writeInput) return null;\n        return (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FilePlus />}\n            action=\"Successfully wrote\"\n            target={writeInput.file_path}\n            isClickable={true}\n            onClick={() => {\n              openSidebar({\n                path: writeInput.file_path,\n                content: writeInput.contents,\n                action: \"writing\",\n              });\n            }}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\" || e.key === \" \") {\n                e.preventDefault();\n                openSidebar({\n                  path: writeInput.file_path,\n                  content: writeInput.contents,\n                  action: \"writing\",\n                });\n              }\n            }}\n          />\n        );\n      default:\n        return null;\n    }\n  };\n\n  const renderDeleteFileTool = () => {\n    const { toolCallId, state, input, output } = part;\n    const deleteInput = input as\n      | {\n          target_file: string;\n          explanation: string;\n        }\n      | undefined;\n\n    switch (state) {\n      case \"input-streaming\":\n        return status === \"streaming\" ? (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FileMinus />}\n            action=\"Deleting file\"\n            isShimmer={true}\n          />\n        ) : null;\n      case \"input-available\":\n        return status === \"streaming\" ? (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FileMinus />}\n            action=\"Deleting\"\n            target={deleteInput?.target_file}\n            isShimmer={true}\n          />\n        ) : null;\n      case \"output-available\": {\n        if (!deleteInput) return null;\n        const deleteOutput = output as { result: string };\n        const isSuccess = deleteOutput.result.includes(\"Successfully deleted\");\n\n        return (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FileMinus />}\n            action={isSuccess ? \"Successfully deleted\" : \"Failed to delete\"}\n            target={deleteInput.target_file}\n          />\n        );\n      }\n      default:\n        return null;\n    }\n  };\n\n  const renderSearchReplaceTool = () => {\n    const { toolCallId, state, input, output } = part;\n    const searchReplaceInput = input as\n      | {\n          file_path: string;\n          old_string: string;\n          new_string: string;\n          replace_all?: boolean;\n        }\n      | undefined;\n\n    switch (state) {\n      case \"input-streaming\":\n        return status === \"streaming\" ? (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FilePen />}\n            action=\"Editing file\"\n            isShimmer={true}\n          />\n        ) : null;\n      case \"input-available\":\n        return status === \"streaming\" ? (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FilePen />}\n            action={\n              searchReplaceInput?.replace_all ? \"Replacing all in\" : \"Editing\"\n            }\n            target={searchReplaceInput?.file_path}\n            isShimmer={true}\n          />\n        ) : null;\n      case \"output-available\": {\n        if (!searchReplaceInput) return null;\n        const searchReplaceOutput = output as { result: string };\n        const isSuccess =\n          searchReplaceOutput.result.includes(\"Successfully made\");\n\n        const handleOpenInSidebar = () => {\n          // Use diff data from stream if available (not persisted across reloads)\n          openSidebar({\n            path: searchReplaceInput.file_path,\n            content:\n              diffDataFromStream?.modifiedContent || searchReplaceOutput.result,\n            action: \"editing\",\n            toolCallId,\n            originalContent: diffDataFromStream?.originalContent,\n            modifiedContent: diffDataFromStream?.modifiedContent,\n          });\n        };\n\n        const handleKeyDown = (e: React.KeyboardEvent) => {\n          if (e.key === \"Enter\" || e.key === \" \") {\n            e.preventDefault();\n            handleOpenInSidebar();\n          }\n        };\n\n        return (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FilePen />}\n            action={isSuccess ? \"Successfully edited\" : \"Failed to edit\"}\n            target={searchReplaceInput.file_path}\n            isClickable={true}\n            onClick={handleOpenInSidebar}\n            onKeyDown={handleKeyDown}\n          />\n        );\n      }\n      default:\n        return null;\n    }\n  };\n\n  const renderMultiEditTool = () => {\n    const { toolCallId, state, input, output } = part;\n    const multiEditInput = input as\n      | {\n          file_path: string;\n          edits: Array<{\n            old_string: string;\n            new_string: string;\n            replace_all?: boolean;\n          }>;\n        }\n      | undefined;\n\n    switch (state) {\n      case \"input-streaming\":\n        return status === \"streaming\" ? (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FilePen />}\n            action=\"Making multiple edits\"\n            isShimmer={true}\n          />\n        ) : null;\n      case \"input-available\":\n        return status === \"streaming\" ? (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FilePen />}\n            action={\n              multiEditInput\n                ? `Making ${multiEditInput.edits.length} edits to`\n                : \"Making edits\"\n            }\n            target={multiEditInput?.file_path}\n            isShimmer={true}\n          />\n        ) : null;\n      case \"output-available\": {\n        if (!multiEditInput) return null;\n        const multiEditOutput = output as { result: string };\n        const isSuccess = multiEditOutput.result.includes(\n          \"Successfully applied\",\n        );\n\n        return (\n          <ToolBlock\n            key={toolCallId}\n            icon={<FilePen />}\n            action={\n              isSuccess\n                ? `Successfully applied ${multiEditInput.edits.length} edits`\n                : \"Failed to apply edits\"\n            }\n            target={multiEditInput.file_path}\n          />\n        );\n      }\n      default:\n        return null;\n    }\n  };\n\n  // Main switch for file tool types\n  switch (part.type) {\n    case \"tool-read_file\":\n      return renderReadFileTool();\n    case \"tool-write_file\":\n      return renderWriteFileTool();\n    case \"tool-delete_file\":\n      return renderDeleteFileTool();\n    case \"tool-search_replace\":\n      return renderSearchReplaceTool();\n    case \"tool-multi_edit\":\n      return renderMultiEditTool();\n    default:\n      return null;\n  }\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1090, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/tools/TerminalToolHandler.tsx"],"sourcesContent":["import React, { useEffect, useMemo } from \"react\";\nimport { UIMessage } from \"@ai-sdk/react\";\nimport { CommandResult } from \"@e2b/code-interpreter\";\nimport ToolBlock from \"@/components/ui/tool-block\";\nimport { Terminal } from \"lucide-react\";\nimport { useGlobalState } from \"../../contexts/GlobalState\";\nimport type { ChatStatus, SidebarTerminal } from \"@/types/chat\";\nimport { isSidebarTerminal } from \"@/types/chat\";\n\ninterface TerminalToolHandlerProps {\n  message: UIMessage;\n  part: any;\n  status: ChatStatus;\n}\n\nexport const TerminalToolHandler = ({\n  message,\n  part,\n  status,\n}: TerminalToolHandlerProps) => {\n  const { openSidebar, sidebarOpen, sidebarContent, updateSidebarContent } =\n    useGlobalState();\n  const { toolCallId, state, input, output, errorText } = part;\n  const terminalInput = input as {\n    command: string;\n    is_background: boolean;\n  };\n  const terminalOutput = output as {\n    result: CommandResult & { output?: string };\n  };\n\n  // Memoize streaming output computation\n  const streamingOutput = useMemo(() => {\n    const terminalDataParts = message.parts.filter(\n      (p) =>\n        p.type === \"data-terminal\" &&\n        (p as any).data?.toolCallId === toolCallId,\n    );\n    return terminalDataParts\n      .map((p) => (p as any).data?.terminal || \"\")\n      .join(\"\");\n  }, [message.parts, toolCallId]);\n\n  // Memoize final output computation\n  const finalOutput = useMemo(() => {\n    // Prefer new combined output format, fall back to legacy stdout+stderr for old messages\n    const newFormatOutput = terminalOutput?.result?.output ?? \"\";\n    const stdout = terminalOutput?.result?.stdout ?? \"\";\n    const stderr = terminalOutput?.result?.stderr ?? \"\";\n    const legacyOutput = stdout + stderr;\n\n    return (\n      newFormatOutput ||\n      legacyOutput ||\n      streamingOutput ||\n      (terminalOutput?.result?.error ?? \"\") ||\n      errorText ||\n      \"\"\n    );\n  }, [terminalOutput, streamingOutput, errorText]);\n\n  const isExecuting = state === \"input-available\" && status === \"streaming\";\n\n  const handleOpenInSidebar = () => {\n    if (!terminalInput?.command) return;\n\n    const sidebarTerminal: SidebarTerminal = {\n      command: terminalInput.command,\n      output: finalOutput,\n      isExecuting,\n      isBackground: terminalInput.is_background,\n      toolCallId: toolCallId,\n    };\n\n    openSidebar(sidebarTerminal);\n  };\n\n  // Track if this sidebar is currently active\n  const isSidebarActive =\n    sidebarOpen &&\n    sidebarContent &&\n    isSidebarTerminal(sidebarContent) &&\n    sidebarContent.toolCallId === toolCallId;\n\n  // Update sidebar content in real-time if it's currently open for this tool call\n  useEffect(() => {\n    if (!isSidebarActive) return;\n\n    updateSidebarContent({\n      output: finalOutput,\n      isExecuting,\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSidebarActive, finalOutput, isExecuting]);\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault();\n      handleOpenInSidebar();\n    }\n  };\n\n  switch (state) {\n    case \"input-streaming\":\n      return status === \"streaming\" ? (\n        <ToolBlock\n          key={toolCallId}\n          icon={<Terminal />}\n          action=\"Generating command\"\n          isShimmer={true}\n        />\n      ) : null;\n    case \"input-available\":\n      return (\n        <ToolBlock\n          key={toolCallId}\n          icon={<Terminal />}\n          action={status === \"streaming\" ? \"Executing\" : \"Executed\"}\n          target={terminalInput?.command || \"\"}\n          isShimmer={status === \"streaming\"}\n          isClickable={true}\n          onClick={handleOpenInSidebar}\n          onKeyDown={handleKeyDown}\n        />\n      );\n    case \"output-available\":\n      return (\n        <ToolBlock\n          key={toolCallId}\n          icon={<Terminal />}\n          action=\"Executed\"\n          target={terminalInput?.command || \"\"}\n          isClickable={true}\n          onClick={handleOpenInSidebar}\n          onKeyDown={handleKeyDown}\n        />\n      );\n    case \"output-error\":\n      return (\n        <ToolBlock\n          key={toolCallId}\n          icon={<Terminal />}\n          action=\"Executed\"\n          target={terminalInput?.command || \"\"}\n          isClickable={true}\n          onClick={handleOpenInSidebar}\n          onKeyDown={handleKeyDown}\n        />\n      );\n    default:\n      return null;\n  }\n};\n"],"names":[],"mappings":";;;;;AAAA;AAGA;AACA;AACA;AAEA;;;;;;;AAQO,MAAM,sBAAsB,CAAC,EAClC,OAAO,EACP,IAAI,EACJ,MAAM,EACmB;IACzB,MAAM,EAAE,WAAW,EAAE,WAAW,EAAE,cAAc,EAAE,oBAAoB,EAAE,GACtE,IAAA,iJAAc;IAChB,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG;IACxD,MAAM,gBAAgB;IAItB,MAAM,iBAAiB;IAIvB,uCAAuC;IACvC,MAAM,kBAAkB,IAAA,+ZAAO,EAAC;QAC9B,MAAM,oBAAoB,QAAQ,KAAK,CAAC,MAAM,CAC5C,CAAC,IACC,EAAE,IAAI,KAAK,mBACX,AAAC,EAAU,IAAI,EAAE,eAAe;QAEpC,OAAO,kBACJ,GAAG,CAAC,CAAC,IAAM,AAAC,EAAU,IAAI,EAAE,YAAY,IACxC,IAAI,CAAC;IACV,GAAG;QAAC,QAAQ,KAAK;QAAE;KAAW;IAE9B,mCAAmC;IACnC,MAAM,cAAc,IAAA,+ZAAO,EAAC;QAC1B,wFAAwF;QACxF,MAAM,kBAAkB,gBAAgB,QAAQ,UAAU;QAC1D,MAAM,SAAS,gBAAgB,QAAQ,UAAU;QACjD,MAAM,SAAS,gBAAgB,QAAQ,UAAU;QACjD,MAAM,eAAe,SAAS;QAE9B,OACE,mBACA,gBACA,mBACA,CAAC,gBAAgB,QAAQ,SAAS,EAAE,KACpC,aACA;IAEJ,GAAG;QAAC;QAAgB;QAAiB;KAAU;IAE/C,MAAM,cAAc,UAAU,qBAAqB,WAAW;IAE9D,MAAM,sBAAsB;QAC1B,IAAI,CAAC,eAAe,SAAS;QAE7B,MAAM,kBAAmC;YACvC,SAAS,cAAc,OAAO;YAC9B,QAAQ;YACR;YACA,cAAc,cAAc,aAAa;YACzC,YAAY;QACd;QAEA,YAAY;IACd;IAEA,4CAA4C;IAC5C,MAAM,kBACJ,eACA,kBACA,IAAA,kIAAiB,EAAC,mBAClB,eAAe,UAAU,KAAK;IAEhC,gFAAgF;IAChF,IAAA,iaAAS,EAAC;QACR,IAAI,CAAC,iBAAiB;QAEtB,qBAAqB;YACnB,QAAQ;YACR;QACF;IACA,uDAAuD;IACzD,GAAG;QAAC;QAAiB;QAAa;KAAY;IAE9C,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK;YACtC,EAAE,cAAc;YAChB;QACF;IACF;IAEA,OAAQ;QACN,KAAK;YACH,OAAO,WAAW,4BAChB,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,0SAAQ;;;;;gBACf,QAAO;gBACP,WAAW;eAHN;;;;2DAKL;QACN,KAAK;YACH,qBACE,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,0SAAQ;;;;;gBACf,QAAQ,WAAW,cAAc,cAAc;gBAC/C,QAAQ,eAAe,WAAW;gBAClC,WAAW,WAAW;gBACtB,aAAa;gBACb,SAAS;gBACT,WAAW;eAPN;;;;;QAUX,KAAK;YACH,qBACE,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,0SAAQ;;;;;gBACf,QAAO;gBACP,QAAQ,eAAe,WAAW;gBAClC,aAAa;gBACb,SAAS;gBACT,WAAW;eANN;;;;;QASX,KAAK;YACH,qBACE,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,0SAAQ;;;;;gBACf,QAAO;gBACP,QAAQ,eAAe,WAAW;gBAClC,aAAa;gBACb,SAAS;gBACT,WAAW;eANN;;;;;QASX;YACE,OAAO;IACX;AACF"}},
    {"offset": {"line": 1240, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/tools/PythonToolHandler.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useCallback } from \"react\";\nimport { UIMessage } from \"@ai-sdk/react\";\nimport ToolBlock from \"@/components/ui/tool-block\";\nimport { Code2 } from \"lucide-react\";\nimport { useGlobalState } from \"../../contexts/GlobalState\";\nimport type { ChatStatus, SidebarPython } from \"@/types/chat\";\nimport { isSidebarPython } from \"@/types/chat\";\n\ninterface PythonToolHandlerProps {\n  message: UIMessage;\n  part: any;\n  status: ChatStatus;\n}\n\nexport const PythonToolHandler = ({\n  message,\n  part,\n  status,\n}: PythonToolHandlerProps) => {\n  const { openSidebar, sidebarOpen, sidebarContent, updateSidebarContent } =\n    useGlobalState();\n  const { toolCallId, state, input, output, errorText } = part;\n  const pythonInput = input as { code: string };\n  const pythonOutput = output as {\n    result: {\n      output?: string; // New combined output format\n      stdout?: string; // Legacy support\n      stderr?: string; // Legacy support\n      results?: any[];\n      exitCode?: number | null;\n      error?: string;\n    };\n    files?: Array<{ path: string }>;\n    // Legacy support for old messages\n    fileUrls?: Array<{ path: string; downloadUrl?: string }>;\n  };\n\n  const codePreview = pythonInput?.code || \"\";\n\n  // Memoize streaming output computation\n  const streamingOutput = useMemo(() => {\n    const pythonDataParts = message.parts.filter(\n      (p) =>\n        p.type === \"data-python\" && (p as any).data?.toolCallId === toolCallId,\n    );\n    return pythonDataParts.map((p) => (p as any).data?.terminal || \"\").join(\"\");\n  }, [message.parts, toolCallId]);\n\n  // Memoize final output computation\n  const finalOutput = useMemo(() => {\n    // Prefer new combined output format\n    const newFormatOutput = pythonOutput?.result?.output ?? \"\";\n\n    // Fall back to legacy stdout+stderr for old messages\n    const stdout = pythonOutput?.result?.stdout ?? \"\";\n    const stderr = pythonOutput?.result?.stderr ?? \"\";\n    const legacyOutput = stdout + stderr;\n\n    return (\n      newFormatOutput ||\n      legacyOutput ||\n      streamingOutput ||\n      (pythonOutput?.result?.error ?? \"\") ||\n      errorText ||\n      \"\"\n    );\n  }, [pythonOutput, streamingOutput, errorText]);\n\n  const isExecuting = state === \"input-available\" && status === \"streaming\";\n\n  const handleOpenInSidebar = useCallback(() => {\n    if (!pythonInput?.code) return;\n\n    const sidebarPython: SidebarPython = {\n      code: pythonInput.code,\n      output: finalOutput,\n      isExecuting,\n      toolCallId,\n    };\n\n    openSidebar(sidebarPython);\n  }, [pythonInput?.code, finalOutput, isExecuting, toolCallId, openSidebar]);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === \"Enter\" || e.key === \" \") {\n        e.preventDefault();\n        handleOpenInSidebar();\n      }\n    },\n    [handleOpenInSidebar],\n  );\n\n  // Track if this sidebar is currently active\n  const isSidebarActive =\n    sidebarOpen &&\n    sidebarContent &&\n    isSidebarPython(sidebarContent) &&\n    sidebarContent.toolCallId === toolCallId;\n\n  // Update sidebar content in real-time if it's currently open for this tool call\n  useEffect(() => {\n    if (!isSidebarActive) return;\n\n    updateSidebarContent({\n      code: codePreview,\n      output: finalOutput,\n      isExecuting,\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSidebarActive, codePreview, finalOutput, isExecuting]);\n\n  switch (state) {\n    case \"input-streaming\":\n      return status === \"streaming\" ? (\n        <ToolBlock\n          key={toolCallId}\n          icon={<Code2 />}\n          action=\"Generating Python code\"\n          target={codePreview}\n          isShimmer={true}\n          isClickable={true}\n          onClick={handleOpenInSidebar}\n          onKeyDown={handleKeyDown}\n        />\n      ) : null;\n    case \"input-available\":\n      return (\n        <ToolBlock\n          key={toolCallId}\n          icon={<Code2 />}\n          action={\n            status === \"streaming\" ? \"Executing Python\" : \"Executed Python\"\n          }\n          target={codePreview}\n          isShimmer={status === \"streaming\"}\n          isClickable={true}\n          onClick={handleOpenInSidebar}\n          onKeyDown={handleKeyDown}\n        />\n      );\n    case \"output-available\":\n      return (\n        <ToolBlock\n          key={toolCallId}\n          icon={<Code2 />}\n          action=\"Executed Python\"\n          target={codePreview}\n          isClickable={true}\n          onClick={handleOpenInSidebar}\n          onKeyDown={handleKeyDown}\n        />\n      );\n    case \"output-error\":\n      return (\n        <ToolBlock\n          key={toolCallId}\n          icon={<Code2 />}\n          action=\"Executed Python\"\n          target={codePreview}\n          isClickable={true}\n          onClick={handleOpenInSidebar}\n          onKeyDown={handleKeyDown}\n        />\n      );\n    default:\n      return null;\n  }\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1405, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/tools/WebToolHandler.tsx"],"sourcesContent":["import ToolBlock from \"@/components/ui/tool-block\";\nimport { Search, ExternalLink } from \"lucide-react\";\nimport type { ChatStatus } from \"@/types\";\n\ninterface WebToolHandlerProps {\n  part: any;\n  status: ChatStatus;\n}\n\nexport const WebToolHandler = ({ part, status }: WebToolHandlerProps) => {\n  const { toolCallId, state, input } = part;\n\n  // Handle both new web tool format and legacy web_search format\n  const webInput = input as\n    | {\n        command?: \"search\" | \"open_url\";\n        query?: string;\n        url?: string;\n        explanation?: string;\n      }\n    | undefined;\n\n  // Determine tool type - for backward compatibility: if no command, assume it's a search (legacy web_search)\n  const isUrlCommand = webInput?.command === \"open_url\";\n\n  const getIcon = () => {\n    return isUrlCommand ? <ExternalLink /> : <Search />;\n  };\n\n  const getAction = (isCompleted = false) => {\n    const action = isUrlCommand ? \"Opening URL\" : \"Searching web\";\n    return isCompleted ? action.replace(\"ing\", \"ed\") : action;\n  };\n\n  const getTarget = () => {\n    if (!webInput) return undefined;\n    return isUrlCommand ? webInput.url : webInput.query;\n  };\n\n  switch (state) {\n    case \"input-streaming\":\n      return status === \"streaming\" ? (\n        <ToolBlock\n          key={toolCallId}\n          icon={getIcon()}\n          action={getAction()}\n          isShimmer={true}\n        />\n      ) : null;\n\n    case \"input-available\":\n      return status === \"streaming\" ? (\n        <ToolBlock\n          key={toolCallId}\n          icon={getIcon()}\n          action={getAction()}\n          target={getTarget()}\n          isShimmer={true}\n        />\n      ) : null;\n\n    case \"output-available\":\n      return (\n        <ToolBlock\n          key={toolCallId}\n          icon={getIcon()}\n          action={getAction(true)}\n          target={getTarget()}\n        />\n      );\n\n    default:\n      return null;\n  }\n};\n\n// Keep the old export for backward compatibility\nexport const WebSearchToolHandler = WebToolHandler;\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AAAA;;;;AAQO,MAAM,iBAAiB,CAAC,EAAE,IAAI,EAAE,MAAM,EAAuB;IAClE,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG;IAErC,+DAA+D;IAC/D,MAAM,WAAW;IASjB,4GAA4G;IAC5G,MAAM,eAAe,UAAU,YAAY;IAE3C,MAAM,UAAU;QACd,OAAO,6BAAe,6bAAC,0TAAY;;;;qEAAM,6bAAC,oSAAM;;;;;IAClD;IAEA,MAAM,YAAY,CAAC,cAAc,KAAK;QACpC,MAAM,SAAS,eAAe,gBAAgB;QAC9C,OAAO,cAAc,OAAO,OAAO,CAAC,OAAO,QAAQ;IACrD;IAEA,MAAM,YAAY;QAChB,IAAI,CAAC,UAAU,OAAO;QACtB,OAAO,eAAe,SAAS,GAAG,GAAG,SAAS,KAAK;IACrD;IAEA,OAAQ;QACN,KAAK;YACH,OAAO,WAAW,4BAChB,6bAAC,6IAAS;gBAER,MAAM;gBACN,QAAQ;gBACR,WAAW;eAHN;;;;2DAKL;QAEN,KAAK;YACH,OAAO,WAAW,4BAChB,6bAAC,6IAAS;gBAER,MAAM;gBACN,QAAQ;gBACR,QAAQ;gBACR,WAAW;eAJN;;;;2DAML;QAEN,KAAK;YACH,qBACE,6bAAC,6IAAS;gBAER,MAAM;gBACN,QAAQ,UAAU;gBAClB,QAAQ;eAHH;;;;;QAOX;YACE,OAAO;IACX;AACF;AAGO,MAAM,uBAAuB"}},
    {"offset": {"line": 1484, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/tools/TodoToolHandler.tsx"],"sourcesContent":["import React from \"react\";\nimport { UIMessage } from \"@ai-sdk/react\";\nimport ToolBlock from \"@/components/ui/tool-block\";\nimport { TodoBlock } from \"@/components/ui/todo-block\";\nimport { ListTodo } from \"lucide-react\";\nimport type { ChatStatus, Todo, TodoWriteInput } from \"@/types\";\n\ninterface TodoToolHandlerProps {\n  message: UIMessage;\n  part: any;\n  status: ChatStatus;\n}\n\nexport const TodoToolHandler = ({\n  message,\n  part,\n  status,\n}: TodoToolHandlerProps) => {\n  const { toolCallId, state, input, output } = part;\n  const todoInput = input as TodoWriteInput;\n\n  switch (state) {\n    case \"input-streaming\":\n      return status === \"streaming\" ? (\n        <ToolBlock\n          key={toolCallId}\n          icon={<ListTodo />}\n          action=\"Creating to-do list\"\n          isShimmer={true}\n        />\n      ) : null;\n\n    case \"input-available\":\n      return status === \"streaming\" ? (\n        <ToolBlock\n          key={toolCallId}\n          icon={<ListTodo />}\n          action={\n            todoInput?.merge ? \"Updating to-do list\" : \"Creating to-do list\"\n          }\n          target={`${todoInput?.todos?.length || 0} items`}\n          isShimmer={true}\n        />\n      ) : null;\n\n    case \"output-available\": {\n      const todoOutput = output as {\n        result: string;\n        counts: {\n          completed: number;\n          total: number;\n        };\n        currentTodos: Todo[];\n      };\n\n      return (\n        <TodoBlock\n          todos={todoOutput.currentTodos}\n          inputTodos={todoInput?.todos}\n          blockId={toolCallId}\n          messageId={message.id}\n        />\n      );\n    }\n\n    default:\n      return null;\n  }\n};\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;;;AASO,MAAM,kBAAkB,CAAC,EAC9B,OAAO,EACP,IAAI,EACJ,MAAM,EACe;IACrB,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;IAC7C,MAAM,YAAY;IAElB,OAAQ;QACN,KAAK;YACH,OAAO,WAAW,4BAChB,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,8SAAQ;;;;;gBACf,QAAO;gBACP,WAAW;eAHN;;;;2DAKL;QAEN,KAAK;YACH,OAAO,WAAW,4BAChB,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,8SAAQ;;;;;gBACf,QACE,WAAW,QAAQ,wBAAwB;gBAE7C,QAAQ,GAAG,WAAW,OAAO,UAAU,EAAE,MAAM,CAAC;gBAChD,WAAW;eANN;;;;2DAQL;QAEN,KAAK;YAAoB;gBACvB,MAAM,aAAa;gBASnB,qBACE,6bAAC,+IAAS;oBACR,OAAO,WAAW,YAAY;oBAC9B,YAAY,WAAW;oBACvB,SAAS;oBACT,WAAW,QAAQ,EAAE;;;;;;YAG3B;QAEA;YACE,OAAO;IACX;AACF"}},
    {"offset": {"line": 1551, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/tools/MemoryToolHandler.tsx"],"sourcesContent":["import { useState } from \"react\";\nimport ToolBlock from \"@/components/ui/tool-block\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Button } from \"@/components/ui/button\";\nimport { NotebookPen } from \"lucide-react\";\nimport type { ChatStatus } from \"@/types\";\n\ninterface MemoryToolHandlerProps {\n  part: any;\n  status: ChatStatus;\n}\n\nexport const MemoryToolHandler = ({ part, status }: MemoryToolHandlerProps) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const { toolCallId, state, input, output } = part;\n\n  const memoryInput = (input || {}) as {\n    action?: \"create\" | \"update\" | \"delete\";\n    knowledge_to_store?: string;\n    title?: string;\n    existing_knowledge_id?: string;\n  };\n\n  const getActionText = (action?: string) => {\n    switch (action) {\n      case \"create\":\n        return \"Created memory\";\n      case \"update\":\n        return \"Updated memory\";\n      case \"delete\":\n        return \"Deleted memory\";\n      default:\n        return \"Updated memory\";\n    }\n  };\n\n  const getStreamingActionText = (action?: string) => {\n    switch (action) {\n      case \"create\":\n        return \"Creating memory\";\n      case \"update\":\n        return \"Updating memory\";\n      case \"delete\":\n        return \"Deleting memory\";\n      default:\n        return \"Updating memory\";\n    }\n  };\n\n  const getMemoryContent = () => {\n    // Try to get content from the output first (for completed tool executions)\n    let content = \"\";\n    const title = memoryInput.title;\n\n    // Check if we have output data with memoryContent (tool execution completed)\n    if (output && typeof output === \"object\" && output.memoryContent) {\n      content = output.memoryContent;\n    } else if (\n      part.result &&\n      typeof part.result === \"object\" &&\n      part.result.memoryContent\n    ) {\n      // Fallback to result data\n      content = part.result.memoryContent;\n    } else {\n      // Fallback to input content\n      content = memoryInput.knowledge_to_store || \"No content available\";\n    }\n\n    return (\n      <div className=\"space-y-2 max-h-40 overflow-y-auto\">\n        {title && (\n          <div>\n            <span className=\"font-semibold text-sm text-foreground\">\n              Title:\n            </span>\n            <div className=\"text-sm mt-1 max-h-12 overflow-y-auto\">{title}</div>\n          </div>\n        )}\n        <div className=\"text-sm whitespace-pre-wrap max-h-20 overflow-y-auto leading-relaxed\">\n          {content}\n        </div>\n      </div>\n    );\n  };\n\n  const handleClick = () => {\n    setIsOpen(!isOpen);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault();\n      setIsOpen(!isOpen);\n    }\n  };\n\n  const handleMouseEnter = () => {\n    setIsOpen(true);\n  };\n\n  const handleMouseLeave = () => {\n    setIsOpen(false);\n  };\n\n  switch (state) {\n    case \"input-streaming\":\n      return status === \"streaming\" ? (\n        <ToolBlock\n          key={toolCallId}\n          icon={<NotebookPen />}\n          action={getStreamingActionText(memoryInput.action)}\n          isShimmer={true}\n        />\n      ) : null;\n\n    case \"input-available\":\n      return status === \"streaming\" ? (\n        <ToolBlock\n          key={toolCallId}\n          icon={<NotebookPen />}\n          action={getStreamingActionText(memoryInput.action)}\n          target={memoryInput.title}\n          isShimmer={true}\n        />\n      ) : null;\n\n    case \"output-available\":\n      return (\n        <div className=\"block w-full my-2\">\n          <Popover open={isOpen} onOpenChange={setIsOpen}>\n            <PopoverTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-auto text-muted-foreground hover:text-foreground justify-start w-auto\"\n                onClick={handleClick}\n                onKeyDown={handleKeyDown}\n                onMouseEnter={handleMouseEnter}\n                onMouseLeave={handleMouseLeave}\n              >\n                <NotebookPen className=\"h-4 w-4\" />\n                {getActionText(memoryInput.action)}\n              </Button>\n            </PopoverTrigger>\n            <PopoverContent\n              className=\"w-80 max-w-sm\"\n              align=\"start\"\n              sideOffset={8}\n              onMouseEnter={handleMouseEnter}\n              onMouseLeave={handleMouseLeave}\n            >\n              {getMemoryContent()}\n            </PopoverContent>\n          </Popover>\n        </div>\n      );\n\n    default:\n      return null;\n  }\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAKA;AACA;;;;;;;AAQO,MAAM,oBAAoB,CAAC,EAAE,IAAI,EAAE,MAAM,EAA0B;IACxE,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,gaAAQ,EAAC;IACrC,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;IAE7C,MAAM,cAAe,SAAS,CAAC;IAO/B,MAAM,gBAAgB,CAAC;QACrB,OAAQ;YACN,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT;gBACE,OAAO;QACX;IACF;IAEA,MAAM,yBAAyB,CAAC;QAC9B,OAAQ;YACN,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT;gBACE,OAAO;QACX;IACF;IAEA,MAAM,mBAAmB;QACvB,2EAA2E;QAC3E,IAAI,UAAU;QACd,MAAM,QAAQ,YAAY,KAAK;QAE/B,6EAA6E;QAC7E,IAAI,UAAU,OAAO,WAAW,YAAY,OAAO,aAAa,EAAE;YAChE,UAAU,OAAO,aAAa;QAChC,OAAO,IACL,KAAK,MAAM,IACX,OAAO,KAAK,MAAM,KAAK,YACvB,KAAK,MAAM,CAAC,aAAa,EACzB;YACA,0BAA0B;YAC1B,UAAU,KAAK,MAAM,CAAC,aAAa;QACrC,OAAO;YACL,4BAA4B;YAC5B,UAAU,YAAY,kBAAkB,IAAI;QAC9C;QAEA,qBACE,6bAAC;YAAI,WAAU;;gBACZ,uBACC,6bAAC;;sCACC,6bAAC;4BAAK,WAAU;sCAAwC;;;;;;sCAGxD,6bAAC;4BAAI,WAAU;sCAAyC;;;;;;;;;;;;8BAG5D,6bAAC;oBAAI,WAAU;8BACZ;;;;;;;;;;;;IAIT;IAEA,MAAM,cAAc;QAClB,UAAU,CAAC;IACb;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK;YACtC,EAAE,cAAc;YAChB,UAAU,CAAC;QACb;IACF;IAEA,MAAM,mBAAmB;QACvB,UAAU;IACZ;IAEA,MAAM,mBAAmB;QACvB,UAAU;IACZ;IAEA,OAAQ;QACN,KAAK;YACH,OAAO,WAAW,4BAChB,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,uTAAW;;;;;gBAClB,QAAQ,uBAAuB,YAAY,MAAM;gBACjD,WAAW;eAHN;;;;2DAKL;QAEN,KAAK;YACH,OAAO,WAAW,4BAChB,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,uTAAW;;;;;gBAClB,QAAQ,uBAAuB,YAAY,MAAM;gBACjD,QAAQ,YAAY,KAAK;gBACzB,WAAW;eAJN;;;;2DAML;QAEN,KAAK;YACH,qBACE,6bAAC;gBAAI,WAAU;0BACb,cAAA,6bAAC,uIAAO;oBAAC,MAAM;oBAAQ,cAAc;;sCACnC,6bAAC,8IAAc;4BAAC,OAAO;sCACrB,cAAA,6bAAC,qIAAM;gCACL,SAAQ;gCACR,MAAK;gCACL,WAAU;gCACV,SAAS;gCACT,WAAW;gCACX,cAAc;gCACd,cAAc;;kDAEd,6bAAC,uTAAW;wCAAC,WAAU;;;;;;oCACtB,cAAc,YAAY,MAAM;;;;;;;;;;;;sCAGrC,6bAAC,8IAAc;4BACb,WAAU;4BACV,OAAM;4BACN,YAAY;4BACZ,cAAc;4BACd,cAAc;sCAEb;;;;;;;;;;;;;;;;;QAMX;YACE,OAAO;IACX;AACF"}},
    {"offset": {"line": 1764, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/tools/GetTerminalFilesHandler.tsx"],"sourcesContent":["import React from \"react\";\nimport ToolBlock from \"@/components/ui/tool-block\";\nimport { FileDown } from \"lucide-react\";\nimport type { ChatStatus } from \"@/types/chat\";\n\ninterface TerminalFilesPart {\n  toolCallId: string;\n  state:\n    | \"input-streaming\"\n    | \"input-available\"\n    | \"output-available\"\n    | \"output-error\";\n  input?: { files: string[] };\n  output?: {\n    result: string;\n    files?: Array<{ path: string }>;\n    // Legacy support for old messages\n    fileUrls?: Array<{ path: string; downloadUrl?: string }>;\n  };\n}\n\ninterface GetTerminalFilesHandlerProps {\n  part: TerminalFilesPart;\n  status: ChatStatus;\n}\n\nexport const GetTerminalFilesHandler = ({\n  part,\n  status,\n}: GetTerminalFilesHandlerProps) => {\n  const { toolCallId, state, input, output } = part;\n  const filesInput = input;\n  const filesOutput = output;\n\n  const getFileNames = (paths: string[]) => {\n    return paths.map((path) => path.split(\"/\").pop() || path).join(\", \");\n  };\n\n  switch (state) {\n    case \"input-streaming\":\n      return status === \"streaming\" ? (\n        <ToolBlock\n          key={toolCallId}\n          icon={<FileDown />}\n          action=\"Preparing\"\n          isShimmer={true}\n        />\n      ) : null;\n\n    case \"input-available\":\n      return (\n        <ToolBlock\n          key={toolCallId}\n          icon={<FileDown />}\n          action={status === \"streaming\" ? \"Sharing\" : \"Shared\"}\n          target={getFileNames(filesInput?.files || [])}\n          isShimmer={status === \"streaming\"}\n        />\n      );\n\n    case \"output-available\": {\n      // Support both new (files) and legacy (fileUrls) formats\n      const fileCount =\n        filesOutput?.files?.length || filesOutput?.fileUrls?.length || 0;\n      const fileNames = getFileNames(filesInput?.files || []);\n\n      return (\n        <ToolBlock\n          key={toolCallId}\n          icon={<FileDown />}\n          action={`Shared ${fileCount} file${fileCount !== 1 ? \"s\" : \"\"}`}\n          target={fileNames}\n        />\n      );\n    }\n\n    case \"output-error\":\n      return (\n        <ToolBlock\n          key={toolCallId}\n          icon={<FileDown />}\n          action=\"Failed to share\"\n          target={getFileNames(filesInput?.files || [])}\n        />\n      );\n\n    default:\n      return null;\n  }\n};\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAwBO,MAAM,0BAA0B,CAAC,EACtC,IAAI,EACJ,MAAM,EACuB;IAC7B,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;IAC7C,MAAM,aAAa;IACnB,MAAM,cAAc;IAEpB,MAAM,eAAe,CAAC;QACpB,OAAO,MAAM,GAAG,CAAC,CAAC,OAAS,KAAK,KAAK,CAAC,KAAK,GAAG,MAAM,MAAM,IAAI,CAAC;IACjE;IAEA,OAAQ;QACN,KAAK;YACH,OAAO,WAAW,4BAChB,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,8SAAQ;;;;;gBACf,QAAO;gBACP,WAAW;eAHN;;;;2DAKL;QAEN,KAAK;YACH,qBACE,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,8SAAQ;;;;;gBACf,QAAQ,WAAW,cAAc,YAAY;gBAC7C,QAAQ,aAAa,YAAY,SAAS,EAAE;gBAC5C,WAAW,WAAW;eAJjB;;;;;QAQX,KAAK;YAAoB;gBACvB,yDAAyD;gBACzD,MAAM,YACJ,aAAa,OAAO,UAAU,aAAa,UAAU,UAAU;gBACjE,MAAM,YAAY,aAAa,YAAY,SAAS,EAAE;gBAEtD,qBACE,6bAAC,6IAAS;oBAER,oBAAM,6bAAC,8SAAQ;;;;;oBACf,QAAQ,CAAC,OAAO,EAAE,UAAU,KAAK,EAAE,cAAc,IAAI,MAAM,IAAI;oBAC/D,QAAQ;mBAHH;;;;;YAMX;QAEA,KAAK;YACH,qBACE,6bAAC,6IAAS;gBAER,oBAAM,6bAAC,8SAAQ;;;;;gBACf,QAAO;gBACP,QAAQ,aAAa,YAAY,SAAS,EAAE;eAHvC;;;;;QAOX;YACE,OAAO;IACX;AACF"}},
    {"offset": {"line": 1852, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/tools/SummarizationHandler.tsx"],"sourcesContent":["import { UIMessage } from \"@ai-sdk/react\";\nimport { WandSparkles } from \"lucide-react\";\nimport { Shimmer } from \"@/components/ai-elements/shimmer\";\n\ninterface SummarizationHandlerProps {\n  message: UIMessage;\n  part: any;\n  partIndex: number;\n}\n\nexport const SummarizationHandler = ({\n  message,\n  part,\n  partIndex,\n}: SummarizationHandlerProps) => {\n  return (\n    <div\n      key={`${message.id}-summarization-${partIndex}`}\n      className=\"mb-3 flex items-center gap-2\"\n    >\n      <WandSparkles className=\"w-4 h-4 text-muted-foreground\" />\n      {part.data.status === \"started\" ? (\n        <Shimmer className=\"text-sm\">{`${part.data.message}...`}</Shimmer>\n      ) : (\n        <span className=\"text-sm text-muted-foreground\">\n          {part.data.message}\n        </span>\n      )}\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAQO,MAAM,uBAAuB,CAAC,EACnC,OAAO,EACP,IAAI,EACJ,SAAS,EACiB;IAC1B,qBACE,6bAAC;QAEC,WAAU;;0BAEV,6bAAC,0TAAY;gBAAC,WAAU;;;;;;YACvB,KAAK,IAAI,CAAC,MAAM,KAAK,0BACpB,6bAAC,mJAAO;gBAAC,WAAU;0BAAW,GAAG,KAAK,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC;;;;;yEAEvD,6bAAC;gBAAK,WAAU;0BACb,KAAK,IAAI,CAAC,OAAO;;;;;;;OARjB,GAAG,QAAQ,EAAE,CAAC,eAAe,EAAE,WAAW;;;;;AAarD"}},
    {"offset": {"line": 1901, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ReasoningHandler.tsx"],"sourcesContent":["\"use client\";\n\nimport { UIMessage } from \"@ai-sdk/react\";\nimport type { ChatStatus } from \"@/types\";\nimport { MemoizedMarkdown } from \"./MemoizedMarkdown\";\nimport {\n  Reasoning,\n  ReasoningContent,\n  ReasoningTrigger,\n} from \"@/components/ai-elements/reasoning\";\n\ntype ReasoningHandlerProps = {\n  message: UIMessage;\n  partIndex: number;\n  status: ChatStatus;\n  isLastMessage?: boolean;\n};\n\nconst collectReasoningText = (\n  parts: UIMessage[\"parts\"],\n  startIndex: number,\n): string => {\n  const collected: string[] = [];\n  for (let i = startIndex; i < parts.length; i++) {\n    const part = parts[i];\n    if (part?.type === \"reasoning\") {\n      collected.push(part.text ?? \"\");\n    } else {\n      break;\n    }\n  }\n  return collected.join(\"\");\n};\n\nexport const ReasoningHandler = ({\n  message,\n  partIndex,\n  status,\n  isLastMessage,\n}: ReasoningHandlerProps) => {\n  const parts = Array.isArray(message.parts) ? message.parts : [];\n  const currentPart = parts[partIndex];\n\n  if (currentPart?.type !== \"reasoning\") return null;\n\n  // Skip if previous part is also reasoning (avoid duplicate renders)\n  const previousPart = parts[partIndex - 1];\n  if (previousPart?.type === \"reasoning\") return null;\n\n  const combined = collectReasoningText(parts, partIndex);\n\n  if (!combined && status !== \"streaming\") return null;\n\n  const isLastPart = partIndex === parts.length - 1;\n  const autoOpen =\n    status === \"streaming\" && isLastPart && Boolean(isLastMessage);\n\n  return (\n    <Reasoning className=\"w-full\" isStreaming={autoOpen}>\n      <ReasoningTrigger />\n      {combined && (\n        <ReasoningContent>\n          <MemoizedMarkdown content={combined} />\n        </ReasoningContent>\n      )}\n    </Reasoning>\n  );\n};\n"],"names":[],"mappings":";;;;;AAIA;AACA;;;;;AALA;;;;AAkBA,MAAM,uBAAuB,CAC3B,OACA;IAEA,MAAM,YAAsB,EAAE;IAC9B,IAAK,IAAI,IAAI,YAAY,IAAI,MAAM,MAAM,EAAE,IAAK;QAC9C,MAAM,OAAO,KAAK,CAAC,EAAE;QACrB,IAAI,MAAM,SAAS,aAAa;YAC9B,UAAU,IAAI,CAAC,KAAK,IAAI,IAAI;QAC9B,OAAO;YACL;QACF;IACF;IACA,OAAO,UAAU,IAAI,CAAC;AACxB;AAEO,MAAM,mBAAmB,CAAC,EAC/B,OAAO,EACP,SAAS,EACT,MAAM,EACN,aAAa,EACS;IACtB,MAAM,QAAQ,MAAM,OAAO,CAAC,QAAQ,KAAK,IAAI,QAAQ,KAAK,GAAG,EAAE;IAC/D,MAAM,cAAc,KAAK,CAAC,UAAU;IAEpC,IAAI,aAAa,SAAS,aAAa,OAAO;IAE9C,oEAAoE;IACpE,MAAM,eAAe,KAAK,CAAC,YAAY,EAAE;IACzC,IAAI,cAAc,SAAS,aAAa,OAAO;IAE/C,MAAM,WAAW,qBAAqB,OAAO;IAE7C,IAAI,CAAC,YAAY,WAAW,aAAa,OAAO;IAEhD,MAAM,aAAa,cAAc,MAAM,MAAM,GAAG;IAChD,MAAM,WACJ,WAAW,eAAe,cAAc,QAAQ;IAElD,qBACE,6bAAC,uJAAS;QAAC,WAAU;QAAS,aAAa;;0BACzC,6bAAC,8JAAgB;;;;;YAChB,0BACC,6bAAC,8JAAgB;0BACf,cAAA,6bAAC,0JAAgB;oBAAC,SAAS;;;;;;;;;;;;;;;;;AAKrC"}},
    {"offset": {"line": 1975, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/MessagePartHandler.tsx"],"sourcesContent":["import { UIMessage } from \"@ai-sdk/react\";\nimport { MemoizedMarkdown } from \"./MemoizedMarkdown\";\nimport { FileToolsHandler } from \"./tools/FileToolsHandler\";\nimport { TerminalToolHandler } from \"./tools/TerminalToolHandler\";\nimport { PythonToolHandler } from \"./tools/PythonToolHandler\";\nimport { WebSearchToolHandler, WebToolHandler } from \"./tools/WebToolHandler\";\nimport { TodoToolHandler } from \"./tools/TodoToolHandler\";\nimport { MemoryToolHandler } from \"./tools/MemoryToolHandler\";\nimport { GetTerminalFilesHandler } from \"./tools/GetTerminalFilesHandler\";\nimport { SummarizationHandler } from \"./tools/SummarizationHandler\";\nimport type { ChatStatus } from \"@/types\";\nimport { ReasoningHandler } from \"./ReasoningHandler\";\n\ninterface MessagePartHandlerProps {\n  message: UIMessage;\n  part: any;\n  partIndex: number;\n  status: ChatStatus;\n  isLastMessage?: boolean;\n}\n\nexport const MessagePartHandler = ({\n  message,\n  part,\n  partIndex,\n  status,\n  isLastMessage,\n}: MessagePartHandlerProps) => {\n  const renderTextPart = () => {\n    const partId = `${message.id}-text-${partIndex}`;\n    const isUser = message.role === \"user\";\n\n    // For user messages, render plain text to avoid markdown processing\n    if (isUser) {\n      return (\n        <div key={partId} className=\"whitespace-pre-wrap\">\n          {part.text ?? \"\"}\n        </div>\n      );\n    }\n\n    // For assistant messages, use markdown rendering\n    return <MemoizedMarkdown key={partId} content={part.text ?? \"\"} />;\n  };\n\n  // Main switch for different part types\n  switch (part.type) {\n    case \"text\":\n      return renderTextPart();\n\n    case \"reasoning\":\n      return (\n        <ReasoningHandler\n          message={message}\n          partIndex={partIndex}\n          status={status}\n          isLastMessage={isLastMessage}\n        />\n      );\n\n    case \"data-summarization\":\n      return (\n        <SummarizationHandler\n          message={message}\n          part={part}\n          partIndex={partIndex}\n        />\n      );\n\n    case \"tool-read_file\":\n    case \"tool-write_file\":\n    case \"tool-delete_file\":\n    case \"tool-search_replace\":\n    case \"tool-multi_edit\":\n      return <FileToolsHandler message={message} part={part} status={status} />;\n\n    // Keep the old export for backward compatibility\n    case \"tool-web_search\":\n      return <WebSearchToolHandler part={part} status={status} />;\n\n    case \"tool-web\":\n      return <WebToolHandler part={part} status={status} />;\n\n    case \"data-terminal\":\n    case \"tool-run_terminal_cmd\":\n      return (\n        <TerminalToolHandler message={message} part={part} status={status} />\n      );\n\n    case \"data-python\":\n    case \"tool-python\":\n      return (\n        <PythonToolHandler message={message} part={part} status={status} />\n      );\n\n    case \"tool-get_terminal_files\":\n      return <GetTerminalFilesHandler part={part} status={status} />;\n\n    case \"tool-todo_write\":\n      return <TodoToolHandler message={message} part={part} status={status} />;\n\n    case \"tool-update_memory\":\n      return <MemoryToolHandler part={part} status={status} />;\n\n    default:\n      return null;\n  }\n};\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;AAUO,MAAM,qBAAqB,CAAC,EACjC,OAAO,EACP,IAAI,EACJ,SAAS,EACT,MAAM,EACN,aAAa,EACW;IACxB,MAAM,iBAAiB;QACrB,MAAM,SAAS,GAAG,QAAQ,EAAE,CAAC,MAAM,EAAE,WAAW;QAChD,MAAM,SAAS,QAAQ,IAAI,KAAK;QAEhC,oEAAoE;QACpE,IAAI,QAAQ;YACV,qBACE,6bAAC;gBAAiB,WAAU;0BACzB,KAAK,IAAI,IAAI;eADN;;;;;QAId;QAEA,iDAAiD;QACjD,qBAAO,6bAAC,0JAAgB;YAAc,SAAS,KAAK,IAAI,IAAI;WAA9B;;;;;IAChC;IAEA,uCAAuC;IACvC,OAAQ,KAAK,IAAI;QACf,KAAK;YACH,OAAO;QAET,KAAK;YACH,qBACE,6bAAC,0JAAgB;gBACf,SAAS;gBACT,WAAW;gBACX,QAAQ;gBACR,eAAe;;;;;;QAIrB,KAAK;YACH,qBACE,6bAAC,2KAAoB;gBACnB,SAAS;gBACT,MAAM;gBACN,WAAW;;;;;;QAIjB,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACH,qBAAO,6bAAC,mKAAgB;gBAAC,SAAS;gBAAS,MAAM;gBAAM,QAAQ;;;;;;QAEjE,iDAAiD;QACjD,KAAK;YACH,qBAAO,6bAAC,qKAAoB;gBAAC,MAAM;gBAAM,QAAQ;;;;;;QAEnD,KAAK;YACH,qBAAO,6bAAC,+JAAc;gBAAC,MAAM;gBAAM,QAAQ;;;;;;QAE7C,KAAK;QACL,KAAK;YACH,qBACE,6bAAC,yKAAmB;gBAAC,SAAS;gBAAS,MAAM;gBAAM,QAAQ;;;;;;QAG/D,KAAK;QACL,KAAK;YACH,qBACE,6bAAC,qKAAiB;gBAAC,SAAS;gBAAS,MAAM;gBAAM,QAAQ;;;;;;QAG7D,KAAK;YACH,qBAAO,6bAAC,iLAAuB;gBAAC,MAAM;gBAAM,QAAQ;;;;;;QAEtD,KAAK;YACH,qBAAO,6bAAC,iKAAe;gBAAC,SAAS;gBAAS,MAAM;gBAAM,QAAQ;;;;;;QAEhE,KAAK;YACH,qBAAO,6bAAC,qKAAiB;gBAAC,MAAM;gBAAM,QAAQ;;;;;;QAEhD;YACE,OAAO;IACX;AACF"}},
    {"offset": {"line": 2147, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ImageViewer.tsx"],"sourcesContent":["import Image from \"next/image\";\nimport { useState, useEffect, useRef } from \"react\";\n\ninterface ImageViewerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  imageSrc: string;\n  imageAlt: string;\n}\n\nexport const ImageViewer = ({\n  isOpen,\n  onClose,\n  imageSrc,\n  imageAlt,\n}: ImageViewerProps) => {\n  const [isImageLoading, setIsImageLoading] = useState(true);\n  const dialogRef = useRef<HTMLDivElement>(null);\n\n  // Reset loading state when imageSrc changes\n  useEffect(() => {\n    // eslint-disable-next-line react-hooks/set-state-in-effect\n    setIsImageLoading(true);\n  }, [imageSrc]);\n\n  // Focus the dialog when it opens\n  useEffect(() => {\n    if (isOpen && dialogRef.current) {\n      dialogRef.current.focus();\n    }\n  }, [isOpen]);\n\n  // Handle Escape key press\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        onClose();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n    };\n  }, [isOpen, onClose]);\n\n  // Don't render if not open or no valid image source\n  if (!isOpen || !imageSrc || imageSrc.trim() === \"\") {\n    return null;\n  }\n\n  const handleImageLoad = () => {\n    setIsImageLoading(false);\n  };\n\n  const handleImageError = () => {\n    setIsImageLoading(false);\n  };\n\n  const handleClose = () => {\n    onClose();\n  };\n\n  const handleBackdropClick = (e: React.MouseEvent) => {\n    if (e.target === e.currentTarget) {\n      handleClose();\n    }\n  };\n\n  return (\n    <div\n      data-state=\"open\"\n      className=\"radix-state-open:animate-show fixed inset-0 z-[100] flex items-center justify-center overflow-hidden bg-black/90 dark:bg-black/80\"\n      style={{ pointerEvents: \"auto\" }}\n      onClick={handleBackdropClick}\n      tabIndex={-1}\n      data-testid=\"image-zoom-modal\"\n    >\n      {/* Close Button */}\n      <button\n        className=\"absolute end-4 top-4 hover:opacity-70 transition-opacity\"\n        type=\"button\"\n        onClick={handleClose}\n        aria-label=\"Close image viewer\"\n        tabIndex={0}\n      >\n        <svg\n          width=\"20\"\n          height=\"20\"\n          viewBox=\"0 0 20 20\"\n          fill=\"currentColor\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          className=\"h-5 w-5 text-gray-100\"\n        >\n          <path d=\"M14.2548 4.75488C14.5282 4.48152 14.9717 4.48152 15.2451 4.75488C15.5184 5.02825 15.5184 5.47175 15.2451 5.74512L10.9902 10L15.2451 14.2549L15.3349 14.3652C15.514 14.6369 15.4841 15.006 15.2451 15.2451C15.006 15.4842 14.6368 15.5141 14.3652 15.335L14.2548 15.2451L9.99995 10.9902L5.74506 15.2451C5.4717 15.5185 5.0282 15.5185 4.75483 15.2451C4.48146 14.9718 4.48146 14.5282 4.75483 14.2549L9.00971 10L4.75483 5.74512L4.66499 5.63477C4.48589 5.3631 4.51575 4.99396 4.75483 4.75488C4.99391 4.51581 5.36305 4.48594 5.63471 4.66504L5.74506 4.75488L9.99995 9.00977L14.2548 4.75488Z\" />\n        </svg>\n      </button>\n\n      {/* Image Container */}\n      <div\n        ref={dialogRef}\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-labelledby=\"image-viewer-title\"\n        aria-describedby=\"image-viewer-description\"\n        data-state=\"open\"\n        className=\"radix-state-open:animate-contentShow shadow-xl focus:outline-hidden relative\"\n        tabIndex={-1}\n        style={{ pointerEvents: \"auto\" }}\n      >\n        {/* Screen reader title */}\n        <div id=\"image-viewer-title\" className=\"sr-only\">\n          Image Viewer\n        </div>\n        <div id=\"image-viewer-description\" className=\"sr-only\">\n          {imageAlt}\n        </div>\n\n        <div className=\"relative max-h-[85vh] max-w-[90vw]\">\n          {/* Loading Indicator */}\n          {isImageLoading && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-black/50 rounded-lg\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"animate-spin rounded-full h-6 w-6 border-2 border-white border-t-transparent\" />\n                <span className=\"text-sm text-white\">Loading...</span>\n              </div>\n            </div>\n          )}\n\n          <Image\n            className={`h-full w-full object-contain transition-opacity duration-300 ${\n              isImageLoading ? \"opacity-0\" : \"opacity-100\"\n            }`}\n            src={imageSrc}\n            alt={imageAlt}\n            width={1200}\n            height={800}\n            style={{\n              maxHeight: \"85vh\",\n              maxWidth: \"90vw\",\n              height: \"auto\",\n              width: \"auto\",\n            }}\n            sizes=\"(max-width: 768px) 90vw, 85vw\"\n            onLoad={handleImageLoad}\n            onError={handleImageError}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AASO,MAAM,cAAc,CAAC,EAC1B,MAAM,EACN,OAAO,EACP,QAAQ,EACR,QAAQ,EACS;IACjB,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,gaAAQ,EAAC;IACrD,MAAM,YAAY,IAAA,8ZAAM,EAAiB;IAEzC,4CAA4C;IAC5C,IAAA,iaAAS,EAAC;QACR,2DAA2D;QAC3D,kBAAkB;IACpB,GAAG;QAAC;KAAS;IAEb,iCAAiC;IACjC,IAAA,iaAAS,EAAC;QACR,IAAI,UAAU,UAAU,OAAO,EAAE;YAC/B,UAAU,OAAO,CAAC,KAAK;QACzB;IACF,GAAG;QAAC;KAAO;IAEX,0BAA0B;IAC1B,IAAA,iaAAS,EAAC;QACR,IAAI,CAAC,QAAQ;QAEb,MAAM,gBAAgB,CAAC;YACrB,IAAI,EAAE,GAAG,KAAK,UAAU;gBACtB;YACF;QACF;QAEA,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO;YACL,OAAO,mBAAmB,CAAC,WAAW;QACxC;IACF,GAAG;QAAC;QAAQ;KAAQ;IAEpB,oDAAoD;IACpD,IAAI,CAAC,UAAU,CAAC,YAAY,SAAS,IAAI,OAAO,IAAI;QAClD,OAAO;IACT;IAEA,MAAM,kBAAkB;QACtB,kBAAkB;IACpB;IAEA,MAAM,mBAAmB;QACvB,kBAAkB;IACpB;IAEA,MAAM,cAAc;QAClB;IACF;IAEA,MAAM,sBAAsB,CAAC;QAC3B,IAAI,EAAE,MAAM,KAAK,EAAE,aAAa,EAAE;YAChC;QACF;IACF;IAEA,qBACE,6bAAC;QACC,cAAW;QACX,WAAU;QACV,OAAO;YAAE,eAAe;QAAO;QAC/B,SAAS;QACT,UAAU,CAAC;QACX,eAAY;;0BAGZ,6bAAC;gBACC,WAAU;gBACV,MAAK;gBACL,SAAS;gBACT,cAAW;gBACX,UAAU;0BAEV,cAAA,6bAAC;oBACC,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,OAAM;oBACN,WAAU;8BAEV,cAAA,6bAAC;wBAAK,GAAE;;;;;;;;;;;;;;;;0BAKZ,6bAAC;gBACC,KAAK;gBACL,MAAK;gBACL,cAAW;gBACX,mBAAgB;gBAChB,oBAAiB;gBACjB,cAAW;gBACX,WAAU;gBACV,UAAU,CAAC;gBACX,OAAO;oBAAE,eAAe;gBAAO;;kCAG/B,6bAAC;wBAAI,IAAG;wBAAqB,WAAU;kCAAU;;;;;;kCAGjD,6bAAC;wBAAI,IAAG;wBAA2B,WAAU;kCAC1C;;;;;;kCAGH,6bAAC;wBAAI,WAAU;;4BAEZ,gCACC,6bAAC;gCAAI,WAAU;0CACb,cAAA,6bAAC;oCAAI,WAAU;;sDACb,6bAAC;4CAAI,WAAU;;;;;;sDACf,6bAAC;4CAAK,WAAU;sDAAqB;;;;;;;;;;;;;;;;;0CAK3C,6bAAC,uVAAK;gCACJ,WAAW,CAAC,6DAA6D,EACvE,iBAAiB,cAAc,eAC/B;gCACF,KAAK;gCACL,KAAK;gCACL,OAAO;gCACP,QAAQ;gCACR,OAAO;oCACL,WAAW;oCACX,UAAU;oCACV,QAAQ;oCACR,OAAO;gCACT;gCACA,OAAM;gCACN,QAAQ;gCACR,SAAS;;;;;;;;;;;;;;;;;;;;;;;;AAMrB"}},
    {"offset": {"line": 2357, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/FilePartRenderer.tsx"],"sourcesContent":["import Image from \"next/image\";\nimport React, { useState, memo, useMemo, useCallback, useEffect } from \"react\";\nimport { useConvex, useAction } from \"convex/react\";\nimport { ConvexError } from \"convex/values\";\nimport { api } from \"@/convex/_generated/api\";\nimport { ImageViewer } from \"./ImageViewer\";\nimport { AlertCircle, File, Download } from \"lucide-react\";\nimport { FilePart, FilePartRendererProps } from \"@/types/file\";\nimport { toast } from \"sonner\";\nimport { useFileUrlCacheContext } from \"../contexts/FileUrlCacheContext\";\n\nconst FilePartRendererComponent = ({\n  part,\n  partIndex,\n  messageId,\n  totalFileParts = 1,\n}: FilePartRendererProps) => {\n  const convex = useConvex();\n  const getFileUrlAction = useAction(api.s3Actions.getFileUrlAction);\n  const fileUrlCache = useFileUrlCacheContext();\n  const [selectedImage, setSelectedImage] = useState<{\n    src: string;\n    alt: string;\n  } | null>(null);\n  const [downloadingFile, setDownloadingFile] = useState(false);\n  const [fileUrl, setFileUrl] = useState<string | null>(null);\n  const [urlError, setUrlError] = useState<string | null>(null);\n\n  // Fetch URL ONLY for images (inline display) - non-images are fetched lazily on click\n  useEffect(() => {\n    // Reset state when file part identifiers change to avoid stale URLs\n    setFileUrl(null);\n    setUrlError(null);\n\n    async function fetchUrl() {\n      // Only fetch URLs eagerly for images (they display inline)\n      // Non-images will be fetched lazily when user clicks download button\n      const isImage = part.mediaType?.startsWith(\"image/\");\n      if (!isImage) {\n        return;\n      }\n\n      // If we have fileId (for S3 files), check cache first\n      if (part.fileId) {\n        if (fileUrlCache) {\n          const cachedUrl = fileUrlCache.getCachedUrl(part.fileId);\n          if (cachedUrl) {\n            setFileUrl(cachedUrl);\n            return;\n          }\n        }\n\n        // Not in cache, fetch URL for image\n        setUrlError(null);\n        try {\n          const url = await getFileUrlAction({ fileId: part.fileId });\n          setFileUrl(url);\n          // Cache the fetched URL\n          if (fileUrlCache) {\n            fileUrlCache.setCachedUrl(part.fileId, url);\n          }\n        } catch (error) {\n          console.error(\"Failed to fetch file URL:\", error);\n          const errorMessage =\n            error instanceof ConvexError\n              ? (error.data as { message?: string })?.message ||\n                error.message ||\n                \"Failed to load file\"\n              : error instanceof Error\n                ? error.message\n                : \"Failed to load file\";\n          setUrlError(errorMessage);\n          toast.error(errorMessage);\n        }\n        return;\n      }\n\n      // Fallback: if no fileId but we have part.url (Convex storage), use it\n      if (part.url) {\n        setFileUrl(part.url);\n        return;\n      }\n\n      // If we have storageId (for Convex files), fetch URL on-demand for images\n      if (part.storageId) {\n        setUrlError(null);\n        try {\n          const url = await convex.query(api.fileStorage.getFileDownloadUrl, {\n            storageId: part.storageId,\n          });\n          if (url) {\n            setFileUrl(url);\n          } else {\n            setUrlError(\"Failed to get download URL\");\n          }\n        } catch (error) {\n          console.error(\"Failed to fetch download URL:\", error);\n          const errorMessage =\n            error instanceof ConvexError\n              ? (error.data as { message?: string })?.message ||\n                error.message ||\n                \"Failed to load file\"\n              : error instanceof Error\n                ? error.message\n                : \"Failed to load file\";\n          setUrlError(errorMessage);\n          toast.error(errorMessage);\n        }\n        return;\n      }\n    }\n\n    fetchUrl();\n  }, [\n    part.url,\n    part.fileId,\n    part.storageId,\n    part.mediaType,\n    getFileUrlAction,\n    convex,\n    fileUrlCache,\n  ]);\n\n  const handleDownload = useCallback(async (url: string, fileName: string) => {\n    try {\n      setDownloadingFile(true);\n      const response = await fetch(url);\n      const blob = await response.blob();\n      const blobUrl = URL.createObjectURL(blob);\n\n      const link = document.createElement(\"a\");\n      link.href = blobUrl;\n      link.download = fileName;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n\n      URL.revokeObjectURL(blobUrl);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      toast.error(\"Failed to download file\");\n      window.open(url, \"_blank\", \"noopener,noreferrer\");\n    } finally {\n      setDownloadingFile(false);\n    }\n  }, []);\n\n  const handleNonImageFileClick = useCallback(\n    async (fileName: string) => {\n      // Check if we already have the URL cached or in state\n      if (fileUrl) {\n        await handleDownload(fileUrl, fileName);\n        return;\n      }\n\n      // Check cache first\n      if (fileUrlCache && part.fileId) {\n        const cachedUrl = fileUrlCache.getCachedUrl(part.fileId);\n        if (cachedUrl) {\n          await handleDownload(cachedUrl, fileName);\n          return;\n        }\n      }\n\n      // Clear error state before attempting fetch (allows recovery from transient failures)\n      setUrlError(null);\n\n      // Fetch URL lazily on click\n      try {\n        let url: string | null = null;\n\n        if (part.fileId) {\n          // S3 file - fetch presigned URL\n          url = await getFileUrlAction({ fileId: part.fileId });\n\n          // Cache it for future clicks\n          if (url && fileUrlCache) {\n            fileUrlCache.setCachedUrl(part.fileId, url);\n          }\n        } else if (part.storageId) {\n          // Convex storage file - fetch URL\n          url = await convex.query(api.fileStorage.getFileDownloadUrl, {\n            storageId: part.storageId,\n          });\n        }\n\n        if (url) {\n          setFileUrl(url);\n          await handleDownload(url, fileName);\n        } else {\n          setUrlError(\"Failed to get download URL\");\n          toast.error(\"Failed to get download URL\");\n        }\n      } catch (error) {\n        console.error(\"Failed to fetch download URL:\", error);\n        const errorMessage =\n          error instanceof ConvexError\n            ? (error.data as { message?: string })?.message ||\n              error.message ||\n              \"Failed to fetch download URL\"\n            : error instanceof Error\n              ? error.message\n              : \"Failed to fetch download URL\";\n        setUrlError(errorMessage);\n        toast.error(errorMessage);\n      }\n    },\n    [\n      fileUrl,\n      handleDownload,\n      part.fileId,\n      part.storageId,\n      fileUrlCache,\n      getFileUrlAction,\n      convex,\n    ],\n  );\n\n  // Memoize file preview component to prevent unnecessary re-renders\n  const FilePreviewCard = useMemo(() => {\n    const PreviewCard = ({\n      partId,\n      icon,\n      fileName,\n      subtitle,\n      url,\n      storageId,\n      fileId,\n    }: {\n      partId: string;\n      icon: React.ReactNode;\n      fileName: string;\n      subtitle: string;\n      url?: string;\n      storageId?: string;\n      fileId?: string;\n    }) => {\n      const content = (\n        <div className=\"flex flex-row items-center gap-2\">\n          <div className=\"relative h-10 w-10 shrink-0 overflow-hidden rounded-lg bg-[#FF5588] flex items-center justify-center\">\n            {icon}\n          </div>\n          <div className=\"overflow-hidden flex-1\">\n            <div className=\"truncate font-semibold text-sm text-left\">\n              {fileName}\n            </div>\n            <div className=\"text-muted-foreground truncate text-xs text-left\">\n              {subtitle}\n            </div>\n          </div>\n          {(url || storageId || fileId) && (\n            <div className=\"flex items-center justify-center w-6 h-6 rounded-md border border-border opacity-0 group-hover:opacity-100 transition-opacity\">\n              <Download className=\"w-4 h-4 text-muted-foreground\" />\n            </div>\n          )}\n        </div>\n      );\n\n      if (url || storageId || fileId) {\n        return (\n          <button\n            key={partId}\n            onClick={() => handleNonImageFileClick(fileName)}\n            disabled={downloadingFile}\n            className=\"group p-2 w-full max-w-80 min-w-64 border rounded-lg bg-background hover:bg-secondary transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n            type=\"button\"\n            aria-label={`Download ${fileName}`}\n          >\n            {content}\n          </button>\n        );\n      }\n\n      return (\n        <div\n          key={partId}\n          className=\"p-2 w-full max-w-80 min-w-64 border rounded-lg bg-background\"\n        >\n          {content}\n        </div>\n      );\n    };\n    PreviewCard.displayName = \"FilePreviewCard\";\n    return PreviewCard;\n  }, [handleNonImageFileClick, downloadingFile]);\n\n  // Memoize ConvexFilePart to prevent unnecessary re-renders\n  const ConvexFilePart = memo(\n    ({ part, partId }: { part: FilePart; partId: string }) => {\n      // Show error state if URL fetch failed\n      if (urlError) {\n        return (\n          <FilePreviewCard\n            partId={partId}\n            icon={<AlertCircle className=\"h-6 w-6 text-red-500\" />}\n            fileName={part.name || part.filename || \"Unknown file\"}\n            subtitle={urlError}\n            url={undefined}\n            storageId={undefined}\n            fileId={undefined}\n          />\n        );\n      }\n\n      // Use the fetched URL or the URL from props\n      const actualUrl = fileUrl || part.url;\n\n      if (!actualUrl && !part.storageId && !part.fileId) {\n        // Error state for files without URLs or storage references\n        return (\n          <FilePreviewCard\n            partId={partId}\n            icon={<AlertCircle className=\"h-6 w-6 text-red-500\" />}\n            fileName={part.name || part.filename || \"Unknown file\"}\n            subtitle=\"File not available\"\n            url={undefined}\n            storageId={undefined}\n            fileId={undefined}\n          />\n        );\n      }\n\n      // Handle image files - they should always have URL\n      if (part.mediaType?.startsWith(\"image/\")) {\n        if (!actualUrl) {\n          return (\n            <FilePreviewCard\n              partId={partId}\n              icon={<AlertCircle className=\"h-6 w-6 text-red-500\" />}\n              fileName={part.name || part.filename || \"Unknown image\"}\n              subtitle=\"Image URL not available\"\n              url={undefined}\n              storageId={undefined}\n              fileId={undefined}\n            />\n          );\n        }\n\n        const altText = part.name || `Uploaded image ${partIndex + 1}`;\n        const isMultipleImages = totalFileParts > 1;\n\n        // Different styling for single vs multiple images\n        const containerClass = isMultipleImages\n          ? \"overflow-hidden rounded-lg\"\n          : \"overflow-hidden rounded-lg max-w-64\";\n\n        const innerContainerClass = isMultipleImages\n          ? \"bg-token-main-surface-secondary text-token-text-tertiary relative flex items-center justify-center overflow-hidden\"\n          : \"bg-token-main-surface-secondary text-token-text-tertiary relative flex items-center justify-center overflow-hidden\";\n\n        const buttonClass = isMultipleImages\n          ? \"overflow-hidden rounded-lg\"\n          : \"overflow-hidden rounded-lg w-full\";\n\n        const imageClass = isMultipleImages\n          ? \"aspect-square object-cover object-center h-32 w-32 rounded-se-2xl rounded-ee-sm overflow-hidden transition-opacity duration-300 opacity-100\"\n          : \"w-full h-auto max-h-96 max-w-64 object-contain rounded-lg transition-opacity duration-300 opacity-100\";\n\n        return (\n          <div key={partId} className={containerClass}>\n            <div className={innerContainerClass}>\n              <button\n                onClick={() =>\n                  setSelectedImage({ src: actualUrl, alt: altText })\n                }\n                className={buttonClass}\n                aria-label={`View ${altText} in full size`}\n                type=\"button\"\n              >\n                <Image\n                  src={actualUrl}\n                  alt={altText}\n                  width={902}\n                  height={2048}\n                  className={imageClass}\n                  style={{ maxWidth: \"100%\", height: \"auto\" }}\n                />\n              </button>\n            </div>\n          </div>\n        );\n      }\n\n      // Handle all non-image files with the new UI (use storageId or fileId if no URL)\n      return (\n        <FilePreviewCard\n          partId={partId}\n          icon={<File className=\"h-6 w-6 text-white\" />}\n          fileName={part.name || part.filename || \"Document\"}\n          subtitle=\"Document\"\n          url={actualUrl}\n          storageId={part.storageId}\n          fileId={part.fileId}\n        />\n      );\n    },\n  );\n\n  ConvexFilePart.displayName = \"ConvexFilePart\";\n\n  // Memoize the rendered file part to prevent re-renders\n  const renderedFilePart = useMemo(() => {\n    const partId = `${messageId}-file-${partIndex}`;\n\n    // Check if this is a file part with either URL, storageId, or fileId\n    if (part.url || part.storageId || part.fileId || fileUrl) {\n      return <ConvexFilePart part={part} partId={partId} />;\n    }\n\n    // Fallback for unsupported file types\n    return (\n      <FilePreviewCard\n        partId={partId}\n        icon={<File className=\"h-6 w-6 text-white\" />}\n        fileName={part.name || part.filename || \"Unknown file\"}\n        subtitle=\"Document\"\n        url={part.url}\n        storageId={part.storageId}\n        fileId={part.fileId}\n      />\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    messageId,\n    partIndex,\n    part.url,\n    part.storageId,\n    part.fileId,\n    fileUrl,\n    urlError,\n    FilePreviewCard,\n  ]);\n\n  return (\n    <>\n      {renderedFilePart}\n      {/* Image Viewer Modal */}\n      {selectedImage && (\n        <ImageViewer\n          isOpen={!!selectedImage}\n          onClose={() => setSelectedImage(null)}\n          imageSrc={selectedImage.src}\n          imageAlt={selectedImage.alt}\n        />\n      )}\n    </>\n  );\n};\n\n// Memoize the entire component to prevent unnecessary re-renders during streaming\nexport const FilePartRenderer = memo(\n  FilePartRendererComponent,\n  (prevProps, nextProps) => {\n    // Custom comparison to prevent re-renders when props haven't meaningfully changed\n    return (\n      prevProps.messageId === nextProps.messageId &&\n      prevProps.partIndex === nextProps.partIndex &&\n      prevProps.totalFileParts === nextProps.totalFileParts &&\n      prevProps.part.url === nextProps.part.url &&\n      prevProps.part.storageId === nextProps.part.storageId &&\n      prevProps.part.fileId === nextProps.part.fileId &&\n      prevProps.part.s3Key === nextProps.part.s3Key &&\n      prevProps.part.name === nextProps.part.name &&\n      prevProps.part.filename === nextProps.part.filename &&\n      prevProps.part.mediaType === nextProps.part.mediaType\n    );\n  },\n);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2848, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/MessageErrorState.tsx"],"sourcesContent":["import { Button } from \"@/components/ui/button\";\nimport { MemoizedMarkdown } from \"./MemoizedMarkdown\";\nimport { ChatSDKError } from \"@/lib/errors\";\nimport { useGlobalState } from \"@/app/contexts/GlobalState\";\nimport { redirectToPricing } from \"@/app/hooks/usePricingDialog\";\n\ninterface MessageErrorStateProps {\n  error: Error;\n  onRetry: () => void;\n}\n\nexport const MessageErrorState = ({\n  error,\n  onRetry,\n}: MessageErrorStateProps) => {\n  const { subscription } = useGlobalState();\n  const isRateLimitError =\n    error instanceof ChatSDKError && error.type === \"rate_limit\";\n\n  // Extract error message - check for cause first, then message\n  const errorMessage = (() => {\n    if (error instanceof ChatSDKError) {\n      return typeof error.cause === \"string\" ? error.cause : error.message;\n    }\n    return error.message || \"An error occurred.\";\n  })();\n\n  return (\n    <div className=\"bg-destructive/10 border border-destructive/20 rounded-lg p-3\">\n      <div className=\"text-destructive text-sm mb-2\">\n        {isRateLimitError ? (\n          <MemoizedMarkdown content={errorMessage} />\n        ) : (\n          <p>{errorMessage}</p>\n        )}\n      </div>\n      <div className=\"flex gap-2\">\n        <Button variant=\"destructive\" size=\"sm\" onClick={onRetry}>\n          {isRateLimitError ? \"Try Again\" : \"Retry\"}\n        </Button>\n        {isRateLimitError && subscription === \"free\" && (\n          <Button variant=\"default\" size=\"sm\" onClick={redirectToPricing}>\n            Upgrade\n          </Button>\n        )}\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAOO,MAAM,oBAAoB,CAAC,EAChC,KAAK,EACL,OAAO,EACgB;IACvB,MAAM,EAAE,YAAY,EAAE,GAAG,IAAA,iJAAc;IACvC,MAAM,mBACJ,iBAAiB,6HAAY,IAAI,MAAM,IAAI,KAAK;IAElD,8DAA8D;IAC9D,MAAM,eAAe,CAAC;QACpB,IAAI,iBAAiB,6HAAY,EAAE;YACjC,OAAO,OAAO,MAAM,KAAK,KAAK,WAAW,MAAM,KAAK,GAAG,MAAM,OAAO;QACtE;QACA,OAAO,MAAM,OAAO,IAAI;IAC1B,CAAC;IAED,qBACE,6bAAC;QAAI,WAAU;;0BACb,6bAAC;gBAAI,WAAU;0BACZ,iCACC,6bAAC,0JAAgB;oBAAC,SAAS;;;;;6EAE3B,6bAAC;8BAAG;;;;;;;;;;;0BAGR,6bAAC;gBAAI,WAAU;;kCACb,6bAAC,qIAAM;wBAAC,SAAQ;wBAAc,MAAK;wBAAK,SAAS;kCAC9C,mBAAmB,cAAc;;;;;;oBAEnC,oBAAoB,iBAAiB,wBACpC,6bAAC,qIAAM;wBAAC,SAAQ;wBAAU,MAAK;wBAAK,SAAS,qJAAiB;kCAAE;;;;;;;;;;;;;;;;;;AAO1E"}},
    {"offset": {"line": 2942, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/MessageEditor.tsx"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport TextareaAutosize from \"react-textarea-autosize\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\nimport {\n  countInputTokens,\n  getMaxTokensForSubscription,\n} from \"@/lib/token-utils\";\nimport { toast } from \"sonner\";\n\ninterface MessageEditorProps {\n  initialContent: string;\n  onSave: (content: string) => void;\n  onCancel: () => void;\n}\n\nexport const MessageEditor = ({\n  initialContent,\n  onSave,\n  onCancel,\n}: MessageEditorProps) => {\n  const { subscription } = useGlobalState();\n  const [content, setContent] = useState(initialContent);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  useEffect(() => {\n    setContent(initialContent);\n  }, [initialContent]);\n\n  useEffect(() => {\n    // Auto-focus and select all text when component mounts\n    if (textareaRef.current) {\n      textareaRef.current.focus();\n      textareaRef.current.select();\n    }\n  }, []);\n\n  const handleSave = () => {\n    const trimmedContent = content.trim();\n    if (!trimmedContent) return;\n\n    // Check token limit for edited content based on user plan\n    const tokenCount = countInputTokens(trimmedContent, []);\n    const maxTokens = getMaxTokensForSubscription(subscription);\n\n    if (tokenCount > maxTokens) {\n      const planText = subscription !== \"free\" ? \"\" : \" (Free plan limit)\";\n      toast.error(\"Message is too long\", {\n        description: `Your edited message is too large (${tokenCount.toLocaleString()} tokens). Maximum is ${maxTokens.toLocaleString()} tokens${planText}.`,\n      });\n      return;\n    }\n\n    onSave(trimmedContent);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Escape\") {\n      onCancel();\n    } else if (e.key === \"Enter\" && (e.metaKey || e.ctrlKey)) {\n      e.preventDefault();\n      handleSave();\n    }\n  };\n\n  return (\n    <div className=\"w-full bg-secondary border border-border rounded-lg p-4 space-y-3\">\n      <TextareaAutosize\n        ref={textareaRef}\n        value={content}\n        onChange={(e) => setContent(e.target.value)}\n        onKeyDown={handleKeyDown}\n        className=\"w-full p-3 text-foreground rounded-md resize-none focus:outline-none\"\n        minRows={2}\n        maxRows={10}\n      />\n      <div className=\"flex justify-end space-x-2\">\n        <Button variant=\"outline\" size=\"sm\" onClick={onCancel}>\n          Cancel\n        </Button>\n        <Button size=\"sm\" onClick={handleSave} disabled={!content.trim()}>\n          Save\n        </Button>\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AAIA;;;;;;;;AAQO,MAAM,gBAAgB,CAAC,EAC5B,cAAc,EACd,MAAM,EACN,QAAQ,EACW;IACnB,MAAM,EAAE,YAAY,EAAE,GAAG,IAAA,iJAAc;IACvC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gaAAQ,EAAC;IACvC,MAAM,cAAc,IAAA,8ZAAM,EAAsB;IAEhD,IAAA,iaAAS,EAAC;QACR,WAAW;IACb,GAAG;QAAC;KAAe;IAEnB,IAAA,iaAAS,EAAC;QACR,uDAAuD;QACvD,IAAI,YAAY,OAAO,EAAE;YACvB,YAAY,OAAO,CAAC,KAAK;YACzB,YAAY,OAAO,CAAC,MAAM;QAC5B;IACF,GAAG,EAAE;IAEL,MAAM,aAAa;QACjB,MAAM,iBAAiB,QAAQ,IAAI;QACnC,IAAI,CAAC,gBAAgB;QAErB,0DAA0D;QAC1D,MAAM,aAAa,IAAA,yIAAgB,EAAC,gBAAgB,EAAE;QACtD,MAAM,YAAY,IAAA,oJAA2B,EAAC;QAE9C,IAAI,aAAa,WAAW;YAC1B,MAAM,WAAW,iBAAiB,SAAS,KAAK;YAChD,iRAAK,CAAC,KAAK,CAAC,uBAAuB;gBACjC,aAAa,CAAC,kCAAkC,EAAE,WAAW,cAAc,GAAG,qBAAqB,EAAE,UAAU,cAAc,GAAG,OAAO,EAAE,SAAS,CAAC,CAAC;YACtJ;YACA;QACF;QAEA,OAAO;IACT;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,UAAU;YACtB;QACF,OAAO,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,OAAO,IAAI,EAAE,OAAO,GAAG;YACxD,EAAE,cAAc;YAChB;QACF;IACF;IAEA,qBACE,6bAAC;QAAI,WAAU;;0BACb,6bAAC,0VAAgB;gBACf,KAAK;gBACL,OAAO;gBACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;gBAC1C,WAAW;gBACX,WAAU;gBACV,SAAS;gBACT,SAAS;;;;;;0BAEX,6bAAC;gBAAI,WAAU;;kCACb,6bAAC,qIAAM;wBAAC,SAAQ;wBAAU,MAAK;wBAAK,SAAS;kCAAU;;;;;;kCAGvD,6bAAC,qIAAM;wBAAC,MAAK;wBAAK,SAAS;wBAAY,UAAU,CAAC,QAAQ,IAAI;kCAAI;;;;;;;;;;;;;;;;;;AAM1E"}},
    {"offset": {"line": 3055, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/FeedbackInput.tsx"],"sourcesContent":["import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport TextareaAutosize from \"react-textarea-autosize\";\n\ninterface FeedbackInputProps {\n  onSend: (details: string) => Promise<void>;\n  onCancel: () => void;\n}\n\nexport const FeedbackInput = ({ onSend, onCancel }: FeedbackInputProps) => {\n  const [details, setDetails] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const handleSend = async () => {\n    if (!details.trim()) return;\n\n    setIsSubmitting(true);\n    try {\n      await onSend(details.trim());\n      setDetails(\"\");\n    } catch (error) {\n      console.error(\"Failed to send feedback:\", error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleCancel = () => {\n    setDetails(\"\");\n    onCancel();\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    } else if (e.key === \"Escape\") {\n      e.preventDefault();\n      handleCancel();\n    }\n    // Allow Shift+Enter for new lines\n  };\n\n  return (\n    <div className=\"mt-2 p-3 bg-muted/50 rounded-lg border border-border animate-in fade-in-0 slide-in-from-bottom-2 duration-200\">\n      <div className=\"flex flex-col space-y-3\">\n        <div className=\"flex-1\">\n          <TextareaAutosize\n            value={details}\n            onChange={(e) => setDetails(e.target.value)}\n            onKeyDown={handleKeyDown}\n            placeholder={\"What went wrong?\"}\n            className=\"flex rounded-md border-input focus-visible:outline-none focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 overflow-hidden flex-1 bg-transparent p-2 border-0 focus-visible:ring-0 focus-visible:ring-offset-0 w-full placeholder:text-muted-foreground text-[15px] shadow-none resize-none min-h-[36px]\"\n            rows={2}\n            maxRows={6}\n            autoFocus\n            disabled={isSubmitting}\n          />\n        </div>\n        <div className=\"flex justify-end space-x-2\">\n          <Button\n            size=\"sm\"\n            variant=\"ghost\"\n            onClick={handleCancel}\n            disabled={isSubmitting}\n            className=\"shrink-0\"\n          >\n            Cancel\n          </Button>\n          <Button\n            size=\"sm\"\n            onClick={handleSend}\n            disabled={!details.trim() || isSubmitting}\n            className=\"shrink-0\"\n          >\n            Send\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAOO,MAAM,gBAAgB,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAsB;IACpE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gaAAQ,EAAC;IACvC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,gaAAQ,EAAC;IAEjD,MAAM,aAAa;QACjB,IAAI,CAAC,QAAQ,IAAI,IAAI;QAErB,gBAAgB;QAChB,IAAI;YACF,MAAM,OAAO,QAAQ,IAAI;YACzB,WAAW;QACb,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,4BAA4B;QAC5C,SAAU;YACR,gBAAgB;QAClB;IACF;IAEA,MAAM,eAAe;QACnB,WAAW;QACX;IACF;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,QAAQ,EAAE;YACpC,EAAE,cAAc;YAChB;QACF,OAAO,IAAI,EAAE,GAAG,KAAK,UAAU;YAC7B,EAAE,cAAc;YAChB;QACF;IACA,kCAAkC;IACpC;IAEA,qBACE,6bAAC;QAAI,WAAU;kBACb,cAAA,6bAAC;YAAI,WAAU;;8BACb,6bAAC;oBAAI,WAAU;8BACb,cAAA,6bAAC,0VAAgB;wBACf,OAAO;wBACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;wBAC1C,WAAW;wBACX,aAAa;wBACb,WAAU;wBACV,MAAM;wBACN,SAAS;wBACT,SAAS;wBACT,UAAU;;;;;;;;;;;8BAGd,6bAAC;oBAAI,WAAU;;sCACb,6bAAC,qIAAM;4BACL,MAAK;4BACL,SAAQ;4BACR,SAAS;4BACT,UAAU;4BACV,WAAU;sCACX;;;;;;sCAGD,6bAAC,qIAAM;4BACL,MAAK;4BACL,SAAS;4BACT,UAAU,CAAC,QAAQ,IAAI,MAAM;4BAC7B,WAAU;sCACX;;;;;;;;;;;;;;;;;;;;;;;AAOX"}},
    {"offset": {"line": 3171, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/AllFilesDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport { X, Download, Circle, CircleCheck, File } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { useConvex, useAction } from \"convex/react\";\nimport { api } from \"@/convex/_generated/api\";\nimport { useFileUrlCacheContext } from \"@/app/contexts/FileUrlCacheContext\";\nimport type { FilePart } from \"@/types/file\";\nimport JSZip from \"jszip\";\n\ninterface AllFilesDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  files: Array<{\n    part: FilePart;\n    partIndex: number;\n    messageId: string;\n  }>;\n  chatTitle?: string | null;\n}\n\ninterface FileItemProps {\n  file: {\n    part: FilePart;\n    partIndex: number;\n    messageId: string;\n  };\n  isSelected: boolean;\n  selectionMode: boolean;\n  onToggle: () => void;\n  fileUrl: string | null;\n}\n\nconst FileItem = ({\n  file,\n  isSelected,\n  selectionMode,\n  onToggle,\n  fileUrl,\n}: FileItemProps) => {\n  const fileName = file.part.name || file.part.filename || \"Unknown file\";\n\n  const handleDownload = async () => {\n    if (!fileUrl) return;\n\n    try {\n      const response = await fetch(fileUrl);\n      const blob = await response.blob();\n      const blobUrl = URL.createObjectURL(blob);\n      const link = document.createElement(\"a\");\n      link.href = blobUrl;\n      link.download = fileName;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(blobUrl);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n    }\n  };\n\n  return (\n    <div\n      className={`group flex items-center gap-3 px-3 py-2.5 hover:bg-secondary transition-colors rounded-lg ${\n        selectionMode ? \"cursor-pointer\" : \"\"\n      }`}\n      onClick={selectionMode ? onToggle : undefined}\n    >\n      {selectionMode && (\n        <Button\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"h-5 w-5 p-0 hover:opacity-85\"\n          type=\"button\"\n          aria-label={`${isSelected ? \"Deselect\" : \"Select\"} file`}\n        >\n          {isSelected ? (\n            <CircleCheck className=\"w-5 h-5\" />\n          ) : (\n            <Circle className=\"w-5 h-5 text-muted-foreground\" />\n          )}\n        </Button>\n      )}\n\n      <div className=\"relative flex items-center justify-center w-10 h-10 rounded-lg bg-[#FF5588]\">\n        <File className=\"w-6 h-6 text-white\" />\n      </div>\n\n      <div className=\"flex flex-col gap-1 flex-grow flex-1 min-w-0\">\n        <div className=\"flex justify-between items-center flex-1 min-w-0\">\n          <div className=\"flex flex-col flex-1 min-w-0 max-w-full\">\n            <div className=\"flex-1 min-w-0 flex gap-2 items-center\">\n              <span\n                className=\"inline-block whitespace-nowrap text-sm text-foreground\"\n                style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}\n              >\n                {fileName}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {!selectionMode && fileUrl && (\n        <Button\n          onClick={handleDownload}\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity\"\n          type=\"button\"\n          aria-label=\"Download file\"\n        >\n          <Download className=\"w-4 h-4 text-muted-foreground\" />\n        </Button>\n      )}\n    </div>\n  );\n};\n\nconst AllFilesDialog = ({\n  open,\n  onOpenChange,\n  files,\n  chatTitle,\n}: AllFilesDialogProps) => {\n  const convex = useConvex();\n  const getFileUrlAction = useAction(api.s3Actions.getFileUrlAction);\n  const fileUrlCache = useFileUrlCacheContext();\n  const [selectionMode, setSelectionMode] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState<Set<string>>(new Set());\n  const [fileUrls, setFileUrls] = useState<Map<number, string>>(new Map());\n  const [isLoadingUrls, setIsLoadingUrls] = useState(false);\n\n  // Reset URLs when dialog closes\n  useEffect(() => {\n    if (!open) {\n      setFileUrls(new Map());\n      setIsLoadingUrls(false);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [open]);\n\n  // Batch fetch all URLs when dialog opens\n  useEffect(() => {\n    if (!open) {\n      return;\n    }\n\n    let cancelled = false;\n\n    async function fetchAllUrls() {\n      if (cancelled) return;\n      setIsLoadingUrls(true);\n      const urlMap = new Map<number, string>();\n\n      // Fetch URLs in parallel\n      await Promise.all(\n        files.map(async (file, index) => {\n          // If already has URL, use it\n          if (file.part.url) {\n            urlMap.set(index, file.part.url);\n            return;\n          }\n\n          // Check cache first for fileId\n          if (file.part.fileId && fileUrlCache) {\n            const cachedUrl = fileUrlCache.getCachedUrl(file.part.fileId);\n            if (cachedUrl) {\n              urlMap.set(index, cachedUrl);\n              return;\n            }\n          }\n\n          // Fetch URL based on storage type\n          try {\n            let url: string | null = null;\n\n            if (file.part.fileId) {\n              // S3 file - fetch presigned URL\n              url = await getFileUrlAction({ fileId: file.part.fileId });\n              // Cache it\n              if (url && fileUrlCache) {\n                fileUrlCache.setCachedUrl(file.part.fileId, url);\n              }\n            } else if (file.part.storageId) {\n              // Convex storage file - fetch URL\n              url = await convex.query(api.fileStorage.getFileDownloadUrl, {\n                storageId: file.part.storageId,\n              });\n            }\n\n            if (url) {\n              urlMap.set(index, url);\n            }\n          } catch (error) {\n            console.error(`Failed to fetch URL for file ${index}:`, error);\n          }\n        }),\n      );\n\n      if (!cancelled) {\n        setFileUrls(urlMap);\n        setIsLoadingUrls(false);\n      }\n    }\n\n    fetchAllUrls();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [open, files, getFileUrlAction, convex, fileUrlCache]);\n\n  // Reset selection when dialog closes\n  useEffect(() => {\n    if (!open) {\n      // eslint-disable-next-line react-hooks/set-state-in-effect\n      setSelectionMode(false);\n\n      setSelectedFiles(new Set());\n    }\n  }, [open]);\n\n  const handleEnterSelectionMode = () => {\n    setSelectionMode(true);\n    // Select all files by default\n    const allFileIds = new Set(files.map((_, index) => index.toString()));\n    setSelectedFiles(allFileIds);\n  };\n\n  const handleCancelSelection = () => {\n    setSelectionMode(false);\n    setSelectedFiles(new Set());\n  };\n\n  const handleToggleAll = () => {\n    if (selectedFiles.size === files.length) {\n      setSelectedFiles(new Set());\n    } else {\n      const allFileIds = new Set(files.map((_, index) => index.toString()));\n      setSelectedFiles(allFileIds);\n    }\n  };\n\n  const handleToggleFile = (fileId: string) => {\n    const newSelected = new Set(selectedFiles);\n    if (newSelected.has(fileId)) {\n      newSelected.delete(fileId);\n    } else {\n      newSelected.add(fileId);\n    }\n    setSelectedFiles(newSelected);\n  };\n\n  const handleBatchDownload = async () => {\n    const filesToDownload = files\n      .map((file, index) => ({ file, index }))\n      .filter(({ index }) => selectedFiles.has(index.toString()));\n\n    if (filesToDownload.length === 0) return;\n\n    try {\n      const zip = new JSZip();\n\n      // Use already fetched URLs or fetch missing ones\n      await Promise.all(\n        filesToDownload.map(async ({ file, index }) => {\n          try {\n            let url = fileUrls.get(index) || file.part.url;\n\n            // Fetch URL if not already available\n            if (!url) {\n              if (file.part.fileId) {\n                url = await getFileUrlAction({ fileId: file.part.fileId });\n              } else if (file.part.storageId) {\n                const fetchedUrl = await convex.query(\n                  api.fileStorage.getFileDownloadUrl,\n                  {\n                    storageId: file.part.storageId,\n                  },\n                );\n                url = fetchedUrl || undefined;\n              }\n            }\n\n            if (url) {\n              const response = await fetch(url);\n              const blob = await response.blob();\n              const fileName =\n                file.part.name ||\n                file.part.filename ||\n                `file-${file.partIndex}`;\n              zip.file(fileName, blob);\n            }\n          } catch (error) {\n            console.error(`Error adding ${file.part.name} to ZIP:`, error);\n          }\n        }),\n      );\n\n      // Generate the ZIP file\n      const zipBlob = await zip.generateAsync({ type: \"blob\" });\n\n      // Download the ZIP file\n      const blobUrl = URL.createObjectURL(zipBlob);\n      const link = document.createElement(\"a\");\n      link.href = blobUrl;\n\n      // Create filename from chat title or use fallback\n      let fileName = \"chat-files\";\n      if (chatTitle) {\n        // Sanitize the title for use in filename\n        fileName = chatTitle\n          .replace(/[^a-zA-Z0-9-_ ]/g, \"\") // Remove invalid characters\n          .replace(/\\s+/g, \"-\") // Replace spaces with hyphens\n          .substring(0, 50); // Limit length\n      }\n      if (!fileName || fileName === \"\") {\n        const timestamp = new Date().toISOString().split(\"T\")[0];\n        fileName = `chat-files-${timestamp}`;\n      }\n\n      link.download = `${fileName}.zip`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(blobUrl);\n    } catch (error) {\n      console.error(\"Error creating ZIP file:\", error);\n    }\n\n    // Exit selection mode after download\n    handleCancelSelection();\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent\n        className=\"bg-background rounded-[20px] border border-border fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 max-w-[95%] max-h-[95%] overflow-auto h-[680px] flex flex-col p-0\"\n        style={{ width: \"600px\" }}\n        showCloseButton={false}\n      >\n        <DialogTitle className=\"sr-only\">All files in this chat</DialogTitle>\n        {selectionMode ? (\n          <header className=\"flex items-center justify-between pt-6 pr-6 pl-6 pb-2.5\">\n            <Button\n              onClick={handleToggleAll}\n              variant=\"ghost\"\n              className=\"flex items-center gap-2.5 text-sm text-muted-foreground hover:opacity-85 h-auto p-0\"\n              type=\"button\"\n            >\n              {selectedFiles.size === files.length ? (\n                <CircleCheck className=\"w-5 h-5\" />\n              ) : (\n                <Circle className=\"w-5 h-5 text-muted-foreground\" />\n              )}\n              Select all\n            </Button>\n            <Button\n              onClick={handleCancelSelection}\n              variant=\"ghost\"\n              className=\"text-muted-foreground hover:opacity-85 text-sm h-auto p-0\"\n              type=\"button\"\n            >\n              Cancel\n            </Button>\n          </header>\n        ) : (\n          <header className=\"flex items-center pt-6 pr-6 pl-6 pb-2.5\">\n            <h1 className=\"flex-1 text-foreground text-lg font-semibold\">\n              All files in this chat\n            </h1>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                onClick={handleEnterSelectionMode}\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-7 w-7\"\n                aria-label=\"Download files\"\n                type=\"button\"\n              >\n                <Download className=\"size-5 text-muted-foreground\" />\n              </Button>\n              <Button\n                onClick={() => onOpenChange(false)}\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-7 w-7\"\n                aria-label=\"Close dialog\"\n                type=\"button\"\n              >\n                <X className=\"size-5 text-muted-foreground\" />\n              </Button>\n            </div>\n          </header>\n        )}\n\n        <div className=\"flex-1 min-h-0 overflow-auto px-6 pt-4 pb-4\">\n          <div className=\"flex flex-col gap-0\">\n            {files.length === 0 ? (\n              <div className=\"text-center text-muted-foreground py-8\">\n                No files\n              </div>\n            ) : isLoadingUrls ? (\n              <div className=\"text-center text-muted-foreground py-8\">\n                Loading files...\n              </div>\n            ) : (\n              files.map((file, index) => {\n                const fileId = index.toString();\n                const isSelected = selectedFiles.has(fileId);\n                const fileUrl = fileUrls.get(index) || file.part.url || null;\n\n                return (\n                  <FileItem\n                    key={`${file.messageId}-${file.partIndex}`}\n                    file={file}\n                    isSelected={isSelected}\n                    selectionMode={selectionMode}\n                    onToggle={() => handleToggleFile(fileId)}\n                    fileUrl={fileUrl}\n                  />\n                );\n              })\n            )}\n          </div>\n        </div>\n\n        {selectionMode && (\n          <footer className=\"px-5 py-4 border-t border-border flex justify-end\">\n            <Button\n              onClick={handleBatchDownload}\n              variant=\"outline\"\n              className=\"h-9 px-3 rounded-full\"\n              disabled={selectedFiles.size === 0}\n              type=\"button\"\n            >\n              <Download className=\"w-[18px] h-[18px] text-muted-foreground\" />\n              <span className=\"text-sm text-muted-foreground\">\n                Batch download ({selectedFiles.size})\n              </span>\n            </Button>\n          </footer>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport { AllFilesDialog };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3744, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/BranchIndicator.tsx"],"sourcesContent":["\"use client\";\n\nimport { memo, useCallback } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\n\ninterface BranchIndicatorProps {\n  branchedFromChatId: string;\n  branchedFromChatTitle: string;\n  onNavigate?: (chatId: string) => void;\n}\n\nexport const BranchIndicator = memo(function BranchIndicator({\n  branchedFromChatId,\n  branchedFromChatTitle,\n  onNavigate,\n}: BranchIndicatorProps) {\n  const router = useRouter();\n  const { initializeChat, closeSidebar, setChatSidebarOpen } = useGlobalState();\n  const isMobile = useIsMobile();\n\n  const handleClick = useCallback(() => {\n    if (onNavigate) {\n      onNavigate(branchedFromChatId);\n      return;\n    }\n    closeSidebar();\n\n    if (isMobile) {\n      setChatSidebarOpen(false);\n    }\n\n    initializeChat(branchedFromChatId);\n    router.push(`/c/${branchedFromChatId}`);\n  }, [\n    onNavigate,\n    branchedFromChatId,\n    closeSidebar,\n    isMobile,\n    setChatSidebarOpen,\n    initializeChat,\n    router,\n  ]);\n\n  return (\n    <div\n      data-testid=\"branch-indicator\"\n      className=\"relative flex items-center justify-center py-6\"\n    >\n      <div className=\"absolute inset-0 flex items-center\">\n        <div className=\"w-full border-t border-border\"></div>\n      </div>\n      <div className=\"relative flex items-center gap-2 bg-background px-4\">\n        <span className=\"text-sm text-muted-foreground\">\n          Branched from{\" \"}\n          <button\n            onClick={handleClick}\n            className=\"font-medium underline hover:text-foreground/50 transition-colors cursor-pointer\"\n            type=\"button\"\n            aria-label={`Open branched-from chat ${branchedFromChatTitle}`}\n          >\n            {branchedFromChatTitle}\n          </button>\n        </span>\n      </div>\n    </div>\n  );\n});\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAaO,MAAM,gCAAkB,IAAA,4ZAAI,EAAC,SAAS,gBAAgB,EAC3D,kBAAkB,EAClB,qBAAqB,EACrB,UAAU,EACW;IACrB,MAAM,SAAS,IAAA,8VAAS;IACxB,MAAM,EAAE,cAAc,EAAE,YAAY,EAAE,kBAAkB,EAAE,GAAG,IAAA,iJAAc;IAC3E,MAAM,WAAW,IAAA,qIAAW;IAE5B,MAAM,cAAc,IAAA,maAAW,EAAC;QAC9B,IAAI,YAAY;YACd,WAAW;YACX;QACF;QACA;QAEA,IAAI,UAAU;YACZ,mBAAmB;QACrB;QAEA,eAAe;QACf,OAAO,IAAI,CAAC,CAAC,GAAG,EAAE,oBAAoB;IACxC,GAAG;QACD;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,qBACE,6bAAC;QACC,eAAY;QACZ,WAAU;;0BAEV,6bAAC;gBAAI,WAAU;0BACb,cAAA,6bAAC;oBAAI,WAAU;;;;;;;;;;;0BAEjB,6bAAC;gBAAI,WAAU;0BACb,cAAA,6bAAC;oBAAK,WAAU;;wBAAgC;wBAChC;sCACd,6bAAC;4BACC,SAAS;4BACT,WAAU;4BACV,MAAK;4BACL,cAAY,CAAC,wBAAwB,EAAE,uBAAuB;sCAE7D;;;;;;;;;;;;;;;;;;;;;;;AAMb"}},
    {"offset": {"line": 3841, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/FinishReasonNotice.tsx"],"sourcesContent":["interface FinishReasonNoticeProps {\n  finishReason?: string;\n  mode?: \"ask\" | \"agent\";\n}\n\nexport const FinishReasonNotice = ({\n  finishReason,\n  mode,\n}: FinishReasonNoticeProps) => {\n  if (!finishReason) return null;\n\n  const getNoticeContent = () => {\n    if (finishReason === \"tool-calls\") {\n      return (\n        <>\n          I automatically stopped to prevent going off course. Say\n          &quot;continue&quot; if you&apos;d like me to keep working on this\n          task.\n        </>\n      );\n    }\n\n    if (finishReason === \"timeout\") {\n      return (\n        <>\n          I had to stop due to the time limit. Say &quot;continue&quot; if\n          you&apos;d like me to keep working on this task.\n        </>\n      );\n    }\n\n    if (finishReason === \"length\") {\n      return (\n        <>\n          I hit the output token limit and had to stop. Say &quot;continue&quot;\n          to pick up where I left off.\n        </>\n      );\n    }\n\n    return null;\n  };\n\n  const content = getNoticeContent();\n\n  if (!content) return null;\n\n  return (\n    <div className=\"mt-2 w-full\">\n      <div className=\"bg-muted text-muted-foreground rounded-lg px-3 py-2 border border-border\">\n        {content}\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;;AAKO,MAAM,qBAAqB,CAAC,EACjC,YAAY,EACZ,IAAI,EACoB;IACxB,IAAI,CAAC,cAAc,OAAO;IAE1B,MAAM,mBAAmB;QACvB,IAAI,iBAAiB,cAAc;YACjC,qBACE;0BAAE;;QAMN;QAEA,IAAI,iBAAiB,WAAW;YAC9B,qBACE;0BAAE;;QAKN;QAEA,IAAI,iBAAiB,UAAU;YAC7B,qBACE;0BAAE;;QAKN;QAEA,OAAO;IACT;IAEA,MAAM,UAAU;IAEhB,IAAI,CAAC,SAAS,OAAO;IAErB,qBACE,6bAAC;QAAI,WAAU;kBACb,cAAA,6bAAC;YAAI,WAAU;sBACZ;;;;;;;;;;;AAIT"}},
    {"offset": {"line": 3891, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/Messages.tsx"],"sourcesContent":["import {\n  useState,\n  RefObject,\n  useEffect,\n  useMemo,\n  useCallback,\n  Dispatch,\n  SetStateAction,\n  Fragment,\n} from \"react\";\nimport { MessageActions } from \"./MessageActions\";\nimport { MessagePartHandler } from \"./MessagePartHandler\";\nimport { FilePartRenderer } from \"./FilePartRenderer\";\nimport { MessageErrorState } from \"./MessageErrorState\";\nimport { MessageEditor } from \"./MessageEditor\";\nimport { FeedbackInput } from \"./FeedbackInput\";\nimport { Shimmer } from \"@/components/ai-elements/shimmer\";\nimport { AllFilesDialog } from \"./AllFilesDialog\";\nimport { BranchIndicator } from \"./BranchIndicator\";\nimport { FinishReasonNotice } from \"./FinishReasonNotice\";\nimport DotsSpinner from \"@/components/ui/dots-spinner\";\nimport Loading from \"@/components/ui/loading\";\nimport { useFeedback } from \"../hooks/useFeedback\";\nimport { useFileUrlCache } from \"../hooks/useFileUrlCache\";\nimport { FileUrlCacheProvider } from \"../contexts/FileUrlCacheContext\";\nimport {\n  extractMessageText,\n  hasTextContent,\n  findLastAssistantMessageIndex,\n  extractWebSourcesFromMessage,\n} from \"@/lib/utils/message-utils\";\nimport type { ChatStatus, ChatMessage } from \"@/types\";\nimport type { FileDetails } from \"@/types/file\";\nimport { toast } from \"sonner\";\nimport { FileSearch } from \"lucide-react\";\n\ninterface MessagesProps {\n  messages: ChatMessage[];\n  setMessages: Dispatch<SetStateAction<ChatMessage[]>>;\n  onRegenerate: () => void;\n  onRetry: () => void;\n  onEditMessage: (messageId: string, newContent: string) => Promise<void>;\n  onBranchMessage?: (messageId: string) => Promise<void>;\n  status: ChatStatus;\n  error: Error | null;\n  scrollRef: RefObject<HTMLDivElement | null>;\n  contentRef: RefObject<HTMLDivElement | null>;\n  paginationStatus?:\n    | \"LoadingFirstPage\"\n    | \"CanLoadMore\"\n    | \"LoadingMore\"\n    | \"Exhausted\";\n  loadMore?: (numItems: number) => void;\n  isSwitchingChats?: boolean;\n  isTemporaryChat?: boolean;\n  tempChatFileDetails?: Map<string, FileDetails[]>;\n  finishReason?: string;\n  uploadStatus?: { message: string; isUploading: boolean } | null;\n  mode?: \"ask\" | \"agent\";\n  chatTitle?: string | null;\n  branchedFromChatId?: string;\n  branchedFromChatTitle?: string;\n}\n\nexport const Messages = ({\n  messages,\n  setMessages,\n  onRegenerate,\n  onRetry,\n  onEditMessage,\n  onBranchMessage,\n  status,\n  error,\n  scrollRef,\n  contentRef,\n  paginationStatus,\n  loadMore,\n  isSwitchingChats,\n  isTemporaryChat,\n  tempChatFileDetails,\n  finishReason,\n  uploadStatus,\n  mode,\n  chatTitle,\n  branchedFromChatId,\n  branchedFromChatTitle,\n}: MessagesProps) => {\n  // Prefetch and cache image URLs for better performance\n  const { getCachedUrl, setCachedUrl } = useFileUrlCache(messages);\n\n  // Memoize expensive calculations\n  const lastAssistantMessageIndex = useMemo(() => {\n    return findLastAssistantMessageIndex(messages);\n  }, [messages]);\n\n  // Compute the branch boundary: last message that originated from another chat\n  const branchBoundaryIndex = useMemo(() => {\n    for (let i = messages.length - 1; i >= 0; i--) {\n      if (messages[i].sourceMessageId) return i;\n    }\n    return -1;\n  }, [messages]);\n\n  // Track hover state for all messages\n  const [hoveredMessageId, setHoveredMessageId] = useState<string | null>(null);\n\n  // Track edit state for messages\n  const [editingMessageId, setEditingMessageId] = useState<string | null>(null);\n\n  // Track all files dialog state\n  const [showAllFilesDialog, setShowAllFilesDialog] = useState(false);\n  const [dialogFiles, setDialogFiles] = useState<\n    Array<{\n      part: any;\n      partIndex: number;\n      messageId: string;\n    }>\n  >([]);\n\n  // Handle feedback logic\n  const {\n    feedbackInputMessageId,\n    handleFeedback,\n    handleFeedbackSubmit,\n    handleFeedbackCancel,\n  } = useFeedback({ messages, setMessages });\n\n  // Sidebar auto-open removed - sidebar only opens via manual clicks\n\n  // Memoized edit handlers to prevent unnecessary re-renders\n  const handleStartEdit = useCallback((messageId: string) => {\n    setEditingMessageId(messageId);\n  }, []);\n\n  const handleSaveEdit = useCallback(\n    async (newContent: string) => {\n      if (editingMessageId) {\n        try {\n          await onEditMessage(editingMessageId, newContent);\n        } catch (error) {\n          console.error(\"Failed to edit message:\", error);\n          toast.error(\"Failed to edit message. Please try again.\");\n        } finally {\n          setEditingMessageId(null);\n        }\n      }\n    },\n    [editingMessageId, onEditMessage],\n  );\n\n  const handleCancelEdit = useCallback(() => {\n    setEditingMessageId(null);\n  }, []);\n\n  // Memoized mouse event handlers\n  const handleMouseEnter = useCallback((messageId: string) => {\n    setHoveredMessageId(messageId);\n  }, []);\n\n  const handleMouseLeave = useCallback(() => {\n    setHoveredMessageId(null);\n  }, []);\n\n  // Extract web sources (memoized adapter)\n  const extractWebSources = useCallback(\n    (message: ChatMessage) => extractWebSourcesFromMessage(message as any),\n    [],\n  );\n\n  // Handler to show all files for a specific message\n  const handleShowAllFiles = useCallback(\n    (message: ChatMessage, fileDetails: FileDetails[]) => {\n      if (!fileDetails || fileDetails.length === 0) return;\n\n      const files = fileDetails\n        .filter((file) => file.url || file.storageId || file.s3Key)\n        .map((file, fileIndex) => ({\n          part: {\n            url: file.url ?? undefined,\n            storageId: file.storageId,\n            fileId: file.fileId,\n            s3Key: file.s3Key,\n            name: file.name,\n            filename: file.name,\n            mediaType: file.mediaType,\n          },\n          partIndex: fileIndex,\n          messageId: message.id,\n        }));\n\n      setDialogFiles(files);\n      setShowAllFilesDialog(true);\n    },\n    [],\n  );\n\n  // Handler for branching a message\n  const handleBranchMessage = useCallback(\n    async (messageId: string) => {\n      if (onBranchMessage) {\n        try {\n          await onBranchMessage(messageId);\n        } catch (error) {\n          console.error(\"Failed to branch message:\", error);\n          toast.error(\"Failed to branch chat. Please try again.\");\n        }\n      }\n    },\n    [onBranchMessage],\n  );\n\n  // Handle scroll to load more messages when scrolling to top\n  const handleScroll = useCallback(() => {\n    if (!scrollRef.current || !loadMore || paginationStatus !== \"CanLoadMore\") {\n      return;\n    }\n\n    // Don't trigger pagination while switching chats\n    if (isSwitchingChats) {\n      return;\n    }\n\n    const { scrollTop } = scrollRef.current;\n\n    // Check if we're near the top (within 100px)\n    if (scrollTop < 100) {\n      loadMore(28); // Load 28 more messages\n    }\n  }, [scrollRef, loadMore, paginationStatus, isSwitchingChats]);\n\n  // Add scroll event listener\n  useEffect(() => {\n    const scrollElement = scrollRef.current;\n    if (!scrollElement) return;\n\n    scrollElement.addEventListener(\"scroll\", handleScroll);\n    return () => scrollElement.removeEventListener(\"scroll\", handleScroll);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [handleScroll]);\n\n  return (\n    <FileUrlCacheProvider\n      getCachedUrl={getCachedUrl}\n      setCachedUrl={setCachedUrl}\n    >\n      <div ref={scrollRef} className=\"flex-1 overflow-y-auto p-4\">\n        <div\n          ref={contentRef}\n          className=\"mx-auto w-full max-w-full sm:max-w-[768px] sm:min-w-[390px] flex flex-col space-y-4 pb-20\"\n          data-testid=\"messages-container\"\n        >\n          {/* Loading indicator at top when loading more messages */}\n          {paginationStatus === \"LoadingMore\" && (\n            <div className=\"flex justify-center py-2\">\n              <Loading size={6} />\n            </div>\n          )}\n          {messages.map((message, index) => {\n            const isUser = message.role === \"user\";\n            const isHovered = hoveredMessageId === message.id;\n            const isLastAssistantMessage =\n              message.role === \"assistant\" &&\n              index === lastAssistantMessageIndex;\n            const canRegenerate = status === \"ready\" || status === \"error\";\n            const isEditing = editingMessageId === message.id;\n\n            // Get message text content for editing\n            const messageText = extractMessageText(message.parts);\n            const messageHasTextContent = hasTextContent(message.parts);\n\n            // Separate file parts from other parts for user messages\n            const fileParts = message.parts.filter(\n              (part) => part.type === \"file\",\n            );\n            const nonFileParts = message.parts.filter(\n              (part) => part.type !== \"file\",\n            );\n\n            // Check if message contains image content\n            const hasFileContent = message.parts.some(\n              (part) => part.type === \"file\",\n            );\n\n            const shouldShowLoader =\n              isLastAssistantMessage &&\n              status === \"streaming\" &&\n              !messageHasTextContent;\n\n            // Merge fileDetails from parallel state for temporary chats\n            const effectiveFileDetails = !isUser\n              ? message.fileDetails ||\n                tempChatFileDetails?.get(message.id) ||\n                undefined\n              : undefined;\n\n            // Get saved files for assistant messages (include files with url, storageId, or s3Key)\n            const savedFiles =\n              !isUser &&\n              (isLastAssistantMessage ? status !== \"streaming\" : true) &&\n              effectiveFileDetails\n                ? effectiveFileDetails.filter(\n                    (f) => f.url || f.storageId || f.s3Key,\n                  )\n                : [];\n\n            // Check if we should show branch indicator after this message\n            const shouldShowBranchIndicator = Boolean(\n              branchedFromChatId &&\n              branchedFromChatTitle &&\n              branchBoundaryIndex >= 0 &&\n              index === branchBoundaryIndex,\n            );\n\n            return (\n              <Fragment key={message.id}>\n                <div\n                  data-testid={isUser ? \"user-message\" : \"assistant-message\"}\n                  className={`flex flex-col ${isUser ? \"items-end\" : \"items-start\"}`}\n                  onMouseEnter={() => handleMouseEnter(message.id)}\n                  onMouseLeave={handleMouseLeave}\n                >\n                  {isEditing && isUser ? (\n                    <div className=\"w-full\">\n                      <MessageEditor\n                        initialContent={messageText}\n                        onSave={handleSaveEdit}\n                        onCancel={handleCancelEdit}\n                      />\n                    </div>\n                  ) : (\n                    <div\n                      className={`${\n                        isUser\n                          ? \"w-full flex flex-col gap-1 items-end\"\n                          : \"w-full text-foreground\"\n                      } overflow-hidden`}\n                    >\n                      {/* Render file parts first for user messages */}\n                      {isUser && fileParts.length > 0 && (\n                        <div className=\"flex flex-wrap items-center justify-end gap-2 w-full\">\n                          {fileParts.map((part, partIndex) => (\n                            <FilePartRenderer\n                              key={`${message.id}-file-${partIndex}`}\n                              part={part}\n                              partIndex={partIndex}\n                              messageId={message.id}\n                              totalFileParts={fileParts.length}\n                            />\n                          ))}\n                        </div>\n                      )}\n\n                      {/* Render text and other parts */}\n                      {nonFileParts.length > 0 && (\n                        <div\n                          data-testid=\"message-content\"\n                          className={`${\n                            isUser\n                              ? \"max-w-[80%] bg-secondary rounded-[18px] px-4 py-1.5 data-[multiline]:py-3 rounded-se-lg text-primary-foreground border border-border\"\n                              : \"w-full prose space-y-3 max-w-none dark:prose-invert min-w-0\"\n                          } overflow-hidden`}\n                        >\n                          {isUser ? (\n                            <div className=\"whitespace-pre-wrap\">\n                              {nonFileParts.map((part, partIndex) => (\n                                <MessagePartHandler\n                                  key={`${message.id}-${partIndex}`}\n                                  message={message}\n                                  part={part}\n                                  partIndex={partIndex}\n                                  status={status}\n                                />\n                              ))}\n                            </div>\n                          ) : (\n                            // For assistant messages, render all parts in original order\n                            message.parts.map((part, partIndex) => (\n                              <MessagePartHandler\n                                key={`${message.id}-${partIndex}`}\n                                message={message}\n                                part={part}\n                                partIndex={partIndex}\n                                status={status}\n                                isLastMessage={index === messages.length - 1}\n                              />\n                            ))\n                          )}\n                        </div>\n                      )}\n\n                      {/* For assistant messages without the user-specific styling, render files mixed with content */}\n                      {!isUser &&\n                        fileParts.length > 0 &&\n                        nonFileParts.length === 0 && (\n                          <div className=\"prose space-y-3 max-w-none dark:prose-invert min-w-0 overflow-hidden\">\n                            {message.parts.map((part, partIndex) => (\n                              <MessagePartHandler\n                                key={`${message.id}-${partIndex}`}\n                                message={message}\n                                part={part}\n                                partIndex={partIndex}\n                                status={status}\n                              />\n                            ))}\n                          </div>\n                        )}\n                    </div>\n                  )}\n\n                  {/* Saved files from tools (shown after message content for assistant) */}\n                  {!isUser && savedFiles.length > 0 && (\n                    <div className=\"mt-2 flex flex-wrap items-center gap-2 w-full\">\n                      {savedFiles.length > 2 ? (\n                        <>\n                          {/* Show only last file when more than 2 */}\n                          <FilePartRenderer\n                            key={`${message.id}-saved-file-${savedFiles.length - 1}`}\n                            part={{\n                              url:\n                                savedFiles[savedFiles.length - 1].url ??\n                                undefined,\n                              storageId:\n                                savedFiles[savedFiles.length - 1].storageId,\n                              fileId: savedFiles[savedFiles.length - 1].fileId,\n                              s3Key: savedFiles[savedFiles.length - 1].s3Key,\n                              name: savedFiles[savedFiles.length - 1].name,\n                              filename: savedFiles[savedFiles.length - 1].name,\n                              mediaType:\n                                savedFiles[savedFiles.length - 1].mediaType,\n                            }}\n                            partIndex={savedFiles.length - 1}\n                            messageId={message.id}\n                            totalFileParts={savedFiles.length}\n                          />\n                          {/* View all files button */}\n                          <button\n                            onClick={() =>\n                              handleShowAllFiles(\n                                message,\n                                effectiveFileDetails || [],\n                              )\n                            }\n                            className=\"h-[55px] ps-4 pe-1.5 w-full max-w-80 min-w-64 flex items-center gap-1.5 rounded-[12px] border-[0.5px] border-border bg-background hover:bg-secondary transition-colors\"\n                            type=\"button\"\n                            aria-label=\"View all files\"\n                          >\n                            <FileSearch\n                              className=\"w-4 h-4 text-muted-foreground\"\n                              strokeWidth={2}\n                            />\n                            <span className=\"text-sm text-muted-foreground\">\n                              View all files in this task\n                            </span>\n                          </button>\n                        </>\n                      ) : (\n                        /* Show all files when 2 or less */\n                        savedFiles.map((file, fileIndex) => (\n                          <FilePartRenderer\n                            key={`${message.id}-saved-file-${fileIndex}`}\n                            part={{\n                              url: file.url ?? undefined,\n                              storageId: file.storageId,\n                              fileId: file.fileId,\n                              s3Key: file.s3Key,\n                              name: file.name,\n                              filename: file.name,\n                              mediaType: file.mediaType,\n                            }}\n                            partIndex={fileIndex}\n                            messageId={message.id}\n                            totalFileParts={savedFiles.length}\n                          />\n                        ))\n                      )}\n                    </div>\n                  )}\n\n                  {/* Loading state */}\n                  {shouldShowLoader && (\n                    <div className=\"mt-1 flex justify-start\">\n                      <div\n                        data-testid=\"streaming\"\n                        className=\"bg-muted text-muted-foreground rounded-lg px-3 py-2 flex items-center space-x-2\"\n                      >\n                        <DotsSpinner size=\"sm\" variant=\"primary\" />\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Finish reason notice under last assistant message */}\n                  {isLastAssistantMessage && status !== \"streaming\" && (\n                    <FinishReasonNotice\n                      finishReason={finishReason}\n                      mode={mode}\n                    />\n                  )}\n\n                  <MessageActions\n                    messageText={messageText}\n                    isUser={isUser}\n                    isLastAssistantMessage={isLastAssistantMessage}\n                    canRegenerate={canRegenerate}\n                    onRegenerate={onRegenerate}\n                    onEdit={() => handleStartEdit(message.id)}\n                    onBranch={\n                      !isUser && onBranchMessage\n                        ? () => handleBranchMessage(message.id)\n                        : undefined\n                    }\n                    isHovered={isHovered}\n                    isEditing={isEditing}\n                    status={status}\n                    onFeedback={(type) => handleFeedback(message.id, type)}\n                    existingFeedback={message.metadata?.feedbackType || null}\n                    isAwaitingFeedbackDetails={\n                      feedbackInputMessageId === message.id\n                    }\n                    hasFileContent={hasFileContent}\n                    isTemporaryChat={Boolean(isTemporaryChat)}\n                    sources={\n                      !isUser\n                        ? isLastAssistantMessage\n                          ? status !== \"streaming\"\n                            ? extractWebSources(message)\n                            : []\n                          : extractWebSources(message)\n                        : []\n                    }\n                  />\n\n                  {/* Show feedback input for negative feedback */}\n                  {feedbackInputMessageId === message.id && (\n                    <div className=\"w-full\">\n                      <FeedbackInput\n                        onSend={handleFeedbackSubmit}\n                        onCancel={handleFeedbackCancel}\n                      />\n                    </div>\n                  )}\n                </div>\n\n                {/* Branch indicator - show after the branched message */}\n                {shouldShowBranchIndicator && (\n                  <BranchIndicator\n                    branchedFromChatId={branchedFromChatId!}\n                    branchedFromChatTitle={branchedFromChatTitle!}\n                  />\n                )}\n              </Fragment>\n            );\n          })}\n\n          {/* Upload status - shown where assistant response will appear */}\n          {uploadStatus?.isUploading && (\n            <div className=\"flex flex-col items-start\">\n              <Shimmer className=\"text-sm\">\n                {`${uploadStatus.message}...`}\n              </Shimmer>\n            </div>\n          )}\n\n          {/* Error state */}\n          {error && <MessageErrorState error={error} onRetry={onRetry} />}\n        </div>\n\n        {/* All Files Dialog */}\n        <AllFilesDialog\n          open={showAllFilesDialog}\n          onOpenChange={setShowAllFilesDialog}\n          files={dialogFiles}\n          chatTitle={chatTitle}\n        />\n      </div>\n    </FileUrlCacheProvider>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4432, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/TodoPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\nimport { ChevronDown, ChevronRight } from \"lucide-react\";\nimport type { ChatStatus } from \"@/types\";\nimport { useGlobalState } from \"@/app/contexts/GlobalState\";\nimport { SharedTodoItem } from \"@/components/ui/shared-todo-item\";\nimport { getTodoStats } from \"@/lib/utils/todo-utils\";\n\ninterface TodoPanelProps {\n  status: ChatStatus;\n}\n\nexport const TodoPanel = ({ status }: TodoPanelProps) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const { todos, setIsTodoPanelExpanded } = useGlobalState();\n\n  // Deduplicate todos by id (keep last occurrence, consistent with backend)\n  const uniqueTodos = Array.from(\n    new Map(todos.map((todo) => [todo.id, todo])).values(),\n  );\n\n  const stats = getTodoStats(uniqueTodos);\n\n  // Don't show panel if no todos exist\n  const hasTodos = uniqueTodos.length > 0;\n\n  // Reflect expansion to global state\n  useEffect(() => {\n    setIsTodoPanelExpanded(isExpanded);\n    return () => {\n      setIsTodoPanelExpanded(false);\n    };\n  }, [isExpanded, setIsTodoPanelExpanded]);\n\n  // Show panel only when there are active todos (hide when all are finished)\n  const hasActiveTodos = stats.inProgress > 0 || stats.pending > 0;\n\n  // If panel is not visible, ensure global state is reset\n  useEffect(() => {\n    if (!hasTodos || !hasActiveTodos) {\n      setIsTodoPanelExpanded(false);\n    }\n  }, [hasTodos, hasActiveTodos, setIsTodoPanelExpanded]);\n\n  if (!hasTodos) {\n    return null;\n  }\n\n  if (!hasActiveTodos) {\n    return null;\n  }\n\n  const handleToggleExpand = () => {\n    setIsExpanded(!isExpanded);\n  };\n\n  const getHeaderText = () => {\n    if (stats.done === 0) {\n      return `${stats.total} To-dos`;\n    }\n    return `${stats.done} of ${stats.total} To-dos`;\n  };\n\n  return (\n    <div className=\"mx-4 rounded-[22px_22px_0px_0px] shadow-[0px_12px_32px_0px_rgba(0,0,0,0.02)] border border-black/8 dark:border-border border-b-0 bg-input-chat\">\n      {/* Header */}\n      <div\n        className={`flex items-center px-4 transition-all duration-300 py-2`}\n      >\n        <button\n          onClick={handleToggleExpand}\n          className=\"flex items-center gap-2 hover:opacity-80 transition-opacity cursor-pointer focus:outline-none rounded-md p-1 -m-1 flex-1\"\n          aria-label={isExpanded ? \"Collapse todos\" : \"Expand todos\"}\n          tabIndex={0}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" || e.key === \" \") {\n              e.preventDefault();\n              handleToggleExpand();\n            }\n          }}\n        >\n          {isExpanded ? (\n            <ChevronDown className=\"w-4 h-4 text-muted-foreground\" />\n          ) : (\n            <ChevronRight className=\"w-4 h-4 text-muted-foreground\" />\n          )}\n          <div className=\"flex items-center gap-2\">\n            <h3 className=\"text-muted-foreground text-sm font-medium\">\n              {getHeaderText()}\n            </h3>\n          </div>\n        </button>\n      </div>\n\n      {/* Todo List - Collapsible */}\n      {isExpanded && (\n        <div className=\"border-t border-border px-4 py-3 space-y-2 max-h-[200px] overflow-y-auto\">\n          {uniqueTodos.map((todo) => (\n            <SharedTodoItem key={todo.id} todo={todo} />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAEA;AACA;AACA;AAPA;;;;;;;AAaO,MAAM,YAAY,CAAC,EAAE,MAAM,EAAkB;IAClD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,gaAAQ,EAAC;IAC7C,MAAM,EAAE,KAAK,EAAE,sBAAsB,EAAE,GAAG,IAAA,iJAAc;IAExD,0EAA0E;IAC1E,MAAM,cAAc,MAAM,IAAI,CAC5B,IAAI,IAAI,MAAM,GAAG,CAAC,CAAC,OAAS;YAAC,KAAK,EAAE;YAAE;SAAK,GAAG,MAAM;IAGtD,MAAM,QAAQ,IAAA,6IAAY,EAAC;IAE3B,qCAAqC;IACrC,MAAM,WAAW,YAAY,MAAM,GAAG;IAEtC,oCAAoC;IACpC,IAAA,iaAAS,EAAC;QACR,uBAAuB;QACvB,OAAO;YACL,uBAAuB;QACzB;IACF,GAAG;QAAC;QAAY;KAAuB;IAEvC,2EAA2E;IAC3E,MAAM,iBAAiB,MAAM,UAAU,GAAG,KAAK,MAAM,OAAO,GAAG;IAE/D,wDAAwD;IACxD,IAAA,iaAAS,EAAC;QACR,IAAI,CAAC,YAAY,CAAC,gBAAgB;YAChC,uBAAuB;QACzB;IACF,GAAG;QAAC;QAAU;QAAgB;KAAuB;IAErD,IAAI,CAAC,UAAU;QACb,OAAO;IACT;IAEA,IAAI,CAAC,gBAAgB;QACnB,OAAO;IACT;IAEA,MAAM,qBAAqB;QACzB,cAAc,CAAC;IACjB;IAEA,MAAM,gBAAgB;QACpB,IAAI,MAAM,IAAI,KAAK,GAAG;YACpB,OAAO,GAAG,MAAM,KAAK,CAAC,OAAO,CAAC;QAChC;QACA,OAAO,GAAG,MAAM,IAAI,CAAC,IAAI,EAAE,MAAM,KAAK,CAAC,OAAO,CAAC;IACjD;IAEA,qBACE,6bAAC;QAAI,WAAU;;0BAEb,6bAAC;gBACC,WAAW,CAAC,uDAAuD,CAAC;0BAEpE,cAAA,6bAAC;oBACC,SAAS;oBACT,WAAU;oBACV,cAAY,aAAa,mBAAmB;oBAC5C,UAAU;oBACV,WAAW,CAAC;wBACV,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK;4BACtC,EAAE,cAAc;4BAChB;wBACF;oBACF;;wBAEC,2BACC,6bAAC,uTAAW;4BAAC,WAAU;;;;;qFAEvB,6bAAC,0TAAY;4BAAC,WAAU;;;;;;sCAE1B,6bAAC;4BAAI,WAAU;sCACb,cAAA,6bAAC;gCAAG,WAAU;0CACX;;;;;;;;;;;;;;;;;;;;;;YAOR,4BACC,6bAAC;gBAAI,WAAU;0BACZ,YAAY,GAAG,CAAC,CAAC,qBAChB,6bAAC,6JAAc;wBAAe,MAAM;uBAAf,KAAK,EAAE;;;;;;;;;;;;;;;;AAMxC"}},
    {"offset": {"line": 4579, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/FileUploadPreview.tsx"],"sourcesContent":["import { Button } from \"@/components/ui/button\";\nimport { X, File, Loader2 } from \"lucide-react\";\nimport { useEffect, useState, useCallback, useRef } from \"react\";\nimport Image from \"next/image\";\nimport {\n  fileToBase64,\n  formatFileSize,\n  isImageFile,\n} from \"@/lib/utils/file-utils\";\nimport { ImageViewer } from \"./ImageViewer\";\nimport {\n  UploadedFileState,\n  FileUploadPreviewProps,\n  FilePreview,\n} from \"@/types/file\";\n\nexport const FileUploadPreview = ({\n  uploadedFiles,\n  onRemoveFile,\n}: FileUploadPreviewProps) => {\n  const [filePreviews, setFilePreviews] = useState<FilePreview[]>([]);\n  const [selectedImage, setSelectedImage] = useState<{\n    src: string;\n    alt: string;\n  } | null>(null);\n\n  // Use ref to store base64 previews to avoid regenerating them\n  const previewCache = useRef<Map<string, string>>(new Map());\n\n  const generateFileKey = useCallback((file: File): string => {\n    return `${file.name}_${file.size}_${file.lastModified}`;\n  }, []);\n\n  useEffect(() => {\n    const loadPreviews = async () => {\n      const previews: FilePreview[] = [];\n\n      for (const uploadedFile of uploadedFiles) {\n        const preview: FilePreview = {\n          file: uploadedFile.file,\n          loading: false,\n          uploading: uploadedFile.uploading,\n          uploaded: uploadedFile.uploaded,\n          error: uploadedFile.error,\n        };\n\n        // Generate base64 preview for images - this will show immediately while uploading\n        if (isImageFile(uploadedFile.file)) {\n          const fileKey = generateFileKey(uploadedFile.file);\n          const cachedPreview = previewCache.current.get(fileKey);\n\n          if (cachedPreview) {\n            // Use cached preview\n            preview.preview = cachedPreview;\n          } else {\n            // Generate new base64 preview\n            preview.loading = true;\n            try {\n              const base64Preview = await fileToBase64(uploadedFile.file);\n              preview.preview = base64Preview;\n              // Cache the preview\n              previewCache.current.set(fileKey, base64Preview);\n            } catch (error) {\n              console.error(\"Error converting file to base64:\", error);\n            }\n            preview.loading = false;\n          }\n        }\n\n        previews.push(preview);\n      }\n\n      setFilePreviews(previews);\n    };\n\n    if (uploadedFiles && uploadedFiles.length > 0) {\n      loadPreviews();\n    } else {\n      // eslint-disable-next-line react-hooks/set-state-in-effect\n      setFilePreviews([]);\n      // Don't clear cache when no files - we might get the same files back\n    }\n  }, [uploadedFiles, generateFileKey]);\n\n  if (!uploadedFiles || uploadedFiles.length === 0) {\n    return null;\n  }\n\n  const hasMultipleFiles = uploadedFiles.length > 1;\n\n  const handleImageClick = (preview: string, fileName: string) => {\n    setSelectedImage({ src: preview, alt: fileName });\n  };\n\n  return (\n    <>\n      <div className=\"flex flex-col gap-3 rounded-t-[22px] transition-all relative bg-input-chat py-3 shadow-[0px_12px_32px_0px_rgba(0,0,0,0.02)] border border-black/8 dark:border-border border-b-0\">\n        <div className=\"w-full\">\n          <div className=\"no-scrollbar horizontal-scroll-fade-mask flex flex-nowrap gap-2 overflow-x-auto px-2.5 [--edge-fade-distance:1rem]\">\n            {filePreviews.map((filePreview, index) => (\n              <div\n                key={`${filePreview.file.name}-${index}`}\n                className=\"group text-token-text-primary relative inline-block text-sm\"\n                data-testid=\"attached-file\"\n              >\n                <div\n                  className={`relative overflow-hidden border rounded-2xl ${\n                    filePreview.error\n                      ? \"border-red-500 border-2 bg-red-50 dark:bg-red-950/20\"\n                      : isImageFile(filePreview.file)\n                        ? \"bg-background\"\n                        : \"bg-primary\"\n                  }`}\n                >\n                  <div\n                    className={\n                      isImageFile(filePreview.file)\n                        ? hasMultipleFiles\n                          ? \"h-14.5 w-14.5\"\n                          : \"h-36 w-36\"\n                        : \"\"\n                    }\n                  >\n                    {filePreview.loading && !filePreview.preview ? (\n                      <div className=\"h-full w-full flex items-center justify-center bg-muted\">\n                        <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-foreground\"></div>\n                      </div>\n                    ) : filePreview.error ? (\n                      isImageFile(filePreview.file) ? (\n                        <div className=\"h-full w-full flex items-center justify-center min-h-[100px]\">\n                          <div className=\"flex flex-col items-center gap-2 p-3\">\n                            <div className=\"rounded-full bg-red-500 p-2\">\n                              <X className=\"h-5 w-5 text-white\" />\n                            </div>\n                            <span className=\"text-xs font-semibold text-red-600 dark:text-red-400 text-center\">\n                              Upload failed\n                            </span>\n                          </div>\n                        </div>\n                      ) : (\n                        <div className=\"p-2 w-80\">\n                          <div className=\"flex flex-row items-center gap-2\">\n                            <div className=\"relative h-10 w-10 shrink-0 overflow-hidden rounded-lg flex items-center justify-center bg-red-500\">\n                              <X className=\"h-6 w-6 text-white\" />\n                            </div>\n                            <div className=\"overflow-hidden flex-1\">\n                              <div className=\"truncate font-semibold text-sm\">\n                                {filePreview.file.name}\n                              </div>\n                              <div className=\"text-red-600 dark:text-red-400 font-medium text-xs\">\n                                Upload failed\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      )\n                    ) : filePreview.preview ? (\n                      <button\n                        className=\"h-full w-full overflow-hidden relative\"\n                        onClick={() =>\n                          handleImageClick(\n                            filePreview.preview!,\n                            filePreview.file.name,\n                          )\n                        }\n                      >\n                        <Image\n                          src={filePreview.preview}\n                          alt={filePreview.file.name}\n                          className=\"h-full w-full object-cover\"\n                          fill\n                          unoptimized\n                        />\n                        {/* Upload overlay - show spinner overlay on top of image while uploading */}\n                        {filePreview.uploading && (\n                          <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center\">\n                            <Loader2 className=\"h-4 w-4 animate-spin text-white\" />\n                          </div>\n                        )}\n                      </button>\n                    ) : (\n                      <div className=\"p-2 w-80\">\n                        <div className=\"flex flex-row items-center gap-2\">\n                          <div\n                            className={`relative h-10 w-10 shrink-0 overflow-hidden rounded-lg flex items-center justify-center ${\n                              filePreview.error ? \"bg-red-500\" : \"bg-[#FF5588]\"\n                            }`}\n                          >\n                            {filePreview.uploading ? (\n                              <Loader2 className=\"h-6 w-6 text-white animate-spin\" />\n                            ) : filePreview.error ? (\n                              <X className=\"h-6 w-6 text-white\" />\n                            ) : (\n                              <File className=\"h-6 w-6 text-white\" />\n                            )}\n                          </div>\n                          <div className=\"overflow-hidden flex-1\">\n                            <div className=\"truncate font-semibold text-sm\">\n                              {filePreview.file.name}\n                            </div>\n                            <div\n                              className={`truncate text-xs ${\n                                filePreview.error\n                                  ? \"text-red-600 dark:text-red-400 font-medium\"\n                                  : \"text-muted-foreground\"\n                              }`}\n                            >\n                              {filePreview.error\n                                ? \"Upload failed\"\n                                : `Document  ${formatFileSize(filePreview.file.size)}`}\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                <div className=\"absolute end-1.5 top-1.5 inline-flex gap-1\">\n                  <Button\n                    type=\"button\"\n                    onClick={() => onRemoveFile(index)}\n                    variant=\"secondary\"\n                    size=\"sm\"\n                    className=\"transition-colors flex h-6 w-6 items-center justify-center rounded-full border-[rgba(0,0,0,0.1)] bg-black text-white dark:border-[rgba(255,255,255,0.1)] dark:bg-white dark:text-black p-0\"\n                    aria-label=\"Remove file\"\n                    data-testid=\"remove-file\"\n                  >\n                    <X className=\"h-3 w-3\" />\n                  </Button>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Image Viewer Modal */}\n      {selectedImage && selectedImage.src && (\n        <ImageViewer\n          isOpen={!!selectedImage}\n          onClose={() => setSelectedImage(null)}\n          imageSrc={selectedImage.src}\n          imageAlt={selectedImage.alt}\n        />\n      )}\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4960, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/QueuedMessagesPanel.tsx"],"sourcesContent":["import { Button } from \"@/components/ui/button\";\nimport {\n  Trash,\n  ArrowUp,\n  ChevronDown,\n  ChevronRight,\n  MoreHorizontal,\n  Check,\n} from \"lucide-react\";\nimport type { QueuedMessage, QueueBehavior } from \"@/types/chat\";\nimport { useState } from \"react\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\ninterface QueuedMessagesPanelProps {\n  messages: QueuedMessage[];\n  onSendNow: (messageId: string) => void;\n  onDelete: (messageId: string) => void;\n  isStreaming: boolean;\n  queueBehavior?: QueueBehavior;\n  onQueueBehaviorChange?: (behavior: QueueBehavior) => void;\n}\n\nexport const QueuedMessagesPanel = ({\n  messages,\n  onSendNow,\n  onDelete,\n  isStreaming,\n  queueBehavior = \"queue\",\n  onQueueBehaviorChange,\n}: QueuedMessagesPanelProps) => {\n  const [isExpanded, setIsExpanded] = useState(true);\n\n  if (messages.length === 0) {\n    return null;\n  }\n\n  const handleToggleExpand = () => {\n    setIsExpanded(!isExpanded);\n  };\n\n  const queueBehaviorOptions: Array<{\n    value: QueueBehavior;\n    label: string;\n  }> = [\n    { value: \"queue\", label: \"Queue after current message\" },\n    { value: \"stop-and-send\", label: \"Stop & send right away\" },\n  ];\n\n  return (\n    <div className=\"mx-4 rounded-[22px_22px_0px_0px] shadow-[0px_12px_32px_0px_rgba(0,0,0,0.02)] border border-black/8 dark:border-border border-b-0 bg-input-chat\">\n      {/* Header */}\n      <div className=\"flex items-center px-4 transition-all duration-300 py-2\">\n        <button\n          onClick={handleToggleExpand}\n          className=\"flex items-center gap-2 hover:opacity-80 transition-opacity cursor-pointer focus:outline-none rounded-md p-1 -m-1 flex-1\"\n          aria-label={\n            isExpanded ? \"Collapse queued messages\" : \"Expand queued messages\"\n          }\n          tabIndex={0}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" || e.key === \" \") {\n              e.preventDefault();\n              handleToggleExpand();\n            }\n          }}\n        >\n          {isExpanded ? (\n            <ChevronDown className=\"w-4 h-4 text-muted-foreground\" />\n          ) : (\n            <ChevronRight className=\"w-4 h-4 text-muted-foreground\" />\n          )}\n          <div className=\"flex items-center gap-2\">\n            <h3 className=\"text-muted-foreground text-sm font-medium\">\n              {messages.length} Queued\n            </h3>\n          </div>\n        </button>\n\n        {/* Settings Dropdown */}\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              aria-label=\"Queue settings\"\n            >\n              <MoreHorizontal className=\"w-4 h-4 text-muted-foreground\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\" className=\"w-56\">\n            <div className=\"px-2 py-1.5 text-xs font-medium text-muted-foreground\">\n              When to send follow-ups\n            </div>\n            {queueBehaviorOptions.map((option) => (\n              <DropdownMenuItem\n                key={option.value}\n                onClick={() => onQueueBehaviorChange?.(option.value)}\n                className=\"flex items-center justify-between cursor-pointer\"\n              >\n                <span>{option.label}</span>\n                {queueBehavior === option.value && (\n                  <Check className=\"w-4 h-4\" />\n                )}\n              </DropdownMenuItem>\n            ))}\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      {/* Message List - Collapsible */}\n      {isExpanded && (\n        <div className=\"border-t border-border px-4 py-3 space-y-2 max-h-[200px] overflow-y-auto\">\n          {messages.map((message) => (\n            <div\n              key={message.id}\n              className=\"flex items-start gap-2 transition-colors\"\n            >\n              {/* Message preview */}\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"text-sm truncate text-foreground\">\n                  {message.text}\n                </div>\n                {message.files && message.files.length > 0 && (\n                  <div className=\"text-xs text-muted-foreground mt-0.5\">\n                    {message.files.length} file\n                    {message.files.length > 1 ? \"s\" : \"\"}\n                  </div>\n                )}\n              </div>\n\n              {/* Actions */}\n              <div className=\"flex items-center gap-1 flex-shrink-0\">\n                <Button\n                  type=\"button\"\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => onSendNow(message.id)}\n                  disabled={!isStreaming}\n                  className=\"h-7 px-2 text-xs\"\n                  title={\n                    isStreaming\n                      ? \"Cancel current response and send this now\"\n                      : \"Waiting for current response to complete\"\n                  }\n                >\n                  <ArrowUp className=\"w-3 h-3 mr-1\" />\n                  Send Now\n                </Button>\n                <Button\n                  type=\"button\"\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => onDelete(message.id)}\n                  className=\"h-7 w-7 p-0\"\n                  title=\"Remove from queue\"\n                >\n                  <Trash className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;;;;;;AAgBO,MAAM,sBAAsB,CAAC,EAClC,QAAQ,EACR,SAAS,EACT,QAAQ,EACR,WAAW,EACX,gBAAgB,OAAO,EACvB,qBAAqB,EACI;IACzB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,gaAAQ,EAAC;IAE7C,IAAI,SAAS,MAAM,KAAK,GAAG;QACzB,OAAO;IACT;IAEA,MAAM,qBAAqB;QACzB,cAAc,CAAC;IACjB;IAEA,MAAM,uBAGD;QACH;YAAE,OAAO;YAAS,OAAO;QAA8B;QACvD;YAAE,OAAO;YAAiB,OAAO;QAAyB;KAC3D;IAED,qBACE,6bAAC;QAAI,WAAU;;0BAEb,6bAAC;gBAAI,WAAU;;kCACb,6bAAC;wBACC,SAAS;wBACT,WAAU;wBACV,cACE,aAAa,6BAA6B;wBAE5C,UAAU;wBACV,WAAW,CAAC;4BACV,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK;gCACtC,EAAE,cAAc;gCAChB;4BACF;wBACF;;4BAEC,2BACC,6bAAC,uTAAW;gCAAC,WAAU;;;;;yFAEvB,6bAAC,0TAAY;gCAAC,WAAU;;;;;;0CAE1B,6bAAC;gCAAI,WAAU;0CACb,cAAA,6bAAC;oCAAG,WAAU;;wCACX,SAAS,MAAM;wCAAC;;;;;;;;;;;;;;;;;;kCAMvB,6bAAC,qJAAY;;0CACX,6bAAC,4JAAmB;gCAAC,OAAO;0CAC1B,cAAA,6bAAC,qIAAM;oCACL,SAAQ;oCACR,MAAK;oCACL,WAAU;oCACV,cAAW;8CAEX,cAAA,6bAAC,sTAAc;wCAAC,WAAU;;;;;;;;;;;;;;;;0CAG9B,6bAAC,4JAAmB;gCAAC,OAAM;gCAAM,WAAU;;kDACzC,6bAAC;wCAAI,WAAU;kDAAwD;;;;;;oCAGtE,qBAAqB,GAAG,CAAC,CAAC,uBACzB,6bAAC,yJAAgB;4CAEf,SAAS,IAAM,wBAAwB,OAAO,KAAK;4CACnD,WAAU;;8DAEV,6bAAC;8DAAM,OAAO,KAAK;;;;;;gDAClB,kBAAkB,OAAO,KAAK,kBAC7B,6bAAC,iSAAK;oDAAC,WAAU;;;;;;;2CANd,OAAO,KAAK;;;;;;;;;;;;;;;;;;;;;;;YAe1B,4BACC,6bAAC;gBAAI,WAAU;0BACZ,SAAS,GAAG,CAAC,CAAC,wBACb,6bAAC;wBAEC,WAAU;;0CAGV,6bAAC;gCAAI,WAAU;;kDACb,6bAAC;wCAAI,WAAU;kDACZ,QAAQ,IAAI;;;;;;oCAEd,QAAQ,KAAK,IAAI,QAAQ,KAAK,CAAC,MAAM,GAAG,mBACvC,6bAAC;wCAAI,WAAU;;4CACZ,QAAQ,KAAK,CAAC,MAAM;4CAAC;4CACrB,QAAQ,KAAK,CAAC,MAAM,GAAG,IAAI,MAAM;;;;;;;;;;;;;0CAMxC,6bAAC;gCAAI,WAAU;;kDACb,6bAAC,qIAAM;wCACL,MAAK;wCACL,MAAK;wCACL,SAAQ;wCACR,SAAS,IAAM,UAAU,QAAQ,EAAE;wCACnC,UAAU,CAAC;wCACX,WAAU;wCACV,OACE,cACI,8CACA;;0DAGN,6bAAC,2SAAO;gDAAC,WAAU;;;;;;4CAAiB;;;;;;;kDAGtC,6bAAC,qIAAM;wCACL,MAAK;wCACL,MAAK;wCACL,SAAQ;wCACR,SAAS,IAAM,SAAS,QAAQ,EAAE;wCAClC,WAAU;wCACV,OAAM;kDAEN,cAAA,6bAAC,iSAAK;4CAAC,WAAU;;;;;;;;;;;;;;;;;;uBA1ChB,QAAQ,EAAE;;;;;;;;;;;;;;;;AAmD7B"}},
    {"offset": {"line": 5239, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ScrollToBottomButton.tsx"],"sourcesContent":["import { ChevronDown } from \"lucide-react\";\nimport { useGlobalState } from \"@/app/contexts/GlobalState\";\n\ninterface ScrollToBottomButtonProps {\n  onClick: () => void;\n  hasMessages: boolean;\n  isAtBottom: boolean;\n}\n\nexport const ScrollToBottomButton = ({\n  onClick,\n  hasMessages,\n  isAtBottom,\n}: ScrollToBottomButtonProps) => {\n  const { isTodoPanelExpanded } = useGlobalState();\n\n  const shouldShowScrollButton =\n    hasMessages && !isAtBottom && !isTodoPanelExpanded;\n\n  if (!shouldShowScrollButton) return null;\n\n  return (\n    <div>\n      <button\n        onClick={onClick}\n        className=\"bg-background border border-border rounded-full p-2 shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 flex items-center justify-center\"\n        aria-label=\"Scroll to bottom\"\n        tabIndex={0}\n      >\n        <ChevronDown className=\"w-4 h-4 text-muted-foreground\" />\n      </button>\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAQO,MAAM,uBAAuB,CAAC,EACnC,OAAO,EACP,WAAW,EACX,UAAU,EACgB;IAC1B,MAAM,EAAE,mBAAmB,EAAE,GAAG,IAAA,iJAAc;IAE9C,MAAM,yBACJ,eAAe,CAAC,cAAc,CAAC;IAEjC,IAAI,CAAC,wBAAwB,OAAO;IAEpC,qBACE,6bAAC;kBACC,cAAA,6bAAC;YACC,SAAS;YACT,WAAU;YACV,cAAW;YACX,UAAU;sBAEV,cAAA,6bAAC,uTAAW;gBAAC,WAAU;;;;;;;;;;;;;;;;AAI/B"}},
    {"offset": {"line": 5281, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/AttachmentButton.tsx"],"sourcesContent":["import { Button } from \"@/components/ui/button\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\";\nimport { Paperclip } from \"lucide-react\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\nimport { useState } from \"react\";\nimport { redirectToPricing } from \"../hooks/usePricingDialog\";\n\ninterface AttachmentButtonProps {\n  onAttachClick: () => void;\n  disabled?: boolean;\n}\n\nexport const AttachmentButton = ({\n  onAttachClick,\n  disabled = false,\n}: AttachmentButtonProps) => {\n  const { subscription, isCheckingProPlan } = useGlobalState();\n  const [popoverOpen, setPopoverOpen] = useState(false);\n\n  const handleClick = () => {\n    if (subscription !== \"free\") {\n      onAttachClick();\n    } else {\n      setPopoverOpen(true);\n    }\n  };\n\n  const handleUpgradeClick = () => {\n    // Close the popover first\n    setPopoverOpen(false);\n    // Navigate to pricing page\n    redirectToPricing();\n  };\n\n  // If user has pro plan or we're checking, show normal tooltip behavior\n  if (subscription !== \"free\" || isCheckingProPlan) {\n    return (\n      <TooltipPrimitive.Root>\n        <TooltipTrigger asChild>\n          <Button\n            type=\"button\"\n            onClick={onAttachClick}\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"rounded-full p-0 w-8 h-8 min-w-0\"\n            aria-label=\"Attach files\"\n            data-testid=\"attach-files-button\"\n            disabled={disabled || isCheckingProPlan}\n          >\n            <Paperclip className=\"w-[15px] h-[15px]\" />\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent>\n          <p>Add files</p>\n        </TooltipContent>\n      </TooltipPrimitive.Root>\n    );\n  }\n\n  // If user doesn't have pro plan, show popover with upgrade option\n  return (\n    <Popover open={popoverOpen} onOpenChange={setPopoverOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          type=\"button\"\n          onClick={handleClick}\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"rounded-full p-0 w-8 h-8 min-w-0\"\n          aria-label=\"Attach files\"\n          data-testid=\"attach-files-button\"\n          disabled={disabled}\n        >\n          <Paperclip className=\"w-[15px] h-[15px]\" />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent\n        className=\"w-80 p-4\"\n        side=\"top\"\n        align=\"start\"\n        data-testid=\"file-attach-upgrade-dialog\"\n      >\n        <div className=\"space-y-3\">\n          <h3 className=\"font-semibold text-base\">Upgrade plan</h3>\n          <p className=\"text-sm text-muted-foreground\">\n            Get access to file attachments and more features with Pro\n          </p>\n          <Button\n            onClick={handleUpgradeClick}\n            className=\"w-full\"\n            data-testid=\"file-attach-upgrade-button\"\n          >\n            Upgrade now\n          </Button>\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AAOO,MAAM,mBAAmB,CAAC,EAC/B,aAAa,EACb,WAAW,KAAK,EACM;IACtB,MAAM,EAAE,YAAY,EAAE,iBAAiB,EAAE,GAAG,IAAA,iJAAc;IAC1D,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,gaAAQ,EAAC;IAE/C,MAAM,cAAc;QAClB,IAAI,iBAAiB,QAAQ;YAC3B;QACF,OAAO;YACL,eAAe;QACjB;IACF;IAEA,MAAM,qBAAqB;QACzB,0BAA0B;QAC1B,eAAe;QACf,2BAA2B;QAC3B,IAAA,qJAAiB;IACnB;IAEA,uEAAuE;IACvE,IAAI,iBAAiB,UAAU,mBAAmB;QAChD,qBACE,6bAAC,4XAAqB;;8BACpB,6bAAC,8IAAc;oBAAC,OAAO;8BACrB,cAAA,6bAAC,qIAAM;wBACL,MAAK;wBACL,SAAS;wBACT,SAAQ;wBACR,MAAK;wBACL,WAAU;wBACV,cAAW;wBACX,eAAY;wBACZ,UAAU,YAAY;kCAEtB,cAAA,6bAAC,6SAAS;4BAAC,WAAU;;;;;;;;;;;;;;;;8BAGzB,6bAAC,8IAAc;8BACb,cAAA,6bAAC;kCAAE;;;;;;;;;;;;;;;;;IAIX;IAEA,kEAAkE;IAClE,qBACE,6bAAC,uIAAO;QAAC,MAAM;QAAa,cAAc;;0BACxC,6bAAC,8IAAc;gBAAC,OAAO;0BACrB,cAAA,6bAAC,qIAAM;oBACL,MAAK;oBACL,SAAS;oBACT,SAAQ;oBACR,MAAK;oBACL,WAAU;oBACV,cAAW;oBACX,eAAY;oBACZ,UAAU;8BAEV,cAAA,6bAAC,6SAAS;wBAAC,WAAU;;;;;;;;;;;;;;;;0BAGzB,6bAAC,8IAAc;gBACb,WAAU;gBACV,MAAK;gBACL,OAAM;gBACN,eAAY;0BAEZ,cAAA,6bAAC;oBAAI,WAAU;;sCACb,6bAAC;4BAAG,WAAU;sCAA0B;;;;;;sCACxC,6bAAC;4BAAE,WAAU;sCAAgC;;;;;;sCAG7C,6bAAC,qIAAM;4BACL,SAAS;4BACT,WAAU;4BACV,eAAY;sCACb;;;;;;;;;;;;;;;;;;;;;;;AAOX"}},
    {"offset": {"line": 5460, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/RateLimitWarning.tsx"],"sourcesContent":["import { X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { redirectToPricing } from \"../hooks/usePricingDialog\";\nimport type { ChatMode, SubscriptionTier } from \"@/types\";\n\ninterface RateLimitWarningProps {\n  remaining: number;\n  resetTime: Date;\n  mode: ChatMode;\n  subscription: SubscriptionTier;\n  onDismiss: () => void;\n}\n\nconst formatTimeUntil = (resetTime: Date): string => {\n  const now = new Date();\n  const timeDiff = resetTime.getTime() - now.getTime();\n\n  if (timeDiff <= 0) {\n    return \"now\";\n  }\n\n  const hoursUntil = Math.floor(timeDiff / (1000 * 60 * 60));\n  const minutesUntil = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));\n\n  if (hoursUntil === 0 && minutesUntil === 0) {\n    return \"in less than a minute\";\n  }\n  if (hoursUntil === 0) {\n    return `in ${minutesUntil} ${minutesUntil === 1 ? \"minute\" : \"minutes\"}`;\n  }\n  if (minutesUntil === 0) {\n    return `in ${hoursUntil} ${hoursUntil === 1 ? \"hour\" : \"hours\"}`;\n  }\n  return `in ${hoursUntil}h ${minutesUntil}m`;\n};\n\nexport const RateLimitWarning = ({\n  remaining,\n  resetTime,\n  mode,\n  subscription,\n  onDismiss,\n}: RateLimitWarningProps) => {\n  const timeString = formatTimeUntil(resetTime);\n  const isFree = subscription === \"free\";\n\n  // Different message when user has 0 remaining\n  const message =\n    remaining === 0\n      ? `You've reached your ${mode} mode limit. It resets ${timeString}.`\n      : `You have ${remaining} ${remaining === 1 ? \"response\" : \"responses\"} in ${mode} mode remaining until it resets ${timeString}.`;\n\n  return (\n    <div\n      data-testid=\"rate-limit-warning\"\n      className=\"mb-2 px-3 py-2.5 bg-input-chat border border-black/8 dark:border-border rounded-lg flex items-center justify-between gap-2\"\n    >\n      <div className=\"flex-1 flex items-center gap-2 flex-wrap\">\n        <span className=\"text-foreground\">{message}</span>\n        {isFree && (\n          <Button\n            onClick={redirectToPricing}\n            size=\"sm\"\n            variant=\"default\"\n            className=\"h-7 px-3 text-xs font-medium\"\n          >\n            Upgrade plan\n          </Button>\n        )}\n      </div>\n      <button\n        onClick={onDismiss}\n        className=\"flex-shrink-0 text-muted-foreground hover:text-foreground cursor-pointer transition-colors\"\n        aria-label=\"Dismiss warning\"\n      >\n        <X className=\"h-5 w-5\" />\n      </button>\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAWA,MAAM,kBAAkB,CAAC;IACvB,MAAM,MAAM,IAAI;IAChB,MAAM,WAAW,UAAU,OAAO,KAAK,IAAI,OAAO;IAElD,IAAI,YAAY,GAAG;QACjB,OAAO;IACT;IAEA,MAAM,aAAa,KAAK,KAAK,CAAC,WAAW,CAAC,OAAO,KAAK,EAAE;IACxD,MAAM,eAAe,KAAK,KAAK,CAAC,AAAC,WAAW,CAAC,OAAO,KAAK,EAAE,IAAK,CAAC,OAAO,EAAE;IAE1E,IAAI,eAAe,KAAK,iBAAiB,GAAG;QAC1C,OAAO;IACT;IACA,IAAI,eAAe,GAAG;QACpB,OAAO,CAAC,GAAG,EAAE,aAAa,CAAC,EAAE,iBAAiB,IAAI,WAAW,WAAW;IAC1E;IACA,IAAI,iBAAiB,GAAG;QACtB,OAAO,CAAC,GAAG,EAAE,WAAW,CAAC,EAAE,eAAe,IAAI,SAAS,SAAS;IAClE;IACA,OAAO,CAAC,GAAG,EAAE,WAAW,EAAE,EAAE,aAAa,CAAC,CAAC;AAC7C;AAEO,MAAM,mBAAmB,CAAC,EAC/B,SAAS,EACT,SAAS,EACT,IAAI,EACJ,YAAY,EACZ,SAAS,EACa;IACtB,MAAM,aAAa,gBAAgB;IACnC,MAAM,SAAS,iBAAiB;IAEhC,8CAA8C;IAC9C,MAAM,UACJ,cAAc,IACV,CAAC,oBAAoB,EAAE,KAAK,uBAAuB,EAAE,WAAW,CAAC,CAAC,GAClE,CAAC,SAAS,EAAE,UAAU,CAAC,EAAE,cAAc,IAAI,aAAa,YAAY,IAAI,EAAE,KAAK,gCAAgC,EAAE,WAAW,CAAC,CAAC;IAEpI,qBACE,6bAAC;QACC,eAAY;QACZ,WAAU;;0BAEV,6bAAC;gBAAI,WAAU;;kCACb,6bAAC;wBAAK,WAAU;kCAAmB;;;;;;oBAClC,wBACC,6bAAC,qIAAM;wBACL,SAAS,qJAAiB;wBAC1B,MAAK;wBACL,SAAQ;wBACR,WAAU;kCACX;;;;;;;;;;;;0BAKL,6bAAC;gBACC,SAAS;gBACT,WAAU;gBACV,cAAW;0BAEX,cAAA,6bAAC,qRAAC;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAIrB"}},
    {"offset": {"line": 5555, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/SandboxSelector.tsx"],"sourcesContent":["\"use client\";\n\nimport { useQuery } from \"convex/react\";\nimport { api } from \"@/convex/_generated/api\";\nimport {\n  Check,\n  Cloud,\n  Laptop,\n  AlertTriangle,\n  ChevronDown,\n  Copy,\n} from \"lucide-react\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Button } from \"@/components/ui/button\";\nimport { useState, useEffect } from \"react\";\nimport { toast } from \"sonner\";\n\ninterface SandboxSelectorProps {\n  value: string;\n  onChange?: (value: string) => void;\n  disabled?: boolean;\n  size?: \"sm\" | \"md\";\n  readOnly?: boolean;\n}\n\ninterface LocalConnection {\n  connectionId: string;\n  name: string;\n  mode: \"docker\" | \"dangerous\" | \"custom\";\n  imageName?: string;\n  containerId?: string;\n  osInfo?: {\n    platform: string;\n  };\n}\n\ninterface ConnectionOption {\n  id: string;\n  label: string;\n  description: string;\n  icon: typeof Cloud;\n  warning: string | null;\n  mode?: \"docker\" | \"dangerous\" | \"custom\";\n}\n\nexport function SandboxSelector({\n  value,\n  onChange,\n  disabled = false,\n  size = \"sm\",\n  readOnly = false,\n}: SandboxSelectorProps) {\n  const [open, setOpen] = useState(false);\n\n  const connections = [];\n\n  const options: ConnectionOption[] = [\n    {\n      id: \"e2b\",\n      label: \"Cloud\",\n      icon: Cloud,\n      description: \"\",\n      warning: null,\n    },\n    ...((connections as LocalConnection[] | undefined)?.map((conn) => ({\n      id: conn.connectionId,\n      label: conn.name,\n      icon: Laptop,\n      description:\n        conn.mode === \"dangerous\"\n          ? `Dangerous: ${conn.osInfo?.platform || \"unknown\"}`\n          : conn.mode === \"custom\"\n            ? `Custom: ${conn.imageName || \"unknown\"}`\n            : `Docker: ${conn.containerId?.slice(0, 8) || \"unknown\"}`,\n      warning:\n        conn.mode === \"dangerous\" ? \"Direct OS access - no isolation\" : null,\n      mode: conn.mode,\n    })) || []),\n  ];\n\n  // Auto-correct stale sandbox preference: if the stored value doesn't match any\n  // available option (e.g., local connection was disconnected), reset to \"e2b\"\n  const valueMatchesOption = options.some((opt) => opt.id === value);\n  useEffect(() => {\n    if (connections !== undefined && !valueMatchesOption && value !== \"e2b\") {\n      onChange?.(\"e2b\");\n      toast.info(\"Local sandbox disconnected. Switched to Cloud.\", {\n        duration: 5000,\n      });\n    }\n  }, [connections, valueMatchesOption, value, onChange]);\n\n  const selectedOption = options.find((opt) => opt.id === value) || options[0];\n  const Icon = selectedOption?.icon || Cloud;\n\n  const buttonClassName =\n    size === \"md\"\n      ? \"h-9 px-3 gap-2 text-sm font-medium rounded-md bg-transparent hover:bg-muted/30 focus-visible:ring-1 min-w-0 shrink\"\n      : \"h-7 px-2 gap-1 text-xs font-medium rounded-md bg-transparent hover:bg-muted/30 focus-visible:ring-1 min-w-0 shrink\";\n\n  const iconClassName = size === \"md\" ? \"h-4 w-4 shrink-0\" : \"h-3 w-3 shrink-0\";\n\n  const buttonContent = (\n    <>\n      <Icon className={iconClassName} />\n      <span className=\"truncate\">{selectedOption?.label}</span>\n      {selectedOption?.mode === \"dangerous\" && (\n        <AlertTriangle\n          className={\n            size === \"md\"\n              ? \"h-4 w-4 text-yellow-500 shrink-0\"\n              : \"h-3 w-3 text-yellow-500 shrink-0\"\n          }\n        />\n      )}\n      {!readOnly && (\n        <ChevronDown\n          className={\n            size === \"md\" ? \"h-4 w-4 ml-1 shrink-0\" : \"h-3 w-3 ml-1 shrink-0\"\n          }\n        />\n      )}\n    </>\n  );\n\n  // Read-only mode: display with tooltip\n  if (readOnly) {\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <div\n            className={`flex items-center cursor-default text-muted-foreground ${buttonClassName}`}\n            aria-label=\"Sandbox environment for this chat\"\n          >\n            {buttonContent}\n          </div>\n        </TooltipTrigger>\n        <TooltipContent>\n          <p>Sandbox environment for this chat</p>\n        </TooltipContent>\n      </Tooltip>\n    );\n  }\n\n  // Editable mode: popover selector\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size={size === \"md\" ? \"default\" : \"sm\"}\n          disabled={disabled}\n          className={buttonClassName}\n        >\n          {buttonContent}\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-[280px] p-1\" align=\"start\">\n        <div className=\"space-y-0.5\">\n          <div className=\"px-2 py-1.5 text-xs font-medium text-muted-foreground\">\n            Execution Environment\n          </div>\n          {options.map((option) => {\n            const OptionIcon = option.icon;\n            return (\n              <button\n                key={option.id}\n                onClick={() => {\n                  onChange?.(option.id);\n                  setOpen(false);\n                }}\n                className={`w-full flex items-center gap-2.5 p-2 rounded-md text-left transition-colors ${\n                  value === option.id\n                    ? \"bg-accent text-accent-foreground\"\n                    : \"hover:bg-muted\"\n                }`}\n              >\n                <OptionIcon className=\"h-4 w-4 shrink-0\" />\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-1.5\">\n                    <span className=\"text-sm font-medium truncate\">\n                      {option.label}\n                    </span>\n                    {option.mode === \"dangerous\" && (\n                      <AlertTriangle className=\"h-3 w-3 text-yellow-500 shrink-0\" />\n                    )}\n                  </div>\n                  {option.description && (\n                    <div className=\"text-xs text-muted-foreground truncate\">\n                      {option.description}\n                    </div>\n                  )}\n                  {option.warning && (\n                    <div className=\"text-xs text-yellow-600 dark:text-yellow-400 mt-0.5\">\n                      {option.warning}\n                    </div>\n                  )}\n                </div>\n                {value === option.id && <Check className=\"h-4 w-4 shrink-0\" />}\n              </button>\n            );\n          })}\n          {connections && connections.length === 0 && (\n            <div className=\"px-2 py-2 border-t mt-1 pt-2 space-y-2\">\n              <div className=\"text-xs text-muted-foreground\">\n                No local connections.\n              </div>\n              <div className=\"flex gap-1.5\">\n                <code className=\"flex-1 p-2 rounded-md font-mono text-xs bg-zinc-900 dark:bg-zinc-950 text-zinc-300 dark:text-zinc-400 overflow-x-auto\">\n                  npx @hackerai/local@latest\n                </code>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  className=\"shrink-0 h-8 w-8\"\n                  onClick={() => {\n                    navigator.clipboard.writeText(\"npx @hackerai/local@latest\");\n                    toast.success(\"Command copied to clipboard\");\n                  }}\n                >\n                  <Copy className=\"h-3.5 w-3.5\" />\n                </Button>\n              </div>\n              <div className=\"text-xs text-muted-foreground\">\n                Run this command to enable local execution.\n              </div>\n            </div>\n          )}\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5892, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ChatInput.tsx"],"sourcesContent":["import { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\";\nimport {\n  ArrowUp,\n  Square,\n  MessageSquare,\n  Infinity,\n  ChevronDown,\n} from \"lucide-react\";\nimport { useHotkeys } from \"react-hotkeys-hook\";\nimport TextareaAutosize from \"react-textarea-autosize\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\nimport { redirectToPricing } from \"../hooks/usePricingDialog\";\nimport { TodoPanel } from \"./TodoPanel\";\nimport type { ChatStatus } from \"@/types\";\nimport { FileUploadPreview } from \"./FileUploadPreview\";\nimport { QueuedMessagesPanel } from \"./QueuedMessagesPanel\";\nimport { ScrollToBottomButton } from \"./ScrollToBottomButton\";\nimport { AttachmentButton } from \"./AttachmentButton\";\nimport { useFileUpload } from \"../hooks/useFileUpload\";\nimport { useEffect, useRef, useState } from \"react\";\nimport {\n  countInputTokens,\n  getMaxTokensForSubscription,\n} from \"@/lib/token-utils\";\nimport { toast } from \"sonner\";\nimport {\n  NULL_THREAD_DRAFT_ID,\n  getDraftContentById,\n  upsertDraft,\n  removeDraft,\n} from \"@/lib/utils/client-storage\";\nimport { RateLimitWarning } from \"./RateLimitWarning\";\nimport { SandboxSelector } from \"./SandboxSelector\";\nimport type { ChatMode, SubscriptionTier } from \"@/types\";\n\ninterface ChatInputProps {\n  onSubmit: (e: React.FormEvent) => void;\n  onStop: () => void;\n  onSendNow: (messageId: string) => void;\n  status: ChatStatus;\n  isCentered?: boolean;\n  hasMessages?: boolean;\n  isAtBottom?: boolean;\n  onScrollToBottom?: () => void;\n  hideStop?: boolean;\n  isNewChat?: boolean;\n  clearDraftOnSubmit?: boolean;\n  chatId?: string;\n  rateLimitWarning?: {\n    remaining: number;\n    resetTime: Date;\n    mode: ChatMode;\n    subscription: SubscriptionTier;\n  };\n  onDismissRateLimitWarning?: () => void;\n}\n\nexport const ChatInput = ({\n  onSubmit,\n  onStop,\n  onSendNow,\n  status,\n  isCentered = false,\n  hasMessages = false,\n  isAtBottom = true,\n  onScrollToBottom,\n  hideStop = false,\n  isNewChat = false,\n  clearDraftOnSubmit = true,\n  chatId,\n  rateLimitWarning,\n  onDismissRateLimitWarning,\n}: ChatInputProps) => {\n  const {\n    input,\n    setInput,\n    chatMode,\n    setChatMode,\n    uploadedFiles,\n    isUploadingFiles,\n    subscription,\n    isCheckingProPlan,\n    messageQueue,\n    removeQueuedMessage,\n    queueBehavior,\n    setQueueBehavior,\n    sandboxPreference,\n    setSandboxPreference,\n    selectedModel,\n    setSelectedModel,\n  } = useGlobalState();\n\n  const models = [\n    { value: \"claude-opus-4-5-20251101\", label: \"Claude 4.5 Opus\" },\n    { value: \"gemini-3-pro-preview\", label: \"Gemini 3 Pro\" },\n    { value: \"gpt-5.2-pro-2025-12-11\", label: \"GPT-5.2 Pro\" },\n    { value: \"o3-pro-2025-06-10\", label: \"o3 Pro\" },\n    { value: \"minimax-m2.1\", label: \"Minimax m2.1\" },\n    { value: \"moonshotai/kimi-k2.5\", label: \"Kimi k2.5\" },\n  ];\n  const {\n    fileInputRef,\n    handleFileUploadEvent,\n    handleRemoveFile,\n    handleAttachClick,\n    handlePasteEvent,\n  } = useFileUpload(chatMode);\n  const [agentUpgradeDialogOpen, setAgentUpgradeDialogOpen] = useState(false);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const isGenerating = status === \"submitted\" || status === \"streaming\";\n\n  // Compute draft ID:\n  // - For new chats (no messages yet): use \"new\" key so draft is preserved when navigating\n  // - For existing chats or chats with messages: use chatId for chat-specific drafts\n  const draftId = isNewChat ? \"new\" : chatId || NULL_THREAD_DRAFT_ID;\n\n  // Fallback to 'ask' mode if user doesn't have pro plan and somehow has agent mode selected\n  useEffect(() => {\n    if (!isCheckingProPlan && subscription === \"free\" && chatMode === \"agent\") {\n      setChatMode(\"ask\");\n    }\n  }, [subscription, isCheckingProPlan, chatMode, setChatMode]);\n\n  const handleAgentModeClick = () => {\n    if (subscription !== \"free\") {\n      setChatMode(\"agent\");\n    } else {\n      setAgentUpgradeDialogOpen(true);\n    }\n  };\n\n  const handleUpgradeClick = () => {\n    // Close the upgrade dialog first\n    setAgentUpgradeDialogOpen(false);\n    // Navigate to pricing page\n    redirectToPricing();\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    // Allow submission if:\n    // - (status is ready) OR (status is streaming AND in agent mode for queueing)\n    // - files are not uploading\n    // - there's text input or files attached\n    const canSubmit =\n      (status === \"ready\" ||\n        (status === \"streaming\" && chatMode === \"agent\")) &&\n      !isUploadingFiles &&\n      (input.trim() || uploadedFiles.length > 0);\n\n    if (canSubmit) {\n      onSubmit(e);\n      if (clearDraftOnSubmit) {\n        // Remove draft immediately and clear input on next tick to avoid race with onSubmit\n        removeDraft(draftId);\n        setTimeout(() => setInput(\"\"), 0);\n      }\n    }\n  };\n\n  // Handle keyboard shortcuts for stopping generation\n  useHotkeys(\n    \"ctrl+c\",\n    (e) => {\n      e.preventDefault();\n      onStop();\n    },\n    {\n      enabled: isGenerating && !hideStop,\n      enableOnFormTags: true,\n      enableOnContentEditable: true,\n      preventDefault: true,\n      description: \"Stop AI generation\",\n    },\n    [isGenerating, onStop],\n  );\n\n  // Load draft when draftId changes (chat switch or mount)\n  useEffect(() => {\n    const content = getDraftContentById(draftId);\n    // Always restore draft when switching chats (when draftId changes)\n    // This ensures each chat loads its own draft content\n    setInput(content || \"\");\n  }, [draftId, setInput]);\n\n  // Auto-save draft as user types with 500ms debounce\n  useEffect(() => {\n    const handle = window.setTimeout(() => {\n      if (input.trim()) {\n        // Save draft if there's content\n        upsertDraft(draftId, input);\n      } else {\n        // Remove draft if input is cleared\n        removeDraft(draftId);\n      }\n    }, 500); // Changed from 600ms to 500ms as per issue requirements\n\n    return () => window.clearTimeout(handle);\n  }, [input, draftId]);\n\n  // Handle paste events for file uploads and token validation\n  useEffect(() => {\n    const handlePaste = async (e: ClipboardEvent) => {\n      // Only handle paste if the textarea is focused\n      if (textareaRef.current === document.activeElement) {\n        // Check if pasting text content\n        const clipboardData = e.clipboardData;\n        if (clipboardData) {\n          const pastedText = clipboardData.getData(\"text\");\n\n          if (pastedText) {\n            // Check token limit for the pasted text only based on user plan\n            const tokenCount = countInputTokens(pastedText, []);\n            const maxTokens = getMaxTokensForSubscription(subscription);\n            if (tokenCount > maxTokens) {\n              e.preventDefault();\n              const planText =\n                subscription !== \"free\" ? \"\" : \" (Free plan limit)\";\n              toast.error(\"Content is too long to paste\", {\n                description: `The content you're trying to paste is too large (${tokenCount.toLocaleString()} tokens). Please copy a smaller amount${planText}.`,\n              });\n              return;\n            }\n          }\n        }\n\n        await handlePasteEvent(e);\n        // If files were processed, the event.preventDefault() is already called\n        // in handlePasteEvent, so no additional action needed here\n      }\n    };\n\n    document.addEventListener(\"paste\", handlePaste);\n    return () => {\n      document.removeEventListener(\"paste\", handlePaste);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [handlePasteEvent]);\n\n  return (\n    <div className={`relative px-4 ${isCentered ? \"\" : \"pb-3\"}`}>\n      <div className=\"mx-auto w-full max-w-full sm:max-w-[768px] sm:min-w-[390px] flex flex-col flex-1\">\n        {/* Rate Limit Warning */}\n        {rateLimitWarning && onDismissRateLimitWarning && (\n          <RateLimitWarning\n            remaining={rateLimitWarning.remaining}\n            resetTime={rateLimitWarning.resetTime}\n            mode={rateLimitWarning.mode}\n            subscription={rateLimitWarning.subscription}\n            onDismiss={onDismissRateLimitWarning}\n          />\n        )}\n\n        {/* Todo Panel */}\n        <TodoPanel status={status} />\n\n        {/* Queued Messages Panel - only shown in Agent mode */}\n        {messageQueue.length > 0 && chatMode === \"agent\" && (\n          <QueuedMessagesPanel\n            messages={messageQueue}\n            onSendNow={onSendNow}\n            onDelete={removeQueuedMessage}\n            isStreaming={status === \"streaming\"}\n            queueBehavior={queueBehavior}\n            onQueueBehaviorChange={setQueueBehavior}\n          />\n        )}\n\n        {/* File Upload Preview */}\n        {uploadedFiles && uploadedFiles.length > 0 && (\n          <FileUploadPreview\n            uploadedFiles={uploadedFiles}\n            onRemoveFile={handleRemoveFile}\n          />\n        )}\n\n        {/* Hidden File Input */}\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\"*\"\n          multiple\n          className=\"hidden\"\n          onChange={handleFileUploadEvent}\n        />\n\n        <div\n          className={`flex flex-col gap-3 transition-all relative bg-input-chat py-3 max-h-[300px] shadow-[0px_12px_32px_0px_rgba(0,0,0,0.02)] border border-black/8 dark:border-border ${uploadedFiles && uploadedFiles.length > 0 ? \"rounded-b-[22px] border-t-0\" : \"rounded-[22px]\"}`}\n        >\n          <div className=\"overflow-y-auto pl-4 pr-2\">\n            <TextareaAutosize\n              ref={textareaRef}\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              placeholder={\n                chatMode === \"agent\"\n                  ? \"Hack, test, secure anything\"\n                  : \"Ask, learn, brainstorm\"\n              }\n              className=\"flex rounded-md border-input focus-visible:outline-none focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 overflow-hidden flex-1 bg-transparent p-0 pt-[1px] border-0 focus-visible:ring-0 focus-visible:ring-offset-0 w-full placeholder:text-muted-foreground text-[15px] shadow-none resize-none min-h-[28px]\"\n              rows={1}\n              autoFocus\n              data-testid=\"chat-input\"\n              onKeyDown={(e) => {\n                if (e.key === \"Enter\" && !e.shiftKey) {\n                  e.preventDefault();\n                  handleSubmit(e);\n                }\n              }}\n            />\n          </div>\n          <div className=\"px-3 flex gap-2 items-center\">\n            {/* Attachment Button */}\n            <div className=\"shrink-0\">\n              <AttachmentButton onAttachClick={handleAttachClick} />\n            </div>\n\n            {/* Mode selector + Sandbox selector container */}\n            <div className=\"flex items-center gap-1.5 min-w-0 overflow-hidden\">\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-7 px-2 text-xs font-medium rounded-md bg-muted hover:bg-muted/50 focus-visible:ring-1 shrink-0\"\n                  >\n                    {models.find(m => m.value === selectedModel)?.label || \"Model\"}\n                    <ChevronDown className=\"w-3 h-3 ml-1\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"start\" className=\"w-48\">\n                  {models.map((model) => (\n                    <DropdownMenuItem\n                      key={model.value}\n                      onClick={() => setSelectedModel(model.value)}\n                      className=\"cursor-pointer\"\n                    >\n                      {model.label}\n                    </DropdownMenuItem>\n                  ))}\n                </DropdownMenuContent>\n              </DropdownMenu>\n\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    data-testid=\"mode-selector\"\n                    className={`h-7 px-2 text-xs font-medium rounded-md focus-visible:ring-1 shrink-0 ${\n                      chatMode === \"agent\"\n                        ? \"bg-red-500/10 text-red-700 hover:bg-red-500/20 dark:bg-red-400/10 dark:text-red-400 dark:hover:bg-red-400/20\"\n                        : \"bg-muted hover:bg-muted/50\"\n                    }`}\n                  >\n                    {chatMode === \"agent\" ? (\n                      <>\n                        <Infinity className=\"w-3 h-3 mr-1\" />\n                        Agent\n                      </>\n                    ) : (\n                      <>\n                        <MessageSquare className=\"w-3 h-3 mr-1\" />\n                        Ask\n                      </>\n                    )}\n                    <ChevronDown className=\"w-3 h-3 ml-1\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"start\" className=\"w-54\">\n                  <DropdownMenuItem\n                    onClick={() => setChatMode(\"ask\")}\n                    className=\"cursor-pointer\"\n                    data-testid=\"mode-ask\"\n                  >\n                    <MessageSquare className=\"w-4 h-4 mr-2\" />\n                    <div className=\"flex flex-col\">\n                      <span className=\"font-medium\">Ask</span>\n                      <span className=\"text-xs text-muted-foreground\">\n                        Ask your hacking questions\n                      </span>\n                    </div>\n                  </DropdownMenuItem>\n                  {subscription !== \"free\" || isCheckingProPlan ? (\n                    <DropdownMenuItem\n                      onClick={handleAgentModeClick}\n                      className=\"cursor-pointer\"\n                      data-testid=\"mode-agent\"\n                    >\n                      <Infinity className=\"w-4 h-4 mr-2\" />\n                      <div className=\"flex flex-col\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-medium\">Agent</span>\n                        </div>\n                        <span className=\"text-xs text-muted-foreground\">\n                          Hack, test, secure anything\n                        </span>\n                      </div>\n                    </DropdownMenuItem>\n                  ) : (\n                    <DropdownMenuItem\n                      onClick={handleAgentModeClick}\n                      className=\"cursor-pointer\"\n                      data-testid=\"mode-agent\"\n                    >\n                      <Infinity className=\"w-4 h-4 mr-2\" />\n                      <div className=\"flex flex-col flex-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-medium\">Agent</span>\n                          <span className=\"flex items-center gap-1 rounded-full py-1 px-2 text-xs font-medium bg-premium-bg text-premium-text hover:bg-premium-hover border-0 transition-all duration-200\">\n                            PRO\n                          </span>\n                        </div>\n                        <span className=\"text-xs text-muted-foreground\">\n                          Hack, test, secure anything\n                        </span>\n                      </div>\n                    </DropdownMenuItem>\n                  )}\n                </DropdownMenuContent>\n              </DropdownMenu>\n\n              {/* Sandbox selector - editable for new chats, read-only for existing */}\n              {chatMode === \"agent\" && (\n                <SandboxSelector\n                  value={sandboxPreference}\n                  onChange={setSandboxPreference}\n                  disabled={status === \"streaming\"}\n                  readOnly={!isNewChat}\n                />\n              )}\n            </div>\n\n            {/* Send/Stop button container */}\n            <div className=\"flex gap-2 shrink-0 items-center ml-auto\">\n              {isGenerating && !hideStop ? (\n                // Show only stop button during streaming for both modes\n                <TooltipPrimitive.Root>\n                  <TooltipTrigger asChild>\n                    <Button\n                      type=\"button\"\n                      onClick={onStop}\n                      variant=\"ghost\"\n                      className={`rounded-full p-0 w-8 h-8 min-w-0 ${\n                        chatMode === \"agent\"\n                          ? \"bg-red-500/10 hover:bg-red-500/20 text-red-700 dark:bg-red-400/10 dark:hover:bg-red-400/20 dark:text-red-400 focus-visible:ring-red-500\"\n                          : \"bg-muted hover:bg-muted/70 text-foreground\"\n                      }`}\n                      aria-label=\"Stop generation\"\n                    >\n                      <Square\n                        className=\"w-[15px] h-[15px]\"\n                        fill=\"currentColor\"\n                      />\n                    </Button>\n                  </TooltipTrigger>\n                  <TooltipContent>\n                    <p>Stop (C)</p>\n                  </TooltipContent>\n                </TooltipPrimitive.Root>\n              ) : (\n                // Not streaming: show only submit button\n                <form onSubmit={handleSubmit}>\n                  <TooltipPrimitive.Root>\n                    <TooltipTrigger asChild>\n                      <div className=\"inline-block\">\n                        <Button\n                          type=\"submit\"\n                          disabled={\n                            status !== \"ready\" ||\n                            isUploadingFiles ||\n                            (!input.trim() && uploadedFiles.length === 0)\n                          }\n                          variant=\"default\"\n                          className={`rounded-full p-0 w-8 h-8 min-w-0 ${\n                            chatMode === \"agent\"\n                              ? \"bg-red-500/10 hover:bg-red-500/20 text-red-700 dark:bg-red-400/10 dark:hover:bg-red-400/20 dark:text-red-400 focus-visible:ring-red-500\"\n                              : \"\"\n                          }`}\n                          aria-label=\"Send message\"\n                          data-testid=\"send-button\"\n                        >\n                          <ArrowUp size={15} strokeWidth={3} />\n                        </Button>\n                      </div>\n                    </TooltipTrigger>\n                    <TooltipContent>\n                      <p>\n                        {uploadedFiles.some((f) => f.error)\n                          ? \"Remove failed files to send\"\n                          : isUploadingFiles\n                            ? \"File upload pending\"\n                            : \"Send ()\"}\n                      </p>\n                    </TooltipContent>\n                  </TooltipPrimitive.Root>\n                </form>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* ScrollToBottomButton positioned relative to input */}\n        {onScrollToBottom && (\n          <div className=\"absolute -top-16 left-1/2 -translate-x-1/2 z-40\">\n            <ScrollToBottomButton\n              onClick={onScrollToBottom}\n              hasMessages={hasMessages}\n              isAtBottom={isAtBottom}\n            />\n          </div>\n        )}\n      </div>\n\n      {/* Agent Upgrade Dialog */}\n      <Dialog\n        open={agentUpgradeDialogOpen}\n        onOpenChange={setAgentUpgradeDialogOpen}\n      >\n        <DialogContent\n          className=\"sm:max-w-[500px]\"\n          data-testid=\"agent-upgrade-dialog\"\n        >\n          <DialogHeader>\n            <DialogTitle>Upgrade plan</DialogTitle>\n            <DialogDescription>\n              Get access to Agent mode and unlock advanced hacking, testing, and\n              security features with Pro.\n            </DialogDescription>\n          </DialogHeader>\n          <Button\n            onClick={handleUpgradeClick}\n            className=\"w-full\"\n            size=\"lg\"\n            data-testid=\"agent-upgrade-button\"\n          >\n            Upgrade plan\n          </Button>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6705, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ComputerCodeBlock.tsx"],"sourcesContent":["import type { ReactNode } from \"react\";\nimport { useState, useMemo } from \"react\";\nimport { Download, Copy, Check, WrapText } from \"lucide-react\";\nimport ShikiHighlighter from \"react-shiki\";\nimport { isLanguageSupported, ShikiErrorBoundary } from \"@/lib/utils/shiki\";\nimport {\n  Tooltip,\n  TooltipTrigger,\n  TooltipContent,\n} from \"@/components/ui/tooltip\";\nimport { toast } from \"sonner\";\n\ninterface ComputerCodeBlockProps {\n  children: ReactNode;\n  language?: string;\n  wrap?: boolean;\n  showButtons?: boolean;\n}\n\nexport const ComputerCodeBlock = ({\n  children,\n  language,\n  wrap = true,\n  showButtons = true,\n}: ComputerCodeBlockProps) => {\n  const codeContent = String(children);\n  const [copied, setCopied] = useState(false);\n  const [isWrapped, setIsWrapped] = useState(wrap);\n\n  // Check if language is supported by Shiki\n  const shouldUsePlainText = useMemo(() => {\n    return !isLanguageSupported(language);\n  }, [language]);\n\n  const handleCopy = async () => {\n    try {\n      await navigator.clipboard.writeText(codeContent.trim());\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      console.error(\"Failed to copy code:\", error);\n    }\n  };\n\n  const handleDownload = async () => {\n    const defaultFilename = `code.${language || \"txt\"}`;\n\n    try {\n      // Try to use the File System Access API for native save dialog\n      if (\"showSaveFilePicker\" in window) {\n        const fileHandle = await (\n          window as Window & {\n            showSaveFilePicker: (options: {\n              suggestedName: string;\n            }) => Promise<FileSystemFileHandle>;\n          }\n        ).showSaveFilePicker({\n          suggestedName: defaultFilename,\n        });\n\n        const writable = await fileHandle.createWritable();\n        await writable.write(codeContent);\n        await writable.close();\n        toast.success(\"File saved successfully\");\n        return;\n      }\n    } catch {\n      toast.error(\"Failed to save file\");\n      return;\n    }\n\n    // Fallback to traditional download\n    try {\n      const blob = new Blob([codeContent], { type: \"text/plain\" });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = defaultFilename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      toast.success(\"File downloaded successfully\");\n    } catch (error) {\n      toast.error(\"Failed to download file\", {\n        description:\n          error instanceof Error ? error.message : \"Unknown error occurred\",\n      });\n    }\n  };\n\n  const handleToggleWrap = () => {\n    setIsWrapped(!isWrapped);\n  };\n\n  return (\n    <div className=\"shiki not-prose relative h-full w-full bg-transparent overflow-hidden\">\n      {/* Floating action buttons - only show if showButtons is true */}\n      {showButtons && (\n        <div className=\"absolute top-1 right-0 z-10 pl-1 pr-2\">\n          <div className=\"backdrop-blur-sm inline-flex h-7 items-center rounded-lg bg-muted/80 p-0.5 border border-border/50\">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <button\n                  onClick={handleDownload}\n                  className=\"inline-flex items-center justify-center rounded-md px-3 py-1 text-xs transition-colors text-muted-foreground hover:bg-background hover:text-foreground\"\n                  aria-label=\"Download\"\n                >\n                  <Download size={12} />\n                </button>\n              </TooltipTrigger>\n              <TooltipContent>Download</TooltipContent>\n            </Tooltip>\n\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <button\n                  onClick={handleToggleWrap}\n                  className={`inline-flex items-center justify-center rounded-md px-3 py-1 text-xs transition-colors ${\n                    isWrapped\n                      ? \"bg-background text-foreground shadow-sm\"\n                      : \"text-muted-foreground hover:bg-background hover:text-foreground\"\n                  }`}\n                  aria-label={\n                    isWrapped ? \"Disable text wrapping\" : \"Enable text wrapping\"\n                  }\n                >\n                  <WrapText size={12} />\n                </button>\n              </TooltipTrigger>\n              <TooltipContent>\n                {isWrapped ? \"Disable text wrapping\" : \"Enable text wrapping\"}\n              </TooltipContent>\n            </Tooltip>\n\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <button\n                  onClick={handleCopy}\n                  className=\"inline-flex items-center justify-center rounded-md px-3 py-1 text-xs transition-colors text-muted-foreground hover:bg-background hover:text-foreground\"\n                  aria-label={copied ? \"Copied!\" : \"Copy\"}\n                >\n                  {copied ? <Check size={12} /> : <Copy size={12} />}\n                </button>\n              </TooltipTrigger>\n              <TooltipContent>{copied ? \"Copied!\" : \"Copy\"}</TooltipContent>\n            </Tooltip>\n          </div>\n        </div>\n      )}\n\n      {/* Code content - takes full available space */}\n      <div className={`h-full w-full overflow-auto bg-background`}>\n        {shouldUsePlainText ? (\n          <pre\n            className={`shiki not-prose relative bg-transparent text-sm font-[450] text-card-foreground h-full w-full px-[0.5em] py-[0.5em] rounded-none m-0 min-h-full min-w-0 ${\n              isWrapped\n                ? \"whitespace-pre-wrap break-words word-break-break-word\"\n                : \"whitespace-pre overflow-x-auto\"\n            }`}\n          >\n            <code className=\"bg-transparent\">{codeContent}</code>\n          </pre>\n        ) : (\n          <ShikiErrorBoundary\n            fallback={\n              <pre\n                className={`shiki not-prose relative bg-transparent text-sm font-[450] text-card-foreground h-full w-full px-[0.5em] py-[0.5em] rounded-none m-0 min-h-full min-w-0 ${\n                  isWrapped\n                    ? \"whitespace-pre-wrap break-words word-break-break-word\"\n                    : \"whitespace-pre overflow-x-auto\"\n                }`}\n              >\n                <code className=\"bg-transparent\">{codeContent}</code>\n              </pre>\n            }\n          >\n            <ShikiHighlighter\n              language={language}\n              theme=\"houston\"\n              delay={150}\n              addDefaultStyles={false}\n              showLanguage={false}\n              className={`shiki not-prose relative bg-transparent text-sm font-[450] text-card-foreground h-full w-full [&_pre]:!bg-transparent [&_pre]:px-[0.5em] [&_pre]:py-[0.5em] [&_pre]:rounded-none [&_pre]:m-0 [&_pre]:h-full [&_pre]:w-full [&_pre]:min-h-full [&_pre]:min-w-0 [&_code]:bg-transparent [&_span]:bg-transparent ${\n                isWrapped\n                  ? \"[&_pre]:whitespace-pre-wrap [&_pre]:break-words [&_pre]:word-break-break-word\"\n                  : \"[&_pre]:whitespace-pre [&_pre]:overflow-x-auto\"\n              }`}\n            >\n              {codeContent}\n            </ShikiHighlighter>\n          </ShikiErrorBoundary>\n        )}\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7001, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/TerminalCodeBlock.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback, useMemo, useRef } from \"react\";\nimport { Terminal } from \"lucide-react\";\nimport { codeToHtml } from \"shiki\";\nimport { Shimmer } from \"@/components/ai-elements/shimmer\";\n\ninterface TerminalCodeBlockProps {\n  command: string;\n  output?: string;\n  isExecuting?: boolean;\n  status?: \"ready\" | \"submitted\" | \"streaming\" | \"error\";\n  isBackground?: boolean;\n  variant?: \"default\" | \"sidebar\";\n  wrap?: boolean;\n}\n\ninterface AnsiCodeBlockProps {\n  code: string;\n  isWrapped?: boolean;\n  isStreaming?: boolean;\n  theme?: string;\n  className?: string;\n  style?: React.CSSProperties;\n  delay?: number;\n}\n\n// Cache for rendered ANSI content to avoid re-rendering identical content\nconst ansiCache = new Map<string, string>();\nconst MAX_CACHE_SIZE = 100;\n\n// Clean cache when it gets too large\nconst cleanCache = () => {\n  if (ansiCache.size >= MAX_CACHE_SIZE) {\n    const entries = Array.from(ansiCache.entries());\n    // Remove only the overflow count of oldest entries (FIFO)\n    const toRemove = Math.max(0, ansiCache.size - MAX_CACHE_SIZE + 1);\n    for (let i = 0; i < toRemove; i++) {\n      ansiCache.delete(entries[i][0]);\n    }\n  }\n};\n\n/**\n * Optimized ANSI code renderer with streaming support\n * Uses native Shiki codeToHtml with react-shiki patterns for performance\n *\n * Features:\n * - Debounced rendering for streaming content (150ms delay, same as react-shiki)\n * - Caching to avoid re-rendering identical content\n * - Race condition protection for async renders\n * - Memory management with cache cleanup\n * - Proper HTML escaping for fallback content\n * - Follows react-shiki performance patterns\n */\nconst AnsiCodeBlock = ({\n  code,\n  isWrapped,\n  isStreaming = false,\n  theme = \"houston\",\n  className,\n  style,\n  delay: customDelay,\n}: AnsiCodeBlockProps) => {\n  const [htmlContent, setHtmlContent] = useState<string>(\"\");\n  const [isRendering, setIsRendering] = useState(false);\n  const renderTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const lastRenderedCodeRef = useRef<string>(\"\");\n  const cacheKeyRef = useRef<string>(\"\");\n\n  // Debounce rendering for streaming content\n  const debouncedRender = useCallback(\n    async (codeToRender: string) => {\n      // Clear any pending render\n      if (renderTimeoutRef.current) {\n        clearTimeout(renderTimeoutRef.current);\n      }\n\n      // For streaming, debounce rapid updates (same as react-shiki default)\n      const delay = customDelay ?? (isStreaming ? 150 : 0);\n\n      renderTimeoutRef.current = setTimeout(async () => {\n        // Skip if we've already rendered this exact content\n        if (lastRenderedCodeRef.current === codeToRender) {\n          return;\n        }\n\n        // Create cache key including theme for proper caching\n        const cacheKey = `${codeToRender}-${isWrapped}-${theme}`;\n        cacheKeyRef.current = cacheKey;\n\n        // Check cache first\n        if (ansiCache.has(cacheKey)) {\n          setHtmlContent(ansiCache.get(cacheKey)!);\n          lastRenderedCodeRef.current = codeToRender;\n          return;\n        }\n\n        setIsRendering(true);\n\n        try {\n          const html = await codeToHtml(codeToRender, {\n            lang: \"ansi\",\n            theme: theme,\n          });\n\n          // Only update if this is still the current render request\n          if (cacheKeyRef.current === cacheKey) {\n            setHtmlContent(html);\n            cleanCache();\n            ansiCache.set(cacheKey, html);\n            lastRenderedCodeRef.current = codeToRender;\n          }\n        } catch (error) {\n          console.error(\"Failed to render ANSI code:\", error);\n          // Fallback to plain text with proper escaping\n          const escapedCode = codeToRender.replace(/[&<>\"']/g, (char) => {\n            const entities: Record<string, string> = {\n              \"&\": \"&amp;\",\n              \"<\": \"&lt;\",\n              \">\": \"&gt;\",\n              '\"': \"&quot;\",\n              \"'\": \"&#39;\",\n            };\n            return entities[char];\n          });\n          const fallbackHtml = `<pre><code>${escapedCode}</code></pre>`;\n\n          if (cacheKeyRef.current === cacheKey) {\n            setHtmlContent(fallbackHtml);\n            cleanCache();\n            ansiCache.set(cacheKey, fallbackHtml);\n            lastRenderedCodeRef.current = codeToRender;\n          }\n        } finally {\n          setIsRendering(false);\n        }\n      }, delay);\n    },\n    [isStreaming, isWrapped, theme, customDelay],\n  );\n\n  useEffect(() => {\n    if (code) {\n      debouncedRender(code);\n    } else {\n      setHtmlContent(\"\");\n      lastRenderedCodeRef.current = \"\";\n    }\n\n    // Cleanup timeout on unmount or code change\n    return () => {\n      if (renderTimeoutRef.current) {\n        clearTimeout(renderTimeoutRef.current);\n      }\n    };\n  }, [code, debouncedRender]);\n\n  // Memoize the className to prevent unnecessary re-calculations (react-shiki pattern)\n  const containerClassName = useMemo(() => {\n    const heightClasses = \"h-full [&_pre]:h-full [&_pre]:flex [&_pre]:flex-col\";\n    const baseClasses = `shiki not-prose relative bg-transparent text-sm font-[450] text-card-foreground [&_pre]:!bg-transparent [&_pre]:px-[1em] [&_pre]:py-[1em] [&_pre]:rounded-none [&_pre]:m-0 [&_pre]:min-w-0 [&_code]:bg-transparent [&_span]:bg-transparent ${heightClasses} ${\n      isWrapped\n        ? \"[&_pre]:whitespace-pre-wrap [&_pre]:break-words [&_pre]:word-break-break-word\"\n        : \"[&_pre]:whitespace-pre [&_pre]:overflow-x-auto [&_pre]:max-w-full\"\n    }`;\n    return className ? `${baseClasses} ${className}` : baseClasses;\n  }, [isWrapped, className]);\n\n  // Show loading state for initial render or when switching between very different content\n  if (!htmlContent && (isRendering || code)) {\n    return (\n      <div className=\"px-4 py-4 text-muted-foreground\">\n        <Shimmer>\n          {isStreaming ? \"Processing output...\" : \"Rendering output...\"}\n        </Shimmer>\n      </div>\n    );\n  }\n\n  // Show empty state\n  if (!htmlContent && !code) {\n    return null;\n  }\n\n  return (\n    <div\n      className={containerClassName}\n      style={style}\n      dangerouslySetInnerHTML={{ __html: htmlContent }}\n    />\n  );\n};\n\nexport const TerminalCodeBlock = ({\n  command,\n  output,\n  isExecuting = false,\n  status,\n  isBackground = false,\n  variant = \"default\",\n  wrap = false,\n}: TerminalCodeBlockProps) => {\n  const [isWrapped, setIsWrapped] = useState(wrap);\n\n  // Update wrapping state when prop changes\n  useEffect(() => {\n    setIsWrapped(wrap);\n  }, [wrap]);\n\n  // Combine command and output for full terminal session\n  const terminalContent = output ? `$ ${command}\\n${output}` : `$ ${command}`;\n  const displayContent = output || \"\";\n\n  // For non-sidebar variant, keep the original terminal look\n  if (variant !== \"sidebar\") {\n    return (\n      <div className=\"terminal-codeblock not-prose relative rounded-lg bg-card border border-border my-2 overflow-hidden flex flex-col h-full\">\n        {/* Terminal command input */}\n        <div className=\"flex items-center justify-between px-4 py-2 bg-secondary border-b border-border\">\n          <div className=\"flex items-center space-x-2 flex-1 min-w-0\">\n            <Terminal\n              size={14}\n              className=\"text-muted-foreground flex-shrink-0\"\n            />\n            <code className=\"text-sm font-mono text-foreground truncate\">\n              {command}\n            </code>\n          </div>\n        </div>\n\n        {/* Background process indicator */}\n        {isBackground && (\n          <div className=\"px-4 py-3 text-muted-foreground border-b border-border\">\n            Running in background\n          </div>\n        )}\n\n        {/* Terminal output */}\n        {(output || isExecuting) && (\n          <div className=\"flex-1 min-h-0 overflow-hidden\">\n            {isExecuting && !output && status === \"streaming\" ? (\n              <div className=\"px-4 py-4 text-muted-foreground\">\n                <Shimmer>Executing command</Shimmer>\n              </div>\n            ) : (\n              <AnsiCodeBlock\n                code={displayContent}\n                isWrapped={isWrapped}\n                isStreaming={status === \"streaming\" || isExecuting}\n                theme=\"houston\"\n                delay={150}\n              />\n            )}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  // For sidebar variant, use file block style (no floating buttons since header handles them)\n  return (\n    <div className=\"shiki not-prose relative h-full w-full bg-transparent overflow-hidden\">\n      {/* Terminal content - takes full available space */}\n      <div className=\"h-full w-full overflow-auto bg-background\">\n        {isExecuting && !output && status === \"streaming\" ? (\n          <div className=\"px-4 py-4 text-muted-foreground h-full flex items-start\">\n            <Shimmer>Executing command</Shimmer>\n          </div>\n        ) : (\n          <AnsiCodeBlock\n            code={terminalContent}\n            isWrapped={isWrapped}\n            isStreaming={status === \"streaming\" || isExecuting}\n            theme=\"houston\"\n            delay={150}\n            className=\"h-full w-full\"\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7317, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/DiffView.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useMemo } from \"react\";\nimport { ComputerCodeBlock } from \"./ComputerCodeBlock\";\n\ntype ViewMode = \"diff\" | \"original\" | \"modified\";\n\ninterface DiffViewProps {\n  originalContent: string;\n  modifiedContent: string;\n  language: string;\n  wrap?: boolean;\n}\n\ninterface DiffLine {\n  type: \"unchanged\" | \"added\" | \"removed\";\n  content: string;\n}\n\n/**\n * Compute a simple line-based diff between two strings using LCS algorithm\n */\nconst computeDiff = (original: string, modified: string): DiffLine[] => {\n  const originalLines = original.split(\"\\n\");\n  const modifiedLines = modified.split(\"\\n\");\n  const lcs = computeLCS(originalLines, modifiedLines);\n\n  const result: DiffLine[] = [];\n  let origIdx = 0;\n  let modIdx = 0;\n  let lcsIdx = 0;\n\n  while (origIdx < originalLines.length || modIdx < modifiedLines.length) {\n    if (lcsIdx < lcs.length) {\n      // Output removed lines (in original but not in LCS at this point)\n      while (\n        origIdx < originalLines.length &&\n        originalLines[origIdx] !== lcs[lcsIdx]\n      ) {\n        result.push({ type: \"removed\", content: originalLines[origIdx] });\n        origIdx++;\n      }\n\n      // Output added lines (in modified but not in LCS at this point)\n      while (\n        modIdx < modifiedLines.length &&\n        modifiedLines[modIdx] !== lcs[lcsIdx]\n      ) {\n        result.push({ type: \"added\", content: modifiedLines[modIdx] });\n        modIdx++;\n      }\n\n      // Output unchanged line (in LCS)\n      if (origIdx < originalLines.length && modIdx < modifiedLines.length) {\n        result.push({ type: \"unchanged\", content: originalLines[origIdx] });\n        origIdx++;\n        modIdx++;\n        lcsIdx++;\n      }\n    } else {\n      // Output remaining removed lines\n      while (origIdx < originalLines.length) {\n        result.push({ type: \"removed\", content: originalLines[origIdx] });\n        origIdx++;\n      }\n\n      // Output remaining added lines\n      while (modIdx < modifiedLines.length) {\n        result.push({ type: \"added\", content: modifiedLines[modIdx] });\n        modIdx++;\n      }\n    }\n  }\n\n  return result;\n};\n\n/**\n * Compute Longest Common Subsequence of two arrays of strings\n */\nconst computeLCS = (a: string[], b: string[]): string[] => {\n  const m = a.length;\n  const n = b.length;\n\n  // Create DP table\n  const dp: number[][] = Array(m + 1)\n    .fill(null)\n    .map(() => Array(n + 1).fill(0));\n\n  // Fill DP table\n  for (let i = 1; i <= m; i++) {\n    for (let j = 1; j <= n; j++) {\n      if (a[i - 1] === b[j - 1]) {\n        dp[i][j] = dp[i - 1][j - 1] + 1;\n      } else {\n        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);\n      }\n    }\n  }\n\n  // Backtrack to find LCS\n  const lcs: string[] = [];\n  let i = m;\n  let j = n;\n\n  while (i > 0 && j > 0) {\n    if (a[i - 1] === b[j - 1]) {\n      lcs.unshift(a[i - 1]);\n      i--;\n      j--;\n    } else if (dp[i - 1][j] > dp[i][j - 1]) {\n      i--;\n    } else {\n      j--;\n    }\n  }\n\n  return lcs;\n};\n\nexport const DiffView: React.FC<DiffViewProps> = ({\n  originalContent,\n  modifiedContent,\n  language,\n  wrap = true,\n}) => {\n  const [viewMode, setViewMode] = useState<ViewMode>(\"diff\");\n\n  const diffLines = useMemo(\n    () => computeDiff(originalContent, modifiedContent),\n    [originalContent, modifiedContent],\n  );\n\n  const tabs: Array<{ id: ViewMode; label: string }> = [\n    { id: \"diff\", label: \"Diff\" },\n    { id: \"original\", label: \"Original\" },\n    { id: \"modified\", label: \"Modified\" },\n  ];\n\n  const handleTabChange = (tab: ViewMode) => {\n    setViewMode(tab);\n  };\n\n  const handleTabKeyDown = (e: React.KeyboardEvent, tab: ViewMode) => {\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault();\n      setViewMode(tab);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      {/* Tab Buttons */}\n      <div className=\"flex gap-1 px-3 py-2 border-b border-border/30 bg-muted/20\">\n        {tabs.map((tab) => (\n          <button\n            key={tab.id}\n            type=\"button\"\n            onClick={() => handleTabChange(tab.id)}\n            onKeyDown={(e) => handleTabKeyDown(e, tab.id)}\n            className={`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${\n              viewMode === tab.id\n                ? \"bg-primary text-primary-foreground\"\n                : \"text-muted-foreground hover:text-foreground hover:bg-muted/50\"\n            }`}\n            tabIndex={0}\n            aria-selected={viewMode === tab.id}\n            role=\"tab\"\n          >\n            {tab.label}\n          </button>\n        ))}\n      </div>\n\n      {/* Content */}\n      <div className=\"flex-1 min-h-0 overflow-auto\">\n        {viewMode === \"diff\" && (\n          <DiffContent diffLines={diffLines} wrap={wrap} />\n        )}\n        {viewMode === \"original\" && (\n          <ComputerCodeBlock\n            language={language}\n            wrap={wrap}\n            showButtons={false}\n          >\n            {originalContent}\n          </ComputerCodeBlock>\n        )}\n        {viewMode === \"modified\" && (\n          <ComputerCodeBlock\n            language={language}\n            wrap={wrap}\n            showButtons={false}\n          >\n            {modifiedContent}\n          </ComputerCodeBlock>\n        )}\n      </div>\n    </div>\n  );\n};\n\ninterface DiffContentProps {\n  diffLines: DiffLine[];\n  wrap: boolean;\n}\n\nconst DiffContent: React.FC<DiffContentProps> = ({ diffLines, wrap }) => {\n  if (diffLines.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">\n        No changes detected\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"shiki not-prose relative h-full w-full bg-transparent overflow-hidden\">\n      <div className=\"h-full w-full overflow-auto bg-background\">\n        <pre\n          className={`shiki not-prose relative bg-transparent text-sm font-[450] text-card-foreground h-full w-full px-[0.5em] py-[0.5em] rounded-none m-0 min-h-full min-w-0 ${\n            wrap\n              ? \"whitespace-pre-wrap break-words word-break-break-word\"\n              : \"whitespace-pre overflow-x-auto\"\n          }`}\n        >\n          <code className=\"bg-transparent\">\n            {diffLines.map((line, index) => {\n              const textClass =\n                line.type === \"added\"\n                  ? \"text-green-600 dark:text-green-400\"\n                  : line.type === \"removed\"\n                    ? \"text-red-600 dark:text-red-400\"\n                    : \"\";\n\n              const bgClass =\n                line.type === \"added\"\n                  ? \"bg-green-500/10 dark:bg-green-500/15\"\n                  : line.type === \"removed\"\n                    ? \"bg-red-500/10 dark:bg-red-500/15\"\n                    : \"\";\n\n              const className =\n                textClass && bgClass ? `${textClass} ${bgClass}` : \"\";\n\n              return (\n                <span key={index} className={className}>\n                  {line.content || \" \"}\n                  {index < diffLines.length - 1 ? \"\\n\" : \"\"}\n                </span>\n              );\n            })}\n          </code>\n        </pre>\n      </div>\n    </div>\n  );\n};\n\nexport default DiffView;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7588, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ComputerSidebar.tsx"],"sourcesContent":["import React from \"react\";\nimport {\n  Minimize2,\n  Edit,\n  Terminal,\n  Code2,\n  Play,\n  SkipBack,\n  SkipForward,\n} from \"lucide-react\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\nimport { ComputerCodeBlock } from \"./ComputerCodeBlock\";\nimport { TerminalCodeBlock } from \"./TerminalCodeBlock\";\nimport { DiffView } from \"./DiffView\";\nimport { CodeActionButtons } from \"@/components/ui/code-action-buttons\";\nimport { useSidebarNavigation } from \"../hooks/useSidebarNavigation\";\nimport {\n  Tooltip,\n  TooltipTrigger,\n  TooltipContent,\n} from \"@/components/ui/tooltip\";\nimport {\n  isSidebarFile,\n  isSidebarTerminal,\n  isSidebarPython,\n  type SidebarContent,\n  type ChatStatus,\n} from \"@/types/chat\";\n\ninterface ComputerSidebarProps {\n  sidebarOpen: boolean;\n  sidebarContent: SidebarContent | null;\n  closeSidebar: () => void;\n  messages?: any[];\n  onNavigate?: (content: SidebarContent) => void;\n  status?: ChatStatus;\n}\n\nexport const ComputerSidebarBase: React.FC<ComputerSidebarProps> = ({\n  sidebarOpen,\n  sidebarContent,\n  closeSidebar,\n  messages = [],\n  onNavigate,\n  status,\n}) => {\n  const [isWrapped, setIsWrapped] = useState(true);\n  const previousToolCountRef = useRef<number>(0);\n\n  const {\n    toolExecutions,\n    currentIndex,\n    maxIndex,\n    handlePrev,\n    handleNext,\n    handleJumpToLive,\n    handleSliderClick,\n    getProgressPercentage,\n    isAtLive,\n    canGoPrev,\n    canGoNext,\n  } = useSidebarNavigation({\n    messages,\n    sidebarContent,\n    onNavigate,\n  });\n\n  // Initialize tool count ref on mount\n  useEffect(() => {\n    if (sidebarOpen && toolExecutions.length > 0) {\n      previousToolCountRef.current = toolExecutions.length;\n    }\n  }, [sidebarOpen]); // Only run when sidebar opens/closes\n\n  // Auto-follow new tools when at live position during streaming\n  useEffect(() => {\n    if (!sidebarOpen || !onNavigate || toolExecutions.length === 0) {\n      return;\n    }\n\n    const currentToolCount = toolExecutions.length;\n    const previousToolCount = previousToolCountRef.current;\n\n    // Check if new tools arrived (count increased)\n    if (currentToolCount > previousToolCount) {\n      // Check if we were at the last position before new tools arrived\n      const wasAtLive = currentIndex === previousToolCount - 1;\n\n      // Also check if we're currently at live (in case sidebarContent already updated)\n      const isCurrentlyAtLive = currentIndex === currentToolCount - 1;\n\n      // Auto-update if we were at live OR currently at live\n      if (wasAtLive || isCurrentlyAtLive) {\n        // Navigate to the latest tool execution\n        // Since we only extract file operations when output is available,\n        // content should always be ready\n        const latestTool = toolExecutions[toolExecutions.length - 1];\n        if (latestTool) {\n          onNavigate(latestTool);\n        }\n      }\n    }\n\n    // Update the ref for next comparison\n    previousToolCountRef.current = currentToolCount;\n  }, [\n    toolExecutions.length,\n    currentIndex,\n    sidebarOpen,\n    onNavigate,\n    toolExecutions,\n  ]);\n\n  if (!sidebarOpen || !sidebarContent) {\n    return null;\n  }\n\n  const isFile = isSidebarFile(sidebarContent);\n  const isTerminal = isSidebarTerminal(sidebarContent);\n  const isPython = isSidebarPython(sidebarContent);\n\n  const getLanguageFromPath = (filePath: string): string => {\n    const extension = filePath.split(\".\").pop()?.toLowerCase() || \"\";\n    const languageMap: Record<string, string> = {\n      js: \"javascript\",\n      jsx: \"javascript\",\n      ts: \"typescript\",\n      tsx: \"typescript\",\n      py: \"python\",\n      rb: \"ruby\",\n      go: \"go\",\n      rs: \"rust\",\n      java: \"java\",\n      c: \"c\",\n      cpp: \"cpp\",\n      h: \"c\",\n      hpp: \"cpp\",\n      css: \"css\",\n      scss: \"scss\",\n      sass: \"sass\",\n      html: \"html\",\n      xml: \"xml\",\n      json: \"json\",\n      yaml: \"yaml\",\n      yml: \"yaml\",\n      md: \"markdown\",\n      sh: \"bash\",\n      bash: \"bash\",\n      zsh: \"bash\",\n      fish: \"bash\",\n      sql: \"sql\",\n      php: \"php\",\n      swift: \"swift\",\n      kt: \"kotlin\",\n      scala: \"scala\",\n      clj: \"clojure\",\n      hs: \"haskell\",\n      elm: \"elm\",\n      vue: \"vue\",\n      svelte: \"svelte\",\n    };\n    return languageMap[extension] || \"text\";\n  };\n\n  const getActionText = (): string => {\n    if (isFile) {\n      const actionMap = {\n        reading: \"Reading file\",\n        creating: \"Creating file\",\n        editing: \"Editing file\",\n        writing: \"Writing file\",\n      };\n      return actionMap[sidebarContent.action || \"reading\"];\n    } else if (isTerminal) {\n      return sidebarContent.isExecuting\n        ? \"Executing command\"\n        : \"Command executed\";\n    } else if (isPython) {\n      return sidebarContent.isExecuting\n        ? \"Executing Python\"\n        : \"Python executed\";\n    }\n    return \"Unknown action\";\n  };\n\n  const getIcon = () => {\n    if (isFile) {\n      return <Edit className=\"w-5 h-5 text-muted-foreground\" />;\n    } else if (isTerminal) {\n      return <Terminal className=\"w-5 h-5 text-muted-foreground\" />;\n    } else if (isPython) {\n      return <Code2 className=\"w-5 h-5 text-muted-foreground\" />;\n    }\n    return <Edit className=\"w-5 h-5 text-muted-foreground\" />;\n  };\n\n  const getToolName = (): string => {\n    if (isFile) {\n      return \"Editor\";\n    } else if (isTerminal) {\n      return \"Terminal\";\n    } else if (isPython) {\n      return \"Python\";\n    }\n    return \"Tool\";\n  };\n\n  const getDisplayTarget = (): string => {\n    if (isFile) {\n      return sidebarContent.path.split(\"/\").pop() || sidebarContent.path;\n    } else if (isTerminal) {\n      return sidebarContent.command;\n    } else if (isPython) {\n      return sidebarContent.code.replace(/\\n/g, \" \");\n    }\n    return \"\";\n  };\n\n  const handleClose = () => {\n    closeSidebar();\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Escape\") {\n      handleClose();\n    }\n  };\n\n  const handleToggleWrap = () => {\n    setIsWrapped(!isWrapped);\n  };\n\n  return (\n    <div className=\"h-full w-full top-0 left-0 desktop:top-auto desktop:left-auto desktop:right-auto z-50 fixed desktop:relative desktop:h-full desktop:mr-4 flex-shrink-0\">\n      <div className=\"h-full w-full\">\n        <div className=\"shadow-[0px_0px_8px_0px_rgba(0,0,0,0.02)] border border-border/20 dark:border-border flex h-full w-full bg-background rounded-[22px]\">\n          <div className=\"flex-1 min-w-0 p-4 flex flex-col h-full\">\n            {/* Header */}\n            <div className=\"flex items-center gap-2 w-full\">\n              <div className=\"text-foreground text-lg font-semibold flex-1\">\n                HackerAI&apos;s Computer\n              </div>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <button\n                    type=\"button\"\n                    onClick={handleClose}\n                    className=\"w-7 h-7 relative rounded-md inline-flex items-center justify-center gap-2.5 cursor-pointer hover:bg-muted/50 transition-colors\"\n                    aria-label=\"Minimize sidebar\"\n                    tabIndex={0}\n                    onKeyDown={handleKeyDown}\n                  >\n                    <Minimize2 className=\"w-5 h-5 text-muted-foreground\" />\n                  </button>\n                </TooltipTrigger>\n                <TooltipContent>Minimize</TooltipContent>\n              </Tooltip>\n            </div>\n\n            {/* Action Status */}\n            <div className=\"flex items-center gap-2 mt-2\">\n              <div className=\"w-[40px] h-[40px] bg-muted/50 rounded-lg flex items-center justify-center flex-shrink-0\">\n                {getIcon()}\n              </div>\n              <div className=\"flex-1 flex flex-col gap-1 min-w-0\">\n                <div className=\"text-[12px] text-muted-foreground\">\n                  HackerAI is using{\" \"}\n                  <span className=\"text-foreground\">{getToolName()}</span>\n                </div>\n                <div\n                  title={`${getActionText()} ${getDisplayTarget()}`}\n                  className=\"max-w-[100%] w-[max-content] truncate text-[13px] rounded-full inline-flex items-center px-[10px] py-[3px] border border-border bg-muted/30 text-foreground\"\n                >\n                  {getActionText()}\n                  <span className=\"flex-1 min-w-0 px-1 ml-1 text-[12px] font-mono max-w-full text-ellipsis overflow-hidden whitespace-nowrap text-muted-foreground\">\n                    <code>{getDisplayTarget()}</code>\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* Content Container */}\n            <div className=\"flex flex-col rounded-lg overflow-hidden bg-muted/20 border border-border/30 dark:border-black/30 shadow-[0px_4px_32px_0px_rgba(0,0,0,0.04)] flex-1 min-h-0 mt-[16px]\">\n              {/* Unified Header */}\n              <div className=\"h-[36px] flex items-center justify-between px-3 w-full bg-muted/30 border-b border-border rounded-t-lg shadow-[inset_0px_1px_0px_0px_rgba(255,255,255,0.1)]\">\n                {/* Title - far left */}\n                <div className=\"flex items-center gap-2\">\n                  {isTerminal ? (\n                    <Terminal\n                      size={14}\n                      className=\"text-muted-foreground flex-shrink-0\"\n                    />\n                  ) : isPython ? (\n                    <Code2\n                      size={14}\n                      className=\"text-muted-foreground flex-shrink-0\"\n                    />\n                  ) : (\n                    <div className=\"max-w-[250px] truncate text-muted-foreground text-sm font-medium\">\n                      {sidebarContent.path.split(\"/\").pop() ||\n                        sidebarContent.path}\n                    </div>\n                  )}\n                </div>\n\n                {/* Action buttons - far right */}\n                <CodeActionButtons\n                  content={\n                    isFile\n                      ? sidebarContent.content\n                      : isPython\n                        ? sidebarContent.code\n                        : sidebarContent.output\n                          ? `$ ${sidebarContent.command}\\n${sidebarContent.output}`\n                          : `$ ${sidebarContent.command}`\n                  }\n                  filename={\n                    isFile\n                      ? sidebarContent.path.split(\"/\").pop() || \"code.txt\"\n                      : isPython\n                        ? \"python-code.py\"\n                        : \"terminal-output.txt\"\n                  }\n                  language={\n                    isFile\n                      ? sidebarContent.language ||\n                        getLanguageFromPath(sidebarContent.path)\n                      : isPython\n                        ? \"python\"\n                        : \"ansi\"\n                  }\n                  isWrapped={isWrapped}\n                  onToggleWrap={handleToggleWrap}\n                  variant=\"sidebar\"\n                />\n              </div>\n\n              {/* Content */}\n              <div className=\"flex-1 min-h-0 w-full overflow-hidden bg-background\">\n                <div className=\"flex flex-col min-h-0 h-full relative\">\n                  <div className=\"focus-visible:outline-none flex-1 min-h-0 h-full text-sm flex flex-col py-0 outline-none\">\n                    <div\n                      className=\"font-mono w-full text-xs leading-[18px] flex-1 min-h-0 h-full min-w-0\"\n                      style={{\n                        overflowWrap: \"break-word\",\n                        wordBreak: \"break-word\",\n                        whiteSpace: \"pre-wrap\",\n                      }}\n                    >\n                      {isFile && (\n                        <>\n                          {/* Show DiffView for editing actions with diff data */}\n                          {sidebarContent.action === \"editing\" &&\n                          sidebarContent.originalContent &&\n                          sidebarContent.modifiedContent ? (\n                            <DiffView\n                              originalContent={sidebarContent.originalContent}\n                              modifiedContent={sidebarContent.modifiedContent}\n                              language={\n                                sidebarContent.language ||\n                                getLanguageFromPath(sidebarContent.path)\n                              }\n                              wrap={isWrapped}\n                            />\n                          ) : (\n                            <ComputerCodeBlock\n                              language={\n                                sidebarContent.language ||\n                                getLanguageFromPath(sidebarContent.path)\n                              }\n                              wrap={isWrapped}\n                              showButtons={false}\n                            >\n                              {sidebarContent.content}\n                            </ComputerCodeBlock>\n                          )}\n                        </>\n                      )}\n                      {isTerminal && (\n                        <TerminalCodeBlock\n                          command={sidebarContent.command}\n                          output={sidebarContent.output}\n                          isExecuting={sidebarContent.isExecuting}\n                          isBackground={sidebarContent.isBackground}\n                          status={\n                            sidebarContent.isExecuting ? \"streaming\" : \"ready\"\n                          }\n                          variant=\"sidebar\"\n                          wrap={isWrapped}\n                        />\n                      )}\n                      {isPython && (\n                        <div className=\"h-full overflow-auto\">\n                          <div className=\"pb-4\">\n                            <ComputerCodeBlock\n                              language=\"python\"\n                              wrap={isWrapped}\n                              showButtons={false}\n                            >\n                              {sidebarContent.code}\n                            </ComputerCodeBlock>\n                          </div>\n                          {sidebarContent.output && (\n                            <>\n                              <div className=\"border-t border-border/30 mb-3\" />\n                              <div className=\"px-4 pb-4\">\n                                <div className=\"text-xs text-muted-foreground font-semibold mb-3\">\n                                  Result:\n                                </div>\n                                <ComputerCodeBlock\n                                  language=\"text\"\n                                  wrap={isWrapped}\n                                  showButtons={false}\n                                >\n                                  {sidebarContent.output}\n                                </ComputerCodeBlock>\n                              </div>\n                            </>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Navigation Footer */}\n              <div className=\"mt-auto flex w-full items-center gap-2 px-4 h-[44px] relative bg-background border-t border-border\">\n                <div className=\"flex items-center\" dir=\"ltr\">\n                  <button\n                    type=\"button\"\n                    onClick={handlePrev}\n                    disabled={!canGoPrev}\n                    className={`flex items-center justify-center w-[24px] h-[24px] transition-colors cursor-pointer ${\n                      !canGoPrev\n                        ? \"text-muted-foreground/30 cursor-not-allowed\"\n                        : \"text-muted-foreground hover:text-blue-500\"\n                    }`}\n                    aria-label=\"Previous tool execution\"\n                  >\n                    <SkipBack size={16} />\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={handleNext}\n                    disabled={!canGoNext}\n                    className={`flex items-center justify-center w-[24px] h-[24px] transition-colors cursor-pointer ${\n                      !canGoNext\n                        ? \"text-muted-foreground/30 cursor-not-allowed\"\n                        : \"text-muted-foreground hover:text-blue-500\"\n                    }`}\n                    aria-label=\"Next tool execution\"\n                  >\n                    <SkipForward size={16} />\n                  </button>\n                </div>\n                <div\n                  className=\"group touch-none group relative hover:z-10 flex h-1 flex-1 min-w-0 cursor-pointer select-none items-center\"\n                  onClick={handleSliderClick}\n                  onKeyDown={(e) => {\n                    if (e.key === \"Enter\" || e.key === \" \") {\n                      e.preventDefault();\n                      // Focus the slider handle for keyboard navigation\n                      const handle = e.currentTarget.querySelector(\n                        '[role=\"slider\"]',\n                      ) as HTMLElement;\n                      handle?.focus();\n                    }\n                  }}\n                >\n                  <span className=\"relative h-full w-full rounded-full bg-muted\">\n                    <span\n                      className=\"absolute h-full rounded-full bg-blue-500\"\n                      style={{\n                        left: \"0%\",\n                        width: `${getProgressPercentage}%`,\n                      }}\n                    ></span>\n                  </span>\n                  {currentIndex >= 0 && (\n                    <span\n                      className=\"absolute -translate-x-1/2 p-[3px]\"\n                      style={{\n                        left: `${getProgressPercentage}%`,\n                      }}\n                    >\n                      <span\n                        role=\"slider\"\n                        tabIndex={0}\n                        aria-valuemin={0}\n                        aria-valuemax={maxIndex}\n                        aria-valuenow={currentIndex}\n                        aria-label={`Tool execution ${currentIndex + 1}`}\n                        className=\"relative block h-[14px] w-[14px] rounded-full bg-blue-500 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 border-2 border-background drop-shadow-[0px_1px_4px_rgba(0,0,0,0.06)]\"\n                      ></span>\n                    </span>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-1 text-sm ms-[2px] cursor-default\">\n                  <div\n                    className={`h-[8px] w-[8px] rounded-full ${\n                      status === \"streaming\"\n                        ? \"bg-green-500\"\n                        : \"bg-muted-foreground\"\n                    }`}\n                  ></div>\n                  <span\n                    className={\n                      status === \"streaming\"\n                        ? \"text-foreground\"\n                        : \"text-muted-foreground\"\n                    }\n                  >\n                    live\n                  </span>\n                </div>\n                {!isAtLive && (\n                  <button\n                    onClick={handleJumpToLive}\n                    className=\"h-10 px-4 border border-border flex items-center gap-2 bg-background hover:bg-muted shadow-[0px_5px_16px_0px_rgba(0,0,0,0.1),0px_0px_1.25px_0px_rgba(0,0,0,0.1)] rounded-full cursor-pointer absolute left-[50%] translate-x-[-50%]\"\n                    style={{ bottom: \"calc(100% + 10px)\" }}\n                    aria-label=\"Jump to live\"\n                  >\n                    <Play size={16} className=\"text-foreground\" />\n                    <span className=\"text-foreground text-sm font-medium\">\n                      Jump to live\n                    </span>\n                  </button>\n                )}\n                <div></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// Wrapper for normal chats using GlobalState\nexport const ComputerSidebar: React.FC<{\n  messages?: any[];\n  status?: ChatStatus;\n}> = ({ messages, status }) => {\n  const { sidebarOpen, sidebarContent, closeSidebar, openSidebar } =\n    useGlobalState();\n\n  return (\n    <ComputerSidebarBase\n      sidebarOpen={sidebarOpen}\n      sidebarContent={sidebarContent}\n      closeSidebar={closeSidebar}\n      messages={messages}\n      onNavigate={openSidebar}\n      status={status}\n    />\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8352, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ShareDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { api } from \"@/convex/_generated/api\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Copy, Check, Loader2, X as XIcon } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { HackerAISVG } from \"@/components/icons/hackerai-svg\";\nimport { MemoizedMarkdown } from \"@/app/components/MemoizedMarkdown\";\n\ninterface ShareDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  chatId: string;\n  chatTitle: string;\n  existingShareId?: string;\n  existingShareDate?: number;\n}\n\nexport const ShareDialog = ({\n  open,\n  onOpenChange,\n  chatId,\n  chatTitle,\n  existingShareId,\n  existingShareDate,\n}: ShareDialogProps) => {\n  const [shareUrl, setShareUrl] = useState<string>(\"\");\n  const [shareDate, setShareDate] = useState<number | undefined>(\n    existingShareDate,\n  );\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [error, setError] = useState<string>(\"\");\n  const [copied, setCopied] = useState(false);\n\n  const shareChat = async () => ({ shareId: \"stub-share-id\", shareDate: Date.now() });\n  const updateShareDate = async () => ({ shareDate: Date.now() });\n\n  // Stubbed preview messages\n  const previewMessages: any[] = [];\n\n  useEffect(() => {\n    if (open) {\n      // Reset all states when dialog opens\n      setError(\"\");\n      setCopied(false);\n      setIsGenerating(false);\n\n      // Auto-generate or update share when dialog opens\n      const handleAutoShare = async () => {\n        setIsGenerating(true);\n        try {\n          if (existingShareId) {\n            // Update existing share to include new messages\n            const result = await updateShareDate({ chatId });\n            const url = `${window.location.origin}/share/${existingShareId}`;\n            setShareUrl(url);\n            setShareDate(result.shareDate);\n          } else {\n            // Create new share\n            const result = await shareChat({ chatId });\n            const url = `${window.location.origin}/share/${result.shareId}`;\n            setShareUrl(url);\n            setShareDate(result.shareDate);\n          }\n        } catch (err) {\n          setError(\"Failed to generate share link. Please try again.\");\n          console.error(\"Share error:\", err);\n        } finally {\n          setIsGenerating(false);\n        }\n      };\n\n      handleAutoShare();\n    }\n  }, [open, existingShareId, chatId, shareChat, updateShareDate]);\n\n  const handleCopyLink = async () => {\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      setCopied(true);\n      toast.success(\"Link copied to clipboard\");\n      setTimeout(() => setCopied(false), 2000);\n    } catch (err) {\n      toast.error(\"Failed to copy link\");\n      console.error(\"Copy error:\", err);\n    }\n  };\n\n  const handleSocialShare = (platform: \"x\" | \"linkedin\" | \"reddit\") => {\n    const encodedUrl = encodeURIComponent(shareUrl);\n    const encodedTitle = encodeURIComponent(chatTitle);\n\n    const urls = {\n      x: `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}`,\n      linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`,\n      reddit: `https://reddit.com/submit?url=${encodedUrl}&title=${encodedTitle}`,\n    };\n\n    window.open(urls[platform], \"_blank\", \"noopener,noreferrer\");\n  };\n\n  const handleClose = () => {\n    setShareUrl(\"\");\n    setError(\"\");\n    setCopied(false);\n    setIsGenerating(false);\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent\n        className=\"sm:max-w-[640px] p-0 gap-0 overflow-hidden\"\n        showCloseButton={false}\n      >\n        {/* Header */}\n        <div className=\"px-6 py-4 border-b flex items-center justify-between\">\n          <DialogTitle className=\"text-3xl font-semibold\">\n            {chatTitle}\n          </DialogTitle>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-9 w-9 rounded-lg\"\n            onClick={handleClose}\n            aria-label=\"Close\"\n          >\n            <XIcon className=\"h-5 w-5\" />\n          </Button>\n        </div>\n\n        <DialogDescription className=\"sr-only\">\n          Share this conversation via a public link\n        </DialogDescription>\n\n        {/* Loading State */}\n        {isGenerating && (\n          <div className=\"flex items-center justify-center py-20\">\n            <div className=\"flex flex-col items-center gap-4\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n              <p className=\"text-sm text-muted-foreground\">\n                Generating share link...\n              </p>\n            </div>\n          </div>\n        )}\n\n        {/* Error State */}\n        {error && (\n          <div className=\"px-6 py-8\">\n            <div className=\"space-y-4\">\n              <p className=\"text-sm text-destructive text-center\">{error}</p>\n              <Button\n                onClick={async () => {\n                  setError(\"\");\n                  setIsGenerating(true);\n                  try {\n                    if (existingShareId) {\n                      const result = await updateShareDate({ chatId });\n                      setShareUrl(\n                        `${window.location.origin}/share/${existingShareId}`,\n                      );\n                      setShareDate(result.shareDate);\n                    } else {\n                      const result = await shareChat({ chatId });\n                      setShareUrl(\n                        `${window.location.origin}/share/${result.shareId}`,\n                      );\n                      setShareDate(result.shareDate);\n                    }\n                  } catch (err) {\n                    setError(\n                      \"Failed to generate share link. Please try again.\",\n                    );\n                  } finally {\n                    setIsGenerating(false);\n                  }\n                }}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"w-full\"\n              >\n                Try again\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {/* Share content */}\n        {shareUrl && !isGenerating && !error && (\n          <div className=\"flex flex-col\">\n            {/* Chat Preview */}\n            <div className=\"px-6 py-4\">\n              <div className=\"w-full rounded-xl aspect-[1200/630] overflow-hidden border bg-muted/30 relative\">\n                <div className=\"h-full w-full overflow-hidden\">\n                  {/* Content wrapper - adapts to dialog width */}\n                  <div className=\"h-full w-full p-4\">\n                    <div className=\"w-full flex flex-col space-y-4\">\n                      {previewMessages &&\n                        previewMessages.map((message) => {\n                          const isUser = message.role === \"user\";\n                          return (\n                            <div\n                              key={message.id}\n                              className={`flex flex-col ${isUser ? \"items-end\" : \"items-start\"}`}\n                            >\n                              <div\n                                className={`${\n                                  isUser\n                                    ? \"w-full flex flex-col gap-1 items-end\"\n                                    : \"w-full text-foreground\"\n                                } overflow-hidden`}\n                              >\n                                <div\n                                  className={`${\n                                    isUser\n                                      ? \"max-w-[80%] bg-secondary rounded-[18px] px-4 py-1.5 data-[multiline]:py-3 rounded-se-lg text-primary-foreground border border-border\"\n                                      : \"w-full prose space-y-3 max-w-none dark:prose-invert min-w-0\"\n                                  } overflow-hidden`}\n                                >\n                                  {isUser ? (\n                                    <div className=\"whitespace-pre-wrap\">\n                                      {message.content}\n                                    </div>\n                                  ) : (\n                                    <MemoizedMarkdown\n                                      content={message.content || \"\"}\n                                    />\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                          );\n                        })}\n                    </div>\n                  </div>\n                </div>\n                {/* Fade-out gradient at the bottom - starts at 66% height, more opaque */}\n                <div className=\"absolute bottom-0 left-0 right-0 h-[34%] bg-gradient-to-t from-muted/90 via-muted/70 via-30% via-muted/40 via-70% to-transparent pointer-events-none\" />\n\n                {/* Floating HackerAI Logo - bottom left corner */}\n                <div className=\"absolute bottom-4 right-4 z-10\">\n                  <HackerAISVG theme=\"dark\" scale={0.12} />\n                </div>\n              </div>\n            </div>\n\n            {/* Social Share Buttons */}\n            <div className=\"px-6 py-4\">\n              <div className=\"flex justify-center gap-8\">\n                {/* Copy Link */}\n                <button\n                  onClick={handleCopyLink}\n                  className=\"flex flex-col items-center gap-2 group\"\n                >\n                  <div className=\"h-16 w-16 rounded-full shadow-lg flex items-center justify-center hover:shadow-xl transition-shadow bg-background\">\n                    <div className=\"flex h-8 w-8 items-center justify-center\">\n                      {copied ? (\n                        <Check className=\"h-5 w-5\" />\n                      ) : (\n                        <Copy className=\"h-5 w-5\" />\n                      )}\n                    </div>\n                  </div>\n                  <span className=\"text-xs text-center max-w-16\">\n                    {copied ? \"Copied!\" : \"Copy link\"}\n                  </span>\n                </button>\n\n                {/* X (Twitter) */}\n                <button\n                  onClick={() => handleSocialShare(\"x\")}\n                  className=\"flex flex-col items-center gap-2 group\"\n                >\n                  <div className=\"h-16 w-16 rounded-full shadow-lg flex items-center justify-center hover:shadow-xl transition-shadow bg-background\">\n                    <div className=\"flex h-8 w-8 items-center justify-center\">\n                      <svg\n                        className=\"h-5 w-5\"\n                        viewBox=\"0 0 24 24\"\n                        fill=\"currentColor\"\n                      >\n                        <path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\" />\n                      </svg>\n                    </div>\n                  </div>\n                  <span className=\"text-xs text-center max-w-16\">X</span>\n                </button>\n\n                {/* LinkedIn */}\n                <button\n                  onClick={() => handleSocialShare(\"linkedin\")}\n                  className=\"flex flex-col items-center gap-2 group\"\n                >\n                  <div className=\"h-16 w-16 rounded-full shadow-lg flex items-center justify-center hover:shadow-xl transition-shadow bg-background\">\n                    <div className=\"flex h-8 w-8 items-center justify-center\">\n                      <svg\n                        className=\"h-5 w-5\"\n                        viewBox=\"0 0 24 24\"\n                        fill=\"currentColor\"\n                      >\n                        <path d=\"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z\" />\n                      </svg>\n                    </div>\n                  </div>\n                  <span className=\"text-xs text-center max-w-16\">LinkedIn</span>\n                </button>\n\n                {/* Reddit */}\n                <button\n                  onClick={() => handleSocialShare(\"reddit\")}\n                  className=\"flex flex-col items-center gap-2 group\"\n                >\n                  <div className=\"h-16 w-16 rounded-full shadow-lg flex items-center justify-center hover:shadow-xl transition-shadow bg-background\">\n                    <div className=\"flex h-8 w-8 items-center justify-center\">\n                      <svg\n                        className=\"h-5 w-5\"\n                        viewBox=\"0 0 24 24\"\n                        fill=\"currentColor\"\n                      >\n                        <path d=\"M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.520c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z\" />\n                      </svg>\n                    </div>\n                  </div>\n                  <span className=\"text-xs text-center max-w-16\">Reddit</span>\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8934, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ChatHeader.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAuth } from \"@workos-inc/authkit-nextjs/components\";\nimport {\n  PanelLeft,\n  Sparkle,\n  SquarePen,\n  HatGlasses,\n  Split,\n  Share,\n} from \"lucide-react\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\nimport { redirectToPricing } from \"../hooks/usePricingDialog\";\nimport { useRouter } from \"next/navigation\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { ShareDialog } from \"./ShareDialog\";\n\ninterface ChatHeaderProps {\n  hasMessages: boolean;\n  hasActiveChat: boolean;\n  chatTitle?: string | null;\n  id?: string;\n  chatData?:\n    | {\n        title?: string;\n        branched_from_chat_id?: string;\n        share_id?: string;\n        share_date?: number;\n      }\n    | null\n    | undefined;\n  chatSidebarOpen?: boolean;\n  isExistingChat?: boolean;\n  isChatNotFound?: boolean;\n  branchedFromChatTitle?: string;\n}\n\nconst ChatHeader: React.FC<ChatHeaderProps> = ({\n  hasMessages,\n  hasActiveChat,\n  chatTitle,\n  id,\n  chatData,\n  chatSidebarOpen = false,\n  isExistingChat = false,\n  isChatNotFound = false,\n  branchedFromChatTitle,\n}) => {\n  const user = { id: \"default-user\" };\n  const loading = false;\n  const {\n    toggleChatSidebar,\n    subscription,\n    isCheckingProPlan,\n    initializeNewChat,\n    closeSidebar,\n    setChatSidebarOpen,\n    temporaryChatsEnabled,\n    setTemporaryChatsEnabled,\n  } = useGlobalState();\n  // Removed useUpgrade hook - we now redirect to pricing dialog instead\n  const router = useRouter();\n  const isMobile = useIsMobile();\n  const [showShareDialog, setShowShareDialog] = useState(false);\n\n  // Show sidebar toggle for everyone\n  const showSidebarToggle = true;\n\n  // Check if we're currently in a chat (use isExistingChat prop for accurate state)\n  const isInChat = isExistingChat;\n\n  // Check if this is a branched chat\n  const isBranchedChat = !!chatData?.branched_from_chat_id;\n\n  const handleSignIn = () => {\n    // Disabled\n  };\n\n  const handleSignUp = () => {\n    // Disabled\n  };\n\n  const handleUpgradeClick = () => {\n    // Disabled\n  };\n\n  const handleNewChat = () => {\n    // Close computer sidebar when creating new chat\n    closeSidebar();\n\n    // Close chat sidebar when creating new chat on mobile screens\n    if (isMobile) {\n      setChatSidebarOpen(false);\n    }\n\n    // Initialize new chat state using global state function\n    initializeNewChat();\n\n    // Always disable temporary chat for a new chat\n    setTemporaryChatsEnabled(false);\n    router.push(\"/\");\n  };\n\n  // Show empty state header when no messages and no active chat\n  if (!hasMessages && !hasActiveChat) {\n    return (\n      <div className=\"flex-shrink-0\">\n        <header className=\"w-full px-6 max-sm:px-4 flex-shrink-0\">\n          {/* Desktop header */}\n          <div className=\"py-[10px] flex gap-10 items-center justify-between max-md:hidden\">\n            <div className=\"flex items-center gap-2\">\n              {/* Removed sidebar toggle for desktop - handled by collapsed sidebar logo */}\n              {/* Show upgrade button for logged-in users without pro plan */}\n              {!loading &&\n                user &&\n                !isCheckingProPlan &&\n                subscription === \"free\" && (\n                  <Button\n                    onClick={handleUpgradeClick}\n                    className=\"flex items-center gap-1 rounded-full py-2 ps-2.5 pe-3 text-sm font-medium bg-premium-bg text-premium-text hover:bg-premium-hover border-0 transition-all duration-200\"\n                    size=\"default\"\n                  >\n                    <Sparkle className=\"mr-2 h-4 w-4 fill-current\" />\n                    Upgrade plan\n                  </Button>\n                )}\n            </div>\n            <div className=\"flex flex-1 gap-2 justify-between items-center\">\n              <div className=\"flex gap-[40px]\"></div>\n              <div className=\"flex gap-2 items-center\">\n                {/* Temporary Chat Toggle - Desktop */}\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button\n                        variant={temporaryChatsEnabled ? \"default\" : \"ghost\"}\n                        size=\"sm\"\n                        aria-label=\"Toggle temporary chats for new chats\"\n                        aria-pressed={temporaryChatsEnabled}\n                        onClick={() =>\n                          setTemporaryChatsEnabled(!temporaryChatsEnabled)\n                        }\n                        className=\"flex items-center gap-2 rounded-full px-3\"\n                      >\n                        <HatGlasses className=\"size-5\" />\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>\n                      <p>\n                        {temporaryChatsEnabled\n                          ? \"Turn off temporary chat\"\n                          : \"Turn on temporary chat\"}\n                      </p>\n                    </TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n                {/* Show sign in/up buttons removed */}\n              </div>\n            </div>\n          </div>\n\n          {/* Mobile header */}\n          <div className=\"py-3 flex items-center justify-between md:hidden\">\n            <div className=\"flex items-center gap-2\">\n              {showSidebarToggle && !chatSidebarOpen && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  aria-label=\"Toggle chat sidebar\"\n                  onClick={toggleChatSidebar}\n                  className=\"h-7 w-7 mr-2\"\n                >\n                  <PanelLeft className=\"size-5\" />\n                </Button>\n              )}\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {/* Temporary Chat Toggle - Mobile */}\n              <TooltipProvider>\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <Button\n                      variant={temporaryChatsEnabled ? \"default\" : \"ghost\"}\n                      size=\"icon\"\n                      aria-label=\"Toggle temporary chats for new chats\"\n                      aria-pressed={temporaryChatsEnabled}\n                      onClick={() =>\n                        setTemporaryChatsEnabled(!temporaryChatsEnabled)\n                      }\n                      className=\"h-7 w-7 rounded-full\"\n                    >\n                      <HatGlasses className=\"size-5\" />\n                    </Button>\n                  </TooltipTrigger>\n                  <TooltipContent>\n                    <p>\n                      {temporaryChatsEnabled\n                        ? \"Turn off temporary chat\"\n                        : \"Turn on temporary chat\"}\n                    </p>\n                  </TooltipContent>\n                </Tooltip>\n              </TooltipProvider>\n            </div>\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  // Show chat header when there are messages or active chat\n  if (hasMessages || hasActiveChat) {\n    return (\n      <>\n        <ShareDialog\n          open={showShareDialog}\n          onOpenChange={setShowShareDialog}\n          chatId={id || \"\"}\n          chatTitle={chatTitle || \"\"}\n          existingShareId={chatData?.share_id}\n          existingShareDate={chatData?.share_date}\n        />\n        <div className=\"px-4 bg-background flex-shrink-0\">\n          <div className=\"sm:min-w-[390px] flex flex-row items-center justify-between pt-3 pb-1 gap-1 sticky top-0 z-10 bg-background flex-shrink-0\">\n            <div className=\"flex items-center flex-1\">\n              <div className=\"relative flex items-center\">\n                {/* Only show sidebar toggle on mobile - desktop uses collapsed sidebar logo */}\n                {showSidebarToggle && !chatSidebarOpen && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    aria-label=\"Open sidebar\"\n                    onClick={toggleChatSidebar}\n                    className=\"h-7 w-7 md:hidden\"\n                  >\n                    <PanelLeft className=\"size-5\" />\n                  </Button>\n                )}\n              </div>\n            </div>\n            <div className=\"max-w-full sm:max-w-[768px] sm:min-w-[390px] flex w-full flex-col gap-[4px] overflow-hidden\">\n              <div className=\"w-full flex flex-row items-center justify-between flex-1 min-w-0 gap-[24px]\">\n                <div className=\"flex flex-row items-center gap-[6px] flex-1 min-w-0 text-foreground text-lg font-medium\">\n                  <span className=\"whitespace-nowrap text-ellipsis overflow-hidden flex items-center gap-2\">\n                    {isChatNotFound ? (\n                      \"\"\n                    ) : !isExistingChat && temporaryChatsEnabled ? (\n                      <>\n                        Temporary Chat\n                        <HatGlasses className=\"size-5\" />\n                      </>\n                    ) : (\n                      <>\n                        {isBranchedChat && branchedFromChatTitle && (\n                          <TooltipProvider delayDuration={300}>\n                            <Tooltip>\n                              <TooltipTrigger asChild>\n                                <Split className=\"size-4 flex-shrink-0 text-muted-foreground\" />\n                              </TooltipTrigger>\n                              <TooltipContent>\n                                <p className=\"text-xs\">\n                                  Branched from: {branchedFromChatTitle}\n                                </p>\n                              </TooltipContent>\n                            </Tooltip>\n                          </TooltipProvider>\n                        )}\n                        {chatTitle ||\n                          (isExistingChat && chatData === undefined\n                            ? \"\"\n                            : \"New Chat\")}\n                      </>\n                    )}\n                  </span>\n                </div>\n                {/* Share button - only show for existing chats that aren't temporary, hide on mobile */}\n                {isExistingChat &&\n                  !temporaryChatsEnabled &&\n                  id &&\n                  chatTitle && (\n                    <button\n                      aria-label=\"Share\"\n                      data-testid=\"share-chat-button\"\n                      onClick={() => setShowShareDialog(true)}\n                      className=\"relative mx-2 flex-shrink-0 rounded-full h-[34px] px-3 py-0 text-sm font-medium transition-colors hover:bg-[#ffffff1a] max-md:hidden\"\n                    >\n                      <div className=\"flex w-full items-center justify-center gap-1.5\">\n                        <Share className=\"h-4 w-4 -ms-0.5\" />\n                        Share\n                      </div>\n                    </button>\n                  )}\n              </div>\n            </div>\n            <div className=\"flex-1 flex justify-end\">\n              {/* New Chat Button - Show on mobile when in a chat or when temporary chat is active */}\n              {isMobile &&\n                (isInChat || (!isExistingChat && temporaryChatsEnabled)) &&\n                showSidebarToggle && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    aria-label=\"Start new chat\"\n                    onClick={handleNewChat}\n                    className=\"h-7 w-7\"\n                  >\n                    <SquarePen className=\"size-5\" />\n                  </Button>\n                )}\n            </div>\n          </div>\n        </div>\n      </>\n    );\n  }\n\n  return null;\n};\n\nexport default ChatHeader;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9447, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/CustomizeHackerAIDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ConvexError } from \"convex/values\";\nimport { api } from \"@/convex/_generated/api\";\nimport { toast } from \"sonner\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Plus } from \"lucide-react\";\nimport TextareaAutosize from \"react-textarea-autosize\";\n\ninterface CustomizeHackerAIDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nconst predefinedTraits = [\n  \"Methodical\",\n  \"Detail-oriented\",\n  \"Thorough\",\n  \"Risk-aware\",\n  \"Tool-savvy\",\n];\n\nconst personalityOptions = [\n  { value: \"default\", label: \"Default\", description: \"\" },\n  { value: \"cynic\", label: \"Cynic\", description: \"Critical and sarcastic\" },\n  { value: \"robot\", label: \"Robot\", description: \"Efficient and blunt\" },\n  {\n    value: \"listener\",\n    label: \"Listener\",\n    description: \"Thoughtful and supportive\",\n  },\n  { value: \"nerd\", label: \"Nerd\", description: \"Exploratory and enthusiastic\" },\n];\n\nexport const CustomizeHackerAIDialog = ({\n  open,\n  onOpenChange,\n}: CustomizeHackerAIDialogProps) => {\n  const [nickname, setNickname] = useState(\"\");\n  const [occupation, setOccupation] = useState(\"\");\n  const [personality, setPersonality] = useState(\"default\");\n  const [traitsText, setTraitsText] = useState(\"\");\n  const [additionalInfo, setAdditionalInfo] = useState(\"\");\n  const [isSaving, setIsSaving] = useState(false);\n\n  const MAX_CHAR_LIMIT = 1500;\n\n  const isNicknameOverLimit = nickname.length > MAX_CHAR_LIMIT;\n  const isOccupationOverLimit = occupation.length > MAX_CHAR_LIMIT;\n  const isTraitsOverLimit = traitsText.length > MAX_CHAR_LIMIT;\n  const isAdditionalInfoOverLimit = additionalInfo.length > MAX_CHAR_LIMIT;\n\n  const saveCustomization = async (data: any) => {\n    console.log(\"Mock save customization:\", data);\n    return { success: true };\n  };\n  const userCustomization = {\n    nickname: \"\",\n    occupation: \"\",\n    personality: \"default\",\n    traits: \"\",\n    additional_info: \"\"\n  };\n\n  // Load existing customization data\n  useEffect(() => {\n    if (userCustomization) {\n      setNickname(userCustomization.nickname || \"\");\n      setOccupation(userCustomization.occupation || \"\");\n      setPersonality(userCustomization.personality || \"default\");\n      setTraitsText(userCustomization.traits || \"\");\n      setAdditionalInfo(userCustomization.additional_info || \"\");\n    }\n  }, [userCustomization]);\n\n  const handleAddTrait = (trait: string) => {\n    if (trait) {\n      const currentText = traitsText.trim();\n      const newText = currentText ? `${currentText}, ${trait}` : trait;\n      setTraitsText(newText);\n    }\n  };\n\n  const handleSave = async () => {\n    // Check for character limit violations\n    if (\n      isNicknameOverLimit ||\n      isOccupationOverLimit ||\n      isTraitsOverLimit ||\n      isAdditionalInfoOverLimit\n    ) {\n      return; // Don't save if any field exceeds the limit\n    }\n\n    try {\n      setIsSaving(true);\n\n      await saveCustomization({\n        nickname: nickname || undefined,\n        occupation: occupation || undefined,\n        personality: personality === \"default\" ? undefined : personality,\n        traits: traitsText.trim() || undefined,\n        additional_info: additionalInfo || undefined,\n      });\n      onOpenChange(false);\n    } catch (error) {\n      console.error(\"Failed to save customization:\", error);\n      const errorMessage =\n        error instanceof ConvexError\n          ? (error.data as { message?: string })?.message ||\n            error.message ||\n            \"Failed to save customization\"\n          : error instanceof Error\n            ? error.message\n            : \"Failed to save customization\";\n      toast.error(errorMessage);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleCancel = () => {\n    // Reset form to original values\n    if (userCustomization) {\n      setNickname(userCustomization.nickname || \"\");\n      setOccupation(userCustomization.occupation || \"\");\n      setPersonality(userCustomization.personality || \"default\");\n      setTraitsText(userCustomization.traits || \"\");\n      setAdditionalInfo(userCustomization.additional_info || \"\");\n    } else {\n      // Reset to empty values if no existing customization\n      setNickname(\"\");\n      setOccupation(\"\");\n      setPersonality(\"default\");\n      setTraitsText(\"\");\n      setAdditionalInfo(\"\");\n    }\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange} modal={true}>\n      <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] flex flex-col\">\n        <DialogHeader>\n          <DialogTitle>Personalization</DialogTitle>\n          <DialogDescription>\n            Introduce yourself to get better, more personalized responses\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-y-auto\">\n          <div className=\"space-y-8\">\n            {/* Nickname */}\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"nickname\">What should HackerAI call you?</Label>\n              <TextareaAutosize\n                id=\"nickname\"\n                placeholder=\"Nickname\"\n                value={nickname}\n                onChange={(e) => setNickname(e.target.value)}\n                className={`flex w-full rounded-md border ${isNicknameOverLimit ? \"border-red-500\" : \"border-input\"} bg-transparent px-3 py-2 text-sm shadow-xs placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none`}\n                maxRows={1}\n              />\n              {isNicknameOverLimit && (\n                <div className=\"text-xs text-red-500 mt-1\">\n                  {nickname.length}/{MAX_CHAR_LIMIT} characters\n                </div>\n              )}\n            </div>\n\n            {/* Occupation */}\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"occupation\">What do you do?</Label>\n              <TextareaAutosize\n                id=\"occupation\"\n                placeholder=\"Pentester, bug bounty hunter, etc.\"\n                value={occupation}\n                onChange={(e) => setOccupation(e.target.value)}\n                className={`flex w-full rounded-md border ${isOccupationOverLimit ? \"border-red-500\" : \"border-input\"} bg-transparent px-3 py-2 text-sm shadow-xs placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none`}\n                maxRows={1}\n              />\n              {isOccupationOverLimit && (\n                <div className=\"text-xs text-red-500 mt-1\">\n                  {occupation.length}/{MAX_CHAR_LIMIT} characters\n                </div>\n              )}\n            </div>\n\n            {/* Personality */}\n            <div className=\"space-y-3\">\n              <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n                <Label className=\"sm:flex-shrink-0\">\n                  What personality should HackerAI have?\n                </Label>\n                <Select value={personality} onValueChange={setPersonality}>\n                  <SelectTrigger className=\"w-full sm:w-auto\">\n                    <SelectValue placeholder=\"Select personality\">\n                      {\n                        personalityOptions.find(\n                          (opt) => opt.value === personality,\n                        )?.label\n                      }\n                    </SelectValue>\n                  </SelectTrigger>\n                  <SelectContent>\n                    {personalityOptions.map((option) => (\n                      <SelectItem\n                        key={option.value}\n                        value={option.value}\n                        className=\"flex flex-col items-start py-3\"\n                      >\n                        <div className=\"flex flex-col\">\n                          <div className=\"font-medium\">{option.label}</div>\n                          {option.value !== \"default\" && (\n                            <div className=\"text-xs text-muted-foreground mt-0.5\">\n                              {option.description}\n                            </div>\n                          )}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Traits */}\n            <div className=\"space-y-4\">\n              <Label>What traits should HackerAI have?</Label>\n\n              <TextareaAutosize\n                placeholder=\"Describe or select traits\"\n                value={traitsText}\n                onChange={(e) => setTraitsText(e.target.value)}\n                className={`flex w-full rounded-md border ${isTraitsOverLimit ? \"border-red-500\" : \"border-input\"} bg-transparent px-3 py-2 text-sm shadow-xs placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none`}\n                minRows={2}\n                maxRows={4}\n              />\n              {isTraitsOverLimit && (\n                <div className=\"text-xs text-red-500 mt-1\">\n                  {traitsText.length}/{MAX_CHAR_LIMIT} characters\n                </div>\n              )}\n\n              {/* Predefined traits */}\n              <div className=\"flex flex-wrap gap-2\">\n                {predefinedTraits.map((trait) => (\n                  <button\n                    key={trait}\n                    type=\"button\"\n                    onClick={() => handleAddTrait(trait)}\n                    className=\"inline-flex items-center gap-1 px-3 py-1 text-sm border rounded-full hover:bg-muted transition-colors\"\n                  >\n                    <Plus className=\"h-3 w-3\" />\n                    {trait}\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            {/* Additional Info */}\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"additional-info\">\n                Anything else HackerAI should know about you?\n              </Label>\n              <TextareaAutosize\n                id=\"additional-info\"\n                placeholder=\"Security interests, preferred methodologies, compliance requirements\"\n                value={additionalInfo}\n                onChange={(e) => setAdditionalInfo(e.target.value)}\n                className={`flex w-full rounded-md border ${isAdditionalInfoOverLimit ? \"border-red-500\" : \"border-input\"} bg-transparent px-3 py-2 text-sm shadow-xs placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none`}\n                minRows={3}\n                maxRows={6}\n              />\n              {isAdditionalInfoOverLimit && (\n                <div className=\"text-xs text-red-500 mt-1\">\n                  {additionalInfo.length}/{MAX_CHAR_LIMIT} characters\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter className=\"flex-row justify-end gap-2 border-t pt-4\">\n          <Button variant=\"outline\" onClick={handleCancel} disabled={isSaving}>\n            Cancel\n          </Button>\n          <Button\n            onClick={handleSave}\n            disabled={\n              isSaving ||\n              isNicknameOverLimit ||\n              isOccupationOverLimit ||\n              isTraitsOverLimit ||\n              isAdditionalInfoOverLimit\n            }\n          >\n            {isSaving ? \"Saving...\" : \"Save\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9957, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ManageMemoriesDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport { Trash2 } from \"lucide-react\";\nimport { useQuery, useMutation } from \"convex/react\";\nimport { ConvexError } from \"convex/values\";\nimport { api } from \"@/convex/_generated/api\";\nimport { toast } from \"sonner\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ManageMemoriesDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nconst ManageMemoriesDialog = ({\n  open,\n  onOpenChange,\n}: ManageMemoriesDialogProps) => {\n  const memories = [];\n  const deleteMemory = async (data: any) => {\n    console.log(\"Mock delete memory:\", data);\n    return { success: true };\n  };\n  const deleteAllMemories = async () => {\n    console.log(\"Mock delete all memories\");\n    return { success: true };\n  };\n\n  const handleDeleteMemory = async (memoryId: string) => {\n    try {\n      await deleteMemory({ memoryId });\n    } catch (error) {\n      console.error(\"Failed to delete memory:\", error);\n      const errorMessage =\n        error instanceof ConvexError\n          ? (error.data as { message?: string })?.message ||\n            error.message ||\n            \"Failed to delete memory\"\n          : error instanceof Error\n            ? error.message\n            : \"Failed to delete memory\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleDeleteAllMemories = async () => {\n    try {\n      await deleteAllMemories({});\n    } catch (error) {\n      console.error(\"Failed to delete all memories:\", error);\n      const errorMessage =\n        error instanceof ConvexError\n          ? (error.data as { message?: string })?.message ||\n            error.message ||\n            \"Failed to delete all memories\"\n          : error instanceof Error\n            ? error.message\n            : \"Failed to delete all memories\";\n      toast.error(errorMessage);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] w-full flex flex-col gap-0 p-0\">\n        <DialogHeader className=\"px-6 py-4\">\n          <DialogTitle className=\"text-lg font-normal text-left\">\n            Saved memories\n          </DialogTitle>\n          <div className=\"text-xs text-muted-foreground text-left mt-1\">\n            HackerAI tries to remember most of your chats, but it may forget\n            things over time. Saved memories are never forgotten.\n          </div>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-hidden px-6 pb-6\">\n          <div className=\"h-[400px] rounded-lg border border-border overflow-hidden\">\n            <div className=\"overflow-y-auto text-sm h-full text-foreground\">\n              {memories === undefined ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"text-muted-foreground\">\n                    Loading memories...\n                  </div>\n                </div>\n              ) : memories.length === 0 ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"text-center\">\n                    <div className=\"mb-2 text-muted-foreground\">\n                      No memories saved yet\n                    </div>\n                    <div className=\"text-sm text-muted-foreground/70\">\n                      HackerAI will automatically save relevant information as\n                      you chat.\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <table className=\"w-full border-separate border-spacing-0\">\n                  <tbody>\n                    {memories.map((memory) => (\n                      <tr key={memory.memory_id}>\n                        <td className=\"align-top px-3 text-left border-b-[0.5px] border-border/50\">\n                          <div className=\"flex min-h-[40px] items-center\">\n                            <div className=\"py-2 whitespace-pre-wrap\">\n                              {memory.content}\n                            </div>\n                          </div>\n                        </td>\n                        <td className=\"align-top px-3 text-right border-b-[0.5px] border-border/50\">\n                          <div className=\"flex justify-end min-h-[40px] items-center\">\n                            <div className=\"text-md flex items-center justify-end gap-2\">\n                              <button\n                                onClick={() =>\n                                  handleDeleteMemory(memory.memory_id)\n                                }\n                                aria-label=\"Remove memory\"\n                                className=\"text-muted-foreground hover:text-destructive transition-colors\"\n                              >\n                                <Trash2 className=\"h-5 w-5\" />\n                              </button>\n                            </div>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              )}\n            </div>\n          </div>\n\n          {memories && memories.length > 0 && (\n            <div className=\"mt-4 flex justify-end\">\n              <Button\n                onClick={handleDeleteAllMemories}\n                variant=\"outline\"\n                className=\"border-destructive text-destructive hover:bg-destructive/10\"\n              >\n                Delete all\n              </Button>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport { ManageMemoriesDialog };\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AAAA;AAEA;AACA;AAMA;AAbA;;;;;;;AAoBA,MAAM,uBAAuB,CAAC,EAC5B,IAAI,EACJ,YAAY,EACc;IAC1B,MAAM,WAAW,EAAE;IACnB,MAAM,eAAe,OAAO;QAC1B,QAAQ,GAAG,CAAC,uBAAuB;QACnC,OAAO;YAAE,SAAS;QAAK;IACzB;IACA,MAAM,oBAAoB;QACxB,QAAQ,GAAG,CAAC;QACZ,OAAO;YAAE,SAAS;QAAK;IACzB;IAEA,MAAM,qBAAqB,OAAO;QAChC,IAAI;YACF,MAAM,aAAa;gBAAE;YAAS;QAChC,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,MAAM,eACJ,iBAAiB,kPAAW,GACxB,AAAC,MAAM,IAAI,EAA2B,WACtC,MAAM,OAAO,IACb,4BACA,iBAAiB,QACf,MAAM,OAAO,GACb;YACR,iRAAK,CAAC,KAAK,CAAC;QACd;IACF;IAEA,MAAM,0BAA0B;QAC9B,IAAI;YACF,MAAM,kBAAkB,CAAC;QAC3B,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kCAAkC;YAChD,MAAM,eACJ,iBAAiB,kPAAW,GACxB,AAAC,MAAM,IAAI,EAA2B,WACtC,MAAM,OAAO,IACb,kCACA,iBAAiB,QACf,MAAM,OAAO,GACb;YACR,iRAAK,CAAC,KAAK,CAAC;QACd;IACF;IAEA,qBACE,6bAAC,qIAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,6bAAC,4IAAa;YAAC,WAAU;;8BACvB,6bAAC,2IAAY;oBAAC,WAAU;;sCACtB,6bAAC,0IAAW;4BAAC,WAAU;sCAAgC;;;;;;sCAGvD,6bAAC;4BAAI,WAAU;sCAA+C;;;;;;;;;;;;8BAMhE,6bAAC;oBAAI,WAAU;;sCACb,6bAAC;4BAAI,WAAU;sCACb,cAAA,6bAAC;gCAAI,WAAU;0CACZ,aAAa,0BACZ,6bAAC;oCAAI,WAAU;8CACb,cAAA,6bAAC;wCAAI,WAAU;kDAAwB;;;;;;;;;;+EAIvC,SAAS,MAAM,KAAK,kBACtB,6bAAC;oCAAI,WAAU;8CACb,cAAA,6bAAC;wCAAI,WAAU;;0DACb,6bAAC;gDAAI,WAAU;0DAA6B;;;;;;0DAG5C,6bAAC;gDAAI,WAAU;0DAAmC;;;;;;;;;;;;;;;;6FAOtD,6bAAC;oCAAM,WAAU;8CACf,cAAA,6bAAC;kDACE,SAAS,GAAG,CAAC,CAAC,uBACb,6bAAC;;kEACC,6bAAC;wDAAG,WAAU;kEACZ,cAAA,6bAAC;4DAAI,WAAU;sEACb,cAAA,6bAAC;gEAAI,WAAU;0EACZ,OAAO,OAAO;;;;;;;;;;;;;;;;kEAIrB,6bAAC;wDAAG,WAAU;kEACZ,cAAA,6bAAC;4DAAI,WAAU;sEACb,cAAA,6bAAC;gEAAI,WAAU;0EACb,cAAA,6bAAC;oEACC,SAAS,IACP,mBAAmB,OAAO,SAAS;oEAErC,cAAW;oEACX,WAAU;8EAEV,cAAA,6bAAC,wSAAM;wEAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;+CAlBnB,OAAO,SAAS;;;;;;;;;;;;;;;;;;;;;;;;;wBA+BpC,YAAY,SAAS,MAAM,GAAG,mBAC7B,6bAAC;4BAAI,WAAU;sCACb,cAAA,6bAAC,qIAAM;gCACL,SAAS;gCACT,SAAQ;gCACR,WAAU;0CACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASf"}},
    {"offset": {"line": 10222, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/MfaVerificationDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport Image from \"next/image\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { toast } from \"sonner\";\n\ninterface EnrollmentData {\n  factor: {\n    id: string;\n    qrCode?: string;\n    secret?: string;\n    issuer?: string;\n    user?: string;\n  };\n  challenge: {\n    id: string;\n    expiresAt: string;\n  };\n}\n\ninterface MfaVerificationDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  enrollmentData: EnrollmentData | null;\n  onVerificationSuccess: () => void;\n}\n\nconst MfaVerificationDialog = ({\n  open,\n  onOpenChange,\n  enrollmentData,\n  onVerificationSuccess,\n}: MfaVerificationDialogProps) => {\n  const [verificationCode, setVerificationCode] = useState(\"\");\n  const [verifying, setVerifying] = useState(false);\n  const [showManualCode, setShowManualCode] = useState(false);\n\n  const handleVerifyCode = async () => {\n    if (!enrollmentData?.challenge.id || !verificationCode.trim()) {\n      toast.error(\"Please enter the verification code\");\n      return;\n    }\n\n    setVerifying(true);\n    try {\n      const response = await fetch(\"/api/mfa/verify\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          challengeId: enrollmentData.challenge.id,\n          code: verificationCode,\n        }),\n      });\n\n      const result = await response.json();\n\n      if (response.ok && result.valid) {\n        toast.success(\n          \"Multi-factor authentication setup completed successfully!\",\n        );\n        handleClose();\n        onVerificationSuccess();\n      } else {\n        toast.error(result.error || \"Invalid verification code\");\n      }\n    } catch (error) {\n      toast.error(\"Failed to verify code\");\n    } finally {\n      setVerifying(false);\n    }\n  };\n\n  const handleClose = () => {\n    setVerificationCode(\"\");\n    setShowManualCode(false);\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md max-w-[95vw]\">\n        <DialogTitle>Secure your account</DialogTitle>\n        <DialogDescription className=\"text-wrap break-words\">\n          {showManualCode\n            ? \"Manually enter the following code into your preferred authenticator app and then enter the provided one-time code below.\"\n            : \"Scan the QR Code below using your preferred authenticator app and then enter the provided one-time code below.\"}\n        </DialogDescription>\n\n        <div className=\"space-y-4\">\n          {/* QR Code or Manual Code */}\n          {enrollmentData?.factor.qrCode && (\n            <div className=\"flex flex-col items-center space-y-3\">\n              {!showManualCode ? (\n                <>\n                  {/* QR Code */}\n                  <div className=\"p-3 bg-white rounded-lg\">\n                    <Image\n                      src={enrollmentData.factor.qrCode}\n                      alt=\"QR Code for 2FA setup\"\n                      className=\"w-32 h-32\"\n                      width={128}\n                      height={128}\n                      unoptimized\n                    />\n                  </div>\n\n                  {/* Trouble scanning button */}\n                  <Button\n                    variant=\"link\"\n                    size=\"sm\"\n                    onClick={() => setShowManualCode(true)}\n                    className=\"text-sm text-muted-foreground hover:text-foreground underline\"\n                  >\n                    Trouble scanning?\n                  </Button>\n                </>\n              ) : (\n                <>\n                  {/* Manual code section */}\n                  <div className=\"text-center p-4 rounded-lg space-y-3\">\n                    <code className=\"text-lg bg-muted px-4 py-3 rounded border block break-all select-all\">\n                      {enrollmentData.factor.secret}\n                    </code>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        if (enrollmentData?.factor.secret) {\n                          navigator.clipboard.writeText(\n                            enrollmentData.factor.secret,\n                          );\n                        }\n                      }}\n                    >\n                      Copy code\n                    </Button>\n                  </div>\n\n                  {/* Switch back to QR button */}\n                  <Button\n                    variant=\"link\"\n                    size=\"sm\"\n                    onClick={() => setShowManualCode(false)}\n                    className=\"text-sm text-muted-foreground hover:text-foreground underline\"\n                  >\n                    Scan QR code instead\n                  </Button>\n                </>\n              )}\n            </div>\n          )}\n\n          {/* Verification Code Input */}\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"code\">Enter your one-time code*</Label>\n              <Input\n                id=\"code\"\n                type=\"text\"\n                value={verificationCode}\n                onChange={(e) => setVerificationCode(e.target.value)}\n                maxLength={6}\n              />\n            </div>\n\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={handleClose}>\n                Cancel\n              </Button>\n              <Button\n                onClick={handleVerifyCode}\n                disabled={verifying || verificationCode.length !== 6}\n              >\n                {verifying ? \"Verifying...\" : \"Verify\"}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport { MfaVerificationDialog };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10480, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/DeleteMfaFactorDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\n\ninterface DeleteMfaFactorDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  factorId: string | null;\n  onDeleted: () => void;\n}\n\nconst DeleteMfaFactorDialog: React.FC<DeleteMfaFactorDialogProps> = ({\n  open,\n  onOpenChange,\n  factorId,\n  onDeleted,\n}) => {\n  const [code, setCode] = useState(\"\");\n  const [removing, setRemoving] = useState(false);\n\n  const handleClose = () => {\n    setCode(\"\");\n    onOpenChange(false);\n  };\n\n  const handleRemove = async () => {\n    if (!factorId) return;\n    if (!code || code.trim().length !== 6) {\n      toast.error(\"Enter a valid 6-digit code\");\n      return;\n    }\n    setRemoving(true);\n    try {\n      const response = await fetch(\"/api/mfa/delete\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ factorId, code: code.trim() }),\n      });\n\n      if (response.ok) {\n        toast.success(\"Authentication method removed successfully\");\n        handleClose();\n        onDeleted();\n        return;\n      }\n\n      const err = await response.json().catch(() => ({}));\n      toast.error(err?.error || \"Failed to remove authentication method\");\n      if (response.status === 401) {\n        const { clientLogout } = await import(\"@/lib/utils/logout\");\n        clientLogout();\n      }\n    } catch {\n      toast.error(\"Failed to remove authentication method\");\n    } finally {\n      setRemoving(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md max-w-[95vw]\">\n        <DialogTitle>Remove authentication method</DialogTitle>\n        <DialogDescription>\n          To remove this method, confirm with a 6-digit code from your\n          authenticator app.\n        </DialogDescription>\n\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"delete-mfa-code\">Enter your one-time code*</Label>\n            <Input\n              id=\"delete-mfa-code\"\n              type=\"text\"\n              inputMode=\"numeric\"\n              value={code}\n              onChange={(e) => setCode(e.target.value.replace(/\\D/g, \"\"))}\n              maxLength={6}\n            />\n          </div>\n\n          <div className=\"flex justify-end gap-2\">\n            <Button variant=\"outline\" onClick={handleClose} disabled={removing}>\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleRemove}\n              disabled={removing || code.length !== 6}\n              className=\"bg-red-600 hover:bg-red-700 text-white\"\n            >\n              {removing ? \"Removing...\" : \"Remove\"}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport { DeleteMfaFactorDialog };\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAPA;;;;;;;;AAqBA,MAAM,wBAA8D,CAAC,EACnE,IAAI,EACJ,YAAY,EACZ,QAAQ,EACR,SAAS,EACV;IACC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,gaAAQ,EAAC;IACjC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gaAAQ,EAAC;IAEzC,MAAM,cAAc;QAClB,QAAQ;QACR,aAAa;IACf;IAEA,MAAM,eAAe;QACnB,IAAI,CAAC,UAAU;QACf,IAAI,CAAC,QAAQ,KAAK,IAAI,GAAG,MAAM,KAAK,GAAG;YACrC,iRAAK,CAAC,KAAK,CAAC;YACZ;QACF;QACA,YAAY;QACZ,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,mBAAmB;gBAC9C,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE;oBAAU,MAAM,KAAK,IAAI;gBAAG;YACrD;YAEA,IAAI,SAAS,EAAE,EAAE;gBACf,iRAAK,CAAC,OAAO,CAAC;gBACd;gBACA;gBACA;YACF;YAEA,MAAM,MAAM,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;YACjD,iRAAK,CAAC,KAAK,CAAC,KAAK,SAAS;YAC1B,IAAI,SAAS,MAAM,KAAK,KAAK;gBAC3B,MAAM,EAAE,YAAY,EAAE,GAAG;gBACzB;YACF;QACF,EAAE,OAAM;YACN,iRAAK,CAAC,KAAK,CAAC;QACd,SAAU;YACR,YAAY;QACd;IACF;IAEA,qBACE,6bAAC,qIAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,6bAAC,4IAAa;YAAC,WAAU;;8BACvB,6bAAC,0IAAW;8BAAC;;;;;;8BACb,6bAAC,gJAAiB;8BAAC;;;;;;8BAKnB,6bAAC;oBAAI,WAAU;;sCACb,6bAAC;4BAAI,WAAU;;8CACb,6bAAC,mIAAK;oCAAC,SAAQ;8CAAkB;;;;;;8CACjC,6bAAC,mIAAK;oCACJ,IAAG;oCACH,MAAK;oCACL,WAAU;oCACV,OAAO;oCACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO;oCACvD,WAAW;;;;;;;;;;;;sCAIf,6bAAC;4BAAI,WAAU;;8CACb,6bAAC,qIAAM;oCAAC,SAAQ;oCAAU,SAAS;oCAAa,UAAU;8CAAU;;;;;;8CAGpE,6bAAC,qIAAM;oCACL,SAAQ;oCACR,SAAS;oCACT,UAAU,YAAY,KAAK,MAAM,KAAK;oCACtC,WAAU;8CAET,WAAW,gBAAgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO1C"}},
    {"offset": {"line": 10647, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/SecurityTab.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { toast } from \"sonner\";\nimport { MfaVerificationDialog } from \"@/app/components/MfaVerificationDialog\";\nimport { DeleteMfaFactorDialog } from \"@/app/components/DeleteMfaFactorDialog\";\n\ninterface MfaFactor {\n  id: string;\n  issuer?: string;\n  user?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface EnrollmentData {\n  factor: {\n    id: string;\n    qrCode?: string;\n    secret?: string;\n    issuer?: string;\n    user?: string;\n  };\n  challenge: {\n    id: string;\n    expiresAt: string;\n  };\n}\n\nconst SecurityTab = () => {\n  const [factors, setFactors] = useState<MfaFactor[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [mfaEnabled, setMfaEnabled] = useState(false);\n  const [verificationDialog, setVerificationDialog] = useState<{\n    open: boolean;\n    data: EnrollmentData | null;\n  }>({ open: false, data: null });\n  const [deleteDialog, setDeleteDialog] = useState<{\n    open: boolean;\n    factorId: string | null;\n  }>({ open: false, factorId: null });\n\n  const fetchFactors = async () => {\n    try {\n      const response = await fetch(\"/api/mfa/factors\");\n      if (response.ok) {\n        const data = await response.json();\n        setFactors(data.factors);\n        setMfaEnabled(data.factors.length > 0);\n      } else {\n        const error = await response.json().catch(() => ({}));\n        toast.error(error?.error || \"Failed to load security settings\");\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch MFA factors:\", error);\n      toast.error(\"Failed to load security settings\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchFactors();\n  }, []);\n\n  const handleEnrollStart = async () => {\n    try {\n      const response = await fetch(\"/api/mfa/enroll\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n\n      if (response.ok) {\n        const enrollmentData = await response.json();\n\n        // Show QR code immediately\n        setVerificationDialog({\n          open: true,\n          data: enrollmentData,\n        });\n      } else {\n        const error = await response.json();\n        toast.error(error.error || \"Failed to enroll MFA factor\");\n      }\n    } catch (error) {\n      toast.error(\"Failed to enroll MFA factor\");\n    }\n  };\n\n  const handleVerificationSuccess = () => {\n    setVerificationDialog({ open: false, data: null });\n    fetchFactors(); // Refresh the factors list\n  };\n\n  const handleDeleteFactor = (factorId: string) => {\n    setDeleteDialog({ open: true, factorId });\n  };\n\n  const handleMfaToggle = async (enabled: boolean) => {\n    if (enabled && factors.length === 0) {\n      // Enable MFA - start enrollment\n      handleEnrollStart();\n    } else if (!enabled && factors.length > 0) {\n      // Disable MFA - remove all factors\n      for (const factor of factors) {\n        handleDeleteFactor(factor.id);\n      }\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      // Redirect to logout route\n      const { clientLogout } = await import(\"@/lib/utils/logout\");\n      clientLogout();\n    } catch (error) {\n      toast.error(\"Failed to log out\");\n    }\n  };\n\n  const handleLogoutAll = async () => {\n    try {\n      const response = await fetch(\"/api/logout-all\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        toast.success(\n          `Logged out of ${data.revokedSessions} devices successfully`,\n        );\n        // Redirect to logout route to end current session\n        const { clientLogout } = await import(\"@/lib/utils/logout\");\n        clientLogout();\n      } else {\n        const error = await response.json();\n        toast.error(error.error || \"Failed to log out of all devices\");\n      }\n    } catch (error) {\n      toast.error(\"Failed to log out of all devices\");\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-4 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-20 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"space-y-6\">\n        {/* Multi-factor Authentication Section */}\n        <div className=\"flex items-center justify-between py-3 border-b\">\n          <div>\n            <div className=\"font-medium text-base\">\n              Multi-factor authentication\n            </div>\n            {!mfaEnabled && (\n              <div className=\"text-sm text-muted-foreground mt-1\">\n                Require an extra security challenge when logging in. If you are\n                unable to pass this challenge, you will have the option to\n                recover your account via email.\n              </div>\n            )}\n          </div>\n          <Switch\n            data-testid=\"mfa-toggle\"\n            checked={mfaEnabled}\n            onCheckedChange={handleMfaToggle}\n            aria-label=\"Toggle multi-factor authentication\"\n          />\n        </div>\n\n        {/* Log out Section */}\n        <div className=\"flex items-center justify-between py-3 border-b\">\n          <div>\n            <div className=\"font-medium text-base\">Log out of this device</div>\n          </div>\n          <Button\n            data-testid=\"logout-button-device\"\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleLogout}\n          >\n            Log out\n          </Button>\n        </div>\n\n        {/* Log out of all devices Section */}\n        <div className=\"flex items-start justify-between py-3\">\n          <div className=\"flex-1 pr-4\">\n            <div className=\"font-medium text-base\">Log out of all devices</div>\n            <div className=\"text-sm text-muted-foreground mt-1\">\n              Log out of all active sessions across all devices, including your\n              current session. It may take up to 10 minutes for other devices to\n              be logged out.\n            </div>\n          </div>\n          <Button\n            data-testid=\"logout-button-all\"\n            variant=\"destructive\"\n            size=\"sm\"\n            onClick={handleLogoutAll}\n            className=\"bg-red-600 hover:bg-red-700 text-white shrink-0\"\n          >\n            Log out all\n          </Button>\n        </div>\n      </div>\n\n      {/* MFA Verification Dialog */}\n      <MfaVerificationDialog\n        open={verificationDialog.open}\n        onOpenChange={(open) => {\n          if (!open) {\n            setVerificationDialog({ open: false, data: null });\n          }\n        }}\n        enrollmentData={verificationDialog.data}\n        onVerificationSuccess={handleVerificationSuccess}\n      />\n\n      <DeleteMfaFactorDialog\n        open={deleteDialog.open}\n        onOpenChange={(open) => {\n          if (!open) setDeleteDialog({ open: false, factorId: null });\n        }}\n        factorId={deleteDialog.factorId}\n        onDeleted={() => {\n          setDeleteDialog({ open: false, factorId: null });\n          fetchFactors();\n        }}\n      />\n    </>\n  );\n};\n\nexport { SecurityTab };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10989, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/PersonalizationTab.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { ChevronRight } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { toast } from \"sonner\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\n\ninterface PersonalizationTabProps {\n  onCustomInstructions: () => void;\n  onManageMemories: () => void;\n}\n\nconst PersonalizationTab = ({\n  onCustomInstructions,\n  onManageMemories,\n}: PersonalizationTabProps) => {\n  const userCustomization = {\n    include_memory_entries: true\n  };\n  const saveCustomization = async (data: any) => {\n    console.log(\"Mock save customization:\", data);\n    return { success: true };\n  };\n\n  const { customSystemPrompt, setCustomSystemPrompt } = useGlobalState();\n\n  return (\n    <div className=\"space-y-6\">\n      {/* System Prompt Section */}\n      <div>\n        <h3 className=\"text-lg font-medium mb-4 pb-2 border-b\">System Prompt</h3>\n        <div className=\"space-y-3\">\n          <textarea\n            value={customSystemPrompt}\n            onChange={(e) => setCustomSystemPrompt(e.target.value)}\n            placeholder=\"Enter custom system instructions...\"\n            className=\"w-full h-32 rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring\"\n          />\n        </div>\n      </div>\n\n      {/* Personalization Section */}\n      <div>\n        <div className=\"space-y-4\">\n          <div\n            className=\"flex items-center justify-between py-3 border-b cursor-pointer hover:bg-muted/50 transition-colors rounded-md px-2 -mx-2\"\n            onClick={onCustomInstructions}\n          >\n            <div>\n              <div className=\"font-medium\">Custom instructions</div>\n            </div>\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n              Configure\n              <ChevronRight className=\"h-4 w-4\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Memory Section */}\n      <div>\n        <h3 className=\"text-lg font-medium mb-4 pb-2 border-b\">Memory</h3>\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between py-3 border-b\">\n            <div>\n              <div className=\"font-medium\">Enable memory</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Let HackerAI save and use memories when responding.\n              </div>\n            </div>\n            <Switch\n              checked={userCustomization?.include_memory_entries ?? true}\n              onCheckedChange={async (checked) => {\n                try {\n                  await saveCustomization({\n                    include_memory_entries: checked,\n                  });\n                } catch (error) {\n                  console.error(\"Failed to save customization:\", error);\n                  const errorMessage =\n                    error instanceof Error\n                      ? error.message\n                      : \"Failed to save customization\";\n                  toast.error(errorMessage);\n                }\n              }}\n              aria-label=\"Toggle memory\"\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between py-3\">\n            <div>\n              <div className=\"font-medium\">Manage memories</div>\n            </div>\n            <Button variant=\"outline\" size=\"sm\" onClick={onManageMemories}>\n              Manage\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport { PersonalizationTab };\n"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AACA;AACA;AAPA;;;;;;;AAcA,MAAM,qBAAqB,CAAC,EAC1B,oBAAoB,EACpB,gBAAgB,EACQ;IACxB,MAAM,oBAAoB;QACxB,wBAAwB;IAC1B;IACA,MAAM,oBAAoB,OAAO;QAC/B,QAAQ,GAAG,CAAC,4BAA4B;QACxC,OAAO;YAAE,SAAS;QAAK;IACzB;IAEA,MAAM,EAAE,kBAAkB,EAAE,qBAAqB,EAAE,GAAG,IAAA,iJAAc;IAEpE,qBACE,6bAAC;QAAI,WAAU;;0BAEb,6bAAC;;kCACC,6bAAC;wBAAG,WAAU;kCAAyC;;;;;;kCACvD,6bAAC;wBAAI,WAAU;kCACb,cAAA,6bAAC;4BACC,OAAO;4BACP,UAAU,CAAC,IAAM,sBAAsB,EAAE,MAAM,CAAC,KAAK;4BACrD,aAAY;4BACZ,WAAU;;;;;;;;;;;;;;;;;0BAMhB,6bAAC;0BACC,cAAA,6bAAC;oBAAI,WAAU;8BACb,cAAA,6bAAC;wBACC,WAAU;wBACV,SAAS;;0CAET,6bAAC;0CACC,cAAA,6bAAC;oCAAI,WAAU;8CAAc;;;;;;;;;;;0CAE/B,6bAAC;gCAAI,WAAU;;oCAAwD;kDAErE,6bAAC,0TAAY;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAOhC,6bAAC;;kCACC,6bAAC;wBAAG,WAAU;kCAAyC;;;;;;kCACvD,6bAAC;wBAAI,WAAU;;0CACb,6bAAC;gCAAI,WAAU;;kDACb,6bAAC;;0DACC,6bAAC;gDAAI,WAAU;0DAAc;;;;;;0DAC7B,6bAAC;gDAAI,WAAU;0DAAgC;;;;;;;;;;;;kDAIjD,6bAAC,qIAAM;wCACL,SAAS,mBAAmB,0BAA0B;wCACtD,iBAAiB,OAAO;4CACtB,IAAI;gDACF,MAAM,kBAAkB;oDACtB,wBAAwB;gDAC1B;4CACF,EAAE,OAAO,OAAO;gDACd,QAAQ,KAAK,CAAC,iCAAiC;gDAC/C,MAAM,eACJ,iBAAiB,QACb,MAAM,OAAO,GACb;gDACN,iRAAK,CAAC,KAAK,CAAC;4CACd;wCACF;wCACA,cAAW;;;;;;;;;;;;0CAIf,6bAAC;gCAAI,WAAU;;kDACb,6bAAC;kDACC,cAAA,6bAAC;4CAAI,WAAU;sDAAc;;;;;;;;;;;kDAE/B,6bAAC,qIAAM;wCAAC,SAAQ;wCAAU,MAAK;wCAAK,SAAS;kDAAkB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ3E"}},
    {"offset": {"line": 11229, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/AccountTab.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useGlobalState } from \"@/app/contexts/GlobalState\";\nimport { usePentestgptMigration } from \"@/app/hooks/usePentestgptMigration\";\nimport { ultraFeatures } from \"@/lib/pricing/features\";\n\nconst AccountTab = () => {\n  const { setMigrateFromPentestgptDialogOpen } = useGlobalState();\n  const { isMigrating } = usePentestgptMigration();\n\n  return (\n    <div className=\"space-y-6 min-h-0\">\n      <div className=\"border-b py-2\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"font-medium\">\n              HackerAI Ultra\n            </div>\n          </div>\n        </div>\n\n        <div className=\"mt-2 rounded-lg bg-transparent px-0\">\n          <span className=\"text-sm font-semibold inline-block pb-4\">\n            Thanks for using Ultra! Your plan includes:\n          </span>\n          <ul className=\"mb-2 flex flex-col gap-5\">\n            {ultraFeatures.map((feature, index) => (\n              <li key={index} className=\"relative\">\n                <div className=\"flex justify-start gap-3.5\">\n                  <feature.icon className=\"h-5 w-5 shrink-0\" />\n                  <span className=\"font-normal\">{feature.text}</span>\n                </div>\n              </li>\n            ))}\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport { AccountTab };\n"],"names":[],"mappings":";;;;;AAIA;AACA;AACA;AANA;;;;;AAQA,MAAM,aAAa;IACjB,MAAM,EAAE,kCAAkC,EAAE,GAAG,IAAA,iJAAc;IAC7D,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,gKAAsB;IAE9C,qBACE,6bAAC;QAAI,WAAU;kBACb,cAAA,6bAAC;YAAI,WAAU;;8BACb,6bAAC;oBAAI,WAAU;8BACb,cAAA,6bAAC;kCACC,cAAA,6bAAC;4BAAI,WAAU;sCAAc;;;;;;;;;;;;;;;;8BAMjC,6bAAC;oBAAI,WAAU;;sCACb,6bAAC;4BAAK,WAAU;sCAA0C;;;;;;sCAG1D,6bAAC;4BAAG,WAAU;sCACX,2IAAa,CAAC,GAAG,CAAC,CAAC,SAAS,sBAC3B,6bAAC;oCAAe,WAAU;8CACxB,cAAA,6bAAC;wCAAI,WAAU;;0DACb,6bAAC,QAAQ,IAAI;gDAAC,WAAU;;;;;;0DACxB,6bAAC;gDAAK,WAAU;0DAAe,QAAQ,IAAI;;;;;;;;;;;;mCAHtC;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYvB"}},
    {"offset": {"line": 11343, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/SharedLinksTab.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useQuery, useMutation } from \"convex/react\";\nimport { api } from \"@/convex/_generated/api\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { toast } from \"sonner\";\nimport { Copy, Trash2, ExternalLink, Share2 } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\n\nconst SharedLinksTab = () => {\n  const sharedChats = [];\n  const unshareChat = async (data: any) => {\n    console.log(\"Mock unshare chat:\", data);\n    return { success: true };\n  };\n  const unshareAllChats = async () => {\n    console.log(\"Mock unshare all chats\");\n    return { success: true };\n  };\n\n  const [showUnshareAll, setShowUnshareAll] = useState(false);\n  const [isUnsharingAll, setIsUnsharingAll] = useState(false);\n  const [unshareTarget, setUnshareTarget] = useState<string | null>(null);\n  const [isUnsharing, setIsUnsharing] = useState(false);\n\n  const handleCopyLink = async (shareId: string, chatTitle: string) => {\n    const shareUrl = `${window.location.origin}/share/${shareId}`;\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      toast.success(`Link copied for \"${chatTitle}\"`);\n    } catch (error) {\n      console.error(\"Failed to copy share link:\", error);\n      toast.error(\"Unable to copy link. Please copy manually.\");\n    }\n  };\n\n  const handleOpenShare = (shareId: string) => {\n    const shareUrl = `${window.location.origin}/share/${shareId}`;\n    window.open(shareUrl, \"_blank\");\n  };\n\n  const handleUnshare = async (chatId: string, chatTitle: string) => {\n    if (isUnsharing) return;\n    setIsUnsharing(true);\n    try {\n      await unshareChat({ chatId });\n      toast.success(`\"${chatTitle}\" is no longer shared`);\n    } catch (error) {\n      console.error(\"Failed to unshare chat:\", error);\n      toast.error(\"Failed to unshare chat\");\n    } finally {\n      setUnshareTarget(null);\n      setIsUnsharing(false);\n    }\n  };\n\n  const handleUnshareAll = async () => {\n    if (isUnsharingAll) return;\n    setIsUnsharingAll(true);\n    try {\n      await unshareAllChats();\n      toast.success(\"All chats unshared successfully\");\n    } catch (error) {\n      console.error(\"Failed to unshare all chats:\", error);\n      toast.error(\"Failed to unshare all chats\");\n    } finally {\n      setShowUnshareAll(false);\n      setIsUnsharingAll(false);\n    }\n  };\n\n  const formatShareDate = (timestamp: number) => {\n    return formatDistanceToNow(new Date(timestamp), { addSuffix: true });\n  };\n\n  // Loading state\n  if (sharedChats === undefined) {\n    return (\n      <div className=\"space-y-6 min-h-0\">\n        <div className=\"flex items-center justify-center py-8\">\n          <div className=\"text-sm text-muted-foreground\">\n            Loading shared links...\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Empty state\n  if (sharedChats.length === 0) {\n    return (\n      <div className=\"space-y-6 min-h-0\">\n        <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n          <Share2 className=\"h-12 w-12 text-muted-foreground mb-4\" />\n          <h3 className=\"text-lg font-medium mb-2\">No shared chats</h3>\n          <p className=\"text-sm text-muted-foreground max-w-sm\">\n            When you share a chat, it will appear here. You can manage all your\n            shared links from this page.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 min-h-0\">\n      {/* Header with Unshare All button */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-sm font-medium\">\n            Shared Chats ({sharedChats.length})\n          </h3>\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            Manage your publicly shared conversations\n          </p>\n        </div>\n        {sharedChats.length > 0 && (\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setShowUnshareAll(true)}\n            aria-label=\"Unshare all chats\"\n          >\n            Unshare All\n          </Button>\n        )}\n      </div>\n\n      {/* Shared Chats List */}\n      <div className=\"space-y-3\">\n        {sharedChats.map((chat) => (\n          <div\n            key={chat.id}\n            className=\"flex items-center justify-between p-4 rounded-lg border bg-card hover:bg-accent/50 transition-colors\"\n          >\n            <div className=\"flex-1 min-w-0 mr-4\">\n              <div className=\"font-medium truncate\">{chat.title}</div>\n              <div className=\"text-xs text-muted-foreground mt-1\">\n                Shared {formatShareDate(chat.share_date!)}\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => handleCopyLink(chat.share_id!, chat.title)}\n                aria-label=\"Copy share link\"\n                title=\"Copy link\"\n              >\n                <Copy className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => handleOpenShare(chat.share_id!)}\n                aria-label=\"Open shared chat\"\n                title=\"Open in new tab\"\n              >\n                <ExternalLink className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setUnshareTarget(chat.id)}\n                aria-label=\"Unshare chat\"\n                title=\"Unshare\"\n                className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Unshare Single Chat Confirmation Dialog */}\n      <AlertDialog\n        open={unshareTarget !== null}\n        onOpenChange={(open) => !open && setUnshareTarget(null)}\n      >\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Unshare this chat?</AlertDialogTitle>\n            <AlertDialogDescription>\n              The public link will stop working and no one will be able to\n              access this shared chat anymore. You can always share it again\n              later.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel disabled={isUnsharing}>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                if (unshareTarget) {\n                  const chat = sharedChats.find((c) => c.id === unshareTarget);\n                  if (chat) {\n                    handleUnshare(unshareTarget, chat.title);\n                  }\n                }\n              }}\n              disabled={isUnsharing}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {isUnsharing ? \"Unsharing...\" : \"Unshare\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Unshare All Confirmation Dialog */}\n      <AlertDialog open={showUnshareAll} onOpenChange={setShowUnshareAll}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Unshare all chats?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This will remove public access to all {sharedChats.length} of your\n              shared chats. All share links will stop working. You can always\n              share your chats again later.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel disabled={isUnsharingAll}>\n              Cancel\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleUnshareAll}\n              disabled={isUnsharingAll}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {isUnsharingAll ? \"Unsharing...\" : \"Unshare All\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n};\n\nexport { SharedLinksTab };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11809, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ManageSharedChatsDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { Dialog, DialogContent, DialogTitle } from \"@/components/ui/dialog\";\nimport { SharedLinksTab } from \"./SharedLinksTab\";\nimport { X } from \"lucide-react\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\n\ninterface ManageSharedChatsDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport const ManageSharedChatsDialog = ({\n  open,\n  onOpenChange,\n}: ManageSharedChatsDialogProps) => {\n  const isMobile = useIsMobile();\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent\n        className=\"w-[380px] max-w-[98%] md:w-[95vw] md:max-w-[720px] max-h-[95%] md:h-[600px] p-0 overflow-hidden rounded-[20px]\"\n        showCloseButton={!isMobile}\n      >\n        <DialogTitle className=\"sr-only\">Manage Shared Chats</DialogTitle>\n\n        {isMobile && (\n          <div className=\"relative z-10 p-0\">\n            <div className=\"flex items-center justify-between px-4 py-3 border-b\">\n              <h3 className=\"text-lg font-semibold\">Manage Shared Chats</h3>\n              <button\n                type=\"button\"\n                className=\"flex h-7 w-7 items-center justify-center cursor-pointer rounded-md hover:bg-muted\"\n                onClick={() => onOpenChange(false)}\n                aria-label=\"Close\"\n              >\n                <X className=\"size-5\" />\n              </button>\n            </div>\n          </div>\n        )}\n\n        <div className=\"flex flex-col h-full min-h-0\">\n          {!isMobile && (\n            <div className=\"gap-1 items-center px-6 py-5 flex self-stretch border-b\">\n              <h3 className=\"text-lg font-medium\">Manage Shared Chats</h3>\n            </div>\n          )}\n          <div className=\"flex-1 self-stretch items-start overflow-y-auto px-4 pt-4 pb-4 md:px-6 md:pt-4 min-h-0\">\n            <SharedLinksTab />\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AACA;AANA;;;;;;AAaO,MAAM,0BAA0B,CAAC,EACtC,IAAI,EACJ,YAAY,EACiB;IAC7B,MAAM,WAAW,IAAA,qIAAW;IAE5B,qBACE,6bAAC,qIAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,6bAAC,4IAAa;YACZ,WAAU;YACV,iBAAiB,CAAC;;8BAElB,6bAAC,0IAAW;oBAAC,WAAU;8BAAU;;;;;;gBAEhC,0BACC,6bAAC;oBAAI,WAAU;8BACb,cAAA,6bAAC;wBAAI,WAAU;;0CACb,6bAAC;gCAAG,WAAU;0CAAwB;;;;;;0CACtC,6bAAC;gCACC,MAAK;gCACL,WAAU;gCACV,SAAS,IAAM,aAAa;gCAC5B,cAAW;0CAEX,cAAA,6bAAC,qRAAC;oCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;8BAMrB,6bAAC;oBAAI,WAAU;;wBACZ,CAAC,0BACA,6bAAC;4BAAI,WAAU;sCACb,cAAA,6bAAC;gCAAG,WAAU;0CAAsB;;;;;;;;;;;sCAGxC,6bAAC;4BAAI,WAAU;sCACb,cAAA,6bAAC,sJAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;AAM3B"}},
    {"offset": {"line": 11934, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/DataControlsTab.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useMutation } from \"convex/react\";\nimport { ConvexError } from \"convex/values\";\nimport { api } from \"@/convex/_generated/api\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { toast } from \"sonner\";\nimport { useGlobalState } from \"@/app/contexts/GlobalState\";\nimport { ManageSharedChatsDialog } from \"./ManageSharedChatsDialog\";\n\nconst DataControlsTab = () => {\n  const { subscription } = useGlobalState();\n  const [showDeleteChats, setShowDeleteChats] = useState(false);\n  const [isDeletingChats, setIsDeletingChats] = useState(false);\n  const [showDeleteSandboxes, setShowDeleteSandboxes] = useState(false);\n  const [isDeletingSandboxes, setIsDeletingSandboxes] = useState(false);\n  const [showManageSharedChats, setShowManageSharedChats] = useState(false);\n\n  const deleteAllChats = async () => {\n    console.log(\"Mock delete all chats\");\n    return { success: true };\n  };\n\n  const handleDeleteAllChats = async () => {\n    if (isDeletingChats) return;\n    setIsDeletingChats(true);\n    try {\n      await deleteAllChats();\n      setShowDeleteChats(false);\n      window.location.href = \"/\";\n    } catch (error) {\n      console.error(\"Failed to delete all chats:\", error);\n      const errorMessage =\n        error instanceof ConvexError\n          ? (error.data as { message?: string })?.message ||\n            error.message ||\n            \"Failed to delete all chats\"\n          : error instanceof Error\n            ? error.message\n            : \"Failed to delete all chats\";\n      toast.error(errorMessage);\n      setShowDeleteChats(false);\n    } finally {\n      setIsDeletingChats(false);\n    }\n  };\n\n  const handleDeleteSandboxes = async () => {\n    if (isDeletingSandboxes) return;\n    setIsDeletingSandboxes(true);\n    try {\n      const response = await fetch(\"/api/delete-sandboxes\", {\n        method: \"POST\",\n      });\n\n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || \"Failed to delete sandbox\");\n      }\n\n      toast.success(\"Successfully deleted terminal sandbox\");\n    } catch (error) {\n      console.error(\"Failed to delete sandbox:\", error);\n      toast.error(\"Failed to delete terminal sandbox\");\n    } finally {\n      setShowDeleteSandboxes(false);\n      setIsDeletingSandboxes(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6 min-h-0\">\n      {/* Manage Shared Chats Section */}\n      <div>\n        <div className=\"flex items-center justify-between py-3\">\n          <div>\n            <div className=\"font-medium\">Shared chats</div>\n            <div className=\"text-sm text-muted-foreground mt-1\">\n              Manage your publicly shared conversations\n            </div>\n          </div>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setShowManageSharedChats(true)}\n            aria-label=\"Manage shared chats\"\n          >\n            Manage\n          </Button>\n        </div>\n      </div>\n\n      {/* Divider */}\n      <div className=\"border-t\" />\n\n      {/* Delete All Chats Section */}\n      <div>\n        <div className=\"flex items-center justify-between py-3\">\n          <div>\n            <div className=\"font-medium\">Delete all chats</div>\n          </div>\n          <Button\n            variant=\"destructive\"\n            size=\"sm\"\n            onClick={() => setShowDeleteChats(true)}\n            aria-label=\"Delete all chats\"\n          >\n            Delete all\n          </Button>\n        </div>\n      </div>\n\n      {/* Delete Terminal Sandbox Section - Only for subscribed users */}\n      {subscription !== \"free\" && (\n        <div>\n          <div className=\"flex items-center justify-between py-3\">\n            <div>\n              <div className=\"font-medium\">Delete terminal sandbox</div>\n              <div className=\"text-sm text-muted-foreground mt-1\">\n                Remove all files and data from terminal\n              </div>\n            </div>\n            <Button\n              variant=\"destructive\"\n              size=\"sm\"\n              onClick={() => setShowDeleteSandboxes(true)}\n              aria-label=\"Delete terminal sandbox\"\n            >\n              Delete\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Delete All Chats Confirmation Dialog */}\n      <AlertDialog open={showDeleteChats} onOpenChange={setShowDeleteChats}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>\n              Clear your chat history - are you sure?\n            </AlertDialogTitle>\n            <AlertDialogDescription>\n              This action cannot be undone. This will permanently delete all\n              your chats and remove all associated data from our servers.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel disabled={isDeletingChats}>\n              Cancel\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDeleteAllChats}\n              disabled={isDeletingChats}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {isDeletingChats ? \"Deleting...\" : \"Confirm deletion\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Delete Terminal Sandbox Confirmation Dialog */}\n      <AlertDialog\n        open={showDeleteSandboxes}\n        onOpenChange={setShowDeleteSandboxes}\n      >\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>\n              Delete terminal sandbox - are you sure?\n            </AlertDialogTitle>\n            <AlertDialogDescription>\n              This action cannot be undone. This will permanently remove all\n              files and data from your terminal sandbox. Any running processes\n              will be stopped.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel disabled={isDeletingSandboxes}>\n              Cancel\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDeleteSandboxes}\n              disabled={isDeletingSandboxes}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {isDeletingSandboxes ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Manage Shared Chats Dialog */}\n      <ManageSharedChatsDialog\n        open={showManageSharedChats}\n        onOpenChange={setShowManageSharedChats}\n      />\n    </div>\n  );\n};\n\nexport { DataControlsTab };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 12303, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/TeamDialogs.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Loader2, Plus, Minus } from \"lucide-react\";\n\ninterface TeamMember {\n  id: string;\n  userId: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  role: string;\n  createdAt: string;\n  isCurrentUser: boolean;\n}\n\ninterface PendingInvitation {\n  id: string;\n  email: string;\n  role: string;\n  invitedAt: string;\n  expiresAt: string;\n}\n\ninterface TeamDialogsProps {\n  // Invite dialog props\n  showInviteDialog: boolean;\n  setShowInviteDialog: (show: boolean) => void;\n  inviteEmail: string;\n  setInviteEmail: (email: string) => void;\n  inviting: boolean;\n  handleInvite: (e: React.FormEvent) => void;\n\n  // Remove member dialog props\n  memberToRemove: TeamMember | null;\n  setMemberToRemove: (member: TeamMember | null) => void;\n  removing: string | null;\n  handleRemove: () => void;\n\n  // Revoke invitation dialog props\n  inviteToRevoke: PendingInvitation | null;\n  setInviteToRevoke: (invitation: PendingInvitation | null) => void;\n  revokingInvite: string | null;\n  handleRevokeInvite: () => void;\n\n  // Leave team dialog props\n  showLeaveDialog: boolean;\n  setShowLeaveDialog: (show: boolean) => void;\n  leaving: boolean;\n  handleLeaveTeam: () => void;\n}\n\nexport const TeamDialogs = ({\n  showInviteDialog,\n  setShowInviteDialog,\n  inviteEmail,\n  setInviteEmail,\n  inviting,\n  handleInvite,\n  memberToRemove,\n  setMemberToRemove,\n  removing,\n  handleRemove,\n  inviteToRevoke,\n  setInviteToRevoke,\n  revokingInvite,\n  handleRevokeInvite,\n  showLeaveDialog,\n  setShowLeaveDialog,\n  leaving,\n  handleLeaveTeam,\n}: TeamDialogsProps) => {\n  return (\n    <>\n      {/* Invite Member Dialog */}\n      <Dialog\n        open={showInviteDialog}\n        onOpenChange={(open) => {\n          setShowInviteDialog(open);\n          if (!open) {\n            setInviteEmail(\"\");\n          }\n        }}\n      >\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Invite team member</DialogTitle>\n            <DialogDescription>\n              Send an invitation to join your team. If they already have an\n              account, they&apos;ll need to log out and log back in after\n              accepting the invite to access the team subscription.\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleInvite}>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"space-y-2\">\n                <label htmlFor=\"email\" className=\"text-sm font-medium\">\n                  Email address\n                </label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"colleague@company.com\"\n                  value={inviteEmail}\n                  onChange={(e) => setInviteEmail(e.target.value)}\n                  disabled={inviting}\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => {\n                  setShowInviteDialog(false);\n                  setInviteEmail(\"\");\n                }}\n                disabled={inviting}\n              >\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={inviting}>\n                {inviting ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                    Sending...\n                  </>\n                ) : (\n                  \"Send invitation\"\n                )}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Remove Member Confirmation Dialog */}\n      <Dialog\n        open={!!memberToRemove}\n        onOpenChange={(open) => !open && setMemberToRemove(null)}\n      >\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Remove team member</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to remove{\" \"}\n              <span className=\"font-medium text-foreground\">\n                {memberToRemove?.email}\n              </span>{\" \"}\n              from your team? This action cannot be undone.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setMemberToRemove(null)}\n              disabled={removing === memberToRemove?.id}\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleRemove}\n              disabled={removing === memberToRemove?.id}\n            >\n              {removing === memberToRemove?.id ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  Removing...\n                </>\n              ) : (\n                \"Remove member\"\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Revoke Invitation Confirmation Dialog */}\n      <Dialog\n        open={!!inviteToRevoke}\n        onOpenChange={(open) => !open && setInviteToRevoke(null)}\n      >\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Revoke invitation</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to revoke the invitation for{\" \"}\n              <span className=\"font-medium text-foreground\">\n                {inviteToRevoke?.email}\n              </span>\n              ? They will no longer be able to join your team using this\n              invitation.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setInviteToRevoke(null)}\n              disabled={revokingInvite === inviteToRevoke?.id}\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleRevokeInvite}\n              disabled={revokingInvite === inviteToRevoke?.id}\n            >\n              {revokingInvite === inviteToRevoke?.id ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  Revoking...\n                </>\n              ) : (\n                \"Revoke invitation\"\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Decrease Seats Dialog - Removed, now using ManageSeatsDialog in TeamTab */}\n\n      {/* Leave Team Dialog */}\n      <Dialog\n        open={showLeaveDialog}\n        onOpenChange={(open) => !open && setShowLeaveDialog(false)}\n      >\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Leave team</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to leave this team? You will lose access to\n              all team plan features and will need to be re-invited to join\n              again.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setShowLeaveDialog(false)}\n              disabled={leaving}\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleLeaveTeam}\n              disabled={leaving}\n            >\n              {leaving ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  Leaving...\n                </>\n              ) : (\n                \"Leave team\"\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n};\n\nexport const TeamWelcomeDialog = ({\n  open,\n  onOpenChange,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}) => {\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Welcome to Team Plan! </DialogTitle>\n          <DialogDescription>\n            Thanks for subscribing to the Team plan! You can now add members to\n            your team through Settings  Team tab.\n          </DialogDescription>\n        </DialogHeader>\n        <DialogFooter>\n          <Button onClick={() => onOpenChange(false)}>Got it</Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport const InviteAcceptedDialog = ({\n  open,\n  onOpenChange,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}) => {\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Welcome to the team! </DialogTitle>\n          <DialogDescription>\n            You&apos;ve successfully joined the team. You now have access to all\n            team plan features.\n          </DialogDescription>\n        </DialogHeader>\n        <DialogFooter>\n          <Button onClick={() => onOpenChange(false)}>Got it</Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\ninterface SeatPreview {\n  currentQuantity: number;\n  newQuantity: number;\n  seatsDelta: number;\n  proratedCharge: number;\n  proratedCredit: number;\n  totalDue: number;\n  pricePerSeat: number;\n  proratedPerSeat: number;\n  paymentMethod: string;\n  currentPeriodEnd: number;\n  nextInvoiceAmount: number;\n  isIncrease: boolean;\n  isYearly: boolean;\n  totalUsed: number;\n}\n\nconst formatUnixDate = (ts?: number) =>\n  typeof ts === \"number\" && Number.isFinite(ts) && ts > 0\n    ? new Date(ts * 1000).toLocaleDateString()\n    : \"\";\n\nexport const ManageSeatsDialog = ({\n  open,\n  onOpenChange,\n  currentSeats,\n  totalUsedSeats,\n  onSuccess,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  currentSeats: number;\n  totalUsedSeats: number;\n  onSuccess: () => void;\n}) => {\n  const [targetSeats, setTargetSeats] = useState(currentSeats);\n  const [preview, setPreview] = useState<SeatPreview | null>(null);\n  const [loadingPreview, setLoadingPreview] = useState(false);\n  const [confirming, setConfirming] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  const seatsDelta = targetSeats - currentSeats;\n  const isIncrease = seatsDelta > 0;\n  const isDecrease = seatsDelta < 0;\n  const maxSeats = 999;\n  const minSeats = Math.max(2, totalUsedSeats);\n\n  // Fetch preview when dialog opens or targetSeats changes\n  useEffect(() => {\n    if (!open || targetSeats === currentSeats) {\n      setPreview(null);\n      return;\n    }\n\n    const fetchPreview = async () => {\n      setLoadingPreview(true);\n      setError(\"\");\n      try {\n        const res = await fetch(\"/api/team/seats\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ quantity: targetSeats }),\n        });\n\n        if (!res.ok) {\n          const data = await res.json();\n          throw new Error(data.error || \"Failed to fetch preview\");\n        }\n\n        const data = await res.json();\n        setPreview(data);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \"Failed to load preview\");\n        setPreview(null);\n      } finally {\n        setLoadingPreview(false);\n      }\n    };\n\n    const debounce = setTimeout(fetchPreview, 300);\n    return () => clearTimeout(debounce);\n  }, [open, targetSeats, currentSeats]);\n\n  // Reset state when dialog opens\n  useEffect(() => {\n    if (open) {\n      setTargetSeats(currentSeats);\n      setError(\"\");\n      setPreview(null);\n    }\n  }, [open, currentSeats]);\n\n  const handleConfirm = async () => {\n    setConfirming(true);\n    setError(\"\");\n\n    try {\n      const res = await fetch(\"/api/team/seats\", {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ quantity: targetSeats }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        throw new Error(data.error || \"Failed to update seats\");\n      }\n\n      if (data.success) {\n        onOpenChange(false);\n        onSuccess();\n      } else if (data.requiresPayment && data.invoiceUrl) {\n        window.location.href = data.invoiceUrl;\n      } else {\n        throw new Error(data.message || \"Failed to update seats\");\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to update seats\");\n    } finally {\n      setConfirming(false);\n    }\n  };\n\n  const getButtonText = () => {\n    if (confirming) return null;\n    if (!preview || seatsDelta === 0) return \"Select seat count\";\n\n    if (isIncrease) {\n      return `Add ${seatsDelta} seat${seatsDelta > 1 ? \"s\" : \"\"} for $${preview.totalDue.toFixed(2)}`;\n    } else {\n      return `Remove ${Math.abs(seatsDelta)} seat${Math.abs(seatsDelta) > 1 ? \"s\" : \"\"} (+$${preview.proratedCredit.toFixed(2)} credit)`;\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[480px]\">\n        <DialogHeader>\n          <DialogTitle>Manage seats</DialogTitle>\n          <DialogDescription>\n            Adjust the number of seats for your team. Adding seats charges a\n            prorated amount; removing seats applies a credit to your account.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          {/* Seat Selector */}\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">Number of seats</label>\n            <div className=\"flex items-center gap-3\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={() =>\n                  setTargetSeats(Math.max(minSeats, targetSeats - 1))\n                }\n                disabled={targetSeats <= minSeats || confirming}\n              >\n                <Minus className=\"h-4 w-4\" />\n              </Button>\n              <Input\n                type=\"number\"\n                min={minSeats}\n                max={maxSeats}\n                value={targetSeats}\n                onChange={(e) => {\n                  const val = parseInt(e.target.value) || currentSeats;\n                  setTargetSeats(Math.min(maxSeats, Math.max(minSeats, val)));\n                }}\n                className=\"w-24 text-center\"\n                disabled={confirming}\n              />\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={() =>\n                  setTargetSeats(Math.min(maxSeats, targetSeats + 1))\n                }\n                disabled={targetSeats >= maxSeats || confirming}\n              >\n                <Plus className=\"h-4 w-4\" />\n              </Button>\n              <span className=\"text-sm text-muted-foreground\">\n                {seatsDelta === 0\n                  ? `${currentSeats} seats (no change)`\n                  : isIncrease\n                    ? `(+${seatsDelta} new)`\n                    : `(${seatsDelta} fewer)`}\n              </span>\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Currently using {totalUsedSeats} of {currentSeats} seats\n            </p>\n          </div>\n\n          {/* Preview Section */}\n          {loadingPreview ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n            </div>\n          ) : preview && seatsDelta !== 0 ? (\n            <div className=\"space-y-4 rounded-lg border p-4\">\n              <div className=\"flex justify-between text-sm\">\n                <span>\n                  {isIncrease ? \"Additional seats\" : \"Seats to remove\"}\n                </span>\n                <span className=\"font-medium\">\n                  {isIncrease ? `+${seatsDelta}` : seatsDelta}\n                </span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span>\n                  {isIncrease ? \"Prorated charge\" : \"Prorated credit\"}\n                  <span className=\"text-muted-foreground ml-1\">\n                    (~${preview.proratedPerSeat.toFixed(2)}/seat)\n                  </span>\n                </span>\n                <span\n                  className={`font-medium ${isDecrease ? \"text-green-600\" : \"\"}`}\n                >\n                  {isIncrease\n                    ? `$${preview.proratedCharge.toFixed(2)}`\n                    : `+$${preview.proratedCredit.toFixed(2)}`}\n                </span>\n              </div>\n              <div className=\"border-t pt-3 flex justify-between\">\n                <span className=\"font-medium\">\n                  {isIncrease ? \"Total due today\" : \"Credit to account\"}\n                </span>\n                <span\n                  className={`font-semibold text-lg ${isDecrease ? \"text-green-600\" : \"\"}`}\n                >\n                  {isIncrease\n                    ? `$${preview.totalDue.toFixed(2)}`\n                    : `+$${preview.proratedCredit.toFixed(2)}`}\n                </span>\n              </div>\n              {preview.paymentMethod && isIncrease && (\n                <div className=\"flex justify-between text-sm text-muted-foreground\">\n                  <span>Payment method</span>\n                  <span>{preview.paymentMethod}</span>\n                </div>\n              )}\n              <div className=\"flex justify-between text-sm text-muted-foreground\">\n                <span>\n                  Next invoice\n                  {formatUnixDate(preview.currentPeriodEnd) &&\n                    ` (${formatUnixDate(preview.currentPeriodEnd)})`}\n                </span>\n                <span>${preview.nextInvoiceAmount.toFixed(2)}</span>\n              </div>\n            </div>\n          ) : null}\n\n          {/* Error Message */}\n          {error && (\n            <div className=\"p-3 bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900 rounded-md\">\n              <p className=\"text-sm text-red-600 dark:text-red-400\">{error}</p>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={confirming}\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={handleConfirm}\n            disabled={\n              confirming || loadingPreview || !preview || seatsDelta === 0\n            }\n          >\n            {confirming ? (\n              <>\n                <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                Processing...\n              </>\n            ) : (\n              getButtonText()\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AACA;AACA;AAQA;AAAA;AAAA;AAbA;;;;;;;AA8DO,MAAM,cAAc,CAAC,EAC1B,gBAAgB,EAChB,mBAAmB,EACnB,WAAW,EACX,cAAc,EACd,QAAQ,EACR,YAAY,EACZ,cAAc,EACd,iBAAiB,EACjB,QAAQ,EACR,YAAY,EACZ,cAAc,EACd,iBAAiB,EACjB,cAAc,EACd,kBAAkB,EAClB,eAAe,EACf,kBAAkB,EAClB,OAAO,EACP,eAAe,EACE;IACjB,qBACE;;0BAEE,6bAAC,qIAAM;gBACL,MAAM;gBACN,cAAc,CAAC;oBACb,oBAAoB;oBACpB,IAAI,CAAC,MAAM;wBACT,eAAe;oBACjB;gBACF;0BAEA,cAAA,6bAAC,4IAAa;;sCACZ,6bAAC,2IAAY;;8CACX,6bAAC,0IAAW;8CAAC;;;;;;8CACb,6bAAC,gJAAiB;8CAAC;;;;;;;;;;;;sCAMrB,6bAAC;4BAAK,UAAU;;8CACd,6bAAC;oCAAI,WAAU;8CACb,cAAA,6bAAC;wCAAI,WAAU;;0DACb,6bAAC;gDAAM,SAAQ;gDAAQ,WAAU;0DAAsB;;;;;;0DAGvD,6bAAC,mIAAK;gDACJ,IAAG;gDACH,MAAK;gDACL,aAAY;gDACZ,OAAO;gDACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;gDAC9C,UAAU;;;;;;;;;;;;;;;;;8CAIhB,6bAAC,2IAAY;;sDACX,6bAAC,qIAAM;4CACL,MAAK;4CACL,SAAQ;4CACR,SAAS;gDACP,oBAAoB;gDACpB,eAAe;4CACjB;4CACA,UAAU;sDACX;;;;;;sDAGD,6bAAC,qIAAM;4CAAC,MAAK;4CAAS,UAAU;sDAC7B,yBACC;;kEACE,6bAAC,gTAAO;wDAAC,WAAU;;;;;;oDAA8B;;+DAInD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BASZ,6bAAC,qIAAM;gBACL,MAAM,CAAC,CAAC;gBACR,cAAc,CAAC,OAAS,CAAC,QAAQ,kBAAkB;0BAEnD,cAAA,6bAAC,4IAAa;;sCACZ,6bAAC,2IAAY;;8CACX,6bAAC,0IAAW;8CAAC;;;;;;8CACb,6bAAC,gJAAiB;;wCAAC;wCACe;sDAChC,6bAAC;4CAAK,WAAU;sDACb,gBAAgB;;;;;;wCACX;wCAAI;;;;;;;;;;;;;sCAIhB,6bAAC,2IAAY;;8CACX,6bAAC,qIAAM;oCACL,SAAQ;oCACR,SAAS,IAAM,kBAAkB;oCACjC,UAAU,aAAa,gBAAgB;8CACxC;;;;;;8CAGD,6bAAC,qIAAM;oCACL,SAAQ;oCACR,SAAS;oCACT,UAAU,aAAa,gBAAgB;8CAEtC,aAAa,gBAAgB,mBAC5B;;0DACE,6bAAC,gTAAO;gDAAC,WAAU;;;;;;4CAA8B;;uDAInD;;;;;;;;;;;;;;;;;;;;;;;0BAQV,6bAAC,qIAAM;gBACL,MAAM,CAAC,CAAC;gBACR,cAAc,CAAC,OAAS,CAAC,QAAQ,kBAAkB;0BAEnD,cAAA,6bAAC,4IAAa;;sCACZ,6bAAC,2IAAY;;8CACX,6bAAC,0IAAW;8CAAC;;;;;;8CACb,6bAAC,gJAAiB;;wCAAC;wCACkC;sDACnD,6bAAC;4CAAK,WAAU;sDACb,gBAAgB;;;;;;wCACZ;;;;;;;;;;;;;sCAKX,6bAAC,2IAAY;;8CACX,6bAAC,qIAAM;oCACL,SAAQ;oCACR,SAAS,IAAM,kBAAkB;oCACjC,UAAU,mBAAmB,gBAAgB;8CAC9C;;;;;;8CAGD,6bAAC,qIAAM;oCACL,SAAQ;oCACR,SAAS;oCACT,UAAU,mBAAmB,gBAAgB;8CAE5C,mBAAmB,gBAAgB,mBAClC;;0DACE,6bAAC,gTAAO;gDAAC,WAAU;;;;;;4CAA8B;;uDAInD;;;;;;;;;;;;;;;;;;;;;;;0BAUV,6bAAC,qIAAM;gBACL,MAAM;gBACN,cAAc,CAAC,OAAS,CAAC,QAAQ,mBAAmB;0BAEpD,cAAA,6bAAC,4IAAa;;sCACZ,6bAAC,2IAAY;;8CACX,6bAAC,0IAAW;8CAAC;;;;;;8CACb,6bAAC,gJAAiB;8CAAC;;;;;;;;;;;;sCAMrB,6bAAC,2IAAY;;8CACX,6bAAC,qIAAM;oCACL,SAAQ;oCACR,SAAS,IAAM,mBAAmB;oCAClC,UAAU;8CACX;;;;;;8CAGD,6bAAC,qIAAM;oCACL,SAAQ;oCACR,SAAS;oCACT,UAAU;8CAET,wBACC;;0DACE,6bAAC,gTAAO;gDAAC,WAAU;;;;;;4CAA8B;;uDAInD;;;;;;;;;;;;;;;;;;;;;;;;;AAQhB;AAEO,MAAM,oBAAoB,CAAC,EAChC,IAAI,EACJ,YAAY,EAIb;IACC,qBACE,6bAAC,qIAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,6bAAC,4IAAa;;8BACZ,6bAAC,2IAAY;;sCACX,6bAAC,0IAAW;sCAAC;;;;;;sCACb,6bAAC,gJAAiB;sCAAC;;;;;;;;;;;;8BAKrB,6bAAC,2IAAY;8BACX,cAAA,6bAAC,qIAAM;wBAAC,SAAS,IAAM,aAAa;kCAAQ;;;;;;;;;;;;;;;;;;;;;;AAKtD;AAEO,MAAM,uBAAuB,CAAC,EACnC,IAAI,EACJ,YAAY,EAIb;IACC,qBACE,6bAAC,qIAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,6bAAC,4IAAa;;8BACZ,6bAAC,2IAAY;;sCACX,6bAAC,0IAAW;sCAAC;;;;;;sCACb,6bAAC,gJAAiB;sCAAC;;;;;;;;;;;;8BAKrB,6bAAC,2IAAY;8BACX,cAAA,6bAAC,qIAAM;wBAAC,SAAS,IAAM,aAAa;kCAAQ;;;;;;;;;;;;;;;;;;;;;;AAKtD;AAmBA,MAAM,iBAAiB,CAAC,KACtB,OAAO,OAAO,YAAY,OAAO,QAAQ,CAAC,OAAO,KAAK,IAClD,IAAI,KAAK,KAAK,MAAM,kBAAkB,KACtC;AAEC,MAAM,oBAAoB,CAAC,EAChC,IAAI,EACJ,YAAY,EACZ,YAAY,EACZ,cAAc,EACd,SAAS,EAOV;IACC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,gaAAQ,EAAC;IAC/C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gaAAQ,EAAqB;IAC3D,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,gaAAQ,EAAC;IACrD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,gaAAQ,EAAC;IAC7C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,gaAAQ,EAAC;IAEnC,MAAM,aAAa,cAAc;IACjC,MAAM,aAAa,aAAa;IAChC,MAAM,aAAa,aAAa;IAChC,MAAM,WAAW;IACjB,MAAM,WAAW,KAAK,GAAG,CAAC,GAAG;IAE7B,yDAAyD;IACzD,IAAA,iaAAS,EAAC;QACR,IAAI,CAAC,QAAQ,gBAAgB,cAAc;YACzC,WAAW;YACX;QACF;QAEA,MAAM,eAAe;YACnB,kBAAkB;YAClB,SAAS;YACT,IAAI;gBACF,MAAM,MAAM,MAAM,MAAM,mBAAmB;oBACzC,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBAAE,UAAU;oBAAY;gBAC/C;gBAEA,IAAI,CAAC,IAAI,EAAE,EAAE;oBACX,MAAM,OAAO,MAAM,IAAI,IAAI;oBAC3B,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;gBAChC;gBAEA,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,WAAW;YACb,EAAE,OAAO,KAAK;gBACZ,SAAS,eAAe,QAAQ,IAAI,OAAO,GAAG;gBAC9C,WAAW;YACb,SAAU;gBACR,kBAAkB;YACpB;QACF;QAEA,MAAM,WAAW,WAAW,cAAc;QAC1C,OAAO,IAAM,aAAa;IAC5B,GAAG;QAAC;QAAM;QAAa;KAAa;IAEpC,gCAAgC;IAChC,IAAA,iaAAS,EAAC;QACR,IAAI,MAAM;YACR,eAAe;YACf,SAAS;YACT,WAAW;QACb;IACF,GAAG;QAAC;QAAM;KAAa;IAEvB,MAAM,gBAAgB;QACpB,cAAc;QACd,SAAS;QAET,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,mBAAmB;gBACzC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,UAAU;gBAAY;YAC/C;YAEA,MAAM,OAAO,MAAM,IAAI,IAAI;YAE3B,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;YAChC;YAEA,IAAI,KAAK,OAAO,EAAE;gBAChB,aAAa;gBACb;YACF,OAAO,IAAI,KAAK,eAAe,IAAI,KAAK,UAAU,EAAE;gBAClD,OAAO,QAAQ,CAAC,IAAI,GAAG,KAAK,UAAU;YACxC,OAAO;gBACL,MAAM,IAAI,MAAM,KAAK,OAAO,IAAI;YAClC;QACF,EAAE,OAAO,KAAK;YACZ,SAAS,eAAe,QAAQ,IAAI,OAAO,GAAG;QAChD,SAAU;YACR,cAAc;QAChB;IACF;IAEA,MAAM,gBAAgB;QACpB,IAAI,YAAY,OAAO;QACvB,IAAI,CAAC,WAAW,eAAe,GAAG,OAAO;QAEzC,IAAI,YAAY;YACd,OAAO,CAAC,IAAI,EAAE,WAAW,KAAK,EAAE,aAAa,IAAI,MAAM,GAAG,MAAM,EAAE,QAAQ,QAAQ,CAAC,OAAO,CAAC,IAAI;QACjG,OAAO;YACL,OAAO,CAAC,OAAO,EAAE,KAAK,GAAG,CAAC,YAAY,KAAK,EAAE,KAAK,GAAG,CAAC,cAAc,IAAI,MAAM,GAAG,IAAI,EAAE,QAAQ,cAAc,CAAC,OAAO,CAAC,GAAG,QAAQ,CAAC;QACpI;IACF;IAEA,qBACE,6bAAC,qIAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,6bAAC,4IAAa;YAAC,WAAU;;8BACvB,6bAAC,2IAAY;;sCACX,6bAAC,0IAAW;sCAAC;;;;;;sCACb,6bAAC,gJAAiB;sCAAC;;;;;;;;;;;;8BAMrB,6bAAC;oBAAI,WAAU;;sCAEb,6bAAC;4BAAI,WAAU;;8CACb,6bAAC;oCAAM,WAAU;8CAAsB;;;;;;8CACvC,6bAAC;oCAAI,WAAU;;sDACb,6bAAC,qIAAM;4CACL,MAAK;4CACL,SAAQ;4CACR,MAAK;4CACL,SAAS,IACP,eAAe,KAAK,GAAG,CAAC,UAAU,cAAc;4CAElD,UAAU,eAAe,YAAY;sDAErC,cAAA,6bAAC,iSAAK;gDAAC,WAAU;;;;;;;;;;;sDAEnB,6bAAC,mIAAK;4CACJ,MAAK;4CACL,KAAK;4CACL,KAAK;4CACL,OAAO;4CACP,UAAU,CAAC;gDACT,MAAM,MAAM,SAAS,EAAE,MAAM,CAAC,KAAK,KAAK;gDACxC,eAAe,KAAK,GAAG,CAAC,UAAU,KAAK,GAAG,CAAC,UAAU;4CACvD;4CACA,WAAU;4CACV,UAAU;;;;;;sDAEZ,6bAAC,qIAAM;4CACL,MAAK;4CACL,SAAQ;4CACR,MAAK;4CACL,SAAS,IACP,eAAe,KAAK,GAAG,CAAC,UAAU,cAAc;4CAElD,UAAU,eAAe,YAAY;sDAErC,cAAA,6bAAC,8RAAI;gDAAC,WAAU;;;;;;;;;;;sDAElB,6bAAC;4CAAK,WAAU;sDACb,eAAe,IACZ,GAAG,aAAa,kBAAkB,CAAC,GACnC,aACE,CAAC,EAAE,EAAE,WAAW,KAAK,CAAC,GACtB,CAAC,CAAC,EAAE,WAAW,OAAO,CAAC;;;;;;;;;;;;8CAGjC,6bAAC;oCAAE,WAAU;;wCAAgC;wCAC1B;wCAAe;wCAAK;wCAAa;;;;;;;;;;;;;wBAKrD,+BACC,6bAAC;4BAAI,WAAU;sCACb,cAAA,6bAAC,gTAAO;gCAAC,WAAU;;;;;;;;;;uEAEnB,WAAW,eAAe,kBAC5B,6bAAC;4BAAI,WAAU;;8CACb,6bAAC;oCAAI,WAAU;;sDACb,6bAAC;sDACE,aAAa,qBAAqB;;;;;;sDAErC,6bAAC;4CAAK,WAAU;sDACb,aAAa,CAAC,CAAC,EAAE,YAAY,GAAG;;;;;;;;;;;;8CAGrC,6bAAC;oCAAI,WAAU;;sDACb,6bAAC;;gDACE,aAAa,oBAAoB;8DAClC,6bAAC;oDAAK,WAAU;;wDAA6B;wDACvC,QAAQ,eAAe,CAAC,OAAO,CAAC;wDAAG;;;;;;;;;;;;;sDAG3C,6bAAC;4CACC,WAAW,CAAC,YAAY,EAAE,aAAa,mBAAmB,IAAI;sDAE7D,aACG,CAAC,CAAC,EAAE,QAAQ,cAAc,CAAC,OAAO,CAAC,IAAI,GACvC,CAAC,EAAE,EAAE,QAAQ,cAAc,CAAC,OAAO,CAAC,IAAI;;;;;;;;;;;;8CAGhD,6bAAC;oCAAI,WAAU;;sDACb,6bAAC;4CAAK,WAAU;sDACb,aAAa,oBAAoB;;;;;;sDAEpC,6bAAC;4CACC,WAAW,CAAC,sBAAsB,EAAE,aAAa,mBAAmB,IAAI;sDAEvE,aACG,CAAC,CAAC,EAAE,QAAQ,QAAQ,CAAC,OAAO,CAAC,IAAI,GACjC,CAAC,EAAE,EAAE,QAAQ,cAAc,CAAC,OAAO,CAAC,IAAI;;;;;;;;;;;;gCAG/C,QAAQ,aAAa,IAAI,4BACxB,6bAAC;oCAAI,WAAU;;sDACb,6bAAC;sDAAK;;;;;;sDACN,6bAAC;sDAAM,QAAQ,aAAa;;;;;;;;;;;;8CAGhC,6bAAC;oCAAI,WAAU;;sDACb,6bAAC;;gDAAK;gDAEH,eAAe,QAAQ,gBAAgB,KACtC,CAAC,EAAE,EAAE,eAAe,QAAQ,gBAAgB,EAAE,CAAC,CAAC;;;;;;;sDAEpD,6bAAC;;gDAAK;gDAAE,QAAQ,iBAAiB,CAAC,OAAO,CAAC;;;;;;;;;;;;;;;;;;uEAG5C;wBAGH,uBACC,6bAAC;4BAAI,WAAU;sCACb,cAAA,6bAAC;gCAAE,WAAU;0CAA0C;;;;;;;;;;;;;;;;;8BAK7D,6bAAC,2IAAY;;sCACX,6bAAC,qIAAM;4BACL,MAAK;4BACL,SAAQ;4BACR,SAAS,IAAM,aAAa;4BAC5B,UAAU;sCACX;;;;;;sCAGD,6bAAC,qIAAM;4BACL,SAAS;4BACT,UACE,cAAc,kBAAkB,CAAC,WAAW,eAAe;sCAG5D,2BACC;;kDACE,6bAAC,gTAAO;wCAAC,WAAU;;;;;;oCAA8B;;+CAInD;;;;;;;;;;;;;;;;;;;;;;;AAOd"}},
    {"offset": {"line": 13299, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/TeamMembersList.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2, Trash2, Plus } from \"lucide-react\";\n\ninterface TeamMember {\n  id: string;\n  userId: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  role: string;\n  createdAt: string;\n  isCurrentUser: boolean;\n}\n\ninterface PendingInvitation {\n  id: string;\n  email: string;\n  role: string;\n  invitedAt: string;\n  expiresAt: string;\n}\n\ninterface TeamMembersListProps {\n  activeTab: \"all\" | \"pending\";\n  filteredMembers: TeamMember[];\n  filteredInvitations: PendingInvitation[];\n  searchQuery: string;\n  removing: string | null;\n  revokingInvite: string | null;\n  actualAvailableSeats: number;\n  isAdmin: boolean;\n  setMemberToRemove: (member: TeamMember) => void;\n  setInviteToRevoke: (invitation: PendingInvitation) => void;\n  setShowInviteDialog: (show: boolean) => void;\n}\n\nexport const TeamMembersList = ({\n  activeTab,\n  filteredMembers,\n  filteredInvitations,\n  searchQuery,\n  removing,\n  revokingInvite,\n  actualAvailableSeats,\n  isAdmin,\n  setMemberToRemove,\n  setInviteToRevoke,\n  setShowInviteDialog,\n}: TeamMembersListProps) => {\n  return (\n    <>\n      {/* Members Table */}\n      {activeTab === \"all\" && (\n        <div className=\"border rounded-lg\">\n          {/* Table Header */}\n          <div\n            className={`grid ${isAdmin ? \"grid-cols-[2fr_2fr_1fr_auto]\" : \"grid-cols-[2fr_2fr_1fr]\"} gap-4 px-4 py-3 border-b bg-muted/50 text-sm font-medium text-muted-foreground`}\n          >\n            <div>Name</div>\n            <div>Email</div>\n            <div>Role</div>\n            {isAdmin && <div className=\"w-8\"></div>}\n          </div>\n\n          {/* Table Body */}\n          {filteredMembers.length === 0 ? (\n            <div className=\"text-center py-12 text-muted-foreground\">\n              {searchQuery ? \"No members found\" : \"No team members yet\"}\n            </div>\n          ) : (\n            <div>\n              {filteredMembers.map((member, index) => (\n                <div\n                  key={member.id}\n                  className={`grid ${isAdmin ? \"grid-cols-[2fr_2fr_1fr_auto]\" : \"grid-cols-[2fr_2fr_1fr]\"} gap-4 px-4 py-3 items-center hover:bg-muted/50 transition-colors ${\n                    index !== filteredMembers.length - 1 ? \"border-b\" : \"\"\n                  }`}\n                >\n                  <div className=\"truncate\">\n                    {member.firstName || member.lastName\n                      ? `${member.firstName} ${member.lastName}`.trim()\n                      : member.email}\n                    {member.isCurrentUser && (\n                      <span className=\"text-muted-foreground ml-1\">(You)</span>\n                    )}\n                  </div>\n                  <div className=\"truncate text-muted-foreground\">\n                    {member.email}\n                  </div>\n                  <div className=\"capitalize\">{member.role}</div>\n                  {isAdmin && (\n                    <div className=\"w-8\">\n                      {!member.isCurrentUser && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => setMemberToRemove(member)}\n                          disabled={removing === member.id}\n                          className=\"h-8 w-8\"\n                        >\n                          {removing === member.id ? (\n                            <Loader2 className=\"h-4 w-4 animate-spin\" />\n                          ) : (\n                            <Trash2 className=\"h-4 w-4\" />\n                          )}\n                        </Button>\n                      )}\n                    </div>\n                  )}\n                </div>\n              ))}\n\n              {/* Invite member row */}\n              {isAdmin && (\n                <button\n                  onClick={() => setShowInviteDialog(true)}\n                  disabled={actualAvailableSeats === 0}\n                  className=\"flex items-center gap-2 px-4 py-3 w-full text-left hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  <Plus className=\"h-4 w-4\" />\n                  <span>Invite member</span>\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Pending Invites Tab */}\n      {activeTab === \"pending\" && isAdmin && (\n        <div className=\"border rounded-lg\">\n          {/* Table Header */}\n          <div className=\"grid grid-cols-[3fr_1fr_auto] gap-4 px-4 py-3 border-b bg-muted/50 text-sm font-medium text-muted-foreground\">\n            <div>Email</div>\n            <div>Invited</div>\n            <div className=\"w-8\"></div>\n          </div>\n\n          {/* Table Body */}\n          {filteredInvitations.length === 0 ? (\n            <div className=\"text-center py-12 text-muted-foreground\">\n              {searchQuery ? \"No invitations found\" : \"No pending invites\"}\n            </div>\n          ) : (\n            <div>\n              {filteredInvitations.map((invitation, index) => (\n                <div\n                  key={invitation.id}\n                  className={`grid grid-cols-[3fr_1fr_auto] gap-4 px-4 py-3 items-center hover:bg-muted/50 transition-colors ${\n                    index !== filteredInvitations.length - 1 ? \"border-b\" : \"\"\n                  }`}\n                >\n                  <div className=\"truncate text-muted-foreground\">\n                    {invitation.email}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    {new Date(invitation.invitedAt).toLocaleDateString()}\n                  </div>\n                  <div className=\"w-8\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => setInviteToRevoke(invitation)}\n                      disabled={revokingInvite === invitation.id}\n                      className=\"h-8 w-8\"\n                    >\n                      {revokingInvite === invitation.id ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <Trash2 className=\"h-4 w-4\" />\n                      )}\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 13590, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/TeamTab.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useGlobalState } from \"@/app/contexts/GlobalState\";\nimport {\n  Loader2,\n  Search,\n  UserPlus,\n  Users,\n  MoreHorizontal,\n  Settings,\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { TeamDialogs, ManageSeatsDialog } from \"./TeamDialogs\";\nimport { TeamMembersList } from \"./TeamMembersList\";\nimport { clientLogout } from \"@/lib/utils/logout\";\n\ninterface TeamMember {\n  id: string;\n  userId: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  role: string;\n  createdAt: string;\n  isCurrentUser: boolean;\n}\n\ninterface PendingInvitation {\n  id: string;\n  email: string;\n  role: string;\n  invitedAt: string;\n  expiresAt: string;\n}\n\ninterface TeamInfo {\n  teamId: string;\n  teamName: string;\n  currentSeats: number;\n  totalSeats: number;\n  availableSeats: number;\n  billingPeriod: \"monthly\" | \"yearly\" | null;\n}\n\nconst TeamTab = () => {\n  const { subscription } = useGlobalState();\n  const [members, setMembers] = useState<TeamMember[]>([]);\n  const [invitations, setInvitations] = useState<PendingInvitation[]>([]);\n  const [teamInfo, setTeamInfo] = useState<TeamInfo | null>(null);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [inviting, setInviting] = useState(false);\n  const [removing, setRemoving] = useState<string | null>(null);\n  const [revokingInvite, setRevokingInvite] = useState<string | null>(null);\n  const [inviteEmail, setInviteEmail] = useState(\"\");\n  const [memberToRemove, setMemberToRemove] = useState<TeamMember | null>(null);\n  const [inviteToRevoke, setInviteToRevoke] =\n    useState<PendingInvitation | null>(null);\n  const [activeTab, setActiveTab] = useState<\"all\" | \"pending\">(\"all\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [showInviteDialog, setShowInviteDialog] = useState(false);\n  const [showManageSeatsDialog, setShowManageSeatsDialog] = useState(false);\n  const [showLeaveDialog, setShowLeaveDialog] = useState(false);\n  const [leaving, setLeaving] = useState(false);\n  const hasFetchedRef = React.useRef(false);\n\n  const fetchMembers = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch(\"/api/team/members\");\n\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch team data\");\n      }\n\n      const data = await response.json();\n      setMembers(data.members || []);\n      setInvitations(data.invitations || []);\n      setTeamInfo(data.teamInfo || null);\n      setIsAdmin(data.isAdmin || false);\n    } catch (err) {\n      toast.error(err instanceof Error ? err.message : \"Failed to load data\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (subscription === \"team\" && !hasFetchedRef.current) {\n      hasFetchedRef.current = true;\n      fetchMembers();\n    }\n  }, [subscription]);\n\n  const handleInvite = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!inviteEmail) {\n      toast.error(\"Please enter an email address\");\n      return;\n    }\n\n    // Basic email validation\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(inviteEmail)) {\n      toast.error(\"Please enter a valid email address\");\n      return;\n    }\n\n    try {\n      setInviting(true);\n      const response = await fetch(\"/api/team/invite\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ email: inviteEmail }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || \"Failed to invite member\");\n      }\n\n      toast.success(\"Member invited successfully!\");\n      setInviteEmail(\"\");\n      setShowInviteDialog(false);\n      fetchMembers();\n    } catch (err) {\n      toast.error(\n        err instanceof Error ? err.message : \"Failed to invite member\",\n      );\n    } finally {\n      setInviting(false);\n    }\n  };\n\n  const filteredMembers = members.filter((member) => {\n    if (!searchQuery) return true;\n    const query = searchQuery.toLowerCase();\n    const firstName = member.firstName || \"\";\n    const lastName = member.lastName || \"\";\n    const name = `${firstName} ${lastName}`.trim().toLowerCase();\n    const email = member.email.toLowerCase();\n    return name.includes(query) || email.includes(query);\n  });\n\n  const filteredInvitations = invitations.filter((invitation) => {\n    if (!searchQuery) return true;\n    const query = searchQuery.toLowerCase();\n    return invitation.email.toLowerCase().includes(query);\n  });\n\n  // Calculate total seats including pending invites\n  const totalUsedSeats = members.length + invitations.length;\n  const actualAvailableSeats = teamInfo\n    ? teamInfo.totalSeats - totalUsedSeats\n    : 0;\n\n  const handleRemove = async () => {\n    if (!memberToRemove) return;\n\n    try {\n      setRemoving(memberToRemove.id);\n      const response = await fetch(\n        `/api/team/members?id=${memberToRemove.id}`,\n        {\n          method: \"DELETE\",\n        },\n      );\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || \"Failed to remove member\");\n      }\n\n      toast.success(\"Member removed successfully!\");\n      setMemberToRemove(null);\n      fetchMembers();\n    } catch (err) {\n      toast.error(\n        err instanceof Error ? err.message : \"Failed to remove member\",\n      );\n    } finally {\n      setRemoving(null);\n    }\n  };\n\n  const handleRevokeInvite = async () => {\n    if (!inviteToRevoke) return;\n\n    try {\n      setRevokingInvite(inviteToRevoke.id);\n      const response = await fetch(`/api/team/invite?id=${inviteToRevoke.id}`, {\n        method: \"DELETE\",\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || \"Failed to revoke invitation\");\n      }\n\n      toast.success(\"Invitation revoked successfully!\");\n      setInviteToRevoke(null);\n      fetchMembers();\n    } catch (err) {\n      toast.error(\n        err instanceof Error ? err.message : \"Failed to revoke invitation\",\n      );\n    } finally {\n      setRevokingInvite(null);\n    }\n  };\n\n  const handleLeaveTeam = async () => {\n    try {\n      setLeaving(true);\n\n      // Find current user's membership ID\n      const currentUserMembership = members.find((m) => m.isCurrentUser);\n      if (!currentUserMembership) {\n        throw new Error(\"Could not find your membership\");\n      }\n\n      const response = await fetch(\n        `/api/team/members?id=${currentUserMembership.id}`,\n        {\n          method: \"DELETE\",\n        },\n      );\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || \"Failed to leave team\");\n      }\n\n      toast.success(\"You have left the team. Logging out...\");\n      setShowLeaveDialog(false);\n\n      // Log out the user to refresh their session\n      clientLogout();\n    } catch (err) {\n      toast.error(err instanceof Error ? err.message : \"Failed to leave team\");\n      setLeaving(false);\n    }\n  };\n\n  if (subscription !== \"team\") {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"text-center py-8\">\n          <Users className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n          <p className=\"text-muted-foreground\">\n            Team management is only available for Team plan subscribers.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-8\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n        </div>\n      ) : (\n        <>\n          {/* Header */}\n          <div className=\"flex items-start justify-between\">\n            <div className=\"space-y-1\">\n              <h2 className=\"text-2xl font-semibold\">Members</h2>\n              <p className=\"text-sm text-muted-foreground\">\n                {teamInfo ? (\n                  <>\n                    Team  {members.length}{\" \"}\n                    {members.length === 1 ? \"member\" : \"members\"}\n                    {invitations.length > 0 &&\n                      `  ${invitations.length} pending`}\n                  </>\n                ) : (\n                  \"Team\"\n                )}\n              </p>\n            </div>\n            {!isAdmin && (\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowLeaveDialog(true)}\n                className=\"text-destructive hover:text-destructive\"\n              >\n                Leave team\n              </Button>\n            )}\n          </div>\n\n          {/* Tabs and Actions */}\n          <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant={activeTab === \"all\" ? \"secondary\" : \"ghost\"}\n                size=\"sm\"\n                onClick={() => setActiveTab(\"all\")}\n                className=\"rounded-md\"\n              >\n                All members\n              </Button>\n              {isAdmin && (\n                <Button\n                  variant={activeTab === \"pending\" ? \"secondary\" : \"ghost\"}\n                  size=\"sm\"\n                  onClick={() => setActiveTab(\"pending\")}\n                  className=\"rounded-md\"\n                >\n                  Pending invites\n                </Button>\n              )}\n            </div>\n\n            <div className=\"flex items-center gap-2 flex-1 max-w-md\">\n              <div className=\"relative flex-1\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  type=\"text\"\n                  placeholder=\"Search\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9\"\n                />\n              </div>\n              {isAdmin && (\n                <>\n                  <Button\n                    onClick={() => setShowInviteDialog(true)}\n                    disabled={actualAvailableSeats === 0}\n                    className=\"gap-2\"\n                  >\n                    <UserPlus className=\"h-4 w-4\" />\n                    Invite member\n                  </Button>\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreHorizontal className=\"h-4 w-4\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuItem\n                        onClick={() => setShowManageSeatsDialog(true)}\n                      >\n                        <Settings className=\"h-4 w-4 mr-2\" />\n                        Manage seats\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </>\n              )}\n            </div>\n          </div>\n\n          {/* Members and Invitations Lists */}\n          <TeamMembersList\n            activeTab={activeTab}\n            filteredMembers={filteredMembers}\n            filteredInvitations={filteredInvitations}\n            searchQuery={searchQuery}\n            removing={removing}\n            revokingInvite={revokingInvite}\n            actualAvailableSeats={actualAvailableSeats}\n            isAdmin={isAdmin}\n            setMemberToRemove={setMemberToRemove}\n            setInviteToRevoke={setInviteToRevoke}\n            setShowInviteDialog={setShowInviteDialog}\n          />\n\n          {/* Seat limit info */}\n          {teamInfo && isAdmin && (\n            <div className=\"text-sm text-muted-foreground\">\n              {actualAvailableSeats > 0 ? (\n                <span>\n                  {actualAvailableSeats} seat\n                  {actualAvailableSeats !== 1 ? \"s\" : \"\"} available of{\" \"}\n                  {teamInfo.totalSeats}\n                  {invitations.length > 0 &&\n                    ` (${invitations.length} pending invite${invitations.length !== 1 ? \"s\" : \"\"})`}\n                </span>\n              ) : (\n                <span>\n                  {totalUsedSeats} of {teamInfo.totalSeats} seats in use.\n                </span>\n              )}\n            </div>\n          )}\n        </>\n      )}\n\n      <TeamDialogs\n        showInviteDialog={showInviteDialog}\n        setShowInviteDialog={setShowInviteDialog}\n        inviteEmail={inviteEmail}\n        setInviteEmail={setInviteEmail}\n        inviting={inviting}\n        handleInvite={handleInvite}\n        memberToRemove={memberToRemove}\n        setMemberToRemove={setMemberToRemove}\n        removing={removing}\n        handleRemove={handleRemove}\n        inviteToRevoke={inviteToRevoke}\n        setInviteToRevoke={setInviteToRevoke}\n        revokingInvite={revokingInvite}\n        handleRevokeInvite={handleRevokeInvite}\n        showLeaveDialog={showLeaveDialog}\n        setShowLeaveDialog={setShowLeaveDialog}\n        leaving={leaving}\n        handleLeaveTeam={handleLeaveTeam}\n      />\n\n      <ManageSeatsDialog\n        open={showManageSeatsDialog}\n        onOpenChange={setShowManageSeatsDialog}\n        currentSeats={teamInfo?.totalSeats || 0}\n        totalUsedSeats={totalUsedSeats}\n        onSuccess={() => {\n          toast.success(\"Seats updated successfully!\");\n          fetchMembers();\n        }}\n      />\n    </div>\n  );\n};\n\nexport { TeamTab };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 14144, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/AgentsTab.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"convex/react\";\nimport { api } from \"@/convex/_generated/api\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Circle,\n  Copy,\n  Eye,\n  EyeOff,\n  RefreshCw,\n  AlertTriangle,\n  Terminal,\n  Server,\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { useGlobalState } from \"@/app/contexts/GlobalState\";\nimport type { QueueBehavior } from \"@/types/chat\";\nimport { SandboxSelector } from \"@/app/components/SandboxSelector\";\n\n// Production Convex URL (must match @hackerai/local@latest package)\nconst PRODUCTION_CONVEX_URL = \"https://convex.haiusercontent.com\";\n\n// Add --convex-url flag if running against non-production backend\nconst convexUrlFlag =\n  process.env.NEXT_PUBLIC_CONVEX_URL &&\n  process.env.NEXT_PUBLIC_CONVEX_URL !== PRODUCTION_CONVEX_URL\n    ? ` --convex-url ${process.env.NEXT_PUBLIC_CONVEX_URL}`\n    : \"\";\n\ninterface LocalConnection {\n  connectionId: string;\n  name: string;\n  mode: \"docker\" | \"dangerous\" | \"custom\";\n  imageName?: string;\n  containerId?: string;\n  osInfo?: {\n    platform: string;\n    arch: string;\n    release: string;\n    hostname: string;\n  };\n}\n\ninterface CommandBlockProps {\n  label: string;\n  command: string;\n  onCopy: () => void;\n  warning?: boolean;\n}\n\nconst CommandBlock = ({\n  label,\n  command,\n  onCopy,\n  warning,\n}: CommandBlockProps) => (\n  <div className=\"space-y-1.5\">\n    <div\n      className={`text-xs font-medium flex items-center gap-1.5 ${warning ? \"text-yellow-700 dark:text-yellow-400\" : \"\"}`}\n    >\n      {label}\n      {warning && <AlertTriangle className=\"h-3 w-3\" />}\n    </div>\n    <div className=\"flex gap-2\">\n      <code\n        className={`flex-1 p-2.5 rounded-lg font-mono text-xs overflow-x-auto ${\n          warning\n            ? \"bg-yellow-500/5 border border-yellow-500/20 text-yellow-900 dark:text-yellow-100\"\n            : \"bg-zinc-900 dark:bg-zinc-950 text-zinc-300 dark:text-zinc-400\"\n        }`}\n      >\n        {command}\n      </code>\n      <Button\n        variant=\"outline\"\n        size=\"icon\"\n        className=\"shrink-0 h-9 w-9\"\n        onClick={onCopy}\n      >\n        <Copy className=\"h-4 w-4\" />\n      </Button>\n    </div>\n    {warning && (\n      <p className=\"text-xs text-yellow-600 dark:text-yellow-400\">\n        Commands run directly on host OS - no isolation\n      </p>\n    )}\n  </div>\n);\n\nconst AgentsTab = () => {\n  const {\n    queueBehavior,\n    setQueueBehavior,\n    subscription,\n    sandboxPreference,\n    setSandboxPreference,\n  } = useGlobalState();\n\n  const [showToken, setShowToken] = useState(false);\n  const [token, setToken] = useState<string | null>(null);\n  const [isLoadingToken, setIsLoadingToken] = useState(false);\n\n  const connections = useQuery(api.localSandbox.listConnections);\n  const tokenResult = useMutation(api.localSandbox.getToken);\n  const regenerateToken = useMutation(api.localSandbox.regenerateToken);\n\n  const queueBehaviorOptions: Array<{\n    value: QueueBehavior;\n    label: string;\n  }> = [\n    {\n      value: \"queue\",\n      label: \"Queue after current message\",\n    },\n    {\n      value: \"stop-and-send\",\n      label: \"Stop & send right away\",\n    },\n  ];\n\n  const handleGetToken = async () => {\n    setIsLoadingToken(true);\n    try {\n      const result = await tokenResult();\n      setToken(result.token);\n    } catch (error) {\n      console.error(\"Failed to get token:\", error);\n      toast.error(\"Failed to get token\");\n    } finally {\n      setIsLoadingToken(false);\n    }\n  };\n\n  const handleRegenerateToken = async () => {\n    try {\n      const result = await regenerateToken();\n      setToken(result.token);\n      toast.success(\"Token regenerated successfully\");\n      setShowToken(false);\n    } catch (error) {\n      console.error(\"Failed to regenerate token:\", error);\n      toast.error(\"Failed to regenerate token\");\n    }\n  };\n\n  const handleCopyCommand = (command: string) => {\n    navigator.clipboard.writeText(command);\n    toast.success(\"Command copied to clipboard\");\n  };\n\n  const handleCopyToken = () => {\n    if (token) {\n      navigator.clipboard.writeText(token);\n      toast.success(\"Token copied to clipboard\");\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Queue Messages Section - Only show for Pro/Ultra/Team users */}\n      {subscription !== \"free\" && (\n        <div className=\"space-y-4\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b gap-3\">\n            <div className=\"flex-1\">\n              <div className=\"font-medium\">Queue Messages</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Adjust the default behavior of sending a message while Agent is\n                streaming\n              </div>\n            </div>\n            <Select\n              value={queueBehavior}\n              onValueChange={(value) =>\n                setQueueBehavior(value as QueueBehavior)\n              }\n            >\n              <SelectTrigger className=\"w-full sm:w-auto\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {queueBehaviorOptions.map((option) => (\n                  <SelectItem key={option.value} value={option.value}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b gap-3\">\n            <div className=\"flex-1\">\n              <div className=\"font-medium\">Default execution environment</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Choose the default sandbox environment for Agent mode\n              </div>\n            </div>\n            <div className=\"w-full sm:w-auto\">\n              <SandboxSelector\n                value={sandboxPreference}\n                onChange={setSandboxPreference}\n                disabled={false}\n                size=\"md\"\n              />\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Local Sandbox Setup Section - Only show for Pro/Ultra/Team users */}\n      {subscription !== \"free\" && (\n        <div className=\"space-y-5 pt-2\">\n          {/* Section Header */}\n          <div className=\"flex items-center gap-2 border-b pb-3\">\n            <Server className=\"h-4 w-4 text-muted-foreground\" />\n            <h3 className=\"text-sm font-semibold\">Local Sandbox</h3>\n          </div>\n\n          {/* Active Connections */}\n          <div className=\"space-y-3\">\n            <h4 className=\"text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n              Connections\n            </h4>\n            {connections && connections.length > 0 ? (\n              <div className=\"space-y-2\">\n                {(connections as LocalConnection[]).map((conn) => (\n                  <div\n                    key={conn.connectionId}\n                    className=\"flex items-center gap-3 p-3 bg-muted/50 rounded-lg\"\n                  >\n                    <div className=\"relative\">\n                      <Circle className=\"h-2.5 w-2.5 fill-green-500 text-green-500\" />\n                      <Circle className=\"h-2.5 w-2.5 fill-green-500 text-green-500 absolute inset-0 animate-ping opacity-75\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-medium text-sm\">{conn.name}</div>\n                      <div className=\"text-xs text-muted-foreground truncate\">\n                        {conn.mode === \"docker\"\n                          ? `Docker: ${conn.containerId?.slice(0, 12) || \"unknown\"}`\n                          : `${conn.osInfo?.platform || \"unknown\"} ${conn.osInfo?.arch || \"\"}`}\n                      </div>\n                    </div>\n                    {conn.mode === \"dangerous\" && (\n                      <span className=\"flex items-center gap-1 text-xs text-yellow-600 dark:text-yellow-400 bg-yellow-100 dark:bg-yellow-900/30 px-2 py-0.5 rounded-full\">\n                        <AlertTriangle className=\"h-3 w-3\" />\n                        Dangerous\n                      </span>\n                    )}\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"flex flex-col items-center justify-center py-6 px-4 bg-muted/30 rounded-lg\">\n                <div className=\"h-8 w-8 rounded-full bg-muted flex items-center justify-center mb-2\">\n                  <Server className=\"h-4 w-4 text-muted-foreground\" />\n                </div>\n                <p className=\"text-sm font-medium\">No active connections</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  Connect using the commands below\n                </p>\n              </div>\n            )}\n          </div>\n\n          {/* Token Management */}\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <h4 className=\"text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n                Auth Token\n              </h4>\n              {token && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-6 text-xs text-muted-foreground hover:text-foreground\"\n                  onClick={handleRegenerateToken}\n                >\n                  <RefreshCw className=\"h-3 w-3 mr-1\" />\n                  Regenerate\n                </Button>\n              )}\n            </div>\n\n            {!token ? (\n              <Button\n                onClick={handleGetToken}\n                disabled={isLoadingToken}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"w-full sm:w-auto\"\n              >\n                <Terminal className=\"h-3.5 w-3.5 mr-2\" />\n                {isLoadingToken ? \"Loading...\" : \"Generate Token\"}\n              </Button>\n            ) : (\n              <div className=\"flex gap-2\">\n                <div className=\"flex-1 relative\">\n                  <Input\n                    type={showToken ? \"text\" : \"password\"}\n                    value={token}\n                    readOnly\n                    className=\"font-mono text-xs pr-20 bg-muted/50 border-0\"\n                  />\n                  <div className=\"absolute right-1 top-1/2 -translate-y-1/2 flex gap-0.5\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"h-7 w-7 p-0\"\n                      onClick={() => setShowToken(!showToken)}\n                    >\n                      {showToken ? (\n                        <EyeOff className=\"h-3.5 w-3.5\" />\n                      ) : (\n                        <Eye className=\"h-3.5 w-3.5\" />\n                      )}\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"h-7 w-7 p-0\"\n                      onClick={handleCopyToken}\n                    >\n                      <Copy className=\"h-3.5 w-3.5\" />\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Setup Commands */}\n          <div className=\"space-y-3\">\n            <h4 className=\"text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n              Quick Start\n            </h4>\n\n            <div className=\"space-y-4\">\n              {/* Docker command */}\n              <CommandBlock\n                label=\"Basic (Docker)\"\n                command={`npx @hackerai/local@latest --token ${showToken && token ? token : \"<token>\"} --name \"My Machine\"${convexUrlFlag}`}\n                onCopy={() =>\n                  handleCopyCommand(\n                    `npx @hackerai/local@latest --token ${token || \"YOUR_TOKEN\"} --name \"My Machine\"${convexUrlFlag}`,\n                  )\n                }\n              />\n\n              {/* Kali command */}\n              <CommandBlock\n                label=\"Custom Image (Kali Linux)\"\n                command={`npx @hackerai/local@latest --token ${showToken && token ? token : \"<token>\"} --name \"Kali\" --image kalilinux/kali-rolling${convexUrlFlag}`}\n                onCopy={() =>\n                  handleCopyCommand(\n                    `npx @hackerai/local@latest --token ${token || \"YOUR_TOKEN\"} --name \"Kali\" --image kalilinux/kali-rolling${convexUrlFlag}`,\n                  )\n                }\n              />\n\n              {/* Dangerous mode */}\n              <CommandBlock\n                label=\"Dangerous Mode (No Docker)\"\n                warning\n                command={`npx @hackerai/local@latest --token ${showToken && token ? token : \"<token>\"} --name \"Host\" --dangerous${convexUrlFlag}`}\n                onCopy={() =>\n                  handleCopyCommand(\n                    `npx @hackerai/local@latest --token ${token || \"YOUR_TOKEN\"} --name \"Host\" --dangerous${convexUrlFlag}`,\n                  )\n                }\n              />\n            </div>\n          </div>\n\n          {/* Security Notice - Compact */}\n          <div className=\"flex items-start gap-2 p-3 bg-yellow-500/10 rounded-lg text-xs\">\n            <AlertTriangle className=\"h-4 w-4 text-yellow-600 dark:text-yellow-400 shrink-0 mt-0.5\" />\n            <div className=\"text-yellow-800 dark:text-yellow-200 space-y-1\">\n              <span className=\"font-medium\">Security:</span>{\" \"}\n              <span className=\"text-yellow-700 dark:text-yellow-300\">\n                Docker mode runs in isolation. Dangerous mode has direct OS\n                access. Stop anytime with Ctrl+C.\n              </span>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport { AgentsTab };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 14853, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/SettingsDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport {\n  Settings,\n  X,\n  Shield,\n  CircleUserRound,\n  Database,\n  Users,\n  Infinity,\n} from \"lucide-react\";\nimport { Dialog, DialogContent, DialogTitle } from \"@/components/ui/dialog\";\nimport { ManageMemoriesDialog } from \"@/app/components/ManageMemoriesDialog\";\nimport { CustomizeHackerAIDialog } from \"@/app/components/CustomizeHackerAIDialog\";\nimport { SecurityTab } from \"@/app/components/SecurityTab\";\nimport { PersonalizationTab } from \"@/app/components/PersonalizationTab\";\nimport { AccountTab } from \"@/app/components/AccountTab\";\nimport { DataControlsTab } from \"@/app/components/DataControlsTab\";\nimport { TeamTab } from \"@/app/components/TeamTab\";\nimport { AgentsTab } from \"@/app/components/AgentsTab\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { useGlobalState } from \"@/app/contexts/GlobalState\";\n\ninterface SettingsDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nconst SettingsDialog = ({ open, onOpenChange }: SettingsDialogProps) => {\n  const [activeTab, setActiveTab] = useState(\"Personalization\");\n  const [showCustomizeDialog, setShowCustomizeDialog] = useState(false);\n  const [showMemoriesDialog, setShowMemoriesDialog] = useState(false);\n  const isMobile = useIsMobile();\n  const { subscription } = useGlobalState();\n\n  const baseTabs = [\n    { id: \"Personalization\", label: \"Personalization\", icon: Settings },\n    { id: \"Security\", label: \"Security\", icon: Shield },\n    { id: \"Data controls\", label: \"Data controls\", icon: Database },\n    { id: \"Agents\", label: \"Agents\", icon: Infinity },\n  ];\n\n  const teamTab = { id: \"Team\", label: \"Team\", icon: Users };\n  const accountTab = { id: \"Account\", label: \"Account\", icon: CircleUserRound };\n\n  const tabs =\n    subscription === \"team\"\n      ? [...baseTabs, teamTab, accountTab]\n      : [...baseTabs, accountTab];\n\n  const handleCustomInstructions = () => {\n    setShowCustomizeDialog(true);\n  };\n\n  const handleManageMemories = () => {\n    setShowMemoriesDialog(true);\n  };\n\n  return (\n    <>\n      <Dialog open={open} onOpenChange={onOpenChange}>\n        <DialogContent\n          data-testid=\"settings-dialog\"\n          className=\"w-[380px] max-w-[98%] md:w-[95vw] md:max-w-[920px] max-h-[95%] md:h-[672px] p-0 overflow-hidden rounded-[20px]\"\n          showCloseButton={!isMobile}\n        >\n          {/* Accessibility: Always include DialogTitle */}\n          <DialogTitle className=\"sr-only\">Settings</DialogTitle>\n\n          {isMobile && (\n            <div className=\"relative z-10 p-0\">\n              <div className=\"flex items-center justify-between px-4 py-3 border-b\">\n                <h3 className=\"text-lg font-semibold\">Settings</h3>\n                <div\n                  className=\"flex h-7 w-7 items-center justify-center cursor-pointer rounded-md hover:bg-muted\"\n                  onClick={() => onOpenChange(false)}\n                >\n                  <X className=\"size-5\" />\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div\n            className={`flex ${isMobile ? \"flex-col\" : \"flex-row\"} ${isMobile ? \"h-[80dvh]\" : \"h-[672px]\"} max-h-[90vh] min-h-0`}\n          >\n            {/* Tabs */}\n            <div\n              className={`${isMobile ? \"overflow-x-auto md:overflow-x-visible border-r pb-2 md:pb-0 relative\" : \"md:w-[221px] border-r\"}`}\n            >\n              {!isMobile && (\n                <div className=\"items-center hidden px-5 pt-5 pb-3 md:flex\">\n                  <div className=\"flex\">\n                    {/* Logo space - not adding logo as requested */}\n                  </div>\n                </div>\n              )}\n              <div className=\"relative flex w-full\">\n                <div className=\"flex-1 flex items-start self-stretch px-3 w-full pb-0 border-b md:border-b-0 md:flex-col md:gap-3 md:px-2 max-md:gap-2.5\">\n                  <div className=\"flex md:gap-0.5 gap-2.5 md:flex-col items-start self-stretch flex-wrap md:flex-nowrap\">\n                    {tabs.map((tab) => {\n                      const IconComponent = tab.icon;\n                      return (\n                        <button\n                          key={tab.id}\n                          data-testid={`settings-tab-${tab.id.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                          type=\"button\"\n                          onClick={() => setActiveTab(tab.id)}\n                          className={`group flex items-center gap-1.5 px-1 py-2 text-sm leading-5 max-md:whitespace-nowrap md:h-12 md:gap-2.5 md:self-stretch md:px-4 md:rounded-lg hover:bg-muted transition-colors ${\n                            activeTab === tab.id\n                              ? `${isMobile ? \"font-medium\" : \"bg-muted font-medium\"}`\n                              : \"\"\n                          } ${isMobile && activeTab === tab.id ? \"relative\" : \"\"}`}\n                        >\n                          {!isMobile && (\n                            <div className=\"flex items-center justify-center\">\n                              <IconComponent className=\"h-5 w-5\" />\n                            </div>\n                          )}\n                          <div className=\"flex min-w-0 grow items-center\">\n                            <div className=\"truncate\">{tab.label}</div>\n                          </div>\n                          {isMobile && activeTab === tab.id && (\n                            <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-foreground\"></div>\n                          )}\n                        </button>\n                      );\n                    })}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Content area */}\n            <div className=\"flex flex-col items-start self-stretch flex-1 overflow-hidden min-h-0\">\n              {!isMobile && (\n                <div className=\"gap-1 items-center px-6 py-5 hidden md:flex self-stretch border-b\">\n                  <h3 className=\"text-lg font-medium\">{activeTab}</h3>\n                </div>\n              )}\n              <div className=\"flex-1 self-stretch items-start overflow-y-auto px-4 pt-4 pb-4 md:px-6 md:pt-4 min-h-0\">\n                {activeTab === \"Personalization\" && (\n                  <PersonalizationTab\n                    onCustomInstructions={handleCustomInstructions}\n                    onManageMemories={handleManageMemories}\n                  />\n                )}\n\n                {activeTab === \"Security\" && <SecurityTab />}\n\n                {activeTab === \"Data controls\" && <DataControlsTab />}\n\n                {activeTab === \"Agents\" && <AgentsTab />}\n\n                {activeTab === \"Team\" && <TeamTab />}\n\n                {activeTab === \"Account\" && <AccountTab />}\n              </div>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Manage Memories Dialog */}\n      <ManageMemoriesDialog\n        open={showMemoriesDialog}\n        onOpenChange={setShowMemoriesDialog}\n      />\n\n      {/* Customize HackerAI Dialog */}\n      <CustomizeHackerAIDialog\n        open={showCustomizeDialog}\n        onOpenChange={setShowCustomizeDialog}\n      />\n    </>\n  );\n};\n\nexport { SettingsDialog };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 15206, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/SidebarUserNav.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport {\n  LogOut,\n  Sparkle,\n  LifeBuoy,\n  Github,\n  ChevronRight,\n  Settings,\n  Settings2,\n  CircleUserRound,\n} from \"lucide-react\";\nimport { useGlobalState } from \"@/app/contexts/GlobalState\";\nimport { redirectToPricing } from \"../hooks/usePricingDialog\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { CustomizeHackerAIDialog } from \"./CustomizeHackerAIDialog\";\nimport { SettingsDialog } from \"./SettingsDialog\";\n\nconst clientLogout = () => {};\n\nconst NEXT_PUBLIC_HELP_CENTER_URL =\n  process.env.NEXT_PUBLIC_HELP_CENTER_URL || \"https://help.hackerai.co/en/\";\n\nconst XIcon = ({ className, ...props }: React.SVGProps<SVGSVGElement>) => (\n  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" className={className} {...props}>\n    <path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\" />\n  </svg>\n);\n\n// Upgrade banner component\nconst UpgradeBanner = ({ isCollapsed }: { isCollapsed: boolean }) => {\n  const { isCheckingProPlan, subscription } = useGlobalState();\n  const isProUser = subscription !== \"free\";\n\n  // Don't show for pro users or while checking\n  if (isCheckingProPlan || isProUser) {\n    return null;\n  }\n\n  const handleUpgrade = () => {\n    redirectToPricing();\n  };\n\n  return (\n    <div className=\"relative\">\n      {!isCollapsed && (\n        <div className=\"relative rounded-t-2xl bg-premium-bg backdrop-blur-sm transition-all duration-200\">\n          <div\n            role=\"button\"\n            tabIndex={0}\n            onClick={handleUpgrade}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\" || e.key === \" \") {\n                e.preventDefault();\n                handleUpgrade();\n              }\n            }}\n            className=\"group relative z-10 flex w-full items-center rounded-t-2xl py-2.5 px-4 text-xs border border-sidebar-border hover:bg-premium-hover transition-all duration-150 focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-1 focus-visible:outline-none cursor-pointer\"\n            aria-label=\"Upgrade your plan\"\n          >\n            <span className=\"flex items-center gap-2.5\">\n              <Sparkle className=\"h-4 w-4 text-premium-text fill-current\" />\n              <span className=\"text-xs font-medium text-premium-text\">\n                Upgrade your plan\n              </span>\n            </span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst SidebarUserNav = ({ isCollapsed = false }: { isCollapsed?: boolean }) => {\n  const {\n    subscription,\n    selectedModel,\n    setSelectedModel,\n    customSystemPrompt,\n    setCustomSystemPrompt,\n  } = useGlobalState();\n\n  const user = { id: \"default-user\", email: \"user@example.com\", firstName: \"Default\", lastName: \"User\" };\n  const [showCustomizeDialog, setShowCustomizeDialog] = useState(false);\n  const [showSettingsDialog, setShowSettingsDialog] = useState(false);\n  const isMobile = useIsMobile();\n\n  // Determine if user has pro subscription\n  const isProUser = subscription !== \"free\";\n\n  const handleLogOut = async () => {\n    // Disabled\n  };\n\n  const handleHelpCenter = () => {\n    const newWindow = window.open(\n      NEXT_PUBLIC_HELP_CENTER_URL,\n      \"_blank\",\n      \"noopener,noreferrer\",\n    );\n    if (newWindow) {\n      newWindow.opener = null;\n    }\n  };\n\n  const handleGitHub = () => {\n    const newWindow = window.open(\n      \"https://github.com/hackerai-tech/hackerai\",\n      \"_blank\",\n      \"noopener,noreferrer\",\n    );\n    if (newWindow) {\n      newWindow.opener = null;\n    }\n  };\n\n  const handleXCom = () => {\n    const newWindow = window.open(\n      \"https://x.com/pentestgpt\",\n      \"_blank\",\n      \"noopener,noreferrer\",\n    );\n    if (newWindow) {\n      newWindow.opener = null;\n    }\n  };\n\n  const getUserInitials = () => {\n    const firstName = user.firstName?.charAt(0)?.toUpperCase() || \"\";\n    const lastName = user.lastName?.charAt(0)?.toUpperCase() || \"\";\n    if (firstName && lastName) {\n      return firstName + lastName;\n    }\n    if (firstName) {\n      return firstName;\n    }\n    if (lastName) {\n      return lastName;\n    }\n    return user.email?.charAt(0)?.toUpperCase() || \"U\";\n  };\n\n  const getDisplayName = () => {\n    if (user.firstName && user.lastName) {\n      return `${user.firstName} ${user.lastName}`;\n    }\n    return user.firstName || user.lastName || \"User\";\n  };\n\n  return (\n    <div className=\"relative\">\n      {/* Upgrade banner above user nav */}\n      <UpgradeBanner isCollapsed={isCollapsed} />\n\n      {/* Upgrade button for collapsed state */}\n      {isCollapsed && !isCheckingProPlan && !isProUser && (\n        <div className=\"mb-1\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  data-testid=\"upgrade-button-collapsed\"\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  className=\"w-full h-8 px-2 bg-premium-bg text-premium-text hover:bg-premium-hover border-0\"\n                  onClick={redirectToPricing}\n                >\n                  <Sparkle className=\"h-4 w-4 fill-current\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent side=\"right\">\n                <p>Upgrade Plan</p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      )}\n\n      <DropdownMenu>\n        <DropdownMenuTrigger asChild>\n          {isCollapsed ? (\n            /* Collapsed state - only show avatar */\n            <div className=\"mb-1\">\n              <button\n                data-testid=\"user-menu-button-collapsed\"\n                type=\"button\"\n                className=\"flex items-center justify-center p-2 cursor-pointer hover:bg-sidebar-accent/50 rounded-md transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 w-full\"\n                aria-haspopup=\"menu\"\n                aria-label={`Open user menu for ${getDisplayName()}`}\n              >\n                <Avatar data-testid=\"user-avatar\" className=\"h-7 w-7\">\n                  <AvatarImage\n                    src={user.profilePictureUrl || undefined}\n                    alt={getDisplayName()}\n                  />\n                  <AvatarFallback className=\"text-xs\">\n                    {getUserInitials()}\n                  </AvatarFallback>\n                </Avatar>\n              </button>\n            </div>\n          ) : (\n            /* Expanded state - show full user info */\n            <button\n              data-testid=\"user-menu-button\"\n              type=\"button\"\n              className=\"flex items-center gap-3 p-3 cursor-pointer hover:bg-sidebar-accent/50 rounded-md transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 w-full text-left\"\n              aria-haspopup=\"menu\"\n              aria-label={`Open user menu for ${getDisplayName()}`}\n            >\n              <Avatar data-testid=\"user-avatar\" className=\"h-7 w-7\">\n                <AvatarImage\n                  src={user.profilePictureUrl || undefined}\n                  alt={getDisplayName()}\n                />\n                <AvatarFallback className=\"text-xs\">\n                  {getUserInitials()}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"text-sm font-medium text-sidebar-foreground truncate\">\n                  {getDisplayName()}\n                </div>\n                <div\n                  data-testid=\"subscription-badge\"\n                  className=\"text-xs text-sidebar-accent-foreground truncate\"\n                >\n                  {subscription === \"ultra\"\n                    ? \"Ultra\"\n                    : subscription === \"team\"\n                      ? \"Team\"\n                      : subscription === \"pro\"\n                        ? \"Pro\"\n                        : \"Free\"}\n                </div>\n              </div>\n            </button>\n          )}\n        </DropdownMenuTrigger>\n\n        <DropdownMenuContent\n          className=\"w-[calc(100%-12px)] rounded-2xl py-1.5\"\n          align=\"start\"\n          side=\"top\"\n          sideOffset={8}\n        >\n          <DropdownMenuLabel className=\"font-normal py-2.5\">\n            <div className=\"flex items-center space-x-2.5\">\n              <CircleUserRound className=\"h-5 w-5 text-muted-foreground flex-shrink-0\" />\n              <p\n                data-testid=\"user-email\"\n                className=\"leading-none text-muted-foreground truncate min-w-0\"\n              >\n                {user.email}\n              </p>\n            </div>\n          </DropdownMenuLabel>\n\n          <DropdownMenuSeparator />\n\n          {subscription === \"pro\" && (\n            <DropdownMenuItem\n              data-testid=\"upgrade-menu-item\"\n              onClick={redirectToPricing}\n              className=\"py-2.5\"\n            >\n              <Sparkle className=\"mr-2.5 h-5 w-5 text-foreground\" />\n              <span>Upgrade Plan</span>\n            </DropdownMenuItem>\n          )}\n\n          <DropdownMenuItem\n            onClick={() => setShowCustomizeDialog(true)}\n            className=\"py-2.5\"\n          >\n            <Settings2 className=\"mr-2.5 h-5 w-5 text-foreground\" />\n            <span>Personalization</span>\n          </DropdownMenuItem>\n\n          <DropdownMenuItem\n            data-testid=\"settings-button\"\n            onClick={() => setShowSettingsDialog(true)}\n            className=\"py-2.5\"\n          >\n            <Settings className=\"mr-2.5 h-5 w-5 text-foreground\" />\n            <span>Settings</span>\n          </DropdownMenuItem>\n\n          <DropdownMenuSeparator />\n\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <DropdownMenuItem className=\"gap-4 cursor-pointer py-2.5\">\n                <LifeBuoy className=\"h-5 w-5 text-foreground\" />\n                <span>Help</span>\n                <ChevronRight className=\"ml-auto h-5 w-5\" />\n              </DropdownMenuItem>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent\n              side={isMobile ? \"top\" : \"right\"}\n              align={isMobile ? \"center\" : \"start\"}\n              sideOffset={isMobile ? 8 : 4}\n              className=\"rounded-2xl\"\n            >\n              <DropdownMenuItem onClick={handleHelpCenter} className=\"py-2.5\">\n                <LifeBuoy className=\"mr-2.5 h-5 w-5 text-foreground\" />\n                <span>Help Center</span>\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={handleGitHub} className=\"py-2.5\">\n                <Github className=\"mr-2.5 h-5 w-5 text-foreground\" />\n                <span>Source Code</span>\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={handleXCom} className=\"py-2.5\">\n                <XIcon className=\"mr-2.5 h-5 w-5 text-foreground\" />\n                <span>Social</span>\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n\n          <DropdownMenuItem\n            data-testid=\"logout-button\"\n            onClick={handleLogOut}\n            className=\"py-2.5\"\n          >\n            <LogOut className=\"mr-2.5 h-5 w-5 text-foreground\" />\n            <span>Log out</span>\n          </DropdownMenuItem>\n        </DropdownMenuContent>\n      </DropdownMenu>\n\n      {/* Settings Dialog */}\n      <SettingsDialog\n        open={showSettingsDialog}\n        onOpenChange={setShowSettingsDialog}\n      />\n\n      {/* Customize HackerAI Dialog */}\n      <CustomizeHackerAIDialog\n        open={showCustomizeDialog}\n        onOpenChange={setShowCustomizeDialog}\n      />\n    </div>\n  );\n};\n\nexport default SidebarUserNav;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 15887, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/ChatItem.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useRef } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { ConvexError } from \"convex/values\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { toast } from \"sonner\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Ellipsis, Trash2, Edit2, Split, Share } from \"lucide-react\";\nimport { useMutation } from \"convex/react\";\nimport { api } from \"@/convex/_generated/api\";\nimport { removeDraft } from \"@/lib/utils/client-storage\";\nimport { ShareDialog } from \"./ShareDialog\";\n\ninterface ChatItemProps {\n  id: string;\n  title: string;\n  isBranched?: boolean;\n  branchedFromTitle?: string;\n  shareId?: string;\n  shareDate?: number;\n}\n\nconst ChatItem: React.FC<ChatItemProps> = ({\n  id,\n  title,\n  isBranched = false,\n  branchedFromTitle,\n  shareId,\n  shareDate,\n}) => {\n  const router = useRouter();\n  const [isHovered, setIsHovered] = useState(false);\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n  const [showRenameDialog, setShowRenameDialog] = useState(false);\n  const [showShareDialog, setShowShareDialog] = useState(false);\n  const [editTitle, setEditTitle] = useState(title);\n  const [isRenaming, setIsRenaming] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const {\n    closeSidebar,\n    setChatSidebarOpen,\n    initializeNewChat,\n    initializeChat,\n    chatTitle: globalChatTitle,\n    currentChatId,\n  } = useGlobalState();\n  const isMobile = useIsMobile();\n  const deleteChat = async () => {};\n  const renameChat = async () => {};\n\n  // Check if this chat is currently active based on URL\n  const isCurrentlyActive = window.location.pathname === `/c/${id}`;\n\n  // Use global state title only for the currently active chat (based on URL, not global state)\n  // to show real-time updates while avoiding flashing the wrong title during navigation\n  const displayTitle =\n    isCurrentlyActive && globalChatTitle ? globalChatTitle : title;\n\n  const handleClick = () => {\n    // Don't navigate if dialog is open or dropdown is open\n    if (showRenameDialog || isDropdownOpen) {\n      return;\n    }\n\n    closeSidebar();\n\n    if (isMobile) {\n      setChatSidebarOpen(false);\n    }\n\n    // Clear input and transient state only when switching to a different chat\n    if (!isCurrentlyActive) {\n      initializeChat(id);\n    }\n\n    // Navigate to the chat route\n    router.push(`/c/${id}`);\n  };\n\n  const [isDeleting, setIsDeleting] = useState(false);\n\n  const handleDelete = async (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (isDeleting) return;\n    setIsDeleting(true);\n\n    try {\n      await deleteChat({ chatId: id });\n\n      // Remove draft from localStorage immediately after successful deletion\n      removeDraft(id);\n\n      // If we're deleting the currently active chat, navigate to home\n      if (isCurrentlyActive) {\n        initializeNewChat();\n        router.push(\"/\");\n      }\n    } catch (error: any) {\n      // Extract error message\n      const errorMessage =\n        error instanceof ConvexError\n          ? (error.data as { message?: string })?.message ||\n            error.message ||\n            \"Failed to delete chat\"\n          : error instanceof Error\n            ? error.message\n            : String(error?.message || error);\n\n      // Treat not found as success, and show other errors\n      if (errorMessage.includes(\"Chat not found\")) {\n        // Even if chat not found in DB, still clean up draft\n        removeDraft(id);\n        if (isCurrentlyActive) {\n          initializeNewChat();\n          router.push(\"/\");\n        }\n      } else {\n        console.error(\"Failed to delete chat:\", error);\n        toast.error(errorMessage);\n      }\n    } finally {\n      setIsDeleting(false);\n    }\n  };\n\n  const handleRename = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // Close dropdown first, then open dialog with a small delay to avoid focus conflicts\n    setIsDropdownOpen(false);\n    setEditTitle(displayTitle); // Set the current title when opening dialog\n\n    // Small delay to ensure dropdown is fully closed before opening dialog\n    setTimeout(() => {\n      setShowRenameDialog(true);\n    }, 50);\n  };\n\n  const handleShare = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // Close dropdown first, then open share dialog\n    setIsDropdownOpen(false);\n\n    // Small delay to ensure dropdown is fully closed before opening dialog\n    setTimeout(() => {\n      setShowShareDialog(true);\n    }, 50);\n  };\n\n  const handleSaveRename = async () => {\n    const trimmedTitle = editTitle.trim();\n\n    // Don't save if title is empty or unchanged\n    if (!trimmedTitle || trimmedTitle === displayTitle) {\n      setShowRenameDialog(false);\n      setEditTitle(displayTitle); // Reset to original title\n      return;\n    }\n\n    try {\n      setIsRenaming(true);\n      await renameChat({ chatId: id, newTitle: trimmedTitle });\n      setShowRenameDialog(false);\n    } catch (error) {\n      console.error(\"Failed to rename chat:\", error);\n      const errorMessage =\n        error instanceof ConvexError\n          ? (error.data as { message?: string })?.message ||\n            error.message ||\n            \"Failed to rename chat\"\n          : error instanceof Error\n            ? error.message\n            : \"Failed to rename chat\";\n      toast.error(errorMessage);\n      setEditTitle(displayTitle); // Reset to original title on error\n    } finally {\n      setIsRenaming(false);\n    }\n  };\n\n  const handleCancelRename = () => {\n    setShowRenameDialog(false);\n    setEditTitle(displayTitle); // Reset to original title\n  };\n\n  const handleInputKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault();\n      handleSaveRename();\n    } else if (e.key === \"Escape\") {\n      e.preventDefault();\n      handleCancelRename();\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    // Don't handle keyboard events if dialog or dropdown is open\n    if (showRenameDialog || isDropdownOpen) return;\n\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault();\n      handleClick();\n    }\n  };\n\n  return (\n    <div\n      className={`group relative flex w-full cursor-pointer items-center rounded-lg p-2 hover:bg-sidebar-accent/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ${\n        isCurrentlyActive\n          ? \"bg-sidebar-accent text-sidebar-accent-foreground\"\n          : \"\"\n      }`}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n      title={displayTitle}\n      role=\"button\"\n      tabIndex={0}\n      aria-label={`Open chat: ${displayTitle}`}\n    >\n      <div\n        className={`mr-2 flex-1 overflow-hidden text-clip whitespace-nowrap text-sm font-medium ${\n          isHovered || isCurrentlyActive || isDropdownOpen || isMobile\n            ? \"[-webkit-mask-image:var(--sidebar-mask-active)] [mask-image:var(--sidebar-mask-active)]\"\n            : \"[-webkit-mask-image:var(--sidebar-mask)] [mask-image:var(--sidebar-mask)]\"\n        }`}\n        dir=\"auto\"\n      >\n        <span className=\"flex items-center gap-1.5\">\n          {isBranched && branchedFromTitle && (\n            <TooltipProvider delayDuration={300}>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Split className=\"size-3 flex-shrink-0 text-muted-foreground\" />\n                </TooltipTrigger>\n                <TooltipContent side=\"right\">\n                  <p className=\"text-xs\">Branched from: {branchedFromTitle}</p>\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n          )}\n          {displayTitle}\n        </span>\n      </div>\n\n      <div\n        className={`absolute right-2 opacity-0 transition-opacity ${\n          isHovered || isCurrentlyActive || isDropdownOpen || isMobile\n            ? \"opacity-100\"\n            : \"\"\n        }`}\n      >\n        <DropdownMenu open={isDropdownOpen} onOpenChange={setIsDropdownOpen}>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-6 w-6 p-0 hover:bg-sidebar-accent\"\n              onClick={(e) => {\n                e.stopPropagation();\n                e.preventDefault();\n              }}\n              aria-label=\"Open conversation options\"\n            >\n              <Ellipsis className=\"h-4 w-4\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent\n            align=\"start\"\n            side=\"bottom\"\n            sideOffset={5}\n            className=\"z-50 py-2\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <DropdownMenuItem onClick={handleRename}>\n              <Edit2 className=\"mr-2 h-4 w-4\" />\n              Rename\n            </DropdownMenuItem>\n            <DropdownMenuItem onClick={handleShare}>\n              <Share className=\"mr-2 h-4 w-4\" />\n              Share\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={handleDelete}\n              className=\"text-destructive focus:text-destructive\"\n            >\n              <Trash2 className=\"mr-2 h-4 w-4\" />\n              Delete\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      {/* Rename Dialog */}\n      <Dialog open={showRenameDialog} onOpenChange={setShowRenameDialog}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>Rename Chat</DialogTitle>\n            <DialogDescription>\n              Enter a new name for this chat conversation.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <Input\n              ref={inputRef}\n              value={editTitle}\n              onChange={(e) => setEditTitle(e.target.value)}\n              onKeyDown={handleInputKeyDown}\n              disabled={isRenaming}\n              placeholder=\"Chat name\"\n              maxLength={100}\n              className=\"w-full\"\n              autoFocus\n            />\n          </div>\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={handleCancelRename}\n              disabled={isRenaming}\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"button\"\n              onClick={handleSaveRename}\n              disabled={isRenaming || !editTitle.trim()}\n            >\n              {isRenaming ? \"Saving...\" : \"Save\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Share Dialog */}\n      <ShareDialog\n        open={showShareDialog}\n        onOpenChange={setShowShareDialog}\n        chatId={id}\n        chatTitle={displayTitle}\n        existingShareId={shareId}\n        existingShareDate={shareDate}\n      />\n    </div>\n  );\n};\n\nexport default ChatItem;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 16370, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/SidebarHistory.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { MessageSquare } from \"lucide-react\";\nimport ChatItem from \"./ChatItem\";\nimport Loading from \"@/components/ui/loading\";\n\ninterface SidebarHistoryProps {\n  chats: any[];\n  paginationStatus?:\n    | \"LoadingFirstPage\"\n    | \"CanLoadMore\"\n    | \"LoadingMore\"\n    | \"Exhausted\";\n  loadMore?: (numItems: number) => void;\n  containerRef?: React.RefObject<HTMLDivElement | null>;\n}\n\nconst SidebarHistory: React.FC<SidebarHistoryProps> = ({\n  chats,\n  paginationStatus,\n  loadMore,\n  containerRef,\n}) => {\n  // Handle scroll to load more chats when scrolling to bottom\n  React.useEffect(() => {\n    const handleScroll = () => {\n      if (\n        !containerRef?.current ||\n        !loadMore ||\n        paginationStatus !== \"CanLoadMore\"\n      ) {\n        return;\n      }\n\n      const { scrollTop, scrollHeight, clientHeight } = containerRef.current;\n\n      // Check if we're near the bottom (within 100px)\n      if (scrollTop + clientHeight >= scrollHeight - 100) {\n        loadMore(28); // Load 28 more chats\n      }\n    };\n\n    const container = containerRef?.current;\n    if (container) {\n      container.addEventListener(\"scroll\", handleScroll);\n      return () => container.removeEventListener(\"scroll\", handleScroll);\n    }\n  }, [containerRef, loadMore, paginationStatus]);\n\n  if (paginationStatus === \"LoadingFirstPage\") {\n    // Loading state\n    return (\n      <div className=\"p-2\">\n        <div className=\"space-y-3\">\n          {[...Array(5)].map((_, i) => (\n            <div key={i} className=\"animate-pulse\">\n              <div className=\"h-4 bg-sidebar-accent rounded w-3/4 mb-2\"></div>\n              <div className=\"h-3 bg-sidebar-accent rounded w-1/2\"></div>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (!chats || chats.length === 0) {\n    // Empty state\n    return (\n      <div className=\"flex flex-col items-center justify-center h-full p-6 text-center\">\n        <MessageSquare className=\"w-12 h-12 text-sidebar-accent-foreground mb-4\" />\n        <h3 className=\"text-lg font-medium text-sidebar-foreground mb-2\">\n          No chats yet\n        </h3>\n        <p className=\"text-sm text-sidebar-accent-foreground mb-4\">\n          Start a conversation to see your chat history here\n        </p>\n      </div>\n    );\n  }\n\n  // Chat list with buttons (same for mobile and desktop)\n  return (\n    <div className=\"p-2 space-y-1\">\n      {chats.map((chat: any) => (\n        <ChatItem\n          key={chat._id}\n          id={chat.id}\n          title={chat.title}\n          isBranched={!!chat.branched_from_chat_id}\n          branchedFromTitle={chat.branched_from_title}\n          shareId={chat.share_id}\n          shareDate={chat.share_date}\n        />\n      ))}\n\n      {/* Loading indicator when loading more */}\n      {paginationStatus === \"LoadingMore\" && (\n        <div className=\"flex justify-center py-2\">\n          <Loading size={6} />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SidebarHistory;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;;;AALA;;;;;;AAkBA,MAAM,iBAAgD,CAAC,EACrD,KAAK,EACL,gBAAgB,EAChB,QAAQ,EACR,YAAY,EACb;IACC,4DAA4D;IAC5D,+ZAAK,CAAC,SAAS,CAAC;QACd,MAAM,eAAe;YACnB,IACE,CAAC,cAAc,WACf,CAAC,YACD,qBAAqB,eACrB;gBACA;YACF;YAEA,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE,YAAY,EAAE,GAAG,aAAa,OAAO;YAEtE,gDAAgD;YAChD,IAAI,YAAY,gBAAgB,eAAe,KAAK;gBAClD,SAAS,KAAK,qBAAqB;YACrC;QACF;QAEA,MAAM,YAAY,cAAc;QAChC,IAAI,WAAW;YACb,UAAU,gBAAgB,CAAC,UAAU;YACrC,OAAO,IAAM,UAAU,mBAAmB,CAAC,UAAU;QACvD;IACF,GAAG;QAAC;QAAc;QAAU;KAAiB;IAE7C,IAAI,qBAAqB,oBAAoB;QAC3C,gBAAgB;QAChB,qBACE,6bAAC;YAAI,WAAU;sBACb,cAAA,6bAAC;gBAAI,WAAU;0BACZ;uBAAI,MAAM;iBAAG,CAAC,GAAG,CAAC,CAAC,GAAG,kBACrB,6bAAC;wBAAY,WAAU;;0CACrB,6bAAC;gCAAI,WAAU;;;;;;0CACf,6bAAC;gCAAI,WAAU;;;;;;;uBAFP;;;;;;;;;;;;;;;IAQpB;IAEA,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,GAAG;QAChC,cAAc;QACd,qBACE,6bAAC;YAAI,WAAU;;8BACb,6bAAC,6TAAa;oBAAC,WAAU;;;;;;8BACzB,6bAAC;oBAAG,WAAU;8BAAmD;;;;;;8BAGjE,6bAAC;oBAAE,WAAU;8BAA8C;;;;;;;;;;;;IAKjE;IAEA,uDAAuD;IACvD,qBACE,6bAAC;QAAI,WAAU;;YACZ,MAAM,GAAG,CAAC,CAAC,qBACV,6bAAC,yIAAQ;oBAEP,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,YAAY,CAAC,CAAC,KAAK,qBAAqB;oBACxC,mBAAmB,KAAK,mBAAmB;oBAC3C,SAAS,KAAK,QAAQ;oBACtB,WAAW,KAAK,UAAU;mBANrB,KAAK,GAAG;;;;;YAWhB,qBAAqB,+BACpB,6bAAC;gBAAI,WAAU;0BACb,cAAA,6bAAC,uIAAO;oBAAC,MAAM;;;;;;;;;;;;;;;;;AAKzB;uCAEe"}},
    {"offset": {"line": 16532, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/SidebarHeader.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useMemo, FC } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  PanelLeft,\n  Sidebar as SidebarIcon,\n  SquarePen,\n  Search,\n} from \"lucide-react\";\nimport { useSidebar } from \"@/components/ui/sidebar\";\nimport { HackerAISVG } from \"@/components/icons/hackerai-svg\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { useChats } from \"../hooks/useChats\";\n\ninterface SidebarHeaderContentProps {\n  /** Function to handle closing the sidebar */\n  handleCloseSidebar: () => void;\n  /** Whether the sidebar is collapsed */\n  isCollapsed: boolean;\n  /** Whether this is being used in mobile overlay (without SidebarProvider) */\n  isMobileOverlay?: boolean;\n}\n\n// Shared implementation component\ninterface SidebarHeaderContentImplProps {\n  handleCloseSidebar: () => void;\n  isCollapsed: boolean;\n  toggleSidebar: () => void;\n}\n\nconst SidebarHeaderContentImpl: FC<SidebarHeaderContentImplProps> = ({\n  handleCloseSidebar,\n  isCollapsed,\n  toggleSidebar,\n}) => {\n  const isMobile = useIsMobile();\n  const router = useRouter();\n  const {\n    setChatSidebarOpen,\n    closeSidebar,\n    initializeNewChat,\n    setTemporaryChatsEnabled,\n  } = useGlobalState();\n\n  // Search dialog state\n  const [isSearchOpen, setIsSearchOpen] = useState(false);\n\n  // Hover state for search button\n  const [isSearchHovered, setIsSearchHovered] = useState(false);\n\n  // Fetch chats when search dialog is opened to ensure data is available\n  // This handles the case where user opens search without opening sidebar first\n  useChats(isSearchOpen);\n\n  // Detect if user is on Mac\n  const isMac = useMemo(\n    () => /macintosh|mac os x/i.test(navigator.userAgent),\n    [],\n  );\n\n  // Platform-specific modifier key\n  const modifierKey = isMac ? \"\" : \"Ctrl+\";\n\n  // Add keyboard shortcut for search (Cmd/Ctrl + K)\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if ((e.metaKey || e.ctrlKey) && e.key === \"k\") {\n        e.preventDefault();\n        setIsSearchOpen(true);\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => {\n      document.removeEventListener(\"keydown\", handleKeyDown);\n    };\n  }, []);\n\n  const handleNewChat = () => {\n    // Close computer sidebar when creating new chat\n    closeSidebar();\n\n    // Close chat sidebar when creating new chat on mobile screens\n    // On desktop, keep it open for better UX on large screens\n    // On mobile screens, close it to give more space for the chat\n    if (isMobile) {\n      setChatSidebarOpen(false);\n    }\n\n    // Initialize new chat state using global state function\n    initializeNewChat();\n\n    // Always disable temporary chat for a new chat\n    setTemporaryChatsEnabled(false);\n    router.push(\"/\");\n  };\n\n  const handleSearchOpen = () => {\n    setIsSearchOpen(true);\n  };\n\n  const handleSearchClose = () => {\n    setIsSearchOpen(false);\n  };\n\n  if (isCollapsed) {\n    return (\n      <>\n        <div className=\"flex flex-col items-center p-2\">\n          {/* HackerAI Logo with hover sidebar toggle */}\n          <div\n            data-testid=\"sidebar-toggle\"\n            className=\"relative flex items-center justify-center mb-2 cursor-pointer focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded\"\n            onClick={toggleSidebar}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\" || e.key === \" \") {\n                if (e.key === \" \") {\n                  e.preventDefault();\n                }\n                toggleSidebar();\n              }\n            }}\n            tabIndex={0}\n            role=\"button\"\n            aria-label=\"Expand sidebar\"\n          >\n            <HackerAISVG theme=\"dark\" scale={0.12} />\n            {/* Sidebar icon shown on hover over entire collapsed sidebar */}\n            <div className=\"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-sidebar/80 rounded\">\n              <SidebarIcon className=\"w-5 h-5\" />\n            </div>\n          </div>\n\n          {/* Sidebar Actions - Collapsed */}\n          <div className=\"flex flex-col items-center\">\n            {/* New Chat Button - Collapsed */}\n            <div className=\"p-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-8 w-8 p-0 hover:bg-sidebar-accent/50\"\n                onClick={handleNewChat}\n                aria-label=\"Start new chat\"\n              >\n                <SquarePen className=\"w-4 h-4\" />\n              </Button>\n            </div>\n\n            {/* Search Button - Collapsed */}\n            <div className=\"p-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-8 w-8 p-0 hover:bg-sidebar-accent/50\"\n                onClick={handleSearchOpen}\n                aria-label=\"Search chats\"\n                onMouseEnter={() => setIsSearchHovered(true)}\n                onMouseLeave={() => setIsSearchHovered(false)}\n              >\n                <Search className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"flex items-center justify-between p-2\">\n        <div className=\"flex items-center gap-2\">\n          {/* Show close button on mobile or desktop when expanded */}\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"h-8 w-8 p-0\"\n            onClick={handleCloseSidebar}\n          >\n            <PanelLeft className=\"size-5\" />\n          </Button>\n        </div>\n      </div>\n\n      {/* Sidebar Actions - Expanded */}\n      <div className=\"flex flex-col\">\n        {/* New Chat Button styled like a chat item */}\n        <div className=\"px-2 py-1\">\n          <Button\n            variant=\"ghost\"\n            className=\"group relative flex w-full justify-start items-center rounded-lg p-2 h-auto hover:bg-sidebar-accent/50 text-left\"\n            onClick={handleNewChat}\n            aria-label=\"Start new chat\"\n          >\n            <SquarePen className=\"w-4 h-4\" />\n            <div className=\"mr-2 flex-1 overflow-hidden text-clip whitespace-nowrap text-sm font-medium text-left\">\n              New chat\n            </div>\n          </Button>\n        </div>\n\n        {/* Search Button styled like a chat item */}\n        <div className=\"px-2 py-1\">\n          <Button\n            variant=\"ghost\"\n            className=\"relative flex w-full justify-start items-center rounded-lg p-2 h-auto hover:bg-sidebar-accent/50 text-left\"\n            onClick={handleSearchOpen}\n            aria-label=\"Search chats\"\n            onMouseEnter={() => setIsSearchHovered(true)}\n            onMouseLeave={() => setIsSearchHovered(false)}\n          >\n            <Search className=\"w-4 h-4\" />\n            <div className=\"mr-2 flex-1 overflow-hidden text-clip whitespace-nowrap text-sm font-medium text-left\">\n              Search chats\n            </div>\n            {/* Only show shortcut when hovering directly on the search button */}\n            <div\n              className={`text-xs transition-opacity ${\n                isSearchHovered ? \"opacity-100\" : \"opacity-0\"\n              }`}\n            >\n              {modifierKey}K\n            </div>\n          </Button>\n        </div>\n      </div>\n    </>\n  );\n};\n\n// Desktop sidebar header component (requires SidebarProvider)\nconst DesktopSidebarHeaderContent: FC<\n  Omit<SidebarHeaderContentProps, \"isMobileOverlay\">\n> = ({ handleCloseSidebar, isCollapsed }) => {\n  const { toggleSidebar } = useSidebar();\n  return (\n    <SidebarHeaderContentImpl\n      handleCloseSidebar={handleCloseSidebar}\n      isCollapsed={isCollapsed}\n      toggleSidebar={toggleSidebar}\n    />\n  );\n};\n\n// Mobile sidebar header component (doesn't use SidebarProvider)\nconst MobileSidebarHeaderContent: FC<\n  Omit<SidebarHeaderContentProps, \"isMobileOverlay\">\n> = ({ handleCloseSidebar, isCollapsed }) => {\n  const toggleSidebar = () => {}; // No-op for mobile\n  return (\n    <SidebarHeaderContentImpl\n      handleCloseSidebar={handleCloseSidebar}\n      isCollapsed={isCollapsed}\n      toggleSidebar={toggleSidebar}\n    />\n  );\n};\n\n// Main component that conditionally renders based on context\nconst SidebarHeaderContent: FC<SidebarHeaderContentProps> = ({\n  handleCloseSidebar,\n  isCollapsed,\n  isMobileOverlay = false,\n}) => {\n  if (isMobileOverlay) {\n    return (\n      <MobileSidebarHeaderContent\n        handleCloseSidebar={handleCloseSidebar}\n        isCollapsed={isCollapsed}\n      />\n    );\n  }\n\n  return (\n    <DesktopSidebarHeaderContent\n      handleCloseSidebar={handleCloseSidebar}\n      isCollapsed={isCollapsed}\n    />\n  );\n};\n\nexport default SidebarHeaderContent;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 16907, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/Sidebar.tsx"],"sourcesContent":["\"use client\";\n\nimport { FC, useRef } from \"react\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { useChats } from \"../hooks/useChats\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarHeader,\n  SidebarRail,\n  useSidebar,\n} from \"@/components/ui/sidebar\";\nimport SidebarUserNav from \"./SidebarUserNav\";\nimport SidebarHistory from \"./SidebarHistory\";\nimport SidebarHeaderContent from \"./SidebarHeader\";\n\n// ChatList component content\nconst ChatListContent: FC = () => {\n  // Create ref for scroll container\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n\n  // Get user's chats with pagination using the shared hook\n  const paginatedChats = useChats();\n\n  return (\n    <div className={`h-full overflow-y-auto`} ref={scrollContainerRef}>\n      <SidebarHistory\n        chats={paginatedChats.results || []}\n        paginationStatus={paginatedChats.status}\n        loadMore={paginatedChats.loadMore}\n        containerRef={scrollContainerRef}\n      />\n    </div>\n  );\n};\n\n// Desktop-only sidebar content (requires SidebarProvider context)\nconst DesktopSidebarContent: FC<{\n  isMobile: boolean;\n  handleCloseSidebar: () => void;\n}> = ({ isMobile, handleCloseSidebar }) => {\n  const { state } = useSidebar();\n  const isCollapsed = state === \"collapsed\";\n\n  return (\n    <Sidebar\n      side=\"left\"\n      collapsible=\"icon\"\n      className={`${isMobile ? \"w-full\" : \"w-72\"}`}\n    >\n      <SidebarHeader>\n        <SidebarHeaderContent\n          handleCloseSidebar={handleCloseSidebar}\n          isCollapsed={isCollapsed}\n        />\n      </SidebarHeader>\n\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupContent>\n            {/* Hide chat list when collapsed */}\n            {!isCollapsed && <ChatListContent />}\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      <SidebarFooter>\n        <SidebarUserNav isCollapsed={isCollapsed} />\n      </SidebarFooter>\n      <SidebarRail />\n    </Sidebar>\n  );\n};\n\nconst MainSidebar: FC<{ isMobileOverlay?: boolean }> = ({\n  isMobileOverlay = false,\n}) => {\n  const isMobile = useIsMobile();\n  const { setChatSidebarOpen } = useGlobalState();\n\n  const handleCloseSidebar = () => {\n    setChatSidebarOpen(false);\n  };\n\n  // Mobile overlay version - simplified without Sidebar wrapper\n  if (isMobileOverlay) {\n    return (\n      <>\n        <div className=\"flex flex-col h-full w-full bg-sidebar border-r\">\n          {/* Header with Actions */}\n          <SidebarHeaderContent\n            handleCloseSidebar={handleCloseSidebar}\n            isCollapsed={false}\n            isMobileOverlay={true}\n          />\n\n          {/* Chat List */}\n          <div className=\"flex-1 overflow-hidden\">\n            <ChatListContent />\n          </div>\n\n          {/* Footer */}\n          <SidebarUserNav isCollapsed={false} />\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <DesktopSidebarContent\n      isMobile={isMobile}\n      handleCloseSidebar={handleCloseSidebar}\n    />\n  );\n};\n\nexport default MainSidebar;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAUA;AACA;AACA;;;;;AAlBA;;;;;;;;;;AAoBA,6BAA6B;AAC7B,MAAM,kBAAsB;IAC1B,kCAAkC;IAClC,MAAM,qBAAqB,IAAA,8ZAAM,EAAiB;IAElD,yDAAyD;IACzD,MAAM,iBAAiB,IAAA,oIAAQ;IAE/B,qBACE,6bAAC;QAAI,WAAW,CAAC,sBAAsB,CAAC;QAAE,KAAK;kBAC7C,cAAA,6bAAC,+IAAc;YACb,OAAO,eAAe,OAAO,IAAI,EAAE;YACnC,kBAAkB,eAAe,MAAM;YACvC,UAAU,eAAe,QAAQ;YACjC,cAAc;;;;;;;;;;;AAItB;AAEA,kEAAkE;AAClE,MAAM,wBAGD,CAAC,EAAE,QAAQ,EAAE,kBAAkB,EAAE;IACpC,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,0IAAU;IAC5B,MAAM,cAAc,UAAU;IAE9B,qBACE,6bAAC,uIAAO;QACN,MAAK;QACL,aAAY;QACZ,WAAW,GAAG,WAAW,WAAW,QAAQ;;0BAE5C,6bAAC,6IAAa;0BACZ,cAAA,6bAAC,8IAAoB;oBACnB,oBAAoB;oBACpB,aAAa;;;;;;;;;;;0BAIjB,6bAAC,8IAAc;0BACb,cAAA,6bAAC,4IAAY;8BACX,cAAA,6bAAC,mJAAmB;kCAEjB,CAAC,6BAAe,6bAAC;;;;;;;;;;;;;;;;;;;;0BAKxB,6bAAC,6IAAa;0BACZ,cAAA,6bAAC,+IAAc;oBAAC,aAAa;;;;;;;;;;;0BAE/B,6bAAC,2IAAW;;;;;;;;;;;AAGlB;AAEA,MAAM,cAAiD,CAAC,EACtD,kBAAkB,KAAK,EACxB;IACC,MAAM,WAAW,IAAA,qIAAW;IAC5B,MAAM,EAAE,kBAAkB,EAAE,GAAG,IAAA,iJAAc;IAE7C,MAAM,qBAAqB;QACzB,mBAAmB;IACrB;IAEA,8DAA8D;IAC9D,IAAI,iBAAiB;QACnB,qBACE;sBACE,cAAA,6bAAC;gBAAI,WAAU;;kCAEb,6bAAC,8IAAoB;wBACnB,oBAAoB;wBACpB,aAAa;wBACb,iBAAiB;;;;;;kCAInB,6bAAC;wBAAI,WAAU;kCACb,cAAA,6bAAC;;;;;;;;;;kCAIH,6bAAC,+IAAc;wBAAC,aAAa;;;;;;;;;;;;;IAIrC;IAEA,qBACE,6bAAC;QACC,UAAU;QACV,oBAAoB;;;;;;AAG1B;uCAEe"}},
    {"offset": {"line": 17095, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/chat.tsx"],"sourcesContent":["\"use client\";\n\nimport { useChat } from \"@ai-sdk/react\";\nimport { DefaultChatTransport } from \"ai\";\nimport { useRef, useEffect, useState } from \"react\";\nimport { FileDetails } from \"@/types/file\";\nimport { Messages } from \"./Messages\";\nimport { ChatInput } from \"./ChatInput\";\nimport { ComputerSidebar } from \"./ComputerSidebar\";\nimport ChatHeader from \"./ChatHeader\";\nimport MainSidebar from \"./Sidebar\";\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\nimport { useMessageScroll } from \"../hooks/useMessageScroll\";\nimport { useChatHandlers } from \"../hooks/useChatHandlers\";\nimport { useGlobalState } from \"../contexts/GlobalState\";\nimport { useFileUpload } from \"../hooks/useFileUpload\";\nimport { useDocumentDragAndDrop } from \"../hooks/useDocumentDragAndDrop\";\nimport { normalizeMessages } from \"@/lib/utils/message-processor\";\nimport { ChatSDKError } from \"@/lib/errors\";\nimport { fetchWithErrorHandlers, convertToUIMessages } from \"@/lib/utils\";\nimport { toast } from \"sonner\";\nimport type { Todo, ChatMessage, ChatMode, SubscriptionTier } from \"@/types\";\nimport { shouldTreatAsMerge } from \"@/lib/utils/todo-utils\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { useAutoResume } from \"../hooks/useAutoResume\";\nimport { useLatestRef } from \"../hooks/useLatestRef\";\nimport { useDataStream } from \"./DataStreamProvider\";\nimport { removeDraft } from \"@/lib/utils/client-storage\";\n\nconst Chat = ({\n  chatId: routeChatId,\n  autoResume,\n}: {\n  chatId?: string;\n  autoResume: boolean;\n}) => {\n  const isMobile = useIsMobile();\n  const { setDataStream, isAutoResuming, setIsAutoResuming } = useDataStream();\n  const [uploadStatus, setUploadStatus] = useState<{\n    message: string;\n    isUploading: boolean;\n  } | null>(null);\n  const [rateLimitWarning, setRateLimitWarning] = useState<{\n    remaining: number;\n    resetTime: Date;\n    mode: ChatMode;\n    subscription: SubscriptionTier;\n  } | null>(null);\n\n  const {\n    chatTitle,\n    setChatTitle,\n    chatMode,\n    setChatMode,\n    sidebarOpen,\n    chatSidebarOpen,\n    setChatSidebarOpen,\n    mergeTodos,\n    setTodos,\n    replaceAssistantTodos,\n    currentChatId,\n    temporaryChatsEnabled,\n    setChatReset,\n    hasUserDismissedRateLimitWarning,\n    setHasUserDismissedRateLimitWarning,\n    messageQueue,\n    dequeueNext,\n    clearQueue,\n    queueBehavior,\n    todos,\n    sandboxPreference,\n    setSandboxPreference,\n    selectedModel,\n    customSystemPrompt,\n  } = useGlobalState();\n\n  const [chatId, setChatId] = useState<string>(() => {\n    return routeChatId || uuidv4();\n  });\n\n  const [isExistingChat, setIsExistingChat] = useState<boolean>(!!routeChatId);\n  const shouldFetchMessages = isExistingChat;\n\n  const isExistingChatRef = useLatestRef(isExistingChat);\n  const chatModeRef = useLatestRef(chatMode);\n\n  const [awaitingServerChat, setAwaitingServerChat] = useState<boolean>(false);\n\n  const [tempChatFileDetails, setTempChatFileDetails] = useState<\n    Map<string, FileDetails[]>\n  >(new Map());\n\n  const temporaryChatsEnabledRef = useLatestRef(temporaryChatsEnabled);\n  const hasUserDismissedWarningRef = useLatestRef(\n    hasUserDismissedRateLimitWarning,\n  );\n  const todosRef = useLatestRef(todos);\n  const sandboxPreferenceRef = useLatestRef(sandboxPreference);\n\n  const hasInitializedModeFromChatRef = useRef(false);\n\n  useEffect(() => {\n    if (currentChatId === null) {\n      if (routeChatId) {\n        return;\n      }\n      setChatId(uuidv4());\n      setIsExistingChat(false);\n      setChatTitle(null);\n      return;\n    }\n\n    if (routeChatId) {\n      setChatId(routeChatId);\n      setIsExistingChat(true);\n      return;\n    }\n  }, [routeChatId, currentChatId, setChatTitle]);\n\n  const paginatedMessages = { results: [], status: \"Exhausted\" as const, loadMore: () => {} };\n  const chatData = null;\n\n  const initialMessages: ChatMessage[] = [];\n\n  const [isProcessingQueue, setIsProcessingQueue] = useState(false);\n  const isSendingNowRef = useRef(false);\n  const hasManuallyStoppedRef = useRef(false);\n\n  const {\n    messages,\n    sendMessage,\n    setMessages,\n    status,\n    stop,\n    error,\n    regenerate,\n    resumeStream,\n  } = useChat({\n    id: chatId,\n    messages: initialMessages,\n    experimental_throttle: 100,\n    generateId: () => uuidv4(),\n\n    transport: new DefaultChatTransport({\n      api: \"/api/chat\",\n      fetch: async (input, init) => {\n        const url =\n          input === \"/api/chat\" && chatModeRef.current === \"agent\"\n            ? \"/api/agent\"\n            : input;\n        return fetchWithErrorHandlers(url, init);\n      },\n      prepareSendMessagesRequest: ({ id, messages, body }) => {\n        const {\n          messages: normalizedMessages,\n          lastMessage,\n          hasChanges,\n        } = normalizeMessages(messages as ChatMessage[]);\n        if (hasChanges) {\n          setMessages(normalizedMessages);\n        }\n\n        const isTemporaryChat =\n          !isExistingChatRef.current && temporaryChatsEnabledRef.current;\n\n        const stripUrlsFromMessages = (msgs: ChatMessage[]): ChatMessage[] => {\n          return msgs.map((msg) => {\n            if (!msg.parts || msg.parts.length === 0) return msg;\n            const strippedParts = msg.parts.map((part: any) => {\n              if (part.type === \"file\" && \"url\" in part) {\n                const { url, ...partWithoutUrl } = part;\n                return partWithoutUrl;\n              }\n              return part;\n            });\n            return {\n              ...msg,\n              parts: strippedParts,\n            };\n          });\n        };\n\n        const messagesToSend = isTemporaryChat\n          ? normalizedMessages\n          : lastMessage;\n        const messagesWithoutUrls = stripUrlsFromMessages(messagesToSend);\n\n        return {\n          body: {\n            chatId: id,\n            messages: messagesWithoutUrls,\n            selectedModel,\n            customSystemPrompt,\n            ...body,\n          },\n        };\n      },\n    }),\n\n    onData: (dataPart) => {\n      setDataStream((ds) => (ds ? [...ds, dataPart] : []));\n      if (dataPart.type === \"data-title\")\n        setChatTitle((dataPart.data as { chatTitle: string }).chatTitle);\n      if (dataPart.type === \"data-upload-status\") {\n        const uploadData = dataPart.data as {\n          message: string;\n          isUploading: boolean;\n        };\n        setUploadStatus(uploadData.isUploading ? uploadData : null);\n      }\n      if (dataPart.type === \"data-rate-limit-warning\") {\n        const warningData = dataPart.data as {\n          remaining: number;\n          resetTime: string;\n          mode: ChatMode;\n          subscription: SubscriptionTier;\n        };\n\n        if (!hasUserDismissedWarningRef.current) {\n          setRateLimitWarning({\n            remaining: warningData.remaining,\n            resetTime: new Date(warningData.resetTime),\n            mode: warningData.mode,\n            subscription: warningData.subscription,\n          });\n        }\n      }\n      if (dataPart.type === \"data-file-metadata\") {\n        const fileData = dataPart.data as {\n          messageId: string;\n          fileDetails: FileDetails[];\n        };\n\n        setTempChatFileDetails((prev) => {\n          const next = new Map(prev);\n          next.set(fileData.messageId, fileData.fileDetails);\n          return next;\n        });\n      }\n      if (dataPart.type === \"data-sandbox-fallback\") {\n        const fallbackData = dataPart.data as {\n          occurred: boolean;\n          reason: \"connection_unavailable\" | \"no_local_connections\";\n          requestedPreference: string;\n          actualSandbox: string;\n          actualSandboxName?: string;\n        };\n\n        setSandboxPreference(fallbackData.actualSandbox);\n\n        const message =\n          fallbackData.reason === \"no_local_connections\"\n            ? `Local sandbox unavailable. Using ${fallbackData.actualSandboxName || \"Cloud\"}.`\n            : `Selected sandbox disconnected. Switched to ${fallbackData.actualSandboxName || \"Cloud\"}.`;\n        toast.info(message, { duration: 5000 });\n      }\n    },\n    onToolCall: ({ toolCall }) => {\n      if (toolCall.toolName === \"todo_write\" && toolCall.input) {\n        const todoInput = toolCall.input as { merge?: boolean; todos: Todo[] };\n        if (!todoInput.todos) return;\n        const lastAssistant = [...messages]\n          .reverse()\n          .find((m) => m.role === \"assistant\");\n        const lastAssistantId = lastAssistant?.id;\n\n        const treatAsMerge = shouldTreatAsMerge(\n          todoInput.merge,\n          todoInput.todos,\n        );\n\n        if (!treatAsMerge) {\n          replaceAssistantTodos(todoInput.todos, lastAssistantId);\n        } else {\n          mergeTodos(todoInput.todos);\n        }\n      }\n    },\n    onFinish: () => {\n      setIsAutoResuming(false);\n      setAwaitingServerChat(false);\n      setUploadStatus(null);\n      const isTemporaryChat =\n        !isExistingChatRef.current && temporaryChatsEnabledRef.current;\n      if (!isExistingChatRef.current && !isTemporaryChat) {\n        setIsExistingChat(true);\n        removeDraft(\"new\");\n      }\n    },\n    onError: (error) => {\n      setIsAutoResuming(false);\n      setAwaitingServerChat(false);\n      setUploadStatus(null);\n      if (error instanceof ChatSDKError && error.type !== \"rate_limit\") {\n        toast.error(error.message);\n      }\n    },\n  });\n\n  useAutoResume({\n    autoResume,\n    initialMessages,\n    resumeStream,\n    setMessages,\n  });\n\n  useEffect(() => {\n    const reset = () => {\n      setMessages([]);\n      setIsExistingChat(false);\n      setChatId(uuidv4());\n      setChatTitle(null);\n      setTodos([]);\n      setAwaitingServerChat(false);\n      setUploadStatus(null);\n    };\n    setChatReset(reset);\n    return () => setChatReset(null);\n  }, [setChatReset, setMessages, setChatTitle, setTodos]);\n\n  useEffect(() => {\n    hasInitializedModeFromChatRef.current = false;\n  }, [chatId]);\n\n  const { scrollRef, contentRef, scrollToBottom, isAtBottom } =\n    useMessageScroll();\n\n  const {\n    handleDragEnter,\n    handleDragLeave,\n    handleDragOver,\n    handleDrop,\n  } = useFileUpload(chatMode);\n\n  useEffect(() => {\n    if (isExistingChat && messages.length > 0) {\n      scrollToBottom({ instant: true, force: true });\n    }\n  }, [messages.length, scrollToBottom, isExistingChat]);\n\n  useEffect(() => {\n    if (\n      status === \"ready\" &&\n      messageQueue.length > 0 &&\n      !isProcessingQueue &&\n      !isSendingNowRef.current &&\n      !hasManuallyStoppedRef.current &&\n      chatMode === \"agent\" &&\n      queueBehavior === \"queue\"\n    ) {\n      setIsProcessingQueue(true);\n      const nextMessage = dequeueNext();\n\n      if (nextMessage) {\n        sendMessage(\n          {\n            text: nextMessage.text,\n            files: nextMessage.files\n              ? nextMessage.files.map((f) => ({\n                  type: \"file\" as const,\n                  filename: f.file.name,\n                  mediaType: f.file.type,\n                  url: f.url,\n                  fileId: f.fileId,\n                }))\n              : undefined,\n          },\n          {\n            body: {\n              mode: chatMode,\n              todos: todosRef.current,\n              temporary: temporaryChatsEnabledRef.current,\n              sandboxPreference: sandboxPreferenceRef.current,\n              selectedModel,\n              customSystemPrompt,\n            },\n          },\n        );\n      }\n\n      setTimeout(() => setIsProcessingQueue(false), 100);\n    }\n  }, [\n    status,\n    messageQueue.length,\n    isProcessingQueue,\n    chatMode,\n    dequeueNext,\n    sendMessage,\n    temporaryChatsEnabledRef,\n    queueBehavior,\n    selectedModel,\n    customSystemPrompt,\n  ]);\n\n  const messageQueueRef = useRef(messageQueue);\n  useEffect(() => {\n    messageQueueRef.current = messageQueue;\n  }, [messageQueue]);\n\n  useEffect(() => {\n    if (chatMode === \"ask\" && messageQueueRef.current.length > 0) {\n      clearQueue();\n    }\n  }, [chatMode, clearQueue]);\n\n  useEffect(() => {\n    return () => {\n      if (messageQueueRef.current.length > 0) {\n        clearQueue();\n      }\n    };\n  }, [chatId, clearQueue]);\n\n  useDocumentDragAndDrop({\n    handleDragEnter,\n    handleDragLeave,\n    handleDragOver,\n    handleDrop,\n  });\n\n  const {\n    handleSubmit,\n    handleStop,\n    handleRegenerate,\n    handleRetry,\n    handleEditMessage,\n    handleSendNow,\n  } = useChatHandlers({\n    chatId,\n    messages,\n    sendMessage,\n    stop,\n    regenerate,\n    setMessages,\n    isExistingChat,\n    activateChatLocally: () => {\n      setIsExistingChat(true);\n      setAwaitingServerChat(true);\n    },\n    status,\n    isSendingNowRef,\n    hasManuallyStoppedRef,\n  });\n\n  const handleScrollToBottom = () => scrollToBottom({ force: true });\n\n  const handleDismissRateLimitWarning = () => {\n    setRateLimitWarning(null);\n    setHasUserDismissedRateLimitWarning(true);\n  };\n\n  const handleBranchMessage = async (messageId: string) => {\n    window.location.href = `/c/${uuidv4()}`;\n  };\n\n  const hasMessages = messages.length > 0;\n  const showChatLayout = hasMessages || isExistingChat;\n\n  const isTempChat = !isExistingChat && temporaryChatsEnabled;\n\n  const isChatNotFound =\n    isExistingChat &&\n    chatData === null &&\n    shouldFetchMessages &&\n    !awaitingServerChat;\n\n  return (\n    <div className=\"h-full bg-background flex flex-col overflow-hidden\">\n      <div className=\"flex w-full h-full overflow-hidden\">\n        {!isMobile && (\n          <div\n            data-testid=\"sidebar\"\n            className={`transition-all duration-300 ${\n              chatSidebarOpen ? \"w-72 flex-shrink-0\" : \"w-12 flex-shrink-0\"\n            }`}\n          >\n            <SidebarProvider\n              open={chatSidebarOpen}\n              onOpenChange={setChatSidebarOpen}\n              defaultOpen={true}\n            >\n              <MainSidebar />\n            </SidebarProvider>\n          </div>\n        )}\n\n        <div className=\"flex flex-1 min-w-0 relative\">\n          <div className=\"flex flex-col flex-1 min-w-0\">\n            <ChatHeader\n              hasMessages={hasMessages}\n              hasActiveChat={isExistingChat}\n              chatTitle={chatTitle || undefined}\n              id={routeChatId}\n              chatData={chatData}\n              chatSidebarOpen={chatSidebarOpen}\n              isExistingChat={isExistingChat}\n              isChatNotFound={isChatNotFound}\n              branchedFromChatTitle={null}\n              chatMode={chatMode}\n              onModeChange={setChatMode}\n            />\n\n            <div\n              ref={scrollRef}\n              className=\"flex-1 overflow-y-auto overflow-x-hidden min-h-0 relative scroll-smooth selection:bg-primary/20\"\n              onDragEnter={handleDragEnter as any}\n              onDragOver={handleDragOver as any}\n              onDrop={handleDrop as any}\n            >\n              <div ref={contentRef} className=\"max-w-4xl mx-auto px-4 py-8\">\n                <Messages\n                  messages={messages}\n                  status={status}\n                  error={error || null}\n                  onRetry={handleRetry}\n                  onRegenerate={handleRegenerate}\n                  onEditMessage={handleEditMessage}\n                  onBranchMessage={handleBranchMessage}\n                  tempChatFileDetails={tempChatFileDetails}\n                />\n              </div>\n\n              {!isAtBottom && hasMessages && (\n                <button\n                  onClick={handleScrollToBottom}\n                  className=\"fixed bottom-32 right-8 p-2 rounded-full bg-background border shadow-lg hover:bg-muted transition-colors z-20\"\n                >\n                  <svg\n                    className=\"w-5 h-5\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M19 14l-7 7m0 0l-7-7m7 7V3\"\n                    />\n                  </svg>\n                </button>\n              )}\n            </div>\n\n            <div className=\"flex-shrink-0 bg-background/80 backdrop-blur-sm border-t p-4 pb-safe\">\n              <div className=\"max-w-4xl mx-auto\">\n                <ChatInput\n                  onSubmit={handleSubmit}\n                  onStop={handleStop}\n                  onSendNow={handleSendNow}\n                  status={status}\n                  rateLimitWarning={rateLimitWarning || undefined}\n                  onDismissRateLimitWarning={handleDismissRateLimitWarning}\n                  chatId={chatId}\n                />\n              </div>\n            </div>\n          </div>\n\n          {!isMobile && sidebarOpen && (\n            <div className=\"w-96 border-l bg-muted/30 overflow-hidden flex flex-col\">\n              <ComputerSidebar />\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};export default Chat;\n"],"names":[],"mappings":"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"}}]
}