{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/errors.ts"],"sourcesContent":["export type ErrorType =\n  | \"bad_request\"\n  | \"unauthorized\"\n  | \"forbidden\"\n  | \"not_found\"\n  | \"rate_limit\"\n  | \"offline\";\n\nexport type Surface =\n  | \"chat\"\n  | \"auth\"\n  | \"api\"\n  | \"stream\"\n  | \"database\"\n  | \"history\"\n  | \"vote\"\n  | \"document\"\n  | \"suggestions\";\n\nexport type ErrorCode = `${ErrorType}:${Surface}`;\n\nexport type ErrorVisibility = \"response\" | \"log\" | \"none\";\n\nexport const visibilityBySurface: Record<Surface, ErrorVisibility> = {\n  database: \"log\",\n  chat: \"response\",\n  auth: \"response\",\n  stream: \"response\",\n  api: \"response\",\n  history: \"response\",\n  vote: \"response\",\n  document: \"response\",\n  suggestions: \"response\",\n};\n\nexport class ChatSDKError extends Error {\n  public type: ErrorType;\n  public surface: Surface;\n  public statusCode: number;\n\n  constructor(errorCode: ErrorCode, cause?: string) {\n    super();\n\n    const [type, surface] = errorCode.split(\":\");\n\n    this.type = type as ErrorType;\n    this.cause = cause;\n    this.surface = surface as Surface;\n    this.message = getMessageByErrorCode(errorCode);\n    this.statusCode = getStatusCodeByType(this.type);\n  }\n\n  public toResponse() {\n    const code: ErrorCode = `${this.type}:${this.surface}`;\n    const visibility = visibilityBySurface[this.surface];\n\n    const { message, cause, statusCode } = this;\n\n    if (visibility === \"log\") {\n      console.error({\n        code,\n        message,\n        cause,\n      });\n\n      return Response.json(\n        { code: \"\", message: \"Something went wrong. Please try again later.\" },\n        { status: statusCode },\n      );\n    }\n\n    return Response.json({ code, message, cause }, { status: statusCode });\n  }\n}\n\nexport function getMessageByErrorCode(errorCode: ErrorCode): string {\n  if (errorCode.includes(\"database\")) {\n    return \"An error occurred while executing a database query.\";\n  }\n\n  switch (errorCode) {\n    case \"bad_request:api\":\n      return \"The request couldn't be processed. Please check your input and try again.\";\n\n    case \"unauthorized:auth\":\n      return \"You need to sign in before continuing.\";\n    case \"forbidden:auth\":\n      return \"Your account does not have access to this feature.\";\n\n    case \"rate_limit:chat\":\n      return \"You have exceeded your maximum number of messages for the day. Please try again later.\";\n    case \"not_found:chat\":\n      return \"The requested chat was not found. Please check the chat ID and try again.\";\n    case \"forbidden:chat\":\n      return \"This chat belongs to another user. Please check the chat ID and try again.\";\n    case \"unauthorized:chat\":\n      return \"You need to sign in to view this chat. Please sign in and try again.\";\n    case \"offline:chat\":\n      return \"We're having trouble sending your message. Please check your internet connection and try again.\";\n\n    case \"not_found:document\":\n      return \"The requested document was not found. Please check the document ID and try again.\";\n    case \"forbidden:document\":\n      return \"This document belongs to another user. Please check the document ID and try again.\";\n    case \"unauthorized:document\":\n      return \"You need to sign in to view this document. Please sign in and try again.\";\n    case \"bad_request:document\":\n      return \"The request to create or update the document was invalid. Please check your input and try again.\";\n\n    default:\n      return \"Something went wrong. Please try again later.\";\n  }\n}\n\nfunction getStatusCodeByType(type: ErrorType) {\n  switch (type) {\n    case \"bad_request\":\n      return 400;\n    case \"unauthorized\":\n      return 401;\n    case \"forbidden\":\n      return 403;\n    case \"not_found\":\n      return 404;\n    case \"rate_limit\":\n      return 429;\n    case \"offline\":\n      return 503;\n    default:\n      return 500;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAuBO,MAAM,sBAAwD;IACnE,UAAU;IACV,MAAM;IACN,MAAM;IACN,QAAQ;IACR,KAAK;IACL,SAAS;IACT,MAAM;IACN,UAAU;IACV,aAAa;AACf;AAEO,MAAM,qBAAqB;IACzB,KAAgB;IAChB,QAAiB;IACjB,WAAmB;IAE1B,YAAY,SAAoB,EAAE,KAAc,CAAE;QAChD,KAAK;QAEL,MAAM,CAAC,MAAM,QAAQ,GAAG,UAAU,KAAK,CAAC;QAExC,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,KAAK,GAAG;QACb,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,OAAO,GAAG,sBAAsB;QACrC,IAAI,CAAC,UAAU,GAAG,oBAAoB,IAAI,CAAC,IAAI;IACjD;IAEO,aAAa;QAClB,MAAM,OAAkB,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,EAAE;QACtD,MAAM,aAAa,mBAAmB,CAAC,IAAI,CAAC,OAAO,CAAC;QAEpD,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,IAAI;QAE3C,IAAI,eAAe,OAAO;YACxB,QAAQ,KAAK,CAAC;gBACZ;gBACA;gBACA;YACF;YAEA,OAAO,SAAS,IAAI,CAClB;gBAAE,MAAM;gBAAI,SAAS;YAAgD,GACrE;gBAAE,QAAQ;YAAW;QAEzB;QAEA,OAAO,SAAS,IAAI,CAAC;YAAE;YAAM;YAAS;QAAM,GAAG;YAAE,QAAQ;QAAW;IACtE;AACF;AAEO,SAAS,sBAAsB,SAAoB;IACxD,IAAI,UAAU,QAAQ,CAAC,aAAa;QAClC,OAAO;IACT;IAEA,OAAQ;QACN,KAAK;YACH,OAAO;QAET,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QAET,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QAET,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QAET;YACE,OAAO;IACX;AACF;AAEA,SAAS,oBAAoB,IAAe;IAC1C,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF"}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\nimport { ChatSDKError, ErrorCode } from \"./errors\";\nimport { ChatMessage } from \"@/types/chat\";\nimport { UIMessagePart } from \"ai\";\nimport { Id } from \"@/convex/_generated/dataModel\";\n\nexport interface MessageRecord {\n  id: string;\n  role: \"user\" | \"assistant\" | \"system\";\n  parts: UIMessagePart<any, any>[];\n  source_message_id?: string;\n  feedback?: {\n    feedbackType: \"positive\" | \"negative\";\n  } | null;\n  fileDetails?: Array<{\n    fileId: Id<\"files\">;\n    name: string;\n    url: string | null;\n  }>;\n}\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\nexport async function fetchWithErrorHandlers(\n  input: RequestInfo | URL,\n  init?: RequestInit,\n) {\n  try {\n    const response = await fetch(input, init);\n\n    if (!response.ok) {\n      const { code, cause } = await response.json();\n      throw new ChatSDKError(code as ErrorCode, cause);\n    }\n\n    return response;\n  } catch (error: unknown) {\n    if (typeof navigator !== \"undefined\" && !navigator.onLine) {\n      throw new ChatSDKError(\"offline:chat\");\n    }\n\n    throw error;\n  }\n}\n\nexport function convertToUIMessages(messages: MessageRecord[]): ChatMessage[] {\n  return messages.map((message) => ({\n    id: message.id,\n    role: message.role,\n    // Sanitize parts: remove any old URLs that may be stored in database\n    // URLs expire, so we always fetch fresh ones via fileId\n    parts: message.parts.map((part: any) => {\n      if (part.type === \"file\" && part.url) {\n        const { url, ...partWithoutUrl } = part;\n        return partWithoutUrl;\n      }\n      return part;\n    }),\n    sourceMessageId: message.source_message_id,\n    metadata: message.feedback\n      ? { feedbackType: message.feedback.feedbackType }\n      : undefined,\n    fileDetails: message.fileDetails,\n  }));\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AAoBO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,uOAAO,EAAC,IAAA,iMAAI,EAAC;AACtB;AAEO,eAAe,uBACpB,KAAwB,EACxB,IAAkB;IAElB,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,OAAO;QAEpC,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI;YAC3C,MAAM,IAAI,gIAAY,CAAC,MAAmB;QAC5C;QAEA,OAAO;IACT,EAAE,OAAO,OAAgB;QACvB,IAAI,OAAO,cAAc,eAAe,CAAC,UAAU,MAAM,EAAE;YACzD,MAAM,IAAI,gIAAY,CAAC;QACzB;QAEA,MAAM;IACR;AACF;AAEO,SAAS,oBAAoB,QAAyB;IAC3D,OAAO,SAAS,GAAG,CAAC,CAAC,UAAY,CAAC;YAChC,IAAI,QAAQ,EAAE;YACd,MAAM,QAAQ,IAAI;YAClB,qEAAqE;YACrE,wDAAwD;YACxD,OAAO,QAAQ,KAAK,CAAC,GAAG,CAAC,CAAC;gBACxB,IAAI,KAAK,IAAI,KAAK,UAAU,KAAK,GAAG,EAAE;oBACpC,MAAM,EAAE,GAAG,EAAE,GAAG,gBAAgB,GAAG;oBACnC,OAAO;gBACT;gBACA,OAAO;YACT;YACA,iBAAiB,QAAQ,iBAAiB;YAC1C,UAAU,QAAQ,QAAQ,GACtB;gBAAE,cAAc,QAAQ,QAAQ,CAAC,YAAY;YAAC,IAC9C;YACJ,aAAa,QAAQ,WAAW;QAClC,CAAC;AACH"}},
    {"offset": {"line": 179, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/components/ui/tooltip.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\";\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction TooltipProvider({\n  delayDuration = 0,\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {\n  return (\n    <TooltipPrimitive.Provider\n      data-slot=\"tooltip-provider\"\n      delayDuration={delayDuration}\n      {...props}\n    />\n  );\n}\n\nfunction Tooltip({\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Root>) {\n  return (\n    <TooltipProvider>\n      <TooltipPrimitive.Root data-slot=\"tooltip\" {...props} />\n    </TooltipProvider>\n  );\n}\n\nfunction TooltipTrigger({\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {\n  return <TooltipPrimitive.Trigger data-slot=\"tooltip-trigger\" {...props} />;\n}\n\nfunction TooltipContent({\n  className,\n  sideOffset = 0,\n  children,\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Content>) {\n  return (\n    <TooltipPrimitive.Portal>\n      <TooltipPrimitive.Content\n        data-slot=\"tooltip-content\"\n        sideOffset={sideOffset}\n        className={cn(\n          \"bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance\",\n          className,\n        )}\n        {...props}\n      >\n        {children}\n        <TooltipPrimitive.Arrow className=\"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]\" />\n      </TooltipPrimitive.Content>\n    </TooltipPrimitive.Portal>\n  );\n}\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };\n"],"names":[],"mappings":";;;;;;;;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,gBAAgB,EACvB,gBAAgB,CAAC,EACjB,GAAG,OACoD;IACvD,qBACE,4YAAC,mYAAyB;QACxB,aAAU;QACV,eAAe;QACd,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,QAAQ,EACf,GAAG,OACgD;IACnD,qBACE,4YAAC;kBACC,cAAA,4YAAC,+XAAqB;YAAC,aAAU;YAAW,GAAG,KAAK;;;;;;;;;;;AAG1D;MARS;AAUT,SAAS,eAAe,EACtB,GAAG,OACmD;IACtD,qBAAO,4YAAC,kYAAwB;QAAC,aAAU;QAAmB,GAAG,KAAK;;;;;;AACxE;MAJS;AAMT,SAAS,eAAe,EACtB,SAAS,EACT,aAAa,CAAC,EACd,QAAQ,EACR,GAAG,OACmD;IACtD,qBACE,4YAAC,iYAAuB;kBACtB,cAAA,4YAAC,kYAAwB;YACvB,aAAU;YACV,YAAY;YACZ,WAAW,IAAA,qHAAE,EACX,0aACA;YAED,GAAG,KAAK;;gBAER;8BACD,4YAAC,gYAAsB;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAI1C;MAtBS"}},
    {"offset": {"line": 278, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/hooks/use-mobile.ts"],"sourcesContent":["import * as React from \"react\";\n\nconst MOBILE_BREAKPOINT = 768;\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(\n    undefined,\n  );\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);\n    };\n    mql.addEventListener(\"change\", onChange);\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);\n    return () => mql.removeEventListener(\"change\", onChange);\n  }, []);\n\n  return !!isMobile;\n}\n"],"names":[],"mappings":";;;;AAAA;;;AAEA,MAAM,oBAAoB;AAEnB,SAAS;;IACd,MAAM,CAAC,UAAU,YAAY,GAAG,wXAAc,CAC5C;IAGF,yXAAe;iCAAC;YACd,MAAM,MAAM,OAAO,UAAU,CAAC,CAAC,YAAY,EAAE,oBAAoB,EAAE,GAAG,CAAC;YACvE,MAAM;kDAAW;oBACf,YAAY,OAAO,UAAU,GAAG;gBAClC;;YACA,IAAI,gBAAgB,CAAC,UAAU;YAC/B,YAAY,OAAO,UAAU,GAAG;YAChC;yCAAO,IAAM,IAAI,mBAAmB,CAAC,UAAU;;QACjD;gCAAG,EAAE;IAEL,OAAO,CAAC,CAAC;AACX;GAhBgB"}},
    {"offset": {"line": 314, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/components/ui/sonner.tsx"],"sourcesContent":["\"use client\";\n\nimport { useTheme } from \"next-themes\";\nimport { Toaster as Sonner } from \"sonner\";\nimport { useIsMobile } from \"../../hooks/use-mobile\";\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>;\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme();\n  const isMobile = useIsMobile();\n\n  const getPositionProps = () => {\n    if (isMobile) {\n      return {\n        position: \"top-center\" as const,\n        offset: { top: 20 },\n      };\n    }\n    return {\n      position: \"bottom-right\" as const,\n      offset: { bottom: 140, right: 50 },\n    };\n  };\n\n  const positionProps = getPositionProps();\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      position={positionProps.position}\n      offset={positionProps.offset}\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  );\n};\n\nexport { Toaster };\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAQA,MAAM,UAAU,CAAC,EAAE,GAAG,OAAqB;;IACzC,MAAM,EAAE,QAAQ,QAAQ,EAAE,GAAG,IAAA,uSAAQ;IACrC,MAAM,WAAW,IAAA,wIAAW;IAE5B,MAAM,mBAAmB;QACvB,IAAI,UAAU;YACZ,OAAO;gBACL,UAAU;gBACV,QAAQ;oBAAE,KAAK;gBAAG;YACpB;QACF;QACA,OAAO;YACL,UAAU;YACV,QAAQ;gBAAE,QAAQ;gBAAK,OAAO;YAAG;QACnC;IACF;IAEA,MAAM,gBAAgB;IAEtB,qBACE,4YAAC,sRAAM;QACL,OAAO;QACP,WAAU;QACV,UAAU,cAAc,QAAQ;QAChC,QAAQ,cAAc,MAAM;QAC5B,cAAc;YACZ,YAAY;gBACV,OACE;gBACF,aAAa;gBACb,cACE;gBACF,cACE;YACJ;QACF;QACC,GAAG,KAAK;;;;;;AAGf;GAvCM;;QACyB,uSAAQ;QACpB,wIAAW;;;KAFxB"}},
    {"offset": {"line": 387, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/utils/todo-utils.ts"],"sourcesContent":["import type { Todo } from \"@/types\";\n\n/**\n * Efficiently merges new todos with existing ones.\n * Only creates a new array if there are actual changes to prevent unnecessary re-renders.\n *\n * @param currentTodos - The current array of todos\n * @param newTodos - The new todos to merge\n * @returns Updated todos array (same reference if no changes)\n */\nexport const mergeTodos = (\n  currentTodos: Todo[],\n  newTodos: ReadonlyArray<TodoLike>,\n): Todo[] => {\n  let hasChanges = false;\n  const updatedTodos = [...currentTodos];\n\n  for (const newTodo of newTodos) {\n    const existingIndex = updatedTodos.findIndex((t) => t.id === newTodo.id);\n\n    if (existingIndex >= 0) {\n      // Check if the todo actually changed\n      const existing = updatedTodos[existingIndex];\n      const merged: Todo = {\n        ...existing,\n        // Preserve existing fields when incoming values are undefined\n        content:\n          newTodo.content !== undefined ? newTodo.content : existing.content,\n        status: newTodo.status !== undefined ? newTodo.status : existing.status,\n        sourceMessageId:\n          newTodo.sourceMessageId !== undefined\n            ? newTodo.sourceMessageId\n            : existing.sourceMessageId,\n      };\n\n      if (\n        existing.content !== merged.content ||\n        existing.status !== merged.status ||\n        existing.sourceMessageId !== merged.sourceMessageId\n      ) {\n        updatedTodos[existingIndex] = merged;\n        hasChanges = true;\n      }\n    } else {\n      // Add new todo\n      if (isCompleteTodoLike(newTodo)) {\n        updatedTodos.push(newTodo);\n        hasChanges = true;\n      }\n    }\n  }\n\n  // Only return new array if there were actual changes\n  return hasChanges ? updatedTodos : currentTodos;\n};\n\n/**\n * Lightweight shape for tool payloads which may omit fields like content/status.\n */\nexport type TodoLike = {\n  id: string;\n  content?: string;\n  status?: Todo[\"status\"];\n  sourceMessageId?: string;\n};\n\n/**\n * Narrow a `TodoLike` to a full `Todo` by ensuring required fields exist.\n */\nconst isCompleteTodoLike = (candidate: TodoLike): candidate is Todo => {\n  return candidate.content !== undefined && candidate.status !== undefined;\n};\n\n/**\n * Returns true if any todo in the array is partial (missing content or status).\n */\nexport const hasPartialTodos = (\n  todos: Array<TodoLike> | undefined,\n): boolean => {\n  if (!Array.isArray(todos)) return false;\n  return todos.some((t) => t.content === undefined || t.status === undefined);\n};\n\n/**\n * Determines whether an incoming tool call should be treated as a merge.\n * If any todo is partial, or the merge flag is true, we merge.\n */\nexport const shouldTreatAsMerge = (\n  mergeFlag: boolean | undefined,\n  todos: Array<TodoLike> | undefined,\n): boolean => {\n  return Boolean(mergeFlag) || hasPartialTodos(todos);\n};\n\n/**\n * Compute new todos when replacing all assistant-generated todos with incoming ones,\n * while preserving manual todos. Optionally stamp incoming with a source message id.\n */\nexport const computeReplaceAssistantTodos = (\n  currentTodos: Todo[],\n  incoming: Todo[],\n  sourceMessageId?: string,\n): Todo[] => {\n  const manual = currentTodos.filter((t) => !t.sourceMessageId);\n  const stamped = sourceMessageId\n    ? incoming.map((t) => ({ ...t, sourceMessageId }))\n    : incoming;\n  return [...stamped, ...manual];\n};\n\n/**\n * Compute base todos for a request given existing stored todos and incoming todos.\n * - Non-temporary: use stored todos; on regenerate keep only manual todos.\n * - Temporary: rely on incoming todos.\n */\nexport const getBaseTodosForRequest = (\n  existingTodos: Todo[] | undefined,\n  incomingTodos: Todo[] | undefined,\n  opts: { isTemporary: boolean; regenerate?: boolean },\n): Todo[] => {\n  const existing: Todo[] = Array.isArray(existingTodos) ? existingTodos : [];\n  const incoming: Todo[] = Array.isArray(incomingTodos) ? incomingTodos : [];\n\n  if (opts.isTemporary) return incoming;\n  if (opts.regenerate) return existing.filter((t) => !t.sourceMessageId);\n  return existing;\n};\n\n/**\n * Checks if two todos are equal (same content and status)\n */\nexport const areTodosEqual = (todo1: Todo, todo2: Todo): boolean => {\n  return todo1.content === todo2.content && todo1.status === todo2.status;\n};\n\n/**\n * Gets todo statistics for display purposes\n */\nexport const getTodoStats = (todos: Todo[]) => {\n  const completed = todos.filter((t) => t.status === \"completed\").length;\n  const inProgress = todos.filter((t) => t.status === \"in_progress\").length;\n  const pending = todos.filter((t) => t.status === \"pending\").length;\n  const cancelled = todos.filter((t) => t.status === \"cancelled\").length;\n  const total = todos.length;\n  const done = completed + cancelled;\n\n  return {\n    completed,\n    inProgress,\n    pending,\n    cancelled,\n    total,\n    done,\n  };\n};\n\n/**\n * Remove all todos attributed to a given message id.\n */\nexport const removeTodosBySourceMessage = (\n  todos: Todo[],\n  messageId: string,\n): Todo[] => {\n  return todos.filter((t) => t.sourceMessageId !== messageId);\n};\n\n/**\n * Remove all todos attributed to any of the given message ids.\n */\nexport const removeTodosBySourceMessages = (\n  todos: Todo[],\n  messageIds: string[],\n): Todo[] => {\n  if (messageIds.length === 0) return todos;\n  const idSet = new Set(messageIds);\n  return todos.filter((t) => {\n    if (!t.sourceMessageId) return true;\n    // If the assistant id is in the set, drop the todo\n    if (idSet.has(t.sourceMessageId)) return false;\n    return true;\n  });\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 508, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/utils/sidebar-storage.ts"],"sourcesContent":["/**\n * Sidebar localStorage utilities\n * Handles persistent storage for sidebar state with mobile-aware behavior\n */\n\n// Storage keys for different sidebar contexts\nexport const STORAGE_KEYS = {\n  CHAT_SIDEBAR: \"chatSidebarOpen\",\n  MAIN_SIDEBAR: \"sidebar_state\",\n} as const;\n\ntype StorageKey = (typeof STORAGE_KEYS)[keyof typeof STORAGE_KEYS];\n\n/**\n * Safely gets the saved sidebar state from localStorage\n * @param isMobile - Whether the current device is mobile\n * @param storageKey - The localStorage key to use (defaults to CHAT_SIDEBAR)\n * @returns The saved sidebar state (false for mobile, localStorage value for desktop)\n */\nexport const getSavedSidebarState = (\n  isMobile: boolean,\n  storageKey: StorageKey = STORAGE_KEYS.CHAT_SIDEBAR,\n): boolean => {\n  if (isMobile || typeof window === \"undefined\") {\n    return false;\n  }\n\n  try {\n    const saved = localStorage.getItem(storageKey);\n    return saved ? JSON.parse(saved) : false;\n  } catch {\n    return false;\n  }\n};\n\n/**\n * Safely saves the sidebar state to localStorage\n * @param state - The sidebar state to save\n * @param isMobile - Whether the current device is mobile\n * @param storageKey - The localStorage key to use (defaults to CHAT_SIDEBAR)\n */\nexport const saveSidebarState = (\n  state: boolean,\n  isMobile: boolean,\n  storageKey: StorageKey = STORAGE_KEYS.CHAT_SIDEBAR,\n): void => {\n  if (!isMobile && typeof window !== \"undefined\") {\n    try {\n      localStorage.setItem(storageKey, JSON.stringify(state));\n    } catch {\n      // Silently fail in production environments\n      // This handles cases like:\n      // - Incognito mode\n      // - Storage quota exceeded\n      // - Storage disabled by user/browser policy\n    }\n  }\n};\n\n/**\n * Clears the sidebar state from localStorage\n * @param storageKey - The localStorage key to clear (defaults to CHAT_SIDEBAR)\n */\nexport const clearSidebarState = (\n  storageKey: StorageKey = STORAGE_KEYS.CHAT_SIDEBAR,\n): void => {\n  if (typeof window !== \"undefined\") {\n    try {\n      localStorage.removeItem(storageKey);\n    } catch {\n      // Silently fail in production\n    }\n  }\n};\n\n/**\n * Clears all sidebar states from localStorage\n * Useful for logout or complete reset operations\n */\nexport const clearAllSidebarStates = (): void => {\n  Object.values(STORAGE_KEYS).forEach((key) => {\n    clearSidebarState(key);\n  });\n};\n\n/**\n * Creates sidebar storage utilities for a specific context\n * @param storageKey - The storage key to use\n * @returns Object with get, save, and clear functions for the specific context\n */\nexport const createSidebarStorage = (storageKey: StorageKey) => ({\n  get: (isMobile: boolean) => getSavedSidebarState(isMobile, storageKey),\n  save: (state: boolean, isMobile: boolean) =>\n    saveSidebarState(state, isMobile, storageKey),\n  clear: () => clearSidebarState(storageKey),\n});\n\n// Pre-configured storage utilities for common use cases\nexport const chatSidebarStorage = createSidebarStorage(\n  STORAGE_KEYS.CHAT_SIDEBAR,\n);\nexport const mainSidebarStorage = createSidebarStorage(\n  STORAGE_KEYS.MAIN_SIDEBAR,\n);\n"],"names":[],"mappings":"AAAA;;;CAGC,GAED,8CAA8C;;;;;;;;;;;;;;;;;;;AACvC,MAAM,eAAe;IAC1B,cAAc;IACd,cAAc;AAChB;AAUO,MAAM,uBAAuB,CAClC,UACA,aAAyB,aAAa,YAAY;IAElD,IAAI,YAAY,+CAAkB,aAAa;QAC7C,OAAO;IACT;IAEA,IAAI;QACF,MAAM,QAAQ,aAAa,OAAO,CAAC;QACnC,OAAO,QAAQ,KAAK,KAAK,CAAC,SAAS;IACrC,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAQO,MAAM,mBAAmB,CAC9B,OACA,UACA,aAAyB,aAAa,YAAY;IAElD,IAAI,CAAC,YAAY,+CAAkB,aAAa;QAC9C,IAAI;YACF,aAAa,OAAO,CAAC,YAAY,KAAK,SAAS,CAAC;QAClD,EAAE,OAAM;QACN,2CAA2C;QAC3C,2BAA2B;QAC3B,mBAAmB;QACnB,2BAA2B;QAC3B,4CAA4C;QAC9C;IACF;AACF;AAMO,MAAM,oBAAoB,CAC/B,aAAyB,aAAa,YAAY;IAElD,wCAAmC;QACjC,IAAI;YACF,aAAa,UAAU,CAAC;QAC1B,EAAE,OAAM;QACN,8BAA8B;QAChC;IACF;AACF;AAMO,MAAM,wBAAwB;IACnC,OAAO,MAAM,CAAC,cAAc,OAAO,CAAC,CAAC;QACnC,kBAAkB;IACpB;AACF;AAOO,MAAM,uBAAuB,CAAC,aAA2B,CAAC;QAC/D,KAAK,CAAC,WAAsB,qBAAqB,UAAU;QAC3D,MAAM,CAAC,OAAgB,WACrB,iBAAiB,OAAO,UAAU;QACpC,OAAO,IAAM,kBAAkB;IACjC,CAAC;AAGM,MAAM,qBAAqB,qBAChC,aAAa,YAAY;AAEpB,MAAM,qBAAqB,qBAChC,aAAa,YAAY"}},
    {"offset": {"line": 586, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/utils/client-storage.ts"],"sourcesContent":["export type ConversationDraft = {\n  id: string;\n  content: string;\n  timestamp: number;\n};\n\nexport type ConversationDraftStore = {\n  drafts: Array<ConversationDraft>;\n  userId?: string;\n};\n\nexport const CONVERSATION_DRAFTS_STORAGE_KEY = \"conversation_drafts\";\nexport const NULL_THREAD_DRAFT_ID = \"null_thread\";\nexport const CHAT_MODE_STORAGE_KEY = \"chat_mode\";\n\nconst isBrowser = (): boolean => typeof window !== \"undefined\";\n\nexport const readDraftStore = (): ConversationDraftStore => {\n  if (!isBrowser()) return { drafts: [] };\n  try {\n    const raw = window.localStorage.getItem(CONVERSATION_DRAFTS_STORAGE_KEY);\n    if (!raw) return { drafts: [] };\n    const parsed = JSON.parse(raw);\n    const drafts = Array.isArray(parsed?.drafts) ? parsed.drafts : [];\n    const userId =\n      typeof parsed?.userId === \"string\" ? parsed.userId : undefined;\n    return { drafts, userId };\n  } catch {\n    return { drafts: [] };\n  }\n};\n\nexport const writeDraftStore = (store: ConversationDraftStore): void => {\n  if (!isBrowser()) return;\n  try {\n    window.localStorage.setItem(\n      CONVERSATION_DRAFTS_STORAGE_KEY,\n      JSON.stringify({ drafts: store.drafts, userId: store.userId }),\n    );\n  } catch {\n    // ignore\n  }\n};\n\nexport const readChatMode = (): \"ask\" | \"agent\" | null => {\n  if (!isBrowser()) return null;\n  try {\n    const raw = window.localStorage.getItem(CHAT_MODE_STORAGE_KEY);\n    if (raw === \"ask\" || raw === \"agent\") return raw;\n    return null;\n  } catch {\n    return null;\n  }\n};\n\nexport const writeChatMode = (mode: \"ask\" | \"agent\"): void => {\n  if (!isBrowser()) return;\n  try {\n    window.localStorage.setItem(CHAT_MODE_STORAGE_KEY, mode);\n  } catch {\n    // ignore\n  }\n};\n\nexport const getDraftContentById = (id: string): string | null => {\n  const store = readDraftStore();\n  const entry = store.drafts.find((d) => d.id === id);\n  return entry ? entry.content : null;\n};\n\nexport const upsertDraft = (\n  id: string,\n  content: string,\n  timestamp?: number,\n): void => {\n  const store = readDraftStore();\n  const idx = store.drafts.findIndex((d) => d.id === id);\n  const entry: ConversationDraft = {\n    id,\n    content,\n    timestamp: typeof timestamp === \"number\" ? timestamp : Date.now(),\n  };\n  if (idx >= 0) {\n    store.drafts[idx] = entry;\n  } else {\n    store.drafts.push(entry);\n  }\n  writeDraftStore(store);\n};\n\nexport const removeDraft = (id: string): void => {\n  const store = readDraftStore();\n  const nextDrafts = store.drafts.filter((d) => d.id !== id);\n  writeDraftStore({ ...store, drafts: nextDrafts });\n};\n\nexport const getDrafts = (): Array<ConversationDraft> =>\n  readDraftStore().drafts;\n\nexport const getUserIdFromDrafts = (): string | undefined =>\n  readDraftStore().userId;\n\nexport const setUserIdInDrafts = (userId: string): void => {\n  const store = readDraftStore();\n  writeDraftStore({ ...store, userId });\n};\n\nexport const clearAllDrafts = (): void => {\n  if (!isBrowser()) return;\n  try {\n    window.localStorage.removeItem(CONVERSATION_DRAFTS_STORAGE_KEY);\n  } catch {\n    // ignore\n  }\n};\n\n/**\n * Removes drafts older than 7 days\n * Called on app initialization to prevent localStorage bloat\n */\nexport const cleanupExpiredDrafts = (): void => {\n  if (!isBrowser()) return;\n\n  try {\n    const store = readDraftStore();\n    const now = Date.now();\n    const SEVEN_DAYS_MS = 7 * 24 * 60 * 60 * 1000;\n\n    // Filter out drafts older than 7 days\n    const validDrafts = store.drafts.filter((draft) => {\n      const age = now - draft.timestamp;\n      return age < SEVEN_DAYS_MS;\n    });\n\n    // Only write if we actually removed drafts (avoid unnecessary writes)\n    if (validDrafts.length !== store.drafts.length) {\n      writeDraftStore({ ...store, drafts: validDrafts });\n      console.log(\n        `[Draft Cleanup] Removed ${store.drafts.length - validDrafts.length} expired drafts`,\n      );\n    }\n  } catch (error) {\n    // Silently fail - cleanup is not critical\n    console.warn(\"[Draft Cleanup] Failed to cleanup expired drafts:\", error);\n  }\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 753, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/contexts/GlobalState.tsx"],"sourcesContent":["\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useState,\n  useCallback,\n  useEffect,\n  useRef,\n  ReactNode,\n} from \"react\";\nimport type {\n  ChatMode,\n  SidebarContent,\n  QueuedMessage,\n  QueueBehavior,\n  SandboxPreference,\n} from \"@/types/chat\";\nimport type { Todo } from \"@/types\";\nimport {\n  mergeTodos as mergeTodosUtil,\n  computeReplaceAssistantTodos,\n} from \"@/lib/utils/todo-utils\";\nimport type { UploadedFileState } from \"@/types/file\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { chatSidebarStorage } from \"@/lib/utils/sidebar-storage\";\nimport type { SubscriptionTier } from \"@/types\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { toast } from \"sonner\";\nimport {\n  readChatMode,\n  writeChatMode,\n  cleanupExpiredDrafts,\n} from \"@/lib/utils/client-storage\";\n\ntype Id<T extends string> = string;\ntype Doc<T extends string> = any;\n\ninterface GlobalStateType {\n  // Input state\n  input: string;\n  setInput: (value: string) => void;\n  user: { id: string; email: string };\n\n  // File upload state\n  uploadedFiles: UploadedFileState[];\n  setUploadedFiles: (files: UploadedFileState[]) => void;\n  addUploadedFile: (file: UploadedFileState) => void;\n  removeUploadedFile: (index: number) => void;\n  updateUploadedFile: (\n    index: number,\n    updates: Partial<UploadedFileState>,\n  ) => void;\n\n  // Token tracking function\n  getTotalTokens: () => number;\n\n  // File upload status tracking\n  isUploadingFiles: boolean;\n\n  // Chat mode state\n  chatMode: ChatMode;\n  setChatMode: (mode: ChatMode) => void;\n\n  // Chat title state\n  chatTitle: string | null;\n  setChatTitle: (title: string | null) => void;\n\n  // Current chat ID state\n  currentChatId: string | null;\n  setCurrentChatId: (chatId: string | null) => void;\n\n  // User chats state\n  chats: Doc<\"chats\">[];\n  setChats: (chats: Doc<\"chats\">[]) => void;\n\n  // Chat switching state\n  isSwitchingChats: boolean;\n  setIsSwitchingChats: (switching: boolean) => void;\n\n  // Computer sidebar state (right side)\n  sidebarOpen: boolean;\n  setSidebarOpen: (open: boolean) => void;\n  sidebarContent: SidebarContent | null;\n  setSidebarContent: (content: SidebarContent | null) => void;\n\n  // Chat sidebar state (left side)\n  chatSidebarOpen: boolean;\n  setChatSidebarOpen: (open: boolean) => void;\n\n  // Todos state\n  todos: Todo[];\n  setTodos: (todos: Todo[]) => void;\n  mergeTodos: (todos: Todo[]) => void;\n  replaceAssistantTodos: (todos: Todo[], sourceMessageId?: string) => void;\n\n  // UI state\n  isTodoPanelExpanded: boolean;\n  setIsTodoPanelExpanded: (expanded: boolean) => void;\n\n  // Subscription state\n  subscription: SubscriptionTier;\n  isCheckingProPlan: boolean;\n\n  // Rate limit warning dismissal state\n  hasUserDismissedRateLimitWarning: boolean;\n  setHasUserDismissedRateLimitWarning: (dismissed: boolean) => void;\n\n  // Message queue state (for Agent mode)\n  messageQueue: QueuedMessage[];\n  queueMessage: (\n    text: string,\n    files?: Array<{ file: File; fileId: Id<\"files\">; url: string }>,\n  ) => void;\n  removeQueuedMessage: (id: string) => void;\n  clearQueue: () => void;\n  dequeueNext: () => QueuedMessage | null;\n\n  // Queue behavior preference\n  queueBehavior: QueueBehavior;\n  setQueueBehavior: (behavior: QueueBehavior) => void;\n\n  // Sandbox preference (for Agent mode)\n  sandboxPreference: SandboxPreference;\n  setSandboxPreference: (preference: SandboxPreference) => void;\n\n  // Utility methods\n  clearInput: () => void;\n  clearUploadedFiles: () => void;\n  openSidebar: (content: SidebarContent) => void;\n  updateSidebarContent: (updates: Partial<SidebarContent>) => void;\n  closeSidebar: () => void;\n  toggleChatSidebar: () => void;\n  initializeChat: (chatId: string, fromRoute?: boolean) => void;\n  initializeNewChat: () => void;\n  activateChat: (chatId: string) => void;\n\n  // Temporary chats preference\n  temporaryChatsEnabled: boolean;\n  setTemporaryChatsEnabled: (enabled: boolean) => void;\n\n  // Team pricing dialog state\n  teamPricingDialogOpen: boolean;\n  setTeamPricingDialogOpen: (open: boolean) => void;\n\n  // Team welcome dialog state\n  teamWelcomeDialogOpen: boolean;\n  setTeamWelcomeDialogOpen: (open: boolean) => void;\n\n  // PentestGPT migration confirm dialog state\n  migrateFromPentestgptDialogOpen: boolean;\n  setMigrateFromPentestgptDialogOpen: (open: boolean) => void;\n\n  // Register a chat reset function that will be invoked on initializeNewChat\n  setChatReset: (fn: (() => void) | null) => void;\n  selectedModel: string;\n  setSelectedModel: (model: string) => void;\n  customSystemPrompt: string;\n  setCustomSystemPrompt: (prompt: string) => void;\n}\n\nconst GlobalStateContext = createContext<GlobalStateType | undefined>(\n  undefined,\n);\n\ninterface GlobalStateProviderProps {\n  children: ReactNode;\n}\n\nexport const GlobalStateProvider: React.FC<GlobalStateProviderProps> = ({\n  children,\n}) => {\n  const isMobile = useIsMobile();\n  const prevIsMobile = useRef(isMobile);\n  const [input, setInput] = useState(\"\");\n  const [uploadedFiles, setUploadedFiles] = useState<UploadedFileState[]>([]);\n  const [chatMode, setChatMode] = useState<ChatMode>(() => {\n    const saved = readChatMode();\n    return saved === \"ask\" || saved === \"agent\" ? saved : \"ask\";\n  });\n  const [chatTitle, setChatTitle] = useState<string | null>(null);\n  const [currentChatId, setCurrentChatId] = useState<string | null>(null);\n  const [isSwitchingChats, setIsSwitchingChats] = useState(false);\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const [sidebarContent, setSidebarContent] = useState<SidebarContent | null>(\n    null,\n  );\n\n  const [chatSidebarOpen, setChatSidebarOpen] = useState(() =>\n    chatSidebarStorage.get(isMobile),\n  );\n  const [todos, setTodos] = useState<Todo[]>([]);\n  const [isTodoPanelExpanded, setIsTodoPanelExpanded] = useState(false);\n  const [chats, setChats] = useState<any[]>([]);\n  const [subscription] = useState<SubscriptionTier>(\"ultra\");\n  const [isCheckingProPlan] = useState(false);\n  const chatResetRef = useRef<(() => void) | null>(null);\n\n  const user = { \n    id: \"default-user\", \n    email: \"user@example.com\",\n    firstName: \"Default\",\n    lastName: \"User\",\n    profilePictureUrl: null\n  };\n\n  const [\n    hasUserDismissedRateLimitWarning,\n    setHasUserDismissedRateLimitWarning,\n  ] = useState(false);\n\n  const [messageQueue, setMessageQueue] = useState<QueuedMessage[]>([]);\n\n  const [queueBehavior, setQueueBehaviorState] = useState<QueueBehavior>(() => {\n    if (typeof window === \"undefined\") return \"queue\";\n    const saved = localStorage.getItem(\"queue-behavior\");\n    return (saved === \"queue\" || saved === \"stop-and-send\") ? saved : \"queue\";\n  });\n\n  const [sandboxPreference, setSandboxPreferenceState] =\n    useState<SandboxPreference>(() => {\n      if (typeof window === \"undefined\") return \"e2b\";\n      return (localStorage.getItem(\"sandbox-preference\") as SandboxPreference) || \"e2b\";\n    });\n\n  const [temporaryChatsEnabled, setTemporaryChatsEnabledState] = useState(false);\n  const [teamPricingDialogOpen, setTeamPricingDialogOpen] = useState(false);\n  const [teamWelcomeDialogOpen, setTeamWelcomeDialogOpenState] = useState(false);\n  const [migrateFromPentestgptDialogOpen, setMigrateFromPentestgptDialogOpenState] = useState(false);\n\n  const [selectedModel, setSelectedModel] = useState(\"gpt-5.2-pro-2025-12-11\");\n  const [customSystemPrompt, setCustomSystemPrompt] = useState(\"\");\n\n  const mergeTodos = useCallback((newTodos: Todo[]) => {\n    setTodos((currentTodos) => mergeTodosUtil(currentTodos, newTodos));\n  }, []);\n\n  const replaceAssistantTodos = useCallback(\n    (incoming: Todo[], sourceMessageId?: string) => {\n      setTodos((current) =>\n        computeReplaceAssistantTodos(current, incoming, sourceMessageId),\n      );\n    },\n    [],\n  );\n\n  const getTotalTokens = useCallback((): number => {\n    return uploadedFiles.reduce((total, file) => {\n      return file.tokens ? total + file.tokens : total;\n    }, 0);\n  }, [uploadedFiles]);\n\n  const isUploadingFiles = uploadedFiles.some(\n    (file) => file.uploading || file.error,\n  );\n\n  const addUploadedFile = useCallback((file: UploadedFileState) => {\n    setUploadedFiles((prev) => [...prev, file]);\n  }, []);\n\n  const removeUploadedFile = useCallback((index: number) => {\n    setUploadedFiles((prev) => prev.filter((_, i) => i !== index));\n  }, []);\n\n  const updateUploadedFile = useCallback(\n    (index: number, updates: Partial<UploadedFileState>) => {\n      setUploadedFiles((prev) =>\n        prev.map((file, i) => (i === index ? { ...file, ...updates } : file)),\n      );\n    },\n    [],\n  );\n\n  const queueMessage = useCallback(\n    (\n      text: string,\n      files?: Array<{ file: File; fileId: string; url: string }>,\n    ) => {\n      setMessageQueue((prev) => {\n        if (prev.length >= 10) {\n          toast.error(\"Queue is full\");\n          return prev;\n        }\n        const newMessage: QueuedMessage = {\n          id: uuidv4() as any,\n          text,\n          files: files as any,\n          timestamp: Date.now(),\n        };\n        return [...prev, newMessage];\n      });\n    },\n    [],\n  );\n\n  const removeQueuedMessage = useCallback((id: string) => {\n    setMessageQueue((prev) => prev.filter((msg) => msg.id !== id));\n  }, []);\n\n  const clearQueue = useCallback(() => setMessageQueue([]), []);\n\n  const dequeueNext = useCallback((): QueuedMessage | null => {\n    let nextMessage: QueuedMessage | null = null;\n    setMessageQueue((prev) => {\n      if (prev.length === 0) return prev;\n      nextMessage = prev[0];\n      return prev.slice(1);\n    });\n    return nextMessage;\n  }, []);\n\n  const initializeChat = useCallback((chatId: string) => {\n    setIsSwitchingChats(true);\n    setCurrentChatId(chatId);\n    setTodos([]);\n    setIsTodoPanelExpanded(false);\n  }, []);\n\n  const initializeNewChat = useCallback(() => {\n    if (chatResetRef.current) chatResetRef.current();\n    setCurrentChatId(null);\n    setTodos([]);\n    setIsTodoPanelExpanded(false);\n    setChatTitle(null);\n  }, []);\n\n  const setChatReset = useCallback((fn: (() => void) | null) => {\n    chatResetRef.current = fn;\n  }, []);\n\n  const activateChat = useCallback((chatId: string) => {\n    setCurrentChatId(chatId);\n  }, []);\n\n  const openSidebar = (content: SidebarContent) => {\n    setSidebarContent(content);\n    setSidebarOpen(true);\n  };\n\n  const updateSidebarContent = (updates: Partial<SidebarContent>) => {\n    setSidebarContent((current) => current ? { ...current, ...updates } : current);\n  };\n\n  const closeSidebar = () => {\n    setSidebarOpen(false);\n    setSidebarContent(null);\n  };\n\n  const toggleChatSidebar = () => setChatSidebarOpen((prev: boolean) => !prev);\n\n  const value: GlobalStateType = {\n    input, setInput,\n    uploadedFiles, setUploadedFiles, addUploadedFile, removeUploadedFile, updateUploadedFile,\n    getTotalTokens, isUploadingFiles,\n    chatMode, setChatMode,\n    chatTitle, setChatTitle,\n    currentChatId, setCurrentChatId,\n    chats, setChats,\n    isSwitchingChats, setIsSwitchingChats,\n    sidebarOpen, setSidebarOpen, sidebarContent, setSidebarContent,\n    chatSidebarOpen, setChatSidebarOpen,\n    todos, setTodos, mergeTodos, replaceAssistantTodos,\n    isTodoPanelExpanded, setIsTodoPanelExpanded,\n    subscription, isCheckingProPlan,\n    hasUserDismissedRateLimitWarning, setHasUserDismissedRateLimitWarning,\n    messageQueue, queueMessage, removeQueuedMessage, clearQueue, dequeueNext,\n    queueBehavior, setQueueBehavior: setQueueBehaviorState,\n    sandboxPreference, setSandboxPreference: setSandboxPreferenceState,\n    clearInput: () => setInput(\"\"),\n    clearUploadedFiles: () => setUploadedFiles([]),\n    openSidebar, updateSidebarContent, closeSidebar, toggleChatSidebar,\n    initializeChat, initializeNewChat, activateChat,\n    temporaryChatsEnabled, setTemporaryChatsEnabled: setTemporaryChatsEnabledState,\n    teamPricingDialogOpen, setTeamPricingDialogOpen,\n    teamWelcomeDialogOpen, setTeamWelcomeDialogOpen: setTeamWelcomeDialogOpenState,\n    migrateFromPentestgptDialogOpen, setMigrateFromPentestgptDialogOpen: setMigrateFromPentestgptDialogOpenState,\n    setChatReset,\n    selectedModel, setSelectedModel,\n    customSystemPrompt, setCustomSystemPrompt,\n    user,\n  };\n\n  return (\n    <GlobalStateContext.Provider value={value}>\n      {children}\n    </GlobalStateContext.Provider>\n  );\n};\n\nexport const useGlobalState = () => {\n  const context = useContext(GlobalStateContext);\n  if (context === undefined) {\n    throw new Error(\"useGlobalState must be used within a GlobalStateProvider\");\n  }\n  return context;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1082, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/utils/todo-block-manager.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback } from \"react\";\n\ninterface TodoBlockState {\n  autoId: string | null;\n  manualIds: string[];\n}\n\ninterface TodoBlockManager {\n  messageTodoOpen: Record<string, TodoBlockState>;\n  autoOpenTodoBlock: (messageId: string, blockId: string) => void;\n  toggleTodoBlock: (messageId: string, blockId: string) => void;\n  isBlockExpanded: (messageId: string, blockId: string) => boolean;\n}\n\nexport const useTodoBlockManager = (): TodoBlockManager => {\n  const [messageTodoOpen, setMessageTodoOpen] = useState<\n    Record<string, TodoBlockState>\n  >({});\n\n  const autoOpenTodoBlock = useCallback(\n    (messageId: string, blockId: string) => {\n      setMessageTodoOpen((prev) => {\n        const current = prev[messageId] || { autoId: null, manualIds: [] };\n        if (current.autoId === blockId) {\n          return prev; // no change\n        }\n        // Only the latest autoId stays open automatically. Manual opens persist.\n        return {\n          ...prev,\n          [messageId]: { autoId: blockId, manualIds: current.manualIds },\n        };\n      });\n    },\n    [],\n  );\n\n  const toggleTodoBlock = useCallback((messageId: string, blockId: string) => {\n    setMessageTodoOpen((prev) => {\n      const current = prev[messageId] || { autoId: null, manualIds: [] };\n      const isManual = current.manualIds.includes(blockId);\n      const isAuto = current.autoId === blockId;\n\n      if (isManual) {\n        // Remove from manual list\n        const nextManual = current.manualIds.filter((id) => id !== blockId);\n        return {\n          ...prev,\n          [messageId]: { autoId: current.autoId, manualIds: nextManual },\n        };\n      } else if (isAuto) {\n        // Close auto-opened block by clearing autoId\n        return {\n          ...prev,\n          [messageId]: { autoId: null, manualIds: current.manualIds },\n        };\n      } else {\n        // Add to manual list\n        const nextManual = [...current.manualIds, blockId];\n        return {\n          ...prev,\n          [messageId]: { autoId: current.autoId, manualIds: nextManual },\n        };\n      }\n    });\n  }, []);\n\n  const isBlockExpanded = useCallback(\n    (messageId: string, blockId: string): boolean => {\n      const stateForMessage = messageTodoOpen[messageId] || {\n        autoId: null,\n        manualIds: [],\n      };\n      return (\n        stateForMessage.autoId === blockId ||\n        stateForMessage.manualIds.includes(blockId)\n      );\n    },\n    [messageTodoOpen],\n  );\n\n  return {\n    messageTodoOpen,\n    autoOpenTodoBlock,\n    toggleTodoBlock,\n    isBlockExpanded,\n  };\n};\n"],"names":[],"mappings":";;;;AAEA;;AAFA;;AAgBO,MAAM,sBAAsB;;IACjC,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,wXAAQ,EAEpD,CAAC;IAEH,MAAM,oBAAoB,IAAA,2XAAW;8DACnC,CAAC,WAAmB;YAClB;sEAAmB,CAAC;oBAClB,MAAM,UAAU,IAAI,CAAC,UAAU,IAAI;wBAAE,QAAQ;wBAAM,WAAW,EAAE;oBAAC;oBACjE,IAAI,QAAQ,MAAM,KAAK,SAAS;wBAC9B,OAAO,MAAM,YAAY;oBAC3B;oBACA,yEAAyE;oBACzE,OAAO;wBACL,GAAG,IAAI;wBACP,CAAC,UAAU,EAAE;4BAAE,QAAQ;4BAAS,WAAW,QAAQ,SAAS;wBAAC;oBAC/D;gBACF;;QACF;6DACA,EAAE;IAGJ,MAAM,kBAAkB,IAAA,2XAAW;4DAAC,CAAC,WAAmB;YACtD;oEAAmB,CAAC;oBAClB,MAAM,UAAU,IAAI,CAAC,UAAU,IAAI;wBAAE,QAAQ;wBAAM,WAAW,EAAE;oBAAC;oBACjE,MAAM,WAAW,QAAQ,SAAS,CAAC,QAAQ,CAAC;oBAC5C,MAAM,SAAS,QAAQ,MAAM,KAAK;oBAElC,IAAI,UAAU;wBACZ,0BAA0B;wBAC1B,MAAM,aAAa,QAAQ,SAAS,CAAC,MAAM;2FAAC,CAAC,KAAO,OAAO;;wBAC3D,OAAO;4BACL,GAAG,IAAI;4BACP,CAAC,UAAU,EAAE;gCAAE,QAAQ,QAAQ,MAAM;gCAAE,WAAW;4BAAW;wBAC/D;oBACF,OAAO,IAAI,QAAQ;wBACjB,6CAA6C;wBAC7C,OAAO;4BACL,GAAG,IAAI;4BACP,CAAC,UAAU,EAAE;gCAAE,QAAQ;gCAAM,WAAW,QAAQ,SAAS;4BAAC;wBAC5D;oBACF,OAAO;wBACL,qBAAqB;wBACrB,MAAM,aAAa;+BAAI,QAAQ,SAAS;4BAAE;yBAAQ;wBAClD,OAAO;4BACL,GAAG,IAAI;4BACP,CAAC,UAAU,EAAE;gCAAE,QAAQ,QAAQ,MAAM;gCAAE,WAAW;4BAAW;wBAC/D;oBACF;gBACF;;QACF;2DAAG,EAAE;IAEL,MAAM,kBAAkB,IAAA,2XAAW;4DACjC,CAAC,WAAmB;YAClB,MAAM,kBAAkB,eAAe,CAAC,UAAU,IAAI;gBACpD,QAAQ;gBACR,WAAW,EAAE;YACf;YACA,OACE,gBAAgB,MAAM,KAAK,WAC3B,gBAAgB,SAAS,CAAC,QAAQ,CAAC;QAEvC;2DACA;QAAC;KAAgB;IAGnB,OAAO;QACL;QACA;QACA;QACA;IACF;AACF;GAxEa"}},
    {"offset": {"line": 1191, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/contexts/TodoBlockContext.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { createContext, useContext, ReactNode, useMemo } from \"react\";\nimport { useTodoBlockManager } from \"@/lib/utils/todo-block-manager\";\n\ninterface TodoBlockContextType {\n  autoOpenTodoBlock: (messageId: string, blockId: string) => void;\n  toggleTodoBlock: (messageId: string, blockId: string) => void;\n  isBlockExpanded: (messageId: string, blockId: string) => boolean;\n}\n\nconst TodoBlockContext = createContext<TodoBlockContextType | undefined>(\n  undefined,\n);\n\ninterface TodoBlockProviderProps {\n  children: ReactNode;\n}\n\nexport const TodoBlockProvider: React.FC<TodoBlockProviderProps> = ({\n  children,\n}) => {\n  const { autoOpenTodoBlock, toggleTodoBlock, isBlockExpanded } =\n    useTodoBlockManager();\n\n  const value: TodoBlockContextType = useMemo(\n    () => ({\n      autoOpenTodoBlock,\n      toggleTodoBlock,\n      isBlockExpanded,\n    }),\n    [autoOpenTodoBlock, toggleTodoBlock, isBlockExpanded],\n  );\n\n  return (\n    <TodoBlockContext.Provider value={value}>\n      {children}\n    </TodoBlockContext.Provider>\n  );\n};\n\nexport const useTodoBlockContext = (): TodoBlockContextType => {\n  const context = useContext(TodoBlockContext);\n  if (context === undefined) {\n    throw new Error(\n      \"useTodoBlockContext must be used within a TodoBlockProvider\",\n    );\n  }\n  return context;\n};\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;AAHA;;;AAWA,MAAM,iCAAmB,IAAA,6XAAa,EACpC;AAOK,MAAM,oBAAsD,CAAC,EAClE,QAAQ,EACT;;IACC,MAAM,EAAE,iBAAiB,EAAE,eAAe,EAAE,eAAe,EAAE,GAC3D,IAAA,kKAAmB;IAErB,MAAM,QAA8B,IAAA,uXAAO;4CACzC,IAAM,CAAC;gBACL;gBACA;gBACA;YACF,CAAC;2CACD;QAAC;QAAmB;QAAiB;KAAgB;IAGvD,qBACE,4YAAC,iBAAiB,QAAQ;QAAC,OAAO;kBAC/B;;;;;;AAGP;GApBa;;QAIT,kKAAmB;;;KAJV;AAsBN,MAAM,sBAAsB;;IACjC,MAAM,UAAU,IAAA,0XAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MACR;IAEJ;IACA,OAAO;AACT;IARa"}},
    {"offset": {"line": 1253, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/components/DataStreamProvider.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { createContext, useContext, useMemo, useState } from \"react\";\nimport type { DataUIPart } from \"ai\";\n\ninterface DataStreamContextValue {\n  dataStream: DataUIPart<any>[];\n  setDataStream: React.Dispatch<React.SetStateAction<DataUIPart<any>[]>>;\n  isAutoResuming: boolean;\n  setIsAutoResuming: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nconst DataStreamContext = createContext<DataStreamContextValue | null>(null);\n\nexport function DataStreamProvider({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const [dataStream, setDataStream] = useState<DataUIPart<any>[]>([]);\n  const [isAutoResuming, setIsAutoResuming] = useState<boolean>(false);\n\n  const value = useMemo(\n    () => ({\n      dataStream,\n      setDataStream,\n      isAutoResuming,\n      setIsAutoResuming,\n    }),\n    [dataStream, isAutoResuming],\n  );\n\n  return (\n    <DataStreamContext.Provider value={value}>\n      {children}\n    </DataStreamContext.Provider>\n  );\n}\n\nexport function useDataStream() {\n  const context = useContext(DataStreamContext);\n  if (!context) {\n    throw new Error(\"useDataStream must be used within a DataStreamProvider\");\n  }\n  return context;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;;;AAFA;;AAYA,MAAM,kCAAoB,IAAA,6XAAa,EAAgC;AAEhE,SAAS,mBAAmB,EACjC,QAAQ,EAGT;;IACC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,wXAAQ,EAAoB,EAAE;IAClE,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,wXAAQ,EAAU;IAE9D,MAAM,QAAQ,IAAA,uXAAO;6CACnB,IAAM,CAAC;gBACL;gBACA;gBACA;gBACA;YACF,CAAC;4CACD;QAAC;QAAY;KAAe;IAG9B,qBACE,4YAAC,kBAAkB,QAAQ;QAAC,OAAO;kBAChC;;;;;;AAGP;GAvBgB;KAAA;AAyBT,SAAS;;IACd,MAAM,UAAU,IAAA,0XAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANgB"}}]
}